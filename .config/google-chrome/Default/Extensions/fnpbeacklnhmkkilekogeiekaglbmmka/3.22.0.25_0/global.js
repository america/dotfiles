var guid;!function(e){"use strict";(e.NSSS=e.NSSS||{}).chromeGlobal=function(o,s){var a={},r=o.logger,c=(o.utils,o.settings,s.helperUtils),d=s.uiHelper,e=s.nfmEvents,t=o.utils.isNil,S=o.utils.isntNil,n=s.constants,i=(s.globalSettings,s.webProtection),E=(s.wpsHelperUtils,o.localizer),R=(s.uiConstants.MESSAGES,o.extensionAdapter);s.uiConstants.BLOCKPAGE.TYPE;let u=s.NSSSHelper;const l=o.constants.BROWSER_TYPE,g=s.uiConstants;var T=SafeWeb.Rating.SITE_RATING;const m=s.telemetryWrapper;return a.THREE_IN_ONE_EXTENSION=!1,a.updatePopoverUI=function(l){R.getActiveTab(async function(e){var a,t,n,i=R.getLastError();S(i)?(r.log("Tab is not available"),r.log(i)):(i=R.getTabID(e),t=await s.extensionURLValidator.isNortonExtensionURL(e.url),a=o.localizer.getCurrentLanguageDirection(),n=u.isBlockPage(e.url),t&&!n?(t=null,t={annoyanceThreats:0,computerThreats:0,identityThreats:0,rating:1,ratingText:o.localizer.getLocalizedString("Safe"),showSafeWebSearchbox:!1,sitename:e.url,totalThreats:0},n=s.main.popoverWindowStrings(1),l({popoverStrings:n,uiStatus:t,showReportSite:!1,showFullReport:!1,direction:a})):(n=c.getSessionIDForTabID(i),(i=(t=d.uiStatusForSessionID(n,e.url)).uiStatus).customizedRating=s.chromeGlobal._getSiteRating(t.siteRating),n=s.main.popoverWindowStrings(i.rating,t.siteRating),e=t.showFullReport,l({popoverStrings:n,uiStatus:i,showReportSite:!1,showFullReport:e,direction:a})))})},a._getSiteRating=a=>{if(!t(a)){let e=null;switch(a){case T.SW_REGIONAL_BLOCK:e="suspiciousRegionBlock";break;case n.FORMJACK_PROTECTION.SITE_RATING.FORMJACK_STATE:e="formjackProtection"}return e}},a.downloadURLAnalyzedCallback=function(a,e,t){var n=t.getRating();if(S(n.redirectPage)){chrome.downloads.cancel(a),chrome.downloads.removeFile(a);chrome.downloads.erase({id:a});var a=E.getLocalizedString("Malicious Download Detected"),i=E.getLocalizedString("Download Cancelled"),l=E.getLocalizedString("OK"),i=new o.QuestionNotification(i,{},l,()=>{},"content/images/icon-downloadblocked.png",a);o.notificationCenter.addNotification(i);let e=!1;S(t._safeWebResult)&&S(t._safeWebResult.finalRedirectedTabUrl)&&(e=c.isRatingForFinalRedirectedUrl(t._safeWebResult));l=s.main.getParentUrlForDownloadBlock(n.url);m.sendDownloadBlockTelemetry(n.url,e,l)}},a.initialize=function(){!s.isFreshInstall&&s.NSSSHelper._resolveOnUrlParamsSet&&s.NSSSHelper._resolveOnUrlParamsSet(),R.isManifestV3Extension()&&!0===a.THREE_IN_ONE_EXTENSION&&(c.handleOmniSearch(),chrome.webRequest.onBeforeRequest.addListener(s.NSSSHelper.handleOmniSearchMv3,{urls:[s.constants.SEARCH_URL+"?omnisearch=yes*"]})),i.registerEventCallback(e.PAGE_ANALYZED,s.main.pageAnalyzedCallback),i.registerEventCallback(e.SEARCH_URLS_ANALYZED,s.main.searchURLsAnalyzedCallback),o.globals.BROWSER===o.constants.BROWSER_TYPE.FIREFOX&&g.EXTENSION_TYPE===g.THREE_IN_ONE||s.main.handleTelemetryOptOut(),!0===a.THREE_IN_ONE_EXTENSION&&(s.globalSettings.getValue(n.IS_HP_FIRST_LAUNCH),R.isManifestV3Extension()||chrome.webRequest.onBeforeRequest.addListener(s.main.handleOmniSearchEvent,{urls:[s.constants.SEARCH_URL+"?omnisearch=yes*"]},["blocking"]),s.main.initVendorConstants()),R.isManifestV3Extension()||s.isFreshInstall||s.init.updateAntiTrackerStatus(),o.globals.BROWSER!==l.CHROME&&o.globals.BROWSER!==l.FIREFOX||R.getActiveTab(e=>{t(e)||t(e.id)}),s.isFreshInstall||(o.globals.BROWSER===l.EDGE?R.getAllTabs(e=>{e.forEach(e=>{var a;u.isLandingPageURL(e.url)&&(a=R.getTabID(e),R.updateTabUrl(a,e.url))})}):s.main.injectWebCommunication())},a._alarmHandler=async function(e){switch(await s.init.ready(),e){case n.ALARM_NAMES.FETCH_ANTI_TRACKER_STATUS:case n.ALARM_NAMES.PERIODIC_ANTI_TRACKER_SCHEDULER:s.antiTrackerStatusProvider.handleAntiTrackerScheduler(e);break;case n.ALARM_NAMES.TELEMETRY_NOTIFICATION:s.main.setTelemetryNotification();break;case n.ALARM_NAMES.TELEMETRY_NOTIFICATION_AUTOHIDE:s.main.hideTelemetryNotifcation();break;case n.ALARM_NAMES.TELEMETRY_NOTIFICATION_DUE_CHECK_WAKEUP:s.main.checkTelemetryNotificationDueElapsed();break;case n.ALARM_NAMES.FORMJACK_TOUR_SCHEDULER:s.formjackTourBG.handleTourDisplayScheduler(e)}},a._alarmCallback=e=>{a._alarmHandler(e.name)},a._addEventListeners=()=>{o.alarmHelper.registerAlarmListener(a._alarmCallback),R.addTabRemovedEventListener(s.main.handleClose),R.addTabActivatedEventListener(s.main.handleActivate),R.addTabUpdatedEventListener(s.main.handleOnUpdated),R.addMessageListener(s.main.handleMessage),S(chrome.downloads)&&(chrome.downloads.onCreated.addListener(s.main.analyzeDownloadPage),i.registerEventCallback(e.DOWNLOAD_URL_ANALYZED,a.downloadURLAnalyzedCallback))},a.load=function(){a._addEventListeners(),chrome.webNavigation.onTabReplaced.addListener(s.main.handleTabReplaced),s.init.ready().then(a.initialize,function(e){r.error(e)})},a.loadExtension=async function(){R.isManifestV3Extension()||await u.waitForWindowLoadEvent(),a.load()},a}(e.SymBfw,e.NSSS)}(executionContext),SymBfw.utils.isntNil(chrome.runtime.onInstalled)?chrome.runtime.onInstalled.addListener(NSSS.main.handleInstall):(guid=NSSS.globalSettings.getValue(NSSS.constants.NSSS_INSTALLDATEKEY),SymBfw.utils.isNil(guid)&&setTimeout(function(){NSSS.main.handleInstall({reason:"install"})},5e3)),NSSS.chromeGlobal.loadExtension();