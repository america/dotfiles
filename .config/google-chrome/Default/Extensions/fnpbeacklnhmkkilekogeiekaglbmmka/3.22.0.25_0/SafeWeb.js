!function(e){"use strict";(e.SafeWeb=e.SafeWeb||{}).constants=(e.SymBfw,{SHASTA_URL:"https://ratings-wrs.norton.com",SHASTA_LOOKUP_PATH:"brief",DEFAULT_FULL_REPORT_URL:"https://safeweb.norton.com/report/show",HTTP_PROTOCOL:"http",HTTPS_PROTOCOL:"https",HTTPS_GET_METHOD:"GET",HTTPS_POST_METHOD:"POST",PII_SUBMISSION_TIMEOUT:2e3,SCAM_INSIGHT_BLOCK_PAGE_PATH:"content/ui/scam-insight-block-page.html",BLOCK_PAGE_PATH:"content/ui/blockedPage.html",SYMC_USER_AGENT:"X-Symc-User-Agent",X_NLOK_COUNTRY:"X-NLOK-COUNTRY",ACCEPT_HEADER:"Accept",APPLICATION_JSON:"application/json",WRS_HEADER_VALUES:{XBP_SAFEWEB:"xBP/SafeWeb",XBP_SAFEWEB_YAHOO:"xBP/SafeWeb_Yahoo",XBP_SAFEWEB_YAHOO_ADVT:"xBP/SafeWeb_Yahoo_Advt"},JAPAN_LOCALE:"ja",ROOT_NODE:{TAG_NAME:"symantec",VERSION_ATTR:"@v",CACHE_POSITIVE_ATTR:"@cacheP",CACHE_NEGATIVE_ATTR:"@cacheN"},PII_FLAGS:{EXIT_SITE:0,CONTINUE_TO_SITE:1,SUPPRESSED_DUE_TO_SILENTMODE:2,SUPPRESSED_DUE_TO_HTTPS:4},PII_SUBMISSION_STATUS:{SUCCESS:"Success",FAILURE:"Fail"},SITE_NODE:{TAG_NAME:"site",CANONICAL_SITE_ID_ATTR:"@id",COMBINED_RATING_ATTR:"@r",SECURITY_RATING_ATTR:"@sr",BUSINESS_RATING_ATTR:"@br",CATEGORY_ATTR:"@category",CACHE_ATTR:"@cache",PII_ENABLE_ATTR:"@piien",PII_POLICY_HTTPS:"@piipolhttps",PII_POLICY_ID:"@piipolid",PII_POLICY_FIELD_TYPE:"@piipolft"},WRS_RATINGS:{UNKNOWN_SITE:"u",BAD_SITE:"b",WARNING_SITE:"w",GOOD_SITE:"g",NORTON_SECURE_SITE:"r",PII_NOT_ENABLED:"n",PII_ENABLED:"y",PII_SILENCE:"s",REGIONAL_BLOCK:"grbl"},ANNOYANCE_FACTORS_KEYS:{PUAPP:!0,HRDUN:!0,JOKE:!0,MLAPP:!0,TRCKW:!0,TPSQT:!0,PPCNA:!0,HACK:!0,SPAM:!0,SWBPL:!0},PII_FACTORS_KEYS:{PIIAGE:"@age",PIIPOP:"@pop"},PII_POLICY_HTTPS_KEYS:{DONTCARE:"dc",HTTPS:"h"},IDENTITY_THREATS_KEYS:{MLWR:!0,MBCHG:!0,RMTA:!0,PHISH:!0,BDOOR:!0,ISTLR:!0,DIAL:!0,DLDR:!0,SPWR:!0},SHOPPING_RISKS_KEYS:{CTFGS:!0,RCGS:!0,REPLC:!0},COMPUTER_THREATS_KEYS:{COHD:!0,ADWR:!0,VIRUS:!0,WORM:!0,SRISK:!0,BREXP:!0,MLWR:!0,MBCHG:!0,HEUR:!0,ELTMS:!0,TRJN:!0},SITE_FACT_NODE:{TAG_NAME:"d",REPORTED_BY_KEY:"reported_by",SRC_KEY:"src",ID_KEY:"id"},SITE_FACT_IDS:{PRIVACY_POLICY_APPROVED:"privacy policy approved",NETWORK_SCANNING_SERVICE:"network scanning service",SSL_CA_NAME:"ssl CA name",AUTHORIZED_RESELLER:"Authorized Reseller",CERTIFIED_BUSINESS:"certified business",VERISIGN_TRUSTED:"VRTRU",VERISIGN_SSL:"VRSSL"},SITE_FACT_SOURCES:{SRC_BUYSAFE:"BUYSAFE",SRC_VERISIGN:"Verisign",SRC_MARK_MONITOR:"MARKMONITOR"},ATTRIBUTE_COUNT:"@cnt",CACHE_LIMIT:1e3,RATING_TYPE:{WCID_HEURISTICS:1,WCID_CHECK_URL:2,SAFEWEB:3,SCAM_INSIGHT:4},MESSAGES:{WAX_FIELDS_FOUND:"45E6BAD1-9F79-4E16-BA3A-1F77AA21EAC9",PROCESS_PAGE_FOR_SCAM_FIELDS:"FEDA41BC-73DC-4F99-A2CF-B5589CF2D0F8",TOP_FRAME_UNLOADED:"E5C199FF-A74B-414F-803C-4C7030C0E573",CAN_ANALYZE_FOR_SCAM:"6E6CDFB7-4CF6-4C73-B998-6CA3432DDC07"},IS_SCAM_INSIGHT_ENABLED:!0,performanceReporter:{COMPONENT:{SCAM_INSIGHT:"scam_insight"},TYPE:{INIT:"init",PII_PROTO_SUBMISSION:"_piiProtoSubmission",CALCULATE_SCAM_RATING:"_calculateScamInsightRating",HANDLE_PII_RATING:"_handlePIIEnabledRating",SET_WRS_RESPONSE:"setWrsResponse",HANDLE_MESSAGE:"_handleMessage",HANDLE_MESSAGE_CALLBACK:"_handleScamPageFoundCallback",HANDLE_CACHE_RESPONSE:"_handleCacheResponse",SEND_PII_SUBMISSION:"sendPIISubmission",COLLECT_PII_FIELDS:"_collectPIIFields",TOP_FRAME_UNLOADED:"topFrameUnloaded",ADD_MUTATION_OBSERVER:"_addBodyMutationObserver",FIELD_FOUND_CALLBACK:"handleFieldsFoundCallback",WAX_CONTROLLER_INITIALIZE:"scamInsightWaxControllerInitialize",CAN_ANALYZE_HANDLER_RESPONSE:"canAnalyzeForScamHandlerResponse",RUN_WAX_ANALYSIS:"_runWaxAnalysis"}},SCAM_INSIGHT_RESULT:{UNTESTED:0,SUSPICIOUS_PAGE:1,SUSPICIOUS_NO_BLOCK_PAGE:2,NOT_SUSPICIOUS_PAGE:3},SCAM_INSIGHT_RATING_KEY:"scamRating",SCAM_ANALYSIS_STATE:{PENDING:0,ANALYZE:1},YAHOO_DOMAIN:"yahoo.com",HSPART_KEY:"hspart",HSPART_VALUE:["symantec","norton"],SAFEWEB_STORAGE_CONTAINER:"safeweb_storage_container",NORMALIZED_URL_RATING_MAP:"normalized_url_rating_map",CACHED_URLS_COUNT:"cached_urls_count",VIEW_ANYWAY_CACHE:"view_anyway_cache",URLS_TO_BE_REMOVED:"urls_to_be_removed",SW_REMOVE_CACHE_ITEM_ALARM:"sw_remove_cache_item_alarm",SW_REMOVE_VIEW_ANYWAY_ALARM:"sw_remove_view_anyway_alarm",ALARM_URL_SEPARATOR:"alarm_",MINIMUM_ALARM_INTERVAL:"60000",MS_TO_MIN_CONVERSION_VALUE:6e4})}(executionContext),function(e){const{settings:t,utils:{isntNil:i}}=SymBfw,a=SafeWeb["constants"];e.SafeWeb.storageContainer=new class{constructor(){this._container=null}initialize(){return new Promise((n,r)=>{if(i(this._container))return n(!0);t.loadSettingsContainer(a.SAFEWEB_STORAGE_CONTAINER,!0,(e,t,i)=>{!1!==e&&t?(this._container=t,n(!0)):r(i)})})}_isStorageInitialized(){return!!this._container}getValue(e){if(this._isStorageInitialized())return this._container.getObject(e)}setValue(e,t){this._isStorageInitialized()&&this._container.setObject(e,t)}},SafeWeb.storageContainer.initialize()}(executionContext),function(e){const{alarmHelper:i,logger:n,utils:{isNumber:r}}=SymBfw,a=SafeWeb["constants"];e.SafeWeb.utils=new class{async registerTimeoutOperation(e,t){!r(t)||t<a.MINIMUM_ALARM_INTERVAL?n.log("Invalid delay interval"):(t/=a.MS_TO_MIN_CONVERSION_VALUE,await i.setAlarm(e,{delayInMinutes:t}))}}}(executionContext),function(e){const{utils:{isString:n,isNil:r,isEmptyObject:a},logger:o}=SymBfw,{constants:s,storageContainer:S}=SafeWeb;e.SafeWeb.cacheUtils=new class{constructor(){this._normalizedUrlsRatingMap=null}setRatingInStorage(t,i){if(n(t))if(a(i))o.log("rating object is not valid");else{let e=S.getValue(s.NORMALIZED_URL_RATING_MAP);(e=r(e)?{}:e)[t]=i,S.setValue(s.NORMALIZED_URL_RATING_MAP,e),this._normalizedUrlsRatingMap=e}else o.log("url is not string")}getRatingFromStorage(e){var t;if(n(e))return t=this._normalizedUrlsRatingMap||S.getValue(s.NORMALIZED_URL_RATING_MAP),r(t)?null:t[e];o.log("url is not string")}removeRatingFromStorage(e){var t;n(e)?(t=S.getValue(s.NORMALIZED_URL_RATING_MAP),r(t)||r(t[e])||(delete t[e],S.setValue(s.NORMALIZED_URL_RATING_MAP,t))):o.log("Url should be a string")}getAllRatingsFromStorage(){return S.getValue(s.NORMALIZED_URL_RATING_MAP)}getCachedUrlsCount(){var e=this._normalizedUrlsRatingMap||this.getAllRatingsFromStorage();return r(e)?0:Object.keys(e).length}clearCache(){S.setValue(s.NORMALIZED_URL_RATING_MAP,{})}}}(executionContext),function(e){"use strict";e.SafeWeb.telemetryWrapper=function(r){let n={};r.utils.isntNil,r.utils.isNil;const a=r.utils.isString,o=r.telemetryConstants;return n.TELEMETRY_CATEGORY={SCAM_INSIGHT:"Scam_Insight"},n.actionType={PROTO:{PII_SUBMISSION:"PII_Submission"}},n.sendPIISubmissionStatusEvent=function(e){if(!a(e))return null;var t=n.TELEMETRY_CATEGORY.SCAM_INSIGHT,i=n.actionType.PROTO.PII_SUBMISSION;n.send(t,i,e)},n.send=function(e,t,i){if(!a(e)||!a(t)||!a(i))return null;var n={};n[o.parameters.HIT_TYPE]=o.HIT_TYPE.EVENT,n[o.parameters.CATEGORY]=e,n[o.parameters.ACTION]=t,n[o.parameters.LABEL]=i,(r.telemetry||r.telemetryProxy).send(n)},n}(e.SymBfw,e.SafeWeb)}(executionContext),function(e){"use strict";e.SafeWeb.Rating=function(o){const s=o.utils.isNil,t=(o.utils.isFunction,o.utils.isArray),e=SafeWeb.constants;var i=o.utils;const n=o.localizer,r=o.utils.isInteger,a=o.utils.isString,S=SafeWeb.constants;function I(e){if(s(e))throw new Error("Input dictionary cannot be null");var t,i=I.ratingSchema;for(t in i){var n=i[t],r=e[t];if(s(r)){if(n.isRequired)throw new Error("Cannot find value for key "+t+" in the input dictionary.");var a=n.defaultValue;if(s(a))throw new Error("Default value has not been supplied in the Schema.");this[t]=n.defaultValue}else{if(!1===(0,n.typeChecker)(r))throw new Error("Input value for key "+t+" does not match schema.");this[t]=r}}this.id=o.utils.createNewGuid()}return I.ratingSchema={computerThreats:{isRequired:!1,typeChecker:i.isInteger,defaultValue:0},annoyanceFactors:{isRequired:!1,typeChecker:i.isInteger,defaultValue:0},identityThreats:{isRequired:!1,typeChecker:i.isInteger,defaultValue:0},shoppingRisks:{isRequired:!1,typeChecker:i.isInteger,defaultValue:0},phishingThreats:{isRequired:!1,typeChecker:i.isInteger,defaultValue:0},siteRating:{isRequired:!0,typeChecker:i.isInteger},fullURL:{isRequired:!0,typeChecker:i.isString},normalizedURL:{isRequired:!0,typeChecker:i.isString},cacheTime:{isRequired:!1,typeChecker:i.isInteger,defaultValue:0},category:{isRequired:!1,typeChecker:i.isString,defaultValue:"none"},piiAttributes:{isRequired:!1,typeChecker:I._checkPIISchema=function(e){return!!a(e.piiEnable)&&(S.WRS_RATINGS.PII_ENABLED!==e.piiEnable&&S.WRS_RATINGS.PII_SILENCE!==e.piiEnable||!!a(e.piiPolHttps)&&!!(a(e.piiPolID)&&t(e.piiFieldType)&&r(e.age)&&r(e.pop)))},defaultValue:{piiEnable:S.WRS_RATINGS.PII_NOT_ENABLED}},scamRating:{isRequired:!1,typeChecker:i.isInteger,defaultValue:e.SCAM_INSIGHT_RESULT.UNTESTED}},I.prototype.getComputerThreats=function(){return this.computerThreats},I.prototype.getAnnoyanceFactors=function(){return this.annoyanceFactors},I.prototype.getIdentityThreats=function(){return this.identityThreats},I.prototype.getShoppingRisks=function(){return this.shoppingRisks},I.prototype.getPhishingThreats=function(){return this.phishingThreats},I.prototype.getFullReportURL=function(){return e.DEFAULT_FULL_REPORT_URL+"?url="+this.getFullURL()+"&ulang="+n.getLocale()},I.prototype.getSiteRating=function(){return this.siteRating},I.prototype.getFullURL=function(){return this.fullURL},I.prototype.getNormalizedURL=function(){return this.normalizedURL},I.prototype.getID=function(){return this.id},I.prototype.getCacheTime=function(){return this.cacheTime},I.prototype.getCategory=function(){return this.category},I.prototype.getPIIEnValue=function(){return this.piiAttributes.piiEnable},I.prototype.getPIIPolID=function(){return s(this.piiAttributes.piiPolID)?null:this.piiAttributes.piiPolID},I.prototype.getPIIHTTPS=function(){return s(this.piiAttributes.piiPolHttps)?null:this.piiAttributes.piiPolHttps},I.prototype.getPIIFieldType=function(){return s(this.piiAttributes.piiFieldType)?[]:this.piiAttributes.piiFieldType},I.prototype.getPIIAge=function(){return s(this.piiAttributes.age)?0:this.piiAttributes.age},I.prototype.getPIIPop=function(){return s(this.piiAttributes.pop)?0:this.piiAttributes.pop},I.prototype.getScamRating=function(){return this.scamRating},I.prototype.serialize=function(){return JSON.stringify(this)},I.SITE_RATING={SW_INVALID_STATE:0,SW_TRUSTED_STATE:1,SW_NEUTRAL_STATE:2,SW_KNOWN_PHISHING_STATE:3,SW_SUSPECTED_PHISHING_STATE:4,SW_KNOWN_MALICIOUS_STATE:5,SW_CAUTION_MALICIOUS_STATE:6,SW_NORTON_CERTIFIED:7,SW_TRUSTED_TRANSACTION_STATE:8,SW_UNTRUSTED_TRANSACTION_STATE:9,SW_PAGE_BAD_UNTRUSTED_TRANSACTION_STATE:10,SW_DISABLED_STATE:11,SW_UNLICENSED_STATE:12,SW_ERROR_STATE:13,SW_PENDING_STATE:14,SW_MAX_STATE:15,SW_REGIONAL_BLOCK:17},I}(e.SymBfw)}(executionContext),function(e){"use strict";e.SafeWeb.WrsParser=function(e){const l=e.utils.isNil,S=e.utils.isntNil,u=(e.utils.isFunction,e.utils.isArray),R=e.utils.isEmptyObject,A=SafeWeb.constants,c=e.logger,N=SafeWeb.Rating;function t(){this._rootDict={cacheP:600,cacheN:600}}return t.prototype.parseWRSResponse=function(e,t){if(l(e))return null;if(l(t))throw new Error("URL Array cannot be null.");e=this.parseRootNode(e);return l(e)?null:this.parseSiteInformation(e,t)},t.prototype.isSiteRegionalBlock=function(e,t){return e!==N.SITE_RATING.SW_PAGE_BAD_UNTRUSTED_TRANSACTION_STATE&&e!==N.SITE_RATING.SW_KNOWN_MALICIOUS_STATE&&t===A.WRS_RATINGS.REGIONAL_BLOCK},t.prototype.parseSiteInformation=function(e,t){var i=e[A.SITE_NODE.TAG_NAME],n=(i=u(i)?i:[i]).length;if(0===n)return null;if(t.length!==n)return c.error("Lengths of input URL Array("+t.length+") and Shasta results("+n+") do not match."),null;for(var r=[],a=0;a<n;a++){var o=i[a],s={},S=!1,I={};s.fullURL=t[a];for(const E in o)switch(E){case A.SITE_NODE.CANONICAL_SITE_ID_ATTR:s.normalizedURL=o[E];break;case A.SITE_NODE.COMBINED_RATING_ATTR:s.combinedRating=o[E];break;case A.SITE_NODE.SECURITY_RATING_ATTR:s.securityRating=o[E],S=!0;break;case A.SITE_NODE.BUSINESS_RATING_ATTR:s.shoppingRating=o[E];break;case A.SITE_NODE.CACHE_ATTR:s.cacheTime=Number(o[E]);break;case A.SITE_NODE.CATEGORY_ATTR:s.category=o[E];break;case A.SITE_NODE.PII_ENABLE_ATTR:I.piiEnable=o[E];break;case A.SITE_NODE.PII_POLICY_HTTPS:I.piiPolHttps=o[E];break;case A.SITE_NODE.PII_POLICY_ID:I.piiPolID=o[E];break;case A.SITE_NODE.PII_POLICY_FIELD_TYPE:var _=o[E];"*"===_?I.piiFieldType=["*"]:(_=_.split(",").map(Number),I.piiFieldType=_.filter(e=>!isNaN(e)))}s.piiAttributes=I,R(s.piiAttributes)&&(s.piiAttributes.piiEnable=A.WRS_RATINGS.PII_NOT_ENABLED),l(s.normalizedURL)&&(s.normalizedURL=""),l(s.combinedRating)&&(s.combinedRating=A.WRS_RATINGS.UNKNOWN_SITE),l(s.securityRating)&&(s.securityRating=A.WRS_RATINGS.UNKNOWN_SITE),l(s.shoppingRating)&&(s.shoppingRating=A.WRS_RATINGS.UNKNOWN_SITE),l(s.cacheTime)&&(s.cacheTime=!1===S?this._rootDict.cacheN:this._rootDict.cacheP),s.siteRating=this.getSiteRating(s.securityRating,s.shoppingRating);this.isSiteRegionalBlock(s.siteRating,s.category)&&(s.siteRating=N.SITE_RATING.SW_REGIONAL_BLOCK),this.parseSiteAttributes(o,s);var T=new N(s);r.push(T)}return r},t.prototype.parseSiteAttributes=function(e,t){var i,n=0,r=0,a=0,o=0;for(const s in e)S(A.ANNOYANCE_FACTORS_KEYS[s])&&(r+=Number(e[s][A.ATTRIBUTE_COUNT])),S(A.IDENTITY_THREATS_KEYS[s])&&(a+=Number(e[s][A.ATTRIBUTE_COUNT])),S(A.SHOPPING_RISKS_KEYS[s])&&(o+=Number(e[s][A.ATTRIBUTE_COUNT])),S(A.COMPUTER_THREATS_KEYS[s])&&(n+=Number(e[s][A.ATTRIBUTE_COUNT])),S(A.PII_FACTORS_KEYS[s])&&(l(t.piiAttributes)&&(t.piiAttributes={}),i=A.PII_FACTORS_KEYS[s].substring(1),t.piiAttributes[i]=Number(e[s][A.PII_FACTORS_KEYS[s]]));t.computerThreats=n,t.annoyanceFactors=r,t.identityThreats=a,t.shoppingRisks=o},t.prototype.getSiteRating=function(e,t){if(e===A.WRS_RATINGS.NORTON_SECURE_SITE)return N.SITE_RATING.SW_NORTON_CERTIFIED;if(e===A.WRS_RATINGS.GOOD_SITE){if(t===A.WRS_RATINGS.GOOD_SITE)return N.SITE_RATING.SW_TRUSTED_TRANSACTION_STATE;if(t===A.WRS_RATINGS.UNKNOWN_SITE)return N.SITE_RATING.SW_TRUSTED_STATE}return e===A.WRS_RATINGS.BAD_SITE?t===A.WRS_RATINGS.BAD_SITE?N.SITE_RATING.SW_PAGE_BAD_UNTRUSTED_TRANSACTION_STATE:N.SITE_RATING.SW_KNOWN_MALICIOUS_STATE:t===A.WRS_RATINGS.WARNING_SITE||t===A.WRS_RATINGS.BAD_SITE?N.SITE_RATING.SW_UNTRUSTED_TRANSACTION_STATE:e===A.WRS_RATINGS.WARNING_SITE?N.SITE_RATING.SW_CAUTION_MALICIOUS_STATE:N.SITE_RATING.SW_NEUTRAL_STATE},t.prototype.parseRootNode=function(e){var t=e[A.ROOT_NODE.TAG_NAME];if(!t)return null;for(const i in t)switch(i){case A.ROOT_NODE.VERSION_ATTR:this._rootDict[A.ROOT_NODE.VERSION_ATTR]=t[i];break;case A.ROOT_NODE.CACHE_POSITIVE_ATTR:this._rootDict[A.ROOT_NODE.CACHE_POSITIVE_ATTR]=Number(t[i]);break;case A.ROOT_NODE.CACHE_NEGATIVE_ATTR:this._rootDict[A.ROOT_NODE.CACHE_NEGATIVE_ATTR]=Number(t[i])}return t},t}(e.SymBfw)}(executionContext),function(e){"use strict";e.SafeWeb.connection=function(s){var S={timeoutFunction:null},I=s.utils.isNil,_=s.utils.isntNil,T=s.utils.isFunction,o=s.utils.isArray,E=SafeWeb.constants,l=SafeWeb.WrsParser;const u=s.localizer,R=s.logger;return S.getResultForURL=function(r,a){if(I(r))throw new Error("URL cannot be null");if(!1===T(a))throw new Error("Shasta Connection callback cannot be null");var e=encodeURIComponent(SafeWeb.cache.safeURL(r)),e=E.SHASTA_URL+"/"+E.SHASTA_LOOKUP_PATH+"?url="+e,t=S.constructHeader({senderURL:r,methodType:E.HTTPS_GET_METHOD});S.shastaConnection(e,E.HTTPS_GET_METHOD,function(e){const t=e.status;var i=e.responseData;if(200===t){const n=(new l).parseWRSResponse(i,[r]);SafeWeb.cache.addRatingsToCache(n),void setTimeout(function(){a(t,n)},1)}else setTimeout(function(){a(t,e)},1)},t)},S.constructHeader=function(e){var t=u.getNavigatorLanguage().split("-");let i=t[1];I(i)&&t[0]==E.JAPAN_LOCALE&&(i="JP"),I(i)&&(i="US");var n,r,a={};if(a[E.ACCEPT_HEADER]=E.APPLICATION_JSON,_(e))switch(e.methodType){case E.HTTPS_GET_METHOD:a[E.SYMC_USER_AGENT]=E.WRS_HEADER_VALUES.XBP_SAFEWEB,a[E.X_NLOK_COUNTRY]=i;break;case E.HTTPS_POST_METHOD:_(e.senderURL)&&(n=(r=new URI(e.senderURL)).domain(),r=r.query(!0),_(r))&&n===E.YAHOO_DOMAIN&&E.HSPART_VALUE.includes(r[E.HSPART_KEY])&&(I(e.bAdvtFlag)?a[E.SYMC_USER_AGENT]=E.WRS_HEADER_VALUES.XBP_SAFEWEB_YAHOO:a[E.SYMC_USER_AGENT]=E.WRS_HEADER_VALUES.XBP_SAFEWEB_YAHOO_ADVT),a[E.X_NLOK_COUNTRY]=i;break;default:a[E.SYMC_USER_AGENT]=E.WRS_HEADER_VALUES.XBP_SAFEWEB,a[E.X_NLOK_COUNTRY]=i}return new Headers(a)},S.getResultsForURLs=function(r,a,e){if(!1===o(r))throw new Error("URL Array cannot be null");if(0===r.length)throw new Error("URL Array length cannot be null");if(!1===T(a))throw new Error("Shasta Connection callback cannot be null");if(I(e))throw new Error("Payload cannot null");var t,i=E.SHASTA_URL+"/"+E.SHASTA_LOOKUP_PATH,n="";for(t in r)n+=r[t]+"\r\n";e.methodType=E.HTTPS_POST_METHOD;e=S.constructHeader(e);S.shastaConnection(i,E.HTTPS_POST_METHOD,function(e){var t,i=e.status,n=e.responseData;200===i?(t=(new l).parseWRSResponse(n,r),SafeWeb.cache.addRatingsToCache(t),setTimeout(function(){a(i,t)},1)):setTimeout(function(){a(i,e)},1)},e,n)},S.shastaConnection=async function(t,i,n,r,a){if(I(t))throw new Error("API URL cannot be null");if(I(i))throw new Error("HTTP Method cannot be null");if(!1===T(n))throw new Error("Shasta Callback cannot be null");try{var e,o=await s.utils.safeFetch(t,{credentials:"omit",method:i,headers:r,body:a});!0===o.ok?(e=await o.json(),n({status:o.status,responseData:e})):(R.debug("safeFetch() FAILED - url : "+o.url+" - HTTP code : "+o.status),n({status:o.status,responseData:null}))}catch(e){_(S.timeoutFunction)?(S.timeoutFunction=null,R.error("Exception received from safeFetch \n"+e),n({status:null,responseData:null})):S.timeoutFunction=setTimeout(()=>{S.shastaConnection(t,i,n,r,a)},5e3)}},S}(e.SymBfw)}(executionContext),function(e){"use strict";(e.SafeWeb.ScamInsightPII=e.SafeWeb.ScamInsightPII||{}).proto=(e.SymBfw,dcodeIO.ProtoBuf.newBuilder({}).import({package:"PIIFeatureTelem",syntax:"proto2",options:{optimize_for:"LITE_RUNTIME"},messages:[{name:"ScamInsight_PII_Submission_List",syntax:"proto2",fields:[{rule:"optional",type:"uint32",name:"Version",id:1,options:{default:1}},{rule:"optional",type:"bytes",name:"Enterprise_GUID",id:2},{rule:"optional",type:"bytes",name:"Machine_GUID",id:3},{rule:"optional",type:"bytes",name:"Machine_CAT",id:4},{rule:"optional",type:"string",name:"ProductName",id:5,options:{default:""}},{rule:"optional",type:"string",name:"ProductVersion",id:6,options:{default:""}},{rule:"repeated",type:"Submission_Type",name:"Submission",id:7}],messages:[{name:"Submission_Type",syntax:"proto2",fields:[{rule:"optional",type:"int64",name:"UTCTime",id:1},{rule:"optional",type:"sint32",name:"LocalTZUTCOffset",id:2},{rule:"optional",type:"string",name:"Site_URL",id:3},{rule:"optional",type:"string",name:"Referrer_URL",id:4},{rule:"optional",type:"string",name:"FormAction_URL",id:5},{rule:"optional",type:"string",name:"PII_PolicyID",id:6},{rule:"repeated",type:"uint32",name:"Form_Fields",id:7},{rule:"optional",type:"uint32",name:"PII_Flags",id:8}]}]}],enums:[{name:"ScamInsight_PII_FlagValues",syntax:"proto2",values:[{name:"SCAMINSIGHT_PII_CONTINUED_TO_PAGE",id:1},{name:"SCAMINSIGHT_PII_SUPPRESSEDDUETOSILENTMODE",id:2},{name:"SCAMINSIGHT_PII_SUPPRESSEDDUETOHTTPS",id:4}]}],isNamespace:!0}).build())}(executionContext),function(e){"use strict";e.SafeWeb.piiprotoutils=function(i){let n={},r=SafeWeb.ScamInsightPII.proto.PIIFeatureTelem.ScamInsight_PII_Submission_List,a=r.Submission_Type;const t=i.utils.isNil,e=(i.utils.isFunction,i.utils.isArray),o=i.utils.isEmptyObject,s=i.utils.isString,S=(i.utils.isSuccessCode,i.utils.urlWithoutQueryParameters);let I="1.0.0";const _={POST_METHOD:"POST",CONTENT_TYPE:"Content-Type",API_URL:"https://shasta-clt.norton.com/incident-pii/1",REQ_TIMEOUT:1e3,PROTOBUF:"application/x-protobuf"};class T{constructor(){this.piiSubmissionItem={UNIX_TIME:null,OFFSET_TIME:null,SITE_URL:null,REFERRER_URL:null,FORM_ACTION_URL:null,PII_POLICYID:null,FORM_FIELDS:null,PII_FLAGS:null}}setSubmissionTime(){var e=new Date;this.piiSubmissionItem.UNIX_TIME=e.getTime(),this.piiSubmissionItem.OFFSET_TIME=e.getTimezoneOffset()}setSiteUrl(e){e=S(e),e=encodeURIComponent(e);this.piiSubmissionItem.SITE_URL=e}isValidPIISubmissionData(){return!t(this.piiSubmissionItem.UNIX_TIME)&&!t(this.piiSubmissionItem.OFFSET_TIME)&&!(o(this.piiSubmissionItem.SITE_URL)||!s(this.piiSubmissionItem.SITE_URL)||o(this.piiSubmissionItem.PII_POLICYID)||!s(this.piiSubmissionItem.PII_POLICYID)||!e(this.piiSubmissionItem.FORM_FIELDS)||t(this.piiSubmissionItem.PII_FLAGS))}}return n._fillPIIItem=function(e,t){o(e.piiSubmissionItem.REFERRER_URL)||t.setReferrerURL(encodeURIComponent(e.piiSubmissionItem.REFERRER_URL)),o(e.piiSubmissionItem.FORM_ACTION_URL)||t.setFormActionURL(encodeURIComponent(e.piiSubmissionItem.FORM_ACTION_URL));var i=dcodeIO.Long.fromNumber(e.piiSubmissionItem.UNIX_TIME);t.setUTCTime(i),t.setLocalTZUTCOffset(e.piiSubmissionItem.OFFSET_TIME),t.setSiteURL(e.piiSubmissionItem.SITE_URL),t.setPIIPolicyID(e.piiSubmissionItem.PII_POLICYID),t.setFormFields(e.piiSubmissionItem.FORM_FIELDS),t.setPIIFlags(e.piiSubmissionItem.PII_FLAGS)},n.setPIIProductVersion=function(e){if(!s(e))throw new Error("Invalid string");I=e},n._createPIIList=function(e){var t=new r,i=new a;return t.setVersion(1),t.setProductName("NSSS"),t.setProductVersion(I),n._fillPIIItem(e,i),t.setSubmission(i),t},n.submitShastaPII=async function(e){if(!(e instanceof T))throw new Error("Invalid PII Object");if(!e.isValidPIISubmissionData())throw new Error("Invalid PII Submission Data");e=n._createPIIList(e);if(t(e))throw new Error("PII Creation Failed");e=e.toArrayBuffer();if(t(e))throw new Error("Invalid Serialized Message");return n._sendPIIDataToShasta(e)},n._sendPIIDataToShasta=async function(e){var t={"Content-Type":_.PROTOBUF},t={method:_.POST_METHOD,headers:t,body:e};try{if((await fetch(_.API_URL,t)).status!==i.constants.httpStatusCodes.OK)throw new Error("PII Submission Failed")}catch(e){throw new Error("PII Submission Failed")}},n.getPIISUbmissionObj=function(){return new T},n}(e.SymBfw)}(executionContext),function(O){"use strict";O.SafeWeb.cache=function(e){const{logger:s,utils:{isNil:I,isntNil:A,isEmptyObject:c,urlWithoutQueryParameters:N}}=e,{cacheUtils:p,constants:S,connection:_,storageContainer:t,utils:T}=SafeWeb,P={safeURL:function(e){e=new URI(e);return e.protocol()+"://"+e.hostname()+e.pathname()},isLocaleJapan:function(){return e.localizer.getNavigatorLanguage().split("-")[0]===S.JAPAN_LOCALE},addRatingsToCache:function(e){if(I(e)||0===e.length)throw new Error("Ratings array cannot be null or empty");var t,i=P.isLocaleJapan();for(t in e){if(p.getCachedUrlsCount()>=S.CACHE_LIMIT)return;var n,r,a,o=e[t];I(o)||0!==(n=o.getCacheTime())&&(r=i?N(o.getFullURL()):o.getNormalizedURL(),a=null,I(r)||0===r.length?(a=P.safeURL(o.getFullURL()),s.error("Normalized URL cannot not be null or empty:"+a)):(p.setRatingInStorage(r,o),T.registerTimeoutOperation(S.SW_REMOVE_CACHE_ITEM_ALARM+"_"+r,1e3*n)))}},removeRatingFromCache:async function(e){if(I(e))throw new Error("Normalized URL cannot be null");await t.initialize(),p.removeRatingFromStorage(e)},getRatingForURL:function(e,n){var t=P.ratingForCachedURL(e);A(t)?setTimeout(function(){n(t)},1):_.getResultForURL(e,function(e,t){var i=200===e?t[0]:null;setTimeout(function(){n(i)},1)})},ratingForCachedURL:function(e){if(c(p.getAllRatingsFromStorage()))return null;var t=new URI(e),i=null,n=P.isLocaleJapan();do{if(n){i=p.getRatingFromStorage(N(e));break}for(var r=t.hostname(),a=t.domain(),o=null,s=t.segment(),S=t.pathname(),I=s.length,_=0;o=""+r+S,i=p.getRatingFromStorage(N(e)),!A(i)&&(S=S.slice(0,S.lastIndexOf("/")),++_<I););if(A(i))break;if(!0===t.is("IP")&&(i=p.getRatingFromStorage(r),A(i)))break;var T=t.subdomain();if(A(T)&&0<T.length){for(var E=T.split(".").length,l=0;o=T+"."+a,i=p.getRatingFromStorage(o),!A(i)&&(T=T.slice(T.indexOf(".")+1,T.length),++l<E););if(A(i))break}o=a,i=p.getRatingFromStorage(o);break}while(0);var u,R=null;return A(i)&&((u=JSON.parse(JSON.stringify(i))).fullURL=e,R=new O.SafeWeb.Rating(u)),R},getRatingsForURLs:function(e,a,t){var i,o=[],s=(o.length=e.length,{}),n=[];for(i in e){var r,S=e[i];I(S)?o[i]=null:(r=P.ratingForCachedURL(S),A(r)?o[i]=r:(s[n.length]=i,n.push(S)))}0===n.length?setTimeout(function(){a(o)},1):_.getResultsForURLs(n,function(e,t){if(200===e){var i,n=t;for(i in n){var r=n[i];o[s[i]]=r}}setTimeout(function(){a(o)},1)},t)},updateCacheRatingsForUrl:function(e){var t;I(e)||(t=e.getNormalizedURL(),I(t)||0===t.length?s.log("Normalized url for this newRating is null, dont proceed further to alter in this case"):A(p.getRatingFromStorage(t))&&p.setRatingInStorage(t,e))},handleStartup:async function(){await t.initialize(),p.clearCache()}};return P}(O.SymBfw),SymBfw.extensionAdapter.addStartupListener(SafeWeb.cache.handleStartup)}(executionContext),function(e){"use strict";e.SafeWeb.scamInsightUtility=function(i,n){const{urlWithoutQueryParameters:r,isEmptyObject:a,isNil:o}=i["utils"],{storageContainer:s,constants:S}=n;var e={addToViewAnywayCache:function(t){if(!a(t)){t=r(t);let e=s.getValue(S.VIEW_ANYWAY_CACHE);(e=o(e)?new Set:e).has(t)||(e.add(t),s.setValue(S.VIEW_ANYWAY_CACHE,e),n.utils.registerTimeoutOperation(S.SW_REMOVE_VIEW_ANYWAY_ALARM+"_"+t,18e5))}},removeFromViewCache:async function(e){i.logger.debug("Removing from view cache : "+e),await s.initialize();var t=s.getValue(S.VIEW_ANYWAY_CACHE);t.delete(e),s.setValue(S.VIEW_ANYWAY_CACHE,t)},isURLInViewAnywayCache:function(e){var t;return!a(e)&&(e=r(e),t=s.getValue(S.VIEW_ANYWAY_CACHE),!o(t))&&t.has(e)}};return e}(e.SymBfw,e.SafeWeb)}(executionContext),function(e){"use strict";e.SafeWeb.manager=function(e){const{cache:a,constants:i,scamInsightUtility:n}=SafeWeb,{isNil:o,isFunction:s}=e["utils"];var S={getRatingForURL:function(e,t){if(o(e))throw new Error("URL array cannot be null or empty.");if(!1===s(t))throw new Error("Callback function cannot be null.");!1===S.validateURL(e)?setTimeout(function(){t(null)},1):a.getRatingForURL(e,t)},getRatingsForURLs:function(e,t,i){if(o(e)||0===e.length)throw new Error("URL array cannot be null or empty.");if(!1===s(t))throw new Error("Callback function cannot be null.");for(var n in e){var r=e[n];!1===S.validateURL(r)&&(e[n]=null)}a.getRatingsForURLs(e,t,i)},validateURL:function(e){var t;return!o(e)&&(t=(e=new URI(e)).protocol(),e=e.hostname(),0!==t.length)&&0!==e.length&&("http"===t||"https"===t)},handleSchedulerEvent:function(e){var t;e.name.startsWith(i.SW_REMOVE_CACHE_ITEM_ALARM)?(t=S._getUrlFromAlarmName(e.name),a.removeRatingFromCache(t)):e.name.startsWith(i.SW_REMOVE_VIEW_ANYWAY_ALARM)&&(t=S._getUrlFromAlarmName(e.name),n.removeFromViewCache(t))},_getUrlFromAlarmName:function(e){return e.split(i.ALARM_URL_SEPARATOR)[1]}};return S}(e.SymBfw),SymBfw.alarmHelper.registerAlarmListener(SafeWeb.manager.handleSchedulerEvent)}(executionContext),function(e){"use strict";e.SafeWeb.scamInsightMgr=function(e,o){const s=e.extensionAdapter,S=e.utils.isEmptyObject,I=e.utils.isNil,a=e.utils.isntNil,_=e.utils.isArray,T=e.utils.isInteger,t=e.utils.isString,E=o.constants,l=e.telemetrySettings,u=o.piiprotoutils,R=e.utils.urlProtocol,A=e.logger,i=(e.utils.isBoolean,e.utils.isFunction),c=e.performanceReporterFactory,n=o.piiprotoutils,N={WRS_SCAM_RESPONSE:"wrsScamResponse",WAX_FIELDS_INFO:"waxFieldsInfo",MATCHED_FIELDS:"matchedFields",PII_SUBMISSION_TIMER:"piiSubmissionTimer",PII_FLAG:"piiFlag",PII_SUBMITTED:"piiSubmitted",SCAM_INSIGHT_BLOCK_PAGE_HANDLED:"scamInsightBlockPageHandled",TRIGGER_WAX_ANALYSIS:"triggerWaxAnalysis"};let p={initialize:function(){var e;E.IS_SCAM_INSIGHT_ENABLED&&(e=E.performanceReporter.TYPE.INIT+":"+Date.now(),c.reportStartForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,e),p._processedTabFields=new Map,p._PIISubmissionInfo=new Map,p._scamPageFoundCallback=null,s.addMessageListener(p._handleMessage),s.addTabRemovedEventListener(p._handleTabClose),c.reportStopForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,e))},registerEventCallback:function(e){if(!i(e))throw new Error("Invalid Callback function");p._scamPageFoundCallback=e},setVersion:function(e){if(!t(e))throw new Error("Invalid string");n.setPIIProductVersion(e)},_getSITabInfo:function(e){let t=p._processedTabFields.get(e);return I(t)&&((t=new Map).set(N.WAX_FIELDS_INFO,new Set),t.set(N.WRS_SCAM_RESPONSE,{}),t.set(N.MATCHED_FIELDS,new Set),t.set(N.PII_SUBMISSION_TIMER,0),t.set(N.PII_FLAG,0),t.set(N.PII_SUBMITTED,!1),t.set(N.SCAM_INSIGHT_BLOCK_PAGE_HANDLED,!1),p._processedTabFields.set(e,t)),t},_collectPIIFields:function(e,t){if(T(e)&&_(t)&&!(t.length<=0)){var i=E.performanceReporter.TYPE.COLLECT_PII_FIELDS+":"+Date.now(),n=(c.reportStartForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,i),p._getSITabInfo(e));const o=n.get(N.WAX_FIELDS_INFO);var r=o.size,a=(t.every(e=>o.add(e)),o.size);p._processedTabFields.set(e,n),A.debug("Received WAX fields for tabID : "+e+" arrPIIFields : "+t),A.debug("Processed Tab fields map after wax update : "+e),A.debug(p._processedTabFields.get(e)),r<a&&p._calculateScamInsightRating(e),c.reportStopForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,i)}},_getMatchedFields:function(e,t){return I(t)||0===t.size||I(e)||0===e.size?new Set:e.has("*")?t:new Set([...e].filter(e=>t.has(e)))},_piiProtoSubmission:function(e,t,i){var n,r,a;return!l.isTelemetryEnabled()||(n=u.getPIISUbmissionObj(),S(n))||I(i)||0===i.size?null:(r=E.performanceReporter.TYPE.PII_PROTO_SUBMISSION+":"+Date.now(),c.reportStartForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,r),a=e.getFullURL(),e=e.getPIIPolID(),n.setSiteUrl(a),n.setSubmissionTime(),n.piiSubmissionItem.PII_FLAGS=t,n.piiSubmissionItem.PII_POLICYID=e,n.piiSubmissionItem.FORM_FIELDS=[...i],u.submitShastaPII(n).then(e=>{A.debug("Protobuf submission successful"),o.telemetryWrapper.sendPIISubmissionStatusEvent(E.PII_SUBMISSION_STATUS.SUCCESS)}).catch(function(e){A.debug("Protobuf submission failed - "+e),o.telemetryWrapper.sendPIISubmissionStatusEvent(E.PII_SUBMISSION_STATUS.FAILURE)}),void c.reportStopForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,r))},getBlockPageData:function(e){var t,i,n;return!T(e)||(t=p._PIISubmissionInfo.get(e),I(t))?null:(i={},n=t.get(N.WRS_SCAM_RESPONSE),t.get(N.PII_SUBMITTED)||(p.sendPIISubmission(E.PII_FLAGS.EXIT_SITE,e),t.set(N.PII_SUBMITTED,!0),p._PIISubmissionInfo.set(e,t)),i.url=n.getFullURL(),i.ageScore=n.getPIIAge(),i.prevalenceScore=n.getPIIPop(),i)},sendPIISubmission:function(e,t){var i,n;return!T(t)||!T(e)||-1===Object.values(E.PII_FLAGS).indexOf(e)||(t=p._PIISubmissionInfo.get(t),I(t))?null:(i=E.performanceReporter.TYPE.SEND_PII_SUBMISSION+":"+Date.now(),c.reportStartForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,i),n=t.get(N.WRS_SCAM_RESPONSE),t=t.get(N.MATCHED_FIELDS),p._piiProtoSubmission(n,e,t),void c.reportStopForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,i))},_sendPIISubmissionSilentRating:function(e){var t,i,n,r;return!T(e)||(t=p._processedTabFields.get(e),I(t))?null:(i=t.get(N.WRS_SCAM_RESPONSE),n=t.get(N.MATCHED_FIELDS),r=t.get(N.PII_FLAG),p._piiProtoSubmission(i,r,n),t.set(N.PII_SUBMITTED,!0),void p._processedTabFields.set(e,t))},_sendPIISubmissionSilentRatingOnTabClose:function(e){var t,i,n;return!T(e)||(e=p._processedTabFields.get(e),I(e))?null:void(e.get(N.PII_SUBMITTED)||(t=e.get(N.WRS_SCAM_RESPONSE),i=e.get(N.PII_FLAG),n=e.get(N.MATCHED_FIELDS),e=e.get(N.PII_SUBMISSION_TIMER),p._piiProtoSubmission(t,i,n),clearTimeout(e)))},_calculateScamInsightRating:function(e){if(!T(e))return null;var t=p._processedTabFields.get(e);if(I(t))return null;var i=t.get(N.WAX_FIELDS_INFO),n=t.get(N.WRS_SCAM_RESPONSE);if(I(i)||0===i.size||S(n))return null;var i=[E.SCAM_INSIGHT_RESULT.SUSPICIOUS_PAGE,E.SCAM_INSIGHT_RESULT.SUSPICIOUS_NO_BLOCK_PAGE],r=n.getScamRating();if(I(r))throw new Error("ScamInsight rating cannot be null");var a=E.performanceReporter.TYPE.CALCULATE_SCAM_RATING+":"+Date.now();if(c.reportStartForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,a),i.includes(r))p._handleCacheResponse(e,n),A.debug("Handled scam rating from cache for tabId : "+e);else{switch(n.getPIIEnValue()){case E.WRS_RATINGS.PII_NOT_ENABLED:case E.WRS_RATINGS.UNKNOWN_SITE:break;case E.WRS_RATINGS.PII_ENABLED:case E.WRS_RATINGS.PII_SILENCE:p._handlePIIEnabledRating(e,t)}c.reportStopForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,a)}},_handlePIIEnabledRating:function(t,i){var e=E.performanceReporter.TYPE.HANDLE_PII_RATING+":"+Date.now(),n=(c.reportStartForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,e),i.get(N.WAX_FIELDS_INFO)),r=i.get(N.WRS_SCAM_RESPONSE),a=r.getPIIEnValue(),o=new Set(r.getPIIFieldType());if(I(o)||0===o.size)return null;o=p._getMatchedFields(o,n);if(I(o)||0===o.size)return p._updateCachedScamRating(r,E.SCAM_INSIGHT_RESULT.NOT_SUSPICIOUS_PAGE),null;i.set(N.MATCHED_FIELDS,o),p._processedTabFields.set(t,i),A.debug("Processed Tab fields map after matched fields update : "+t),A.debug(p._processedTabFields.get(t));let s=r.getPIIHTTPS();I(s)&&(s=E.PII_POLICY_HTTPS_KEYS.DONTCARE);n=r.getFullURL();let S=R(n);if(I(S)&&(S=E.HTTP_PROTOCOL),a===E.WRS_RATINGS.PII_ENABLED&&s===E.PII_POLICY_HTTPS_KEYS.DONTCARE||a===E.WRS_RATINGS.PII_ENABLED&&s===E.PII_POLICY_HTTPS_KEYS.HTTPS&&S===E.HTTP_PROTOCOL)p._handleScamPageFoundCallback(t,n),p._updateCachedScamRating(r,E.SCAM_INSIGHT_RESULT.SUSPICIOUS_PAGE);else{let e=0;a===E.WRS_RATINGS.PII_ENABLED&&s===E.PII_POLICY_HTTPS_KEYS.HTTPS&&S===E.HTTPS_PROTOCOL&&(e=E.PII_FLAGS.SUPPRESSED_DUE_TO_HTTPS),a===E.WRS_RATINGS.PII_SILENCE&&(e=E.PII_FLAGS.SUPPRESSED_DUE_TO_SILENTMODE),i.get(N.PII_SUBMISSION_TIMER)||(o=setTimeout(p._sendPIISubmissionSilentRating,E.PII_SUBMISSION_TIMEOUT,t),i.set(N.PII_FLAG,e),i.set(N.PII_SUBMISSION_TIMER,o),p._processedTabFields.set(t,i)),p._updateCachedScamRating(r,E.SCAM_INSIGHT_RESULT.SUSPICIOUS_NO_BLOCK_PAGE)}c.reportStopForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,e)},setWrsResponse:function(e,t){var i,n=E.performanceReporter.TYPE.SET_WRS_RESPONSE+":"+Date.now();c.reportStartForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,n),I(e)||S(t)||(A.debug("WRS response set. TabId : "+e+" url : "+t.fullURL),(i=p._getSITabInfo(e)).set(N.WRS_SCAM_RESPONSE,t),(t=t.getPIIEnValue())!==E.WRS_RATINGS.PII_ENABLED&&t!==E.WRS_RATINGS.PII_SILENCE||s.getTab(e,function(e){s.sendMessageToTab(e,{id:E.MESSAGES.PROCESS_PAGE_FOR_SCAM_FIELDS,state:E.SCAM_ANALYSIS_STATE.ANALYZE})}),p._processedTabFields.set(e,i),p._calculateScamInsightRating(e),c.reportStopForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,n))},deletePIISubmissionInfo:function(e){var t;return!T(e)||(t=p._PIISubmissionInfo.get(e),I(t))?null:void p._PIISubmissionInfo.delete(e)},_handleTabClose:function(e){if(!T(e))return null;p.deletePIISubmissionInfo(e)},_handleMessage:function(e,t,i){if(!I(e)&&!I(e.id)){var n=s.getTabID(i);switch(e.id){case E.MESSAGES.WAX_FIELDS_FOUND:I(e.data)||(r=e.data).length<=0||p._collectPIIFields(n,r);break;case E.MESSAGES.TOP_FRAME_UNLOADED:var r=E.performanceReporter.TYPE.TOP_FRAME_UNLOADED+":"+Date.now(),a=(c.reportStartForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,r),p._processedTabFields.get(n));I(a)||(a.get(N.PII_SUBMISSION_TIMER)&&p._sendPIISubmissionSilentRatingOnTabClose(n),p._processedTabFields.delete(n),c.reportStopForComponent(E.performanceReporter.COMPONENT.SCAM_INSIGHT,r));break;case E.MESSAGES.CAN_ANALYZE_FOR_SCAM:var a=p._processedTabFields.get(n);I(a)||(r=a.get(N.WRS_SCAM_RESPONSE),I(r))||(a=r.getPIIEnValue())!==E.WRS_RATINGS.PII_ENABLED&&a!==E.WRS_RATINGS.PII_SILENCE||t(E.SCAM_ANALYSIS_STATE.ANALYZE)}}},_handleScamPageFoundCallback:function(e,t){var i,n,r;!T(e)||o.scamInsightUtility.isURLInViewAnywayCache(t)||(t=p._processedTabFields.get(e),I(t))||(i=t.get(N.SCAM_INSIGHT_BLOCK_PAGE_HANDLED),a(i)&&!0===i)||(i=t.get(N.MATCHED_FIELDS),n=t.get(N.WRS_SCAM_RESPONSE),A.debug("Scam Page detected : "),A.debug(t),p._scamPageFoundCallback(e),(r=new Map).set(N.WRS_SCAM_RESPONSE,n),r.set(N.MATCHED_FIELDS,i),r.set(N.PII_SUBMITTED,!1),p._PIISubmissionInfo.set(e,r),t.set(N.SCAM_INSIGHT_BLOCK_PAGE_HANDLED,!0),p._processedTabFields.set(e,t))},_handleCacheResponse:function(e,t){T(e)&&!I(t)&&t.getScamRating()===E.SCAM_INSIGHT_RESULT.SUSPICIOUS_PAGE&&i(p._scamPageFoundCallback)&&p._handleScamPageFoundCallback(e,t.getFullURL())},_updateCachedScamRating:function(e,t){I(e)||!T(t)||(e=o.cache.ratingForCachedURL(e.getFullURL()),I(e))||e.getScamRating()!==t&&(e[E.SCAM_INSIGHT_RATING_KEY]=t,o.cache.updateCacheRatingsForUrl(e))}};return p.initialize(),p}(e.SymBfw,e.SafeWeb)}(executionContext);