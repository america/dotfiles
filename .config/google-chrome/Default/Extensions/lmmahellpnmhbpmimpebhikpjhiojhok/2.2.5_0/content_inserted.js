/*! For license information please see content_inserted.js.LICENSE.txt */
(()=>{var e={955:function(e,t,n){var r;e.exports=(r=n(9021),n(754),n(4636),n(9506),n(7165),function(){var e=r,t=e.lib.BlockCipher,n=e.algo,i=[],s=[],o=[],a=[],l=[],c=[],h=[],u=[],d=[],f=[];!function(){for(var e=[],t=0;t<256;t++)e[t]=t<128?t<<1:t<<1^283;var n=0,r=0;for(t=0;t<256;t++){var p=r^r<<1^r<<2^r<<3^r<<4;p=p>>>8^255&p^99,i[n]=p,s[p]=n;var g=e[n],v=e[g],m=e[v],y=257*e[p]^16843008*p;o[n]=y<<24|y>>>8,a[n]=y<<16|y>>>16,l[n]=y<<8|y>>>24,c[n]=y,y=16843009*m^65537*v^257*g^16843008*n,h[p]=y<<24|y>>>8,u[p]=y<<16|y>>>16,d[p]=y<<8|y>>>24,f[p]=y,n?(n=g^e[e[e[m^g]]],r^=e[e[r]]):n=r=1}}();var p=[0,1,2,4,8,16,32,64,128,27,54],g=n.AES=t.extend({_doReset:function(){if(!this._nRounds||this._keyPriorReset!==this._key){for(var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4,r=4*((this._nRounds=n+6)+1),s=this._keySchedule=[],o=0;o<r;o++)o<n?s[o]=t[o]:(c=s[o-1],o%n?n>6&&o%n==4&&(c=i[c>>>24]<<24|i[c>>>16&255]<<16|i[c>>>8&255]<<8|i[255&c]):(c=i[(c=c<<8|c>>>24)>>>24]<<24|i[c>>>16&255]<<16|i[c>>>8&255]<<8|i[255&c],c^=p[o/n|0]<<24),s[o]=s[o-n]^c);for(var a=this._invKeySchedule=[],l=0;l<r;l++){if(o=r-l,l%4)var c=s[o];else c=s[o-4];a[l]=l<4||o<=4?c:h[i[c>>>24]]^u[i[c>>>16&255]]^d[i[c>>>8&255]]^f[i[255&c]]}}},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._keySchedule,o,a,l,c,i)},decryptBlock:function(e,t){var n=e[t+1];e[t+1]=e[t+3],e[t+3]=n,this._doCryptBlock(e,t,this._invKeySchedule,h,u,d,f,s),n=e[t+1],e[t+1]=e[t+3],e[t+3]=n},_doCryptBlock:function(e,t,n,r,i,s,o,a){for(var l=this._nRounds,c=e[t]^n[0],h=e[t+1]^n[1],u=e[t+2]^n[2],d=e[t+3]^n[3],f=4,p=1;p<l;p++){var g=r[c>>>24]^i[h>>>16&255]^s[u>>>8&255]^o[255&d]^n[f++],v=r[h>>>24]^i[u>>>16&255]^s[d>>>8&255]^o[255&c]^n[f++],m=r[u>>>24]^i[d>>>16&255]^s[c>>>8&255]^o[255&h]^n[f++],y=r[d>>>24]^i[c>>>16&255]^s[h>>>8&255]^o[255&u]^n[f++];c=g,h=v,u=m,d=y}g=(a[c>>>24]<<24|a[h>>>16&255]<<16|a[u>>>8&255]<<8|a[255&d])^n[f++],v=(a[h>>>24]<<24|a[u>>>16&255]<<16|a[d>>>8&255]<<8|a[255&c])^n[f++],m=(a[u>>>24]<<24|a[d>>>16&255]<<16|a[c>>>8&255]<<8|a[255&h])^n[f++],y=(a[d>>>24]<<24|a[c>>>16&255]<<16|a[h>>>8&255]<<8|a[255&u])^n[f++],e[t]=g,e[t+1]=v,e[t+2]=m,e[t+3]=y},keySize:8});e.AES=t._createHelper(g)}(),r.AES)},3128:function(e,t,n){var r;e.exports=(r=n(9021),n(754),n(4636),n(9506),n(7165),function(){var e=r,t=e.lib.BlockCipher,n=e.algo;const i=16,s=[608135816,2242054355,320440878,57701188,2752067618,698298832,137296536,3964562569,1160258022,953160567,3193202383,887688300,3232508343,3380367581,1065670069,3041331479,2450970073,2306472731],o=[[3509652390,2564797868,805139163,3491422135,3101798381,1780907670,3128725573,4046225305,614570311,3012652279,134345442,2240740374,1667834072,1901547113,2757295779,4103290238,227898511,1921955416,1904987480,2182433518,2069144605,3260701109,2620446009,720527379,3318853667,677414384,3393288472,3101374703,2390351024,1614419982,1822297739,2954791486,3608508353,3174124327,2024746970,1432378464,3864339955,2857741204,1464375394,1676153920,1439316330,715854006,3033291828,289532110,2706671279,2087905683,3018724369,1668267050,732546397,1947742710,3462151702,2609353502,2950085171,1814351708,2050118529,680887927,999245976,1800124847,3300911131,1713906067,1641548236,4213287313,1216130144,1575780402,4018429277,3917837745,3693486850,3949271944,596196993,3549867205,258830323,2213823033,772490370,2760122372,1774776394,2652871518,566650946,4142492826,1728879713,2882767088,1783734482,3629395816,2517608232,2874225571,1861159788,326777828,3124490320,2130389656,2716951837,967770486,1724537150,2185432712,2364442137,1164943284,2105845187,998989502,3765401048,2244026483,1075463327,1455516326,1322494562,910128902,469688178,1117454909,936433444,3490320968,3675253459,1240580251,122909385,2157517691,634681816,4142456567,3825094682,3061402683,2540495037,79693498,3249098678,1084186820,1583128258,426386531,1761308591,1047286709,322548459,995290223,1845252383,2603652396,3431023940,2942221577,3202600964,3727903485,1712269319,422464435,3234572375,1170764815,3523960633,3117677531,1434042557,442511882,3600875718,1076654713,1738483198,4213154764,2393238008,3677496056,1014306527,4251020053,793779912,2902807211,842905082,4246964064,1395751752,1040244610,2656851899,3396308128,445077038,3742853595,3577915638,679411651,2892444358,2354009459,1767581616,3150600392,3791627101,3102740896,284835224,4246832056,1258075500,768725851,2589189241,3069724005,3532540348,1274779536,3789419226,2764799539,1660621633,3471099624,4011903706,913787905,3497959166,737222580,2514213453,2928710040,3937242737,1804850592,3499020752,2949064160,2386320175,2390070455,2415321851,4061277028,2290661394,2416832540,1336762016,1754252060,3520065937,3014181293,791618072,3188594551,3933548030,2332172193,3852520463,3043980520,413987798,3465142937,3030929376,4245938359,2093235073,3534596313,375366246,2157278981,2479649556,555357303,3870105701,2008414854,3344188149,4221384143,3956125452,2067696032,3594591187,2921233993,2428461,544322398,577241275,1471733935,610547355,4027169054,1432588573,1507829418,2025931657,3646575487,545086370,48609733,2200306550,1653985193,298326376,1316178497,3007786442,2064951626,458293330,2589141269,3591329599,3164325604,727753846,2179363840,146436021,1461446943,4069977195,705550613,3059967265,3887724982,4281599278,3313849956,1404054877,2845806497,146425753,1854211946],[1266315497,3048417604,3681880366,3289982499,290971e4,1235738493,2632868024,2414719590,3970600049,1771706367,1449415276,3266420449,422970021,1963543593,2690192192,3826793022,1062508698,1531092325,1804592342,2583117782,2714934279,4024971509,1294809318,4028980673,1289560198,2221992742,1669523910,35572830,157838143,1052438473,1016535060,1802137761,1753167236,1386275462,3080475397,2857371447,1040679964,2145300060,2390574316,1461121720,2956646967,4031777805,4028374788,33600511,2920084762,1018524850,629373528,3691585981,3515945977,2091462646,2486323059,586499841,988145025,935516892,3367335476,2599673255,2839830854,265290510,3972581182,2759138881,3795373465,1005194799,847297441,406762289,1314163512,1332590856,1866599683,4127851711,750260880,613907577,1450815602,3165620655,3734664991,3650291728,3012275730,3704569646,1427272223,778793252,1343938022,2676280711,2052605720,1946737175,3164576444,3914038668,3967478842,3682934266,1661551462,3294938066,4011595847,840292616,3712170807,616741398,312560963,711312465,1351876610,322626781,1910503582,271666773,2175563734,1594956187,70604529,3617834859,1007753275,1495573769,4069517037,2549218298,2663038764,504708206,2263041392,3941167025,2249088522,1514023603,1998579484,1312622330,694541497,2582060303,2151582166,1382467621,776784248,2618340202,3323268794,2497899128,2784771155,503983604,4076293799,907881277,423175695,432175456,1378068232,4145222326,3954048622,3938656102,3820766613,2793130115,2977904593,26017576,3274890735,3194772133,1700274565,1756076034,4006520079,3677328699,720338349,1533947780,354530856,688349552,3973924725,1637815568,332179504,3949051286,53804574,2852348879,3044236432,1282449977,3583942155,3416972820,4006381244,1617046695,2628476075,3002303598,1686838959,431878346,2686675385,1700445008,1080580658,1009431731,832498133,3223435511,2605976345,2271191193,2516031870,1648197032,4164389018,2548247927,300782431,375919233,238389289,3353747414,2531188641,2019080857,1475708069,455242339,2609103871,448939670,3451063019,1395535956,2413381860,1841049896,1491858159,885456874,4264095073,4001119347,1565136089,3898914787,1108368660,540939232,1173283510,2745871338,3681308437,4207628240,3343053890,4016749493,1699691293,1103962373,3625875870,2256883143,3830138730,1031889488,3479347698,1535977030,4236805024,3251091107,2132092099,1774941330,1199868427,1452454533,157007616,2904115357,342012276,595725824,1480756522,206960106,497939518,591360097,863170706,2375253569,3596610801,1814182875,2094937945,3421402208,1082520231,3463918190,2785509508,435703966,3908032597,1641649973,2842273706,3305899714,1510255612,2148256476,2655287854,3276092548,4258621189,236887753,3681803219,274041037,1734335097,3815195456,3317970021,1899903192,1026095262,4050517792,356393447,2410691914,3873677099,3682840055],[3913112168,2491498743,4132185628,2489919796,1091903735,1979897079,3170134830,3567386728,3557303409,857797738,1136121015,1342202287,507115054,2535736646,337727348,3213592640,1301675037,2528481711,1895095763,1721773893,3216771564,62756741,2142006736,835421444,2531993523,1442658625,3659876326,2882144922,676362277,1392781812,170690266,3921047035,1759253602,3611846912,1745797284,664899054,1329594018,3901205900,3045908486,2062866102,2865634940,3543621612,3464012697,1080764994,553557557,3656615353,3996768171,991055499,499776247,1265440854,648242737,3940784050,980351604,3713745714,1749149687,3396870395,4211799374,3640570775,1161844396,3125318951,1431517754,545492359,4268468663,3499529547,1437099964,2702547544,3433638243,2581715763,2787789398,1060185593,1593081372,2418618748,4260947970,69676912,2159744348,86519011,2512459080,3838209314,1220612927,3339683548,133810670,1090789135,1078426020,1569222167,845107691,3583754449,4072456591,1091646820,628848692,1613405280,3757631651,526609435,236106946,48312990,2942717905,3402727701,1797494240,859738849,992217954,4005476642,2243076622,3870952857,3732016268,765654824,3490871365,2511836413,1685915746,3888969200,1414112111,2273134842,3281911079,4080962846,172450625,2569994100,980381355,4109958455,2819808352,2716589560,2568741196,3681446669,3329971472,1835478071,660984891,3704678404,4045999559,3422617507,3040415634,1762651403,1719377915,3470491036,2693910283,3642056355,3138596744,1364962596,2073328063,1983633131,926494387,3423689081,2150032023,4096667949,1749200295,3328846651,309677260,2016342300,1779581495,3079819751,111262694,1274766160,443224088,298511866,1025883608,3806446537,1145181785,168956806,3641502830,3584813610,1689216846,3666258015,3200248200,1692713982,2646376535,4042768518,1618508792,1610833997,3523052358,4130873264,2001055236,3610705100,2202168115,4028541809,2961195399,1006657119,2006996926,3186142756,1430667929,3210227297,1314452623,4074634658,4101304120,2273951170,1399257539,3367210612,3027628629,1190975929,2062231137,2333990788,2221543033,2438960610,1181637006,548689776,2362791313,3372408396,3104550113,3145860560,296247880,1970579870,3078560182,3769228297,1714227617,3291629107,3898220290,166772364,1251581989,493813264,448347421,195405023,2709975567,677966185,3703036547,1463355134,2715995803,1338867538,1343315457,2802222074,2684532164,233230375,2599980071,2000651841,3277868038,1638401717,4028070440,3237316320,6314154,819756386,300326615,590932579,1405279636,3267499572,3150704214,2428286686,3959192993,3461946742,1862657033,1266418056,963775037,2089974820,2263052895,1917689273,448879540,3550394620,3981727096,150775221,3627908307,1303187396,508620638,2975983352,2726630617,1817252668,1876281319,1457606340,908771278,3720792119,3617206836,2455994898,1729034894,1080033504],[976866871,3556439503,2881648439,1522871579,1555064734,1336096578,3548522304,2579274686,3574697629,3205460757,3593280638,3338716283,3079412587,564236357,2993598910,1781952180,1464380207,3163844217,3332601554,1699332808,1393555694,1183702653,3581086237,1288719814,691649499,2847557200,2895455976,3193889540,2717570544,1781354906,1676643554,2592534050,3230253752,1126444790,2770207658,2633158820,2210423226,2615765581,2414155088,3127139286,673620729,2805611233,1269405062,4015350505,3341807571,4149409754,1057255273,2012875353,2162469141,2276492801,2601117357,993977747,3918593370,2654263191,753973209,36408145,2530585658,25011837,3520020182,2088578344,530523599,2918365339,1524020338,1518925132,3760827505,3759777254,1202760957,3985898139,3906192525,674977740,4174734889,2031300136,2019492241,3983892565,4153806404,3822280332,352677332,2297720250,60907813,90501309,3286998549,1016092578,2535922412,2839152426,457141659,509813237,4120667899,652014361,1966332200,2975202805,55981186,2327461051,676427537,3255491064,2882294119,3433927263,1307055953,942726286,933058658,2468411793,3933900994,4215176142,1361170020,2001714738,2830558078,3274259782,1222529897,1679025792,2729314320,3714953764,1770335741,151462246,3013232138,1682292957,1483529935,471910574,1539241949,458788160,3436315007,1807016891,3718408830,978976581,1043663428,3165965781,1927990952,4200891579,2372276910,3208408903,3533431907,1412390302,2931980059,4132332400,1947078029,3881505623,4168226417,2941484381,1077988104,1320477388,886195818,18198404,3786409e3,2509781533,112762804,3463356488,1866414978,891333506,18488651,661792760,1628790961,3885187036,3141171499,876946877,2693282273,1372485963,791857591,2686433993,3759982718,3167212022,3472953795,2716379847,445679433,3561995674,3504004811,3574258232,54117162,3331405415,2381918588,3769707343,4154350007,1140177722,4074052095,668550556,3214352940,367459370,261225585,2610173221,4209349473,3468074219,3265815641,314222801,3066103646,3808782860,282218597,3406013506,3773591054,379116347,1285071038,846784868,2669647154,3771962079,3550491691,2305946142,453669953,1268987020,3317592352,3279303384,3744833421,2610507566,3859509063,266596637,3847019092,517658769,3462560207,3443424879,370717030,4247526661,2224018117,4143653529,4112773975,2788324899,2477274417,1456262402,2901442914,1517677493,1846949527,2295493580,3734397586,2176403920,1280348187,1908823572,3871786941,846861322,1172426758,3287448474,3383383037,1655181056,3139813346,901632758,1897031941,2986607138,3066810236,3447102507,1393639104,373351379,950779232,625454576,3124240540,4148612726,2007998917,544563296,2244738638,2330496472,2058025392,1291430526,424198748,50039436,29584100,3605783033,2429876329,2791104160,1057563949,3255363231,3075367218,3463963227,1469046755,985887462]];var a={pbox:[],sbox:[]};function l(e,t){let n=t>>24&255,r=t>>16&255,i=t>>8&255,s=255&t,o=e.sbox[0][n]+e.sbox[1][r];return o^=e.sbox[2][i],o+=e.sbox[3][s],o}function c(e,t,n){let r,s=t,o=n;for(let t=0;t<i;++t)s^=e.pbox[t],o=l(e,s)^o,r=s,s=o,o=r;return r=s,s=o,o=r,o^=e.pbox[i],s^=e.pbox[i+1],{left:s,right:o}}function h(e,t,n){let r,s=t,o=n;for(let t=i+1;t>1;--t)s^=e.pbox[t],o=l(e,s)^o,r=s,s=o,o=r;return r=s,s=o,o=r,o^=e.pbox[1],s^=e.pbox[0],{left:s,right:o}}function u(e,t,n){for(let t=0;t<4;t++){e.sbox[t]=[];for(let n=0;n<256;n++)e.sbox[t][n]=o[t][n]}let r=0;for(let o=0;o<i+2;o++)e.pbox[o]=s[o]^t[r],r++,r>=n&&(r=0);let a=0,l=0,h=0;for(let t=0;t<i+2;t+=2)h=c(e,a,l),a=h.left,l=h.right,e.pbox[t]=a,e.pbox[t+1]=l;for(let t=0;t<4;t++)for(let n=0;n<256;n+=2)h=c(e,a,l),a=h.left,l=h.right,e.sbox[t][n]=a,e.sbox[t][n+1]=l;return!0}var d=n.Blowfish=t.extend({_doReset:function(){if(this._keyPriorReset!==this._key){var e=this._keyPriorReset=this._key,t=e.words,n=e.sigBytes/4;u(a,t,n)}},encryptBlock:function(e,t){var n=c(a,e[t],e[t+1]);e[t]=n.left,e[t+1]=n.right},decryptBlock:function(e,t){var n=h(a,e[t],e[t+1]);e[t]=n.left,e[t+1]=n.right},blockSize:2,keySize:4,ivSize:2});e.Blowfish=t._createHelper(d)}(),r.Blowfish)},7165:function(e,t,n){var r;e.exports=(r=n(9021),n(9506),void(r.lib.Cipher||function(e){var t=r,n=t.lib,i=n.Base,s=n.WordArray,o=n.BufferedBlockAlgorithm,a=t.enc,l=(a.Utf8,a.Base64),c=t.algo.EvpKDF,h=n.Cipher=o.extend({cfg:i.extend(),createEncryptor:function(e,t){return this.create(this._ENC_XFORM_MODE,e,t)},createDecryptor:function(e,t){return this.create(this._DEC_XFORM_MODE,e,t)},init:function(e,t,n){this.cfg=this.cfg.extend(n),this._xformMode=e,this._key=t,this.reset()},reset:function(){o.reset.call(this),this._doReset()},process:function(e){return this._append(e),this._process()},finalize:function(e){return e&&this._append(e),this._doFinalize()},keySize:4,ivSize:4,_ENC_XFORM_MODE:1,_DEC_XFORM_MODE:2,_createHelper:function(){function e(e){return"string"==typeof e?b:m}return function(t){return{encrypt:function(n,r,i){return e(r).encrypt(t,n,r,i)},decrypt:function(n,r,i){return e(r).decrypt(t,n,r,i)}}}}()}),u=(n.StreamCipher=h.extend({_doFinalize:function(){return this._process(!0)},blockSize:1}),t.mode={}),d=n.BlockCipherMode=i.extend({createEncryptor:function(e,t){return this.Encryptor.create(e,t)},createDecryptor:function(e,t){return this.Decryptor.create(e,t)},init:function(e,t){this._cipher=e,this._iv=t}}),f=u.CBC=function(){var t=d.extend();function n(t,n,r){var i,s=this._iv;s?(i=s,this._iv=e):i=this._prevBlock;for(var o=0;o<r;o++)t[n+o]^=i[o]}return t.Encryptor=t.extend({processBlock:function(e,t){var r=this._cipher,i=r.blockSize;n.call(this,e,t,i),r.encryptBlock(e,t),this._prevBlock=e.slice(t,t+i)}}),t.Decryptor=t.extend({processBlock:function(e,t){var r=this._cipher,i=r.blockSize,s=e.slice(t,t+i);r.decryptBlock(e,t),n.call(this,e,t,i),this._prevBlock=s}}),t}(),p=(t.pad={}).Pkcs7={pad:function(e,t){for(var n=4*t,r=n-e.sigBytes%n,i=r<<24|r<<16|r<<8|r,o=[],a=0;a<r;a+=4)o.push(i);var l=s.create(o,r);e.concat(l)},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},g=(n.BlockCipher=h.extend({cfg:h.cfg.extend({mode:f,padding:p}),reset:function(){var e;h.reset.call(this);var t=this.cfg,n=t.iv,r=t.mode;this._xformMode==this._ENC_XFORM_MODE?e=r.createEncryptor:(e=r.createDecryptor,this._minBufferSize=1),this._mode&&this._mode.__creator==e?this._mode.init(this,n&&n.words):(this._mode=e.call(r,this,n&&n.words),this._mode.__creator=e)},_doProcessBlock:function(e,t){this._mode.processBlock(e,t)},_doFinalize:function(){var e,t=this.cfg.padding;return this._xformMode==this._ENC_XFORM_MODE?(t.pad(this._data,this.blockSize),e=this._process(!0)):(e=this._process(!0),t.unpad(e)),e},blockSize:4}),n.CipherParams=i.extend({init:function(e){this.mixIn(e)},toString:function(e){return(e||this.formatter).stringify(this)}})),v=(t.format={}).OpenSSL={stringify:function(e){var t=e.ciphertext,n=e.salt;return(n?s.create([1398893684,1701076831]).concat(n).concat(t):t).toString(l)},parse:function(e){var t,n=l.parse(e),r=n.words;return 1398893684==r[0]&&1701076831==r[1]&&(t=s.create(r.slice(2,4)),r.splice(0,4),n.sigBytes-=16),g.create({ciphertext:n,salt:t})}},m=n.SerializableCipher=i.extend({cfg:i.extend({format:v}),encrypt:function(e,t,n,r){r=this.cfg.extend(r);var i=e.createEncryptor(n,r),s=i.finalize(t),o=i.cfg;return g.create({ciphertext:s,key:n,iv:o.iv,algorithm:e,mode:o.mode,padding:o.padding,blockSize:e.blockSize,formatter:r.format})},decrypt:function(e,t,n,r){return r=this.cfg.extend(r),t=this._parse(t,r.format),e.createDecryptor(n,r).finalize(t.ciphertext)},_parse:function(e,t){return"string"==typeof e?t.parse(e,this):e}}),y=(t.kdf={}).OpenSSL={execute:function(e,t,n,r,i){if(r||(r=s.random(8)),i)o=c.create({keySize:t+n,hasher:i}).compute(e,r);else var o=c.create({keySize:t+n}).compute(e,r);var a=s.create(o.words.slice(t),4*n);return o.sigBytes=4*t,g.create({key:o,iv:a,salt:r})}},b=n.PasswordBasedCipher=m.extend({cfg:m.cfg.extend({kdf:y}),encrypt:function(e,t,n,r){var i=(r=this.cfg.extend(r)).kdf.execute(n,e.keySize,e.ivSize,r.salt,r.hasher);r.iv=i.iv;var s=m.encrypt.call(this,e,t,i.key,r);return s.mixIn(i),s},decrypt:function(e,t,n,r){r=this.cfg.extend(r),t=this._parse(t,r.format);var i=r.kdf.execute(n,e.keySize,e.ivSize,t.salt,r.hasher);return r.iv=i.iv,m.decrypt.call(this,e,t,i.key,r)}})}()))},9021:function(e,t,n){var r;e.exports=(r=r||function(e,t){var r;if("undefined"!=typeof window&&window.crypto&&(r=window.crypto),"undefined"!=typeof self&&self.crypto&&(r=self.crypto),"undefined"!=typeof globalThis&&globalThis.crypto&&(r=globalThis.crypto),!r&&"undefined"!=typeof window&&window.msCrypto&&(r=window.msCrypto),!r&&void 0!==n.g&&n.g.crypto&&(r=n.g.crypto),!r)try{r=n(477)}catch(e){}var i=function(){if(r){if("function"==typeof r.getRandomValues)try{return r.getRandomValues(new Uint32Array(1))[0]}catch(e){}if("function"==typeof r.randomBytes)try{return r.randomBytes(4).readInt32LE()}catch(e){}}throw new Error("Native crypto module could not be used to get secure random number.")},s=Object.create||function(){function e(){}return function(t){var n;return e.prototype=t,n=new e,e.prototype=null,n}}(),o={},a=o.lib={},l=a.Base={extend:function(e){var t=s(this);return e&&t.mixIn(e),t.hasOwnProperty("init")&&this.init!==t.init||(t.init=function(){t.$super.init.apply(this,arguments)}),t.init.prototype=t,t.$super=this,t},create:function(){var e=this.extend();return e.init.apply(e,arguments),e},init:function(){},mixIn:function(e){for(var t in e)e.hasOwnProperty(t)&&(this[t]=e[t]);e.hasOwnProperty("toString")&&(this.toString=e.toString)},clone:function(){return this.init.prototype.extend(this)}},c=a.WordArray=l.extend({init:function(e,n){e=this.words=e||[],this.sigBytes=n!=t?n:4*e.length},toString:function(e){return(e||u).stringify(this)},concat:function(e){var t=this.words,n=e.words,r=this.sigBytes,i=e.sigBytes;if(this.clamp(),r%4)for(var s=0;s<i;s++){var o=n[s>>>2]>>>24-s%4*8&255;t[r+s>>>2]|=o<<24-(r+s)%4*8}else for(var a=0;a<i;a+=4)t[r+a>>>2]=n[a>>>2];return this.sigBytes+=i,this},clamp:function(){var t=this.words,n=this.sigBytes;t[n>>>2]&=4294967295<<32-n%4*8,t.length=e.ceil(n/4)},clone:function(){var e=l.clone.call(this);return e.words=this.words.slice(0),e},random:function(e){for(var t=[],n=0;n<e;n+=4)t.push(i());return new c.init(t,e)}}),h=o.enc={},u=h.Hex={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;r.push((s>>>4).toString(16)),r.push((15&s).toString(16))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r+=2)n[r>>>3]|=parseInt(e.substr(r,2),16)<<24-r%8*4;return new c.init(n,t/2)}},d=h.Latin1={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i++){var s=t[i>>>2]>>>24-i%4*8&255;r.push(String.fromCharCode(s))}return r.join("")},parse:function(e){for(var t=e.length,n=[],r=0;r<t;r++)n[r>>>2]|=(255&e.charCodeAt(r))<<24-r%4*8;return new c.init(n,t)}},f=h.Utf8={stringify:function(e){try{return decodeURIComponent(escape(d.stringify(e)))}catch(e){throw new Error("Malformed UTF-8 data")}},parse:function(e){return d.parse(unescape(encodeURIComponent(e)))}},p=a.BufferedBlockAlgorithm=l.extend({reset:function(){this._data=new c.init,this._nDataBytes=0},_append:function(e){"string"==typeof e&&(e=f.parse(e)),this._data.concat(e),this._nDataBytes+=e.sigBytes},_process:function(t){var n,r=this._data,i=r.words,s=r.sigBytes,o=this.blockSize,a=s/(4*o),l=(a=t?e.ceil(a):e.max((0|a)-this._minBufferSize,0))*o,h=e.min(4*l,s);if(l){for(var u=0;u<l;u+=o)this._doProcessBlock(i,u);n=i.splice(0,l),r.sigBytes-=h}return new c.init(n,h)},clone:function(){var e=l.clone.call(this);return e._data=this._data.clone(),e},_minBufferSize:0}),g=(a.Hasher=p.extend({cfg:l.extend(),init:function(e){this.cfg=this.cfg.extend(e),this.reset()},reset:function(){p.reset.call(this),this._doReset()},update:function(e){return this._append(e),this._process(),this},finalize:function(e){return e&&this._append(e),this._doFinalize()},blockSize:16,_createHelper:function(e){return function(t,n){return new e.init(n).finalize(t)}},_createHmacHelper:function(e){return function(t,n){return new g.HMAC.init(e,n).finalize(t)}}}),o.algo={});return o}(Math),r)},754:function(e,t,n){var r;e.exports=(r=n(9021),function(){var e=r,t=e.lib.WordArray;function n(e,n,r){for(var i=[],s=0,o=0;o<n;o++)if(o%4){var a=r[e.charCodeAt(o-1)]<<o%4*2|r[e.charCodeAt(o)]>>>6-o%4*2;i[s>>>2]|=a<<24-s%4*8,s++}return t.create(i,s)}e.enc.Base64={stringify:function(e){var t=e.words,n=e.sigBytes,r=this._map;e.clamp();for(var i=[],s=0;s<n;s+=3)for(var o=(t[s>>>2]>>>24-s%4*8&255)<<16|(t[s+1>>>2]>>>24-(s+1)%4*8&255)<<8|t[s+2>>>2]>>>24-(s+2)%4*8&255,a=0;a<4&&s+.75*a<n;a++)i.push(r.charAt(o>>>6*(3-a)&63));var l=r.charAt(64);if(l)for(;i.length%4;)i.push(l);return i.join("")},parse:function(e){var t=e.length,r=this._map,i=this._reverseMap;if(!i){i=this._reverseMap=[];for(var s=0;s<r.length;s++)i[r.charCodeAt(s)]=s}var o=r.charAt(64);if(o){var a=e.indexOf(o);-1!==a&&(t=a)}return n(e,t,i)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/="}}(),r.enc.Base64)},4725:function(e,t,n){var r;e.exports=(r=n(9021),function(){var e=r,t=e.lib.WordArray;function n(e,n,r){for(var i=[],s=0,o=0;o<n;o++)if(o%4){var a=r[e.charCodeAt(o-1)]<<o%4*2|r[e.charCodeAt(o)]>>>6-o%4*2;i[s>>>2]|=a<<24-s%4*8,s++}return t.create(i,s)}e.enc.Base64url={stringify:function(e,t){void 0===t&&(t=!0);var n=e.words,r=e.sigBytes,i=t?this._safe_map:this._map;e.clamp();for(var s=[],o=0;o<r;o+=3)for(var a=(n[o>>>2]>>>24-o%4*8&255)<<16|(n[o+1>>>2]>>>24-(o+1)%4*8&255)<<8|n[o+2>>>2]>>>24-(o+2)%4*8&255,l=0;l<4&&o+.75*l<r;l++)s.push(i.charAt(a>>>6*(3-l)&63));var c=i.charAt(64);if(c)for(;s.length%4;)s.push(c);return s.join("")},parse:function(e,t){void 0===t&&(t=!0);var r=e.length,i=t?this._safe_map:this._map,s=this._reverseMap;if(!s){s=this._reverseMap=[];for(var o=0;o<i.length;o++)s[i.charCodeAt(o)]=o}var a=i.charAt(64);if(a){var l=e.indexOf(a);-1!==l&&(r=l)}return n(e,r,s)},_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",_safe_map:"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789-_"}}(),r.enc.Base64url)},5503:function(e,t,n){var r;e.exports=(r=n(9021),function(){var e=r,t=e.lib.WordArray,n=e.enc;function i(e){return e<<8&4278255360|e>>>8&16711935}n.Utf16=n.Utf16BE={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],i=0;i<n;i+=2){var s=t[i>>>2]>>>16-i%4*8&65535;r.push(String.fromCharCode(s))}return r.join("")},parse:function(e){for(var n=e.length,r=[],i=0;i<n;i++)r[i>>>1]|=e.charCodeAt(i)<<16-i%2*16;return t.create(r,2*n)}},n.Utf16LE={stringify:function(e){for(var t=e.words,n=e.sigBytes,r=[],s=0;s<n;s+=2){var o=i(t[s>>>2]>>>16-s%4*8&65535);r.push(String.fromCharCode(o))}return r.join("")},parse:function(e){for(var n=e.length,r=[],s=0;s<n;s++)r[s>>>1]|=i(e.charCodeAt(s)<<16-s%2*16);return t.create(r,2*n)}}}(),r.enc.Utf16)},9506:function(e,t,n){var r,i,s,o,a,l,c,h;e.exports=(h=n(9021),n(5471),n(1025),i=(r=h).lib,s=i.Base,o=i.WordArray,a=r.algo,l=a.MD5,c=a.EvpKDF=s.extend({cfg:s.extend({keySize:4,hasher:l,iterations:1}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n,r=this.cfg,i=r.hasher.create(),s=o.create(),a=s.words,l=r.keySize,c=r.iterations;a.length<l;){n&&i.update(n),n=i.update(e).finalize(t),i.reset();for(var h=1;h<c;h++)n=i.finalize(n),i.reset();s.concat(n)}return s.sigBytes=4*l,s}}),r.EvpKDF=function(e,t,n){return c.create(n).compute(e,t)},h.EvpKDF)},25:function(e,t,n){var r,i,s,o;e.exports=(o=n(9021),n(7165),i=(r=o).lib.CipherParams,s=r.enc.Hex,r.format.Hex={stringify:function(e){return e.ciphertext.toString(s)},parse:function(e){var t=s.parse(e);return i.create({ciphertext:t})}},o.format.Hex)},1025:function(e,t,n){var r,i,s,o;e.exports=(r=n(9021),s=(i=r).lib.Base,o=i.enc.Utf8,void(i.algo.HMAC=s.extend({init:function(e,t){e=this._hasher=new e.init,"string"==typeof t&&(t=o.parse(t));var n=e.blockSize,r=4*n;t.sigBytes>r&&(t=e.finalize(t)),t.clamp();for(var i=this._oKey=t.clone(),s=this._iKey=t.clone(),a=i.words,l=s.words,c=0;c<n;c++)a[c]^=1549556828,l[c]^=909522486;i.sigBytes=s.sigBytes=r,this.reset()},reset:function(){var e=this._hasher;e.reset(),e.update(this._iKey)},update:function(e){return this._hasher.update(e),this},finalize:function(e){var t=this._hasher,n=t.finalize(e);return t.reset(),t.finalize(this._oKey.clone().concat(n))}})))},1396:function(e,t,n){var r;e.exports=(r=n(9021),n(3240),n(6440),n(5503),n(754),n(4725),n(4636),n(5471),n(3009),n(6308),n(1380),n(9557),n(5953),n(8056),n(1025),n(19),n(9506),n(7165),n(2169),n(6939),n(6372),n(3797),n(8454),n(2073),n(4905),n(482),n(2155),n(8124),n(25),n(955),n(7628),n(7193),n(6298),n(2696),n(3128),r)},6440:function(e,t,n){var r;e.exports=(r=n(9021),function(){if("function"==typeof ArrayBuffer){var e=r.lib.WordArray,t=e.init,n=e.init=function(e){if(e instanceof ArrayBuffer&&(e=new Uint8Array(e)),(e instanceof Int8Array||"undefined"!=typeof Uint8ClampedArray&&e instanceof Uint8ClampedArray||e instanceof Int16Array||e instanceof Uint16Array||e instanceof Int32Array||e instanceof Uint32Array||e instanceof Float32Array||e instanceof Float64Array)&&(e=new Uint8Array(e.buffer,e.byteOffset,e.byteLength)),e instanceof Uint8Array){for(var n=e.byteLength,r=[],i=0;i<n;i++)r[i>>>2]|=e[i]<<24-i%4*8;t.call(this,r,n)}else t.apply(this,arguments)};n.prototype=e}}(),r.lib.WordArray)},4636:function(e,t,n){var r;e.exports=(r=n(9021),function(e){var t=r,n=t.lib,i=n.WordArray,s=n.Hasher,o=t.algo,a=[];!function(){for(var t=0;t<64;t++)a[t]=4294967296*e.abs(e.sin(t+1))|0}();var l=o.MD5=s.extend({_doReset:function(){this._hash=new i.init([1732584193,4023233417,2562383102,271733878])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var r=t+n,i=e[r];e[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var s=this._hash.words,o=e[t+0],l=e[t+1],f=e[t+2],p=e[t+3],g=e[t+4],v=e[t+5],m=e[t+6],y=e[t+7],b=e[t+8],_=e[t+9],w=e[t+10],S=e[t+11],E=e[t+12],A=e[t+13],P=e[t+14],I=e[t+15],x=s[0],O=s[1],T=s[2],L=s[3];x=c(x,O,T,L,o,7,a[0]),L=c(L,x,O,T,l,12,a[1]),T=c(T,L,x,O,f,17,a[2]),O=c(O,T,L,x,p,22,a[3]),x=c(x,O,T,L,g,7,a[4]),L=c(L,x,O,T,v,12,a[5]),T=c(T,L,x,O,m,17,a[6]),O=c(O,T,L,x,y,22,a[7]),x=c(x,O,T,L,b,7,a[8]),L=c(L,x,O,T,_,12,a[9]),T=c(T,L,x,O,w,17,a[10]),O=c(O,T,L,x,S,22,a[11]),x=c(x,O,T,L,E,7,a[12]),L=c(L,x,O,T,A,12,a[13]),T=c(T,L,x,O,P,17,a[14]),x=h(x,O=c(O,T,L,x,I,22,a[15]),T,L,l,5,a[16]),L=h(L,x,O,T,m,9,a[17]),T=h(T,L,x,O,S,14,a[18]),O=h(O,T,L,x,o,20,a[19]),x=h(x,O,T,L,v,5,a[20]),L=h(L,x,O,T,w,9,a[21]),T=h(T,L,x,O,I,14,a[22]),O=h(O,T,L,x,g,20,a[23]),x=h(x,O,T,L,_,5,a[24]),L=h(L,x,O,T,P,9,a[25]),T=h(T,L,x,O,p,14,a[26]),O=h(O,T,L,x,b,20,a[27]),x=h(x,O,T,L,A,5,a[28]),L=h(L,x,O,T,f,9,a[29]),T=h(T,L,x,O,y,14,a[30]),x=u(x,O=h(O,T,L,x,E,20,a[31]),T,L,v,4,a[32]),L=u(L,x,O,T,b,11,a[33]),T=u(T,L,x,O,S,16,a[34]),O=u(O,T,L,x,P,23,a[35]),x=u(x,O,T,L,l,4,a[36]),L=u(L,x,O,T,g,11,a[37]),T=u(T,L,x,O,y,16,a[38]),O=u(O,T,L,x,w,23,a[39]),x=u(x,O,T,L,A,4,a[40]),L=u(L,x,O,T,o,11,a[41]),T=u(T,L,x,O,p,16,a[42]),O=u(O,T,L,x,m,23,a[43]),x=u(x,O,T,L,_,4,a[44]),L=u(L,x,O,T,E,11,a[45]),T=u(T,L,x,O,I,16,a[46]),x=d(x,O=u(O,T,L,x,f,23,a[47]),T,L,o,6,a[48]),L=d(L,x,O,T,y,10,a[49]),T=d(T,L,x,O,P,15,a[50]),O=d(O,T,L,x,v,21,a[51]),x=d(x,O,T,L,E,6,a[52]),L=d(L,x,O,T,p,10,a[53]),T=d(T,L,x,O,w,15,a[54]),O=d(O,T,L,x,l,21,a[55]),x=d(x,O,T,L,b,6,a[56]),L=d(L,x,O,T,I,10,a[57]),T=d(T,L,x,O,m,15,a[58]),O=d(O,T,L,x,A,21,a[59]),x=d(x,O,T,L,g,6,a[60]),L=d(L,x,O,T,S,10,a[61]),T=d(T,L,x,O,f,15,a[62]),O=d(O,T,L,x,_,21,a[63]),s[0]=s[0]+x|0,s[1]=s[1]+O|0,s[2]=s[2]+T|0,s[3]=s[3]+L|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;n[i>>>5]|=128<<24-i%32;var s=e.floor(r/4294967296),o=r;n[15+(i+64>>>9<<4)]=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),n[14+(i+64>>>9<<4)]=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),t.sigBytes=4*(n.length+1),this._process();for(var a=this._hash,l=a.words,c=0;c<4;c++){var h=l[c];l[c]=16711935&(h<<8|h>>>24)|4278255360&(h<<24|h>>>8)}return a},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});function c(e,t,n,r,i,s,o){var a=e+(t&n|~t&r)+i+o;return(a<<s|a>>>32-s)+t}function h(e,t,n,r,i,s,o){var a=e+(t&r|n&~r)+i+o;return(a<<s|a>>>32-s)+t}function u(e,t,n,r,i,s,o){var a=e+(t^n^r)+i+o;return(a<<s|a>>>32-s)+t}function d(e,t,n,r,i,s,o){var a=e+(n^(t|~r))+i+o;return(a<<s|a>>>32-s)+t}t.MD5=s._createHelper(l),t.HmacMD5=s._createHmacHelper(l)}(Math),r.MD5)},2169:function(e,t,n){var r;e.exports=(r=n(9021),n(7165),r.mode.CFB=function(){var e=r.lib.BlockCipherMode.extend();function t(e,t,n,r){var i,s=this._iv;s?(i=s.slice(0),this._iv=void 0):i=this._prevBlock,r.encryptBlock(i,0);for(var o=0;o<n;o++)e[t+o]^=i[o]}return e.Encryptor=e.extend({processBlock:function(e,n){var r=this._cipher,i=r.blockSize;t.call(this,e,n,i,r),this._prevBlock=e.slice(n,n+i)}}),e.Decryptor=e.extend({processBlock:function(e,n){var r=this._cipher,i=r.blockSize,s=e.slice(n,n+i);t.call(this,e,n,i,r),this._prevBlock=s}}),e}(),r.mode.CFB)},6372:function(e,t,n){var r;e.exports=(r=n(9021),n(7165),r.mode.CTRGladman=function(){var e=r.lib.BlockCipherMode.extend();function t(e){if(255&~(e>>24))e+=1<<24;else{var t=e>>16&255,n=e>>8&255,r=255&e;255===t?(t=0,255===n?(n=0,255===r?r=0:++r):++n):++t,e=0,e+=t<<16,e+=n<<8,e+=r}return e}function n(e){return 0===(e[0]=t(e[0]))&&(e[1]=t(e[1])),e}var i=e.Encryptor=e.extend({processBlock:function(e,t){var r=this._cipher,i=r.blockSize,s=this._iv,o=this._counter;s&&(o=this._counter=s.slice(0),this._iv=void 0),n(o);var a=o.slice(0);r.encryptBlock(a,0);for(var l=0;l<i;l++)e[t+l]^=a[l]}});return e.Decryptor=i,e}(),r.mode.CTRGladman)},6939:function(e,t,n){var r,i,s;e.exports=(s=n(9021),n(7165),s.mode.CTR=(r=s.lib.BlockCipherMode.extend(),i=r.Encryptor=r.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=this._iv,s=this._counter;i&&(s=this._counter=i.slice(0),this._iv=void 0);var o=s.slice(0);n.encryptBlock(o,0),s[r-1]=s[r-1]+1|0;for(var a=0;a<r;a++)e[t+a]^=o[a]}}),r.Decryptor=i,r),s.mode.CTR)},8454:function(e,t,n){var r,i;e.exports=(i=n(9021),n(7165),i.mode.ECB=((r=i.lib.BlockCipherMode.extend()).Encryptor=r.extend({processBlock:function(e,t){this._cipher.encryptBlock(e,t)}}),r.Decryptor=r.extend({processBlock:function(e,t){this._cipher.decryptBlock(e,t)}}),r),i.mode.ECB)},3797:function(e,t,n){var r,i,s;e.exports=(s=n(9021),n(7165),s.mode.OFB=(r=s.lib.BlockCipherMode.extend(),i=r.Encryptor=r.extend({processBlock:function(e,t){var n=this._cipher,r=n.blockSize,i=this._iv,s=this._keystream;i&&(s=this._keystream=i.slice(0),this._iv=void 0),n.encryptBlock(s,0);for(var o=0;o<r;o++)e[t+o]^=s[o]}}),r.Decryptor=i,r),s.mode.OFB)},2073:function(e,t,n){var r;e.exports=(r=n(9021),n(7165),r.pad.AnsiX923={pad:function(e,t){var n=e.sigBytes,r=4*t,i=r-n%r,s=n+i-1;e.clamp(),e.words[s>>>2]|=i<<24-s%4*8,e.sigBytes+=i},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},r.pad.Ansix923)},4905:function(e,t,n){var r;e.exports=(r=n(9021),n(7165),r.pad.Iso10126={pad:function(e,t){var n=4*t,i=n-e.sigBytes%n;e.concat(r.lib.WordArray.random(i-1)).concat(r.lib.WordArray.create([i<<24],1))},unpad:function(e){var t=255&e.words[e.sigBytes-1>>>2];e.sigBytes-=t}},r.pad.Iso10126)},482:function(e,t,n){var r;e.exports=(r=n(9021),n(7165),r.pad.Iso97971={pad:function(e,t){e.concat(r.lib.WordArray.create([2147483648],1)),r.pad.ZeroPadding.pad(e,t)},unpad:function(e){r.pad.ZeroPadding.unpad(e),e.sigBytes--}},r.pad.Iso97971)},8124:function(e,t,n){var r;e.exports=(r=n(9021),n(7165),r.pad.NoPadding={pad:function(){},unpad:function(){}},r.pad.NoPadding)},2155:function(e,t,n){var r;e.exports=(r=n(9021),n(7165),r.pad.ZeroPadding={pad:function(e,t){var n=4*t;e.clamp(),e.sigBytes+=n-(e.sigBytes%n||n)},unpad:function(e){var t=e.words,n=e.sigBytes-1;for(n=e.sigBytes-1;n>=0;n--)if(t[n>>>2]>>>24-n%4*8&255){e.sigBytes=n+1;break}}},r.pad.ZeroPadding)},19:function(e,t,n){var r,i,s,o,a,l,c,h,u;e.exports=(u=n(9021),n(3009),n(1025),i=(r=u).lib,s=i.Base,o=i.WordArray,a=r.algo,l=a.SHA256,c=a.HMAC,h=a.PBKDF2=s.extend({cfg:s.extend({keySize:4,hasher:l,iterations:25e4}),init:function(e){this.cfg=this.cfg.extend(e)},compute:function(e,t){for(var n=this.cfg,r=c.create(n.hasher,e),i=o.create(),s=o.create([1]),a=i.words,l=s.words,h=n.keySize,u=n.iterations;a.length<h;){var d=r.update(t).finalize(s);r.reset();for(var f=d.words,p=f.length,g=d,v=1;v<u;v++){g=r.finalize(g),r.reset();for(var m=g.words,y=0;y<p;y++)f[y]^=m[y]}i.concat(d),l[0]++}return i.sigBytes=4*h,i}}),r.PBKDF2=function(e,t,n){return h.create(n).compute(e,t)},u.PBKDF2)},2696:function(e,t,n){var r;e.exports=(r=n(9021),n(754),n(4636),n(9506),n(7165),function(){var e=r,t=e.lib.StreamCipher,n=e.algo,i=[],s=[],o=[],a=n.RabbitLegacy=t.extend({_doReset:function(){var e=this._key.words,t=this.cfg.iv,n=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],r=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];this._b=0;for(var i=0;i<4;i++)l.call(this);for(i=0;i<8;i++)r[i]^=n[i+4&7];if(t){var s=t.words,o=s[0],a=s[1],c=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),h=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),u=c>>>16|4294901760&h,d=h<<16|65535&c;for(r[0]^=c,r[1]^=u,r[2]^=h,r[3]^=d,r[4]^=c,r[5]^=u,r[6]^=h,r[7]^=d,i=0;i<4;i++)l.call(this)}},_doProcessBlock:function(e,t){var n=this._X;l.call(this),i[0]=n[0]^n[5]>>>16^n[3]<<16,i[1]=n[2]^n[7]>>>16^n[5]<<16,i[2]=n[4]^n[1]>>>16^n[7]<<16,i[3]=n[6]^n[3]>>>16^n[1]<<16;for(var r=0;r<4;r++)i[r]=16711935&(i[r]<<8|i[r]>>>24)|4278255360&(i[r]<<24|i[r]>>>8),e[t+r]^=i[r]},blockSize:4,ivSize:2});function l(){for(var e=this._X,t=this._C,n=0;n<8;n++)s[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<s[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<s[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<s[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<s[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<s[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<s[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<s[6]>>>0?1:0)|0,this._b=t[7]>>>0<s[7]>>>0?1:0,n=0;n<8;n++){var r=e[n]+t[n],i=65535&r,a=r>>>16,l=((i*i>>>17)+i*a>>>15)+a*a,c=((4294901760&r)*r|0)+((65535&r)*r|0);o[n]=l^c}e[0]=o[0]+(o[7]<<16|o[7]>>>16)+(o[6]<<16|o[6]>>>16)|0,e[1]=o[1]+(o[0]<<8|o[0]>>>24)+o[7]|0,e[2]=o[2]+(o[1]<<16|o[1]>>>16)+(o[0]<<16|o[0]>>>16)|0,e[3]=o[3]+(o[2]<<8|o[2]>>>24)+o[1]|0,e[4]=o[4]+(o[3]<<16|o[3]>>>16)+(o[2]<<16|o[2]>>>16)|0,e[5]=o[5]+(o[4]<<8|o[4]>>>24)+o[3]|0,e[6]=o[6]+(o[5]<<16|o[5]>>>16)+(o[4]<<16|o[4]>>>16)|0,e[7]=o[7]+(o[6]<<8|o[6]>>>24)+o[5]|0}e.RabbitLegacy=t._createHelper(a)}(),r.RabbitLegacy)},6298:function(e,t,n){var r;e.exports=(r=n(9021),n(754),n(4636),n(9506),n(7165),function(){var e=r,t=e.lib.StreamCipher,n=e.algo,i=[],s=[],o=[],a=n.Rabbit=t.extend({_doReset:function(){for(var e=this._key.words,t=this.cfg.iv,n=0;n<4;n++)e[n]=16711935&(e[n]<<8|e[n]>>>24)|4278255360&(e[n]<<24|e[n]>>>8);var r=this._X=[e[0],e[3]<<16|e[2]>>>16,e[1],e[0]<<16|e[3]>>>16,e[2],e[1]<<16|e[0]>>>16,e[3],e[2]<<16|e[1]>>>16],i=this._C=[e[2]<<16|e[2]>>>16,4294901760&e[0]|65535&e[1],e[3]<<16|e[3]>>>16,4294901760&e[1]|65535&e[2],e[0]<<16|e[0]>>>16,4294901760&e[2]|65535&e[3],e[1]<<16|e[1]>>>16,4294901760&e[3]|65535&e[0]];for(this._b=0,n=0;n<4;n++)l.call(this);for(n=0;n<8;n++)i[n]^=r[n+4&7];if(t){var s=t.words,o=s[0],a=s[1],c=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),h=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8),u=c>>>16|4294901760&h,d=h<<16|65535&c;for(i[0]^=c,i[1]^=u,i[2]^=h,i[3]^=d,i[4]^=c,i[5]^=u,i[6]^=h,i[7]^=d,n=0;n<4;n++)l.call(this)}},_doProcessBlock:function(e,t){var n=this._X;l.call(this),i[0]=n[0]^n[5]>>>16^n[3]<<16,i[1]=n[2]^n[7]>>>16^n[5]<<16,i[2]=n[4]^n[1]>>>16^n[7]<<16,i[3]=n[6]^n[3]>>>16^n[1]<<16;for(var r=0;r<4;r++)i[r]=16711935&(i[r]<<8|i[r]>>>24)|4278255360&(i[r]<<24|i[r]>>>8),e[t+r]^=i[r]},blockSize:4,ivSize:2});function l(){for(var e=this._X,t=this._C,n=0;n<8;n++)s[n]=t[n];for(t[0]=t[0]+1295307597+this._b|0,t[1]=t[1]+3545052371+(t[0]>>>0<s[0]>>>0?1:0)|0,t[2]=t[2]+886263092+(t[1]>>>0<s[1]>>>0?1:0)|0,t[3]=t[3]+1295307597+(t[2]>>>0<s[2]>>>0?1:0)|0,t[4]=t[4]+3545052371+(t[3]>>>0<s[3]>>>0?1:0)|0,t[5]=t[5]+886263092+(t[4]>>>0<s[4]>>>0?1:0)|0,t[6]=t[6]+1295307597+(t[5]>>>0<s[5]>>>0?1:0)|0,t[7]=t[7]+3545052371+(t[6]>>>0<s[6]>>>0?1:0)|0,this._b=t[7]>>>0<s[7]>>>0?1:0,n=0;n<8;n++){var r=e[n]+t[n],i=65535&r,a=r>>>16,l=((i*i>>>17)+i*a>>>15)+a*a,c=((4294901760&r)*r|0)+((65535&r)*r|0);o[n]=l^c}e[0]=o[0]+(o[7]<<16|o[7]>>>16)+(o[6]<<16|o[6]>>>16)|0,e[1]=o[1]+(o[0]<<8|o[0]>>>24)+o[7]|0,e[2]=o[2]+(o[1]<<16|o[1]>>>16)+(o[0]<<16|o[0]>>>16)|0,e[3]=o[3]+(o[2]<<8|o[2]>>>24)+o[1]|0,e[4]=o[4]+(o[3]<<16|o[3]>>>16)+(o[2]<<16|o[2]>>>16)|0,e[5]=o[5]+(o[4]<<8|o[4]>>>24)+o[3]|0,e[6]=o[6]+(o[5]<<16|o[5]>>>16)+(o[4]<<16|o[4]>>>16)|0,e[7]=o[7]+(o[6]<<8|o[6]>>>24)+o[5]|0}e.Rabbit=t._createHelper(a)}(),r.Rabbit)},7193:function(e,t,n){var r;e.exports=(r=n(9021),n(754),n(4636),n(9506),n(7165),function(){var e=r,t=e.lib.StreamCipher,n=e.algo,i=n.RC4=t.extend({_doReset:function(){for(var e=this._key,t=e.words,n=e.sigBytes,r=this._S=[],i=0;i<256;i++)r[i]=i;i=0;for(var s=0;i<256;i++){var o=i%n,a=t[o>>>2]>>>24-o%4*8&255;s=(s+r[i]+a)%256;var l=r[i];r[i]=r[s],r[s]=l}this._i=this._j=0},_doProcessBlock:function(e,t){e[t]^=s.call(this)},keySize:8,ivSize:0});function s(){for(var e=this._S,t=this._i,n=this._j,r=0,i=0;i<4;i++){n=(n+e[t=(t+1)%256])%256;var s=e[t];e[t]=e[n],e[n]=s,r|=e[(e[t]+e[n])%256]<<24-8*i}return this._i=t,this._j=n,r}e.RC4=t._createHelper(i);var o=n.RC4Drop=i.extend({cfg:i.cfg.extend({drop:192}),_doReset:function(){i._doReset.call(this);for(var e=this.cfg.drop;e>0;e--)s.call(this)}});e.RC4Drop=t._createHelper(o)}(),r.RC4)},8056:function(e,t,n){var r;e.exports=(r=n(9021),function(){var e=r,t=e.lib,n=t.WordArray,i=t.Hasher,s=e.algo,o=n.create([0,1,2,3,4,5,6,7,8,9,10,11,12,13,14,15,7,4,13,1,10,6,15,3,12,0,9,5,2,14,11,8,3,10,14,4,9,15,8,1,2,7,0,6,13,11,5,12,1,9,11,10,0,8,12,4,13,3,7,15,14,5,6,2,4,0,5,9,7,12,2,10,14,1,3,8,11,6,15,13]),a=n.create([5,14,7,0,9,2,11,4,13,6,15,8,1,10,3,12,6,11,3,7,0,13,5,10,14,15,8,12,4,9,1,2,15,5,1,3,7,14,6,9,11,8,12,2,10,0,4,13,8,6,4,1,3,11,15,0,5,12,2,13,9,7,10,14,12,15,10,4,1,5,8,7,6,2,13,14,0,3,9,11]),l=n.create([11,14,15,12,5,8,7,9,11,13,14,15,6,7,9,8,7,6,8,13,11,9,7,15,7,12,15,9,11,7,13,12,11,13,6,7,14,9,13,15,14,8,13,6,5,12,7,5,11,12,14,15,14,15,9,8,9,14,5,6,8,6,5,12,9,15,5,11,6,8,13,12,5,12,13,14,11,8,5,6]),c=n.create([8,9,9,11,13,15,15,5,7,7,8,11,14,14,12,6,9,13,15,7,12,8,9,11,7,7,12,7,6,15,13,11,9,7,15,11,8,6,6,14,12,13,5,14,13,13,7,5,15,5,8,11,14,14,6,14,6,9,12,9,12,5,15,8,8,5,12,9,12,5,14,6,8,13,6,5,15,13,11,11]),h=n.create([0,1518500249,1859775393,2400959708,2840853838]),u=n.create([1352829926,1548603684,1836072691,2053994217,0]),d=s.RIPEMD160=i.extend({_doReset:function(){this._hash=n.create([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=0;n<16;n++){var r=t+n,i=e[r];e[r]=16711935&(i<<8|i>>>24)|4278255360&(i<<24|i>>>8)}var s,d,b,_,w,S,E,A,P,I,x,O=this._hash.words,T=h.words,L=u.words,C=o.words,k=a.words,D=l.words,R=c.words;for(S=s=O[0],E=d=O[1],A=b=O[2],P=_=O[3],I=w=O[4],n=0;n<80;n+=1)x=s+e[t+C[n]]|0,x+=n<16?f(d,b,_)+T[0]:n<32?p(d,b,_)+T[1]:n<48?g(d,b,_)+T[2]:n<64?v(d,b,_)+T[3]:m(d,b,_)+T[4],x=(x=y(x|=0,D[n]))+w|0,s=w,w=_,_=y(b,10),b=d,d=x,x=S+e[t+k[n]]|0,x+=n<16?m(E,A,P)+L[0]:n<32?v(E,A,P)+L[1]:n<48?g(E,A,P)+L[2]:n<64?p(E,A,P)+L[3]:f(E,A,P)+L[4],x=(x=y(x|=0,R[n]))+I|0,S=I,I=P,P=y(A,10),A=E,E=x;x=O[1]+b+P|0,O[1]=O[2]+_+I|0,O[2]=O[3]+w+S|0,O[3]=O[4]+s+E|0,O[4]=O[0]+d+A|0,O[0]=x},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=16711935&(n<<8|n>>>24)|4278255360&(n<<24|n>>>8),e.sigBytes=4*(t.length+1),this._process();for(var i=this._hash,s=i.words,o=0;o<5;o++){var a=s[o];s[o]=16711935&(a<<8|a>>>24)|4278255360&(a<<24|a>>>8)}return i},clone:function(){var e=i.clone.call(this);return e._hash=this._hash.clone(),e}});function f(e,t,n){return e^t^n}function p(e,t,n){return e&t|~e&n}function g(e,t,n){return(e|~t)^n}function v(e,t,n){return e&n|t&~n}function m(e,t,n){return e^(t|~n)}function y(e,t){return e<<t|e>>>32-t}e.RIPEMD160=i._createHelper(d),e.HmacRIPEMD160=i._createHmacHelper(d)}(Math),r.RIPEMD160)},5471:function(e,t,n){var r,i,s,o,a,l,c,h;e.exports=(h=n(9021),i=(r=h).lib,s=i.WordArray,o=i.Hasher,a=r.algo,l=[],c=a.SHA1=o.extend({_doReset:function(){this._hash=new s.init([1732584193,4023233417,2562383102,271733878,3285377520])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],s=n[2],o=n[3],a=n[4],c=0;c<80;c++){if(c<16)l[c]=0|e[t+c];else{var h=l[c-3]^l[c-8]^l[c-14]^l[c-16];l[c]=h<<1|h>>>31}var u=(r<<5|r>>>27)+a+l[c];u+=c<20?1518500249+(i&s|~i&o):c<40?1859775393+(i^s^o):c<60?(i&s|i&o|s&o)-1894007588:(i^s^o)-899497514,a=o,o=s,s=i<<30|i>>>2,i=r,r=u}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+a|0},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[14+(r+64>>>9<<4)]=Math.floor(n/4294967296),t[15+(r+64>>>9<<4)]=n,e.sigBytes=4*t.length,this._process(),this._hash},clone:function(){var e=o.clone.call(this);return e._hash=this._hash.clone(),e}}),r.SHA1=o._createHelper(c),r.HmacSHA1=o._createHmacHelper(c),h.SHA1)},6308:function(e,t,n){var r,i,s,o,a,l;e.exports=(l=n(9021),n(3009),i=(r=l).lib.WordArray,s=r.algo,o=s.SHA256,a=s.SHA224=o.extend({_doReset:function(){this._hash=new i.init([3238371032,914150663,812702999,4144912697,4290775857,1750603025,1694076839,3204075428])},_doFinalize:function(){var e=o._doFinalize.call(this);return e.sigBytes-=4,e}}),r.SHA224=o._createHelper(a),r.HmacSHA224=o._createHmacHelper(a),l.SHA224)},3009:function(e,t,n){var r;e.exports=(r=n(9021),function(e){var t=r,n=t.lib,i=n.WordArray,s=n.Hasher,o=t.algo,a=[],l=[];!function(){function t(t){for(var n=e.sqrt(t),r=2;r<=n;r++)if(!(t%r))return!1;return!0}function n(e){return 4294967296*(e-(0|e))|0}for(var r=2,i=0;i<64;)t(r)&&(i<8&&(a[i]=n(e.pow(r,.5))),l[i]=n(e.pow(r,1/3)),i++),r++}();var c=[],h=o.SHA256=s.extend({_doReset:function(){this._hash=new i.init(a.slice(0))},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],s=n[2],o=n[3],a=n[4],h=n[5],u=n[6],d=n[7],f=0;f<64;f++){if(f<16)c[f]=0|e[t+f];else{var p=c[f-15],g=(p<<25|p>>>7)^(p<<14|p>>>18)^p>>>3,v=c[f-2],m=(v<<15|v>>>17)^(v<<13|v>>>19)^v>>>10;c[f]=g+c[f-7]+m+c[f-16]}var y=r&i^r&s^i&s,b=(r<<30|r>>>2)^(r<<19|r>>>13)^(r<<10|r>>>22),_=d+((a<<26|a>>>6)^(a<<21|a>>>11)^(a<<7|a>>>25))+(a&h^~a&u)+l[f]+c[f];d=u,u=h,h=a,a=o+_|0,o=s,s=i,i=r,r=_+(b+y)|0}n[0]=n[0]+r|0,n[1]=n[1]+i|0,n[2]=n[2]+s|0,n[3]=n[3]+o|0,n[4]=n[4]+a|0,n[5]=n[5]+h|0,n[6]=n[6]+u|0,n[7]=n[7]+d|0},_doFinalize:function(){var t=this._data,n=t.words,r=8*this._nDataBytes,i=8*t.sigBytes;return n[i>>>5]|=128<<24-i%32,n[14+(i+64>>>9<<4)]=e.floor(r/4294967296),n[15+(i+64>>>9<<4)]=r,t.sigBytes=4*n.length,this._process(),this._hash},clone:function(){var e=s.clone.call(this);return e._hash=this._hash.clone(),e}});t.SHA256=s._createHelper(h),t.HmacSHA256=s._createHmacHelper(h)}(Math),r.SHA256)},5953:function(e,t,n){var r;e.exports=(r=n(9021),n(3240),function(e){var t=r,n=t.lib,i=n.WordArray,s=n.Hasher,o=t.x64.Word,a=t.algo,l=[],c=[],h=[];!function(){for(var e=1,t=0,n=0;n<24;n++){l[e+5*t]=(n+1)*(n+2)/2%64;var r=(2*e+3*t)%5;e=t%5,t=r}for(e=0;e<5;e++)for(t=0;t<5;t++)c[e+5*t]=t+(2*e+3*t)%5*5;for(var i=1,s=0;s<24;s++){for(var a=0,u=0,d=0;d<7;d++){if(1&i){var f=(1<<d)-1;f<32?u^=1<<f:a^=1<<f-32}128&i?i=i<<1^113:i<<=1}h[s]=o.create(a,u)}}();var u=[];!function(){for(var e=0;e<25;e++)u[e]=o.create()}();var d=a.SHA3=s.extend({cfg:s.cfg.extend({outputLength:512}),_doReset:function(){for(var e=this._state=[],t=0;t<25;t++)e[t]=new o.init;this.blockSize=(1600-2*this.cfg.outputLength)/32},_doProcessBlock:function(e,t){for(var n=this._state,r=this.blockSize/2,i=0;i<r;i++){var s=e[t+2*i],o=e[t+2*i+1];s=16711935&(s<<8|s>>>24)|4278255360&(s<<24|s>>>8),o=16711935&(o<<8|o>>>24)|4278255360&(o<<24|o>>>8),(O=n[i]).high^=o,O.low^=s}for(var a=0;a<24;a++){for(var d=0;d<5;d++){for(var f=0,p=0,g=0;g<5;g++)f^=(O=n[d+5*g]).high,p^=O.low;var v=u[d];v.high=f,v.low=p}for(d=0;d<5;d++){var m=u[(d+4)%5],y=u[(d+1)%5],b=y.high,_=y.low;for(f=m.high^(b<<1|_>>>31),p=m.low^(_<<1|b>>>31),g=0;g<5;g++)(O=n[d+5*g]).high^=f,O.low^=p}for(var w=1;w<25;w++){var S=(O=n[w]).high,E=O.low,A=l[w];A<32?(f=S<<A|E>>>32-A,p=E<<A|S>>>32-A):(f=E<<A-32|S>>>64-A,p=S<<A-32|E>>>64-A);var P=u[c[w]];P.high=f,P.low=p}var I=u[0],x=n[0];for(I.high=x.high,I.low=x.low,d=0;d<5;d++)for(g=0;g<5;g++){var O=n[w=d+5*g],T=u[w],L=u[(d+1)%5+5*g],C=u[(d+2)%5+5*g];O.high=T.high^~L.high&C.high,O.low=T.low^~L.low&C.low}O=n[0];var k=h[a];O.high^=k.high,O.low^=k.low}},_doFinalize:function(){var t=this._data,n=t.words,r=(this._nDataBytes,8*t.sigBytes),s=32*this.blockSize;n[r>>>5]|=1<<24-r%32,n[(e.ceil((r+1)/s)*s>>>5)-1]|=128,t.sigBytes=4*n.length,this._process();for(var o=this._state,a=this.cfg.outputLength/8,l=a/8,c=[],h=0;h<l;h++){var u=o[h],d=u.high,f=u.low;d=16711935&(d<<8|d>>>24)|4278255360&(d<<24|d>>>8),f=16711935&(f<<8|f>>>24)|4278255360&(f<<24|f>>>8),c.push(f),c.push(d)}return new i.init(c,a)},clone:function(){for(var e=s.clone.call(this),t=e._state=this._state.slice(0),n=0;n<25;n++)t[n]=t[n].clone();return e}});t.SHA3=s._createHelper(d),t.HmacSHA3=s._createHmacHelper(d)}(Math),r.SHA3)},9557:function(e,t,n){var r,i,s,o,a,l,c,h;e.exports=(h=n(9021),n(3240),n(1380),i=(r=h).x64,s=i.Word,o=i.WordArray,a=r.algo,l=a.SHA512,c=a.SHA384=l.extend({_doReset:function(){this._hash=new o.init([new s.init(3418070365,3238371032),new s.init(1654270250,914150663),new s.init(2438529370,812702999),new s.init(355462360,4144912697),new s.init(1731405415,4290775857),new s.init(2394180231,1750603025),new s.init(3675008525,1694076839),new s.init(1203062813,3204075428)])},_doFinalize:function(){var e=l._doFinalize.call(this);return e.sigBytes-=16,e}}),r.SHA384=l._createHelper(c),r.HmacSHA384=l._createHmacHelper(c),h.SHA384)},1380:function(e,t,n){var r;e.exports=(r=n(9021),n(3240),function(){var e=r,t=e.lib.Hasher,n=e.x64,i=n.Word,s=n.WordArray,o=e.algo;function a(){return i.create.apply(i,arguments)}var l=[a(1116352408,3609767458),a(1899447441,602891725),a(3049323471,3964484399),a(3921009573,2173295548),a(961987163,4081628472),a(1508970993,3053834265),a(2453635748,2937671579),a(2870763221,3664609560),a(3624381080,2734883394),a(310598401,1164996542),a(607225278,1323610764),a(1426881987,3590304994),a(1925078388,4068182383),a(2162078206,991336113),a(2614888103,633803317),a(3248222580,3479774868),a(3835390401,2666613458),a(4022224774,944711139),a(264347078,2341262773),a(604807628,2007800933),a(770255983,1495990901),a(1249150122,1856431235),a(1555081692,3175218132),a(1996064986,2198950837),a(2554220882,3999719339),a(2821834349,766784016),a(2952996808,2566594879),a(3210313671,3203337956),a(3336571891,1034457026),a(3584528711,2466948901),a(113926993,3758326383),a(338241895,168717936),a(666307205,1188179964),a(773529912,1546045734),a(1294757372,1522805485),a(1396182291,2643833823),a(1695183700,2343527390),a(1986661051,1014477480),a(2177026350,1206759142),a(2456956037,344077627),a(2730485921,1290863460),a(2820302411,3158454273),a(3259730800,3505952657),a(3345764771,106217008),a(3516065817,3606008344),a(3600352804,1432725776),a(4094571909,1467031594),a(275423344,851169720),a(430227734,3100823752),a(506948616,1363258195),a(659060556,3750685593),a(883997877,3785050280),a(958139571,3318307427),a(1322822218,3812723403),a(1537002063,2003034995),a(1747873779,3602036899),a(1955562222,1575990012),a(2024104815,1125592928),a(2227730452,2716904306),a(2361852424,442776044),a(2428436474,593698344),a(2756734187,3733110249),a(3204031479,2999351573),a(3329325298,3815920427),a(3391569614,3928383900),a(3515267271,566280711),a(3940187606,3454069534),a(4118630271,4000239992),a(116418474,1914138554),a(174292421,2731055270),a(289380356,3203993006),a(460393269,320620315),a(685471733,587496836),a(852142971,1086792851),a(1017036298,365543100),a(1126000580,2618297676),a(1288033470,3409855158),a(1501505948,4234509866),a(1607167915,987167468),a(1816402316,1246189591)],c=[];!function(){for(var e=0;e<80;e++)c[e]=a()}();var h=o.SHA512=t.extend({_doReset:function(){this._hash=new s.init([new i.init(1779033703,4089235720),new i.init(3144134277,2227873595),new i.init(1013904242,4271175723),new i.init(2773480762,1595750129),new i.init(1359893119,2917565137),new i.init(2600822924,725511199),new i.init(528734635,4215389547),new i.init(1541459225,327033209)])},_doProcessBlock:function(e,t){for(var n=this._hash.words,r=n[0],i=n[1],s=n[2],o=n[3],a=n[4],h=n[5],u=n[6],d=n[7],f=r.high,p=r.low,g=i.high,v=i.low,m=s.high,y=s.low,b=o.high,_=o.low,w=a.high,S=a.low,E=h.high,A=h.low,P=u.high,I=u.low,x=d.high,O=d.low,T=f,L=p,C=g,k=v,D=m,R=y,N=b,B=_,M=w,F=S,H=E,U=A,W=P,j=I,$=x,V=O,z=0;z<80;z++){var G,q,Q=c[z];if(z<16)q=Q.high=0|e[t+2*z],G=Q.low=0|e[t+2*z+1];else{var K=c[z-15],Y=K.high,J=K.low,X=(Y>>>1|J<<31)^(Y>>>8|J<<24)^Y>>>7,Z=(J>>>1|Y<<31)^(J>>>8|Y<<24)^(J>>>7|Y<<25),ee=c[z-2],te=ee.high,ne=ee.low,re=(te>>>19|ne<<13)^(te<<3|ne>>>29)^te>>>6,ie=(ne>>>19|te<<13)^(ne<<3|te>>>29)^(ne>>>6|te<<26),se=c[z-7],oe=se.high,ae=se.low,le=c[z-16],ce=le.high,he=le.low;q=(q=(q=X+oe+((G=Z+ae)>>>0<Z>>>0?1:0))+re+((G+=ie)>>>0<ie>>>0?1:0))+ce+((G+=he)>>>0<he>>>0?1:0),Q.high=q,Q.low=G}var ue,de=M&H^~M&W,fe=F&U^~F&j,pe=T&C^T&D^C&D,ge=L&k^L&R^k&R,ve=(T>>>28|L<<4)^(T<<30|L>>>2)^(T<<25|L>>>7),me=(L>>>28|T<<4)^(L<<30|T>>>2)^(L<<25|T>>>7),ye=(M>>>14|F<<18)^(M>>>18|F<<14)^(M<<23|F>>>9),be=(F>>>14|M<<18)^(F>>>18|M<<14)^(F<<23|M>>>9),_e=l[z],we=_e.high,Se=_e.low,Ee=$+ye+((ue=V+be)>>>0<V>>>0?1:0),Ae=me+ge;$=W,V=j,W=H,j=U,H=M,U=F,M=N+(Ee=(Ee=(Ee=Ee+de+((ue+=fe)>>>0<fe>>>0?1:0))+we+((ue+=Se)>>>0<Se>>>0?1:0))+q+((ue+=G)>>>0<G>>>0?1:0))+((F=B+ue|0)>>>0<B>>>0?1:0)|0,N=D,B=R,D=C,R=k,C=T,k=L,T=Ee+(ve+pe+(Ae>>>0<me>>>0?1:0))+((L=ue+Ae|0)>>>0<ue>>>0?1:0)|0}p=r.low=p+L,r.high=f+T+(p>>>0<L>>>0?1:0),v=i.low=v+k,i.high=g+C+(v>>>0<k>>>0?1:0),y=s.low=y+R,s.high=m+D+(y>>>0<R>>>0?1:0),_=o.low=_+B,o.high=b+N+(_>>>0<B>>>0?1:0),S=a.low=S+F,a.high=w+M+(S>>>0<F>>>0?1:0),A=h.low=A+U,h.high=E+H+(A>>>0<U>>>0?1:0),I=u.low=I+j,u.high=P+W+(I>>>0<j>>>0?1:0),O=d.low=O+V,d.high=x+$+(O>>>0<V>>>0?1:0)},_doFinalize:function(){var e=this._data,t=e.words,n=8*this._nDataBytes,r=8*e.sigBytes;return t[r>>>5]|=128<<24-r%32,t[30+(r+128>>>10<<5)]=Math.floor(n/4294967296),t[31+(r+128>>>10<<5)]=n,e.sigBytes=4*t.length,this._process(),this._hash.toX32()},clone:function(){var e=t.clone.call(this);return e._hash=this._hash.clone(),e},blockSize:32});e.SHA512=t._createHelper(h),e.HmacSHA512=t._createHmacHelper(h)}(),r.SHA512)},7628:function(e,t,n){var r;e.exports=(r=n(9021),n(754),n(4636),n(9506),n(7165),function(){var e=r,t=e.lib,n=t.WordArray,i=t.BlockCipher,s=e.algo,o=[57,49,41,33,25,17,9,1,58,50,42,34,26,18,10,2,59,51,43,35,27,19,11,3,60,52,44,36,63,55,47,39,31,23,15,7,62,54,46,38,30,22,14,6,61,53,45,37,29,21,13,5,28,20,12,4],a=[14,17,11,24,1,5,3,28,15,6,21,10,23,19,12,4,26,8,16,7,27,20,13,2,41,52,31,37,47,55,30,40,51,45,33,48,44,49,39,56,34,53,46,42,50,36,29,32],l=[1,2,4,6,8,10,12,14,15,17,19,21,23,25,27,28],c=[{0:8421888,268435456:32768,536870912:8421378,805306368:2,1073741824:512,1342177280:8421890,1610612736:8389122,1879048192:8388608,2147483648:514,2415919104:8389120,2684354560:33280,2952790016:8421376,3221225472:32770,3489660928:8388610,3758096384:0,4026531840:33282,134217728:0,402653184:8421890,671088640:33282,939524096:32768,1207959552:8421888,1476395008:512,1744830464:8421378,2013265920:2,2281701376:8389120,2550136832:33280,2818572288:8421376,3087007744:8389122,3355443200:8388610,3623878656:32770,3892314112:514,4160749568:8388608,1:32768,268435457:2,536870913:8421888,805306369:8388608,1073741825:8421378,1342177281:33280,1610612737:512,1879048193:8389122,2147483649:8421890,2415919105:8421376,2684354561:8388610,2952790017:33282,3221225473:514,3489660929:8389120,3758096385:32770,4026531841:0,134217729:8421890,402653185:8421376,671088641:8388608,939524097:512,1207959553:32768,1476395009:8388610,1744830465:2,2013265921:33282,2281701377:32770,2550136833:8389122,2818572289:514,3087007745:8421888,3355443201:8389120,3623878657:0,3892314113:33280,4160749569:8421378},{0:1074282512,16777216:16384,33554432:524288,50331648:1074266128,67108864:1073741840,83886080:1074282496,100663296:1073758208,117440512:16,134217728:540672,150994944:1073758224,167772160:1073741824,184549376:540688,201326592:524304,218103808:0,234881024:16400,251658240:1074266112,8388608:1073758208,25165824:540688,41943040:16,58720256:1073758224,75497472:1074282512,92274688:1073741824,109051904:524288,125829120:1074266128,142606336:524304,159383552:0,176160768:16384,192937984:1074266112,209715200:1073741840,226492416:540672,243269632:1074282496,260046848:16400,268435456:0,285212672:1074266128,301989888:1073758224,318767104:1074282496,335544320:1074266112,352321536:16,369098752:540688,385875968:16384,402653184:16400,419430400:524288,436207616:524304,452984832:1073741840,469762048:540672,486539264:1073758208,503316480:1073741824,520093696:1074282512,276824064:540688,293601280:524288,310378496:1074266112,327155712:16384,343932928:1073758208,360710144:1074282512,377487360:16,394264576:1073741824,411041792:1074282496,427819008:1073741840,444596224:1073758224,461373440:524304,478150656:0,494927872:16400,511705088:1074266128,528482304:540672},{0:260,1048576:0,2097152:67109120,3145728:65796,4194304:65540,5242880:67108868,6291456:67174660,7340032:67174400,8388608:67108864,9437184:67174656,10485760:65792,11534336:67174404,12582912:67109124,13631488:65536,14680064:4,15728640:256,524288:67174656,1572864:67174404,2621440:0,3670016:67109120,4718592:67108868,5767168:65536,6815744:65540,7864320:260,8912896:4,9961472:256,11010048:67174400,12058624:65796,13107200:65792,14155776:67109124,15204352:67174660,16252928:67108864,16777216:67174656,17825792:65540,18874368:65536,19922944:67109120,20971520:256,22020096:67174660,23068672:67108868,24117248:0,25165824:67109124,26214400:67108864,27262976:4,28311552:65792,29360128:67174400,30408704:260,31457280:65796,32505856:67174404,17301504:67108864,18350080:260,19398656:67174656,20447232:0,21495808:65540,22544384:67109120,23592960:256,24641536:67174404,25690112:65536,26738688:67174660,27787264:65796,28835840:67108868,29884416:67109124,30932992:67174400,31981568:4,33030144:65792},{0:2151682048,65536:2147487808,131072:4198464,196608:2151677952,262144:0,327680:4198400,393216:2147483712,458752:4194368,524288:2147483648,589824:4194304,655360:64,720896:2147487744,786432:2151678016,851968:4160,917504:4096,983040:2151682112,32768:2147487808,98304:64,163840:2151678016,229376:2147487744,294912:4198400,360448:2151682112,425984:0,491520:2151677952,557056:4096,622592:2151682048,688128:4194304,753664:4160,819200:2147483648,884736:4194368,950272:4198464,1015808:2147483712,1048576:4194368,1114112:4198400,1179648:2147483712,1245184:0,1310720:4160,1376256:2151678016,1441792:2151682048,1507328:2147487808,1572864:2151682112,1638400:2147483648,1703936:2151677952,1769472:4198464,1835008:2147487744,1900544:4194304,1966080:64,2031616:4096,1081344:2151677952,1146880:2151682112,1212416:0,1277952:4198400,1343488:4194368,1409024:2147483648,1474560:2147487808,1540096:64,1605632:2147483712,1671168:4096,1736704:2147487744,1802240:2151678016,1867776:4160,1933312:2151682048,1998848:4194304,2064384:4198464},{0:128,4096:17039360,8192:262144,12288:536870912,16384:537133184,20480:16777344,24576:553648256,28672:262272,32768:16777216,36864:537133056,40960:536871040,45056:553910400,49152:553910272,53248:0,57344:17039488,61440:553648128,2048:17039488,6144:553648256,10240:128,14336:17039360,18432:262144,22528:537133184,26624:553910272,30720:536870912,34816:537133056,38912:0,43008:553910400,47104:16777344,51200:536871040,55296:553648128,59392:16777216,63488:262272,65536:262144,69632:128,73728:536870912,77824:553648256,81920:16777344,86016:553910272,90112:537133184,94208:16777216,98304:553910400,102400:553648128,106496:17039360,110592:537133056,114688:262272,118784:536871040,122880:0,126976:17039488,67584:553648256,71680:16777216,75776:17039360,79872:537133184,83968:536870912,88064:17039488,92160:128,96256:553910272,100352:262272,104448:553910400,108544:0,112640:553648128,116736:16777344,120832:262144,124928:537133056,129024:536871040},{0:268435464,256:8192,512:270532608,768:270540808,1024:268443648,1280:2097152,1536:2097160,1792:268435456,2048:0,2304:268443656,2560:2105344,2816:8,3072:270532616,3328:2105352,3584:8200,3840:270540800,128:270532608,384:270540808,640:8,896:2097152,1152:2105352,1408:268435464,1664:268443648,1920:8200,2176:2097160,2432:8192,2688:268443656,2944:270532616,3200:0,3456:270540800,3712:2105344,3968:268435456,4096:268443648,4352:270532616,4608:270540808,4864:8200,5120:2097152,5376:268435456,5632:268435464,5888:2105344,6144:2105352,6400:0,6656:8,6912:270532608,7168:8192,7424:268443656,7680:270540800,7936:2097160,4224:8,4480:2105344,4736:2097152,4992:268435464,5248:268443648,5504:8200,5760:270540808,6016:270532608,6272:270540800,6528:270532616,6784:8192,7040:2105352,7296:2097160,7552:0,7808:268435456,8064:268443656},{0:1048576,16:33555457,32:1024,48:1049601,64:34604033,80:0,96:1,112:34603009,128:33555456,144:1048577,160:33554433,176:34604032,192:34603008,208:1025,224:1049600,240:33554432,8:34603009,24:0,40:33555457,56:34604032,72:1048576,88:33554433,104:33554432,120:1025,136:1049601,152:33555456,168:34603008,184:1048577,200:1024,216:34604033,232:1,248:1049600,256:33554432,272:1048576,288:33555457,304:34603009,320:1048577,336:33555456,352:34604032,368:1049601,384:1025,400:34604033,416:1049600,432:1,448:0,464:34603008,480:33554433,496:1024,264:1049600,280:33555457,296:34603009,312:1,328:33554432,344:1048576,360:1025,376:34604032,392:33554433,408:34603008,424:0,440:34604033,456:1049601,472:1024,488:33555456,504:1048577},{0:134219808,1:131072,2:134217728,3:32,4:131104,5:134350880,6:134350848,7:2048,8:134348800,9:134219776,10:133120,11:134348832,12:2080,13:0,14:134217760,15:133152,2147483648:2048,2147483649:134350880,2147483650:134219808,2147483651:134217728,2147483652:134348800,2147483653:133120,2147483654:133152,2147483655:32,2147483656:134217760,2147483657:2080,2147483658:131104,2147483659:134350848,2147483660:0,2147483661:134348832,2147483662:134219776,2147483663:131072,16:133152,17:134350848,18:32,19:2048,20:134219776,21:134217760,22:134348832,23:131072,24:0,25:131104,26:134348800,27:134219808,28:134350880,29:133120,30:2080,31:134217728,2147483664:131072,2147483665:2048,2147483666:134348832,2147483667:133152,2147483668:32,2147483669:134348800,2147483670:134217728,2147483671:134219808,2147483672:134350880,2147483673:134217760,2147483674:134219776,2147483675:0,2147483676:133120,2147483677:2080,2147483678:131104,2147483679:134350848}],h=[4160749569,528482304,33030144,2064384,129024,8064,504,2147483679],u=s.DES=i.extend({_doReset:function(){for(var e=this._key.words,t=[],n=0;n<56;n++){var r=o[n]-1;t[n]=e[r>>>5]>>>31-r%32&1}for(var i=this._subKeys=[],s=0;s<16;s++){var c=i[s]=[],h=l[s];for(n=0;n<24;n++)c[n/6|0]|=t[(a[n]-1+h)%28]<<31-n%6,c[4+(n/6|0)]|=t[28+(a[n+24]-1+h)%28]<<31-n%6;for(c[0]=c[0]<<1|c[0]>>>31,n=1;n<7;n++)c[n]=c[n]>>>4*(n-1)+3;c[7]=c[7]<<5|c[7]>>>27}var u=this._invSubKeys=[];for(n=0;n<16;n++)u[n]=i[15-n]},encryptBlock:function(e,t){this._doCryptBlock(e,t,this._subKeys)},decryptBlock:function(e,t){this._doCryptBlock(e,t,this._invSubKeys)},_doCryptBlock:function(e,t,n){this._lBlock=e[t],this._rBlock=e[t+1],d.call(this,4,252645135),d.call(this,16,65535),f.call(this,2,858993459),f.call(this,8,16711935),d.call(this,1,1431655765);for(var r=0;r<16;r++){for(var i=n[r],s=this._lBlock,o=this._rBlock,a=0,l=0;l<8;l++)a|=c[l][((o^i[l])&h[l])>>>0];this._lBlock=o,this._rBlock=s^a}var u=this._lBlock;this._lBlock=this._rBlock,this._rBlock=u,d.call(this,1,1431655765),f.call(this,8,16711935),f.call(this,2,858993459),d.call(this,16,65535),d.call(this,4,252645135),e[t]=this._lBlock,e[t+1]=this._rBlock},keySize:2,ivSize:2,blockSize:2});function d(e,t){var n=(this._lBlock>>>e^this._rBlock)&t;this._rBlock^=n,this._lBlock^=n<<e}function f(e,t){var n=(this._rBlock>>>e^this._lBlock)&t;this._lBlock^=n,this._rBlock^=n<<e}e.DES=i._createHelper(u);var p=s.TripleDES=i.extend({_doReset:function(){var e=this._key.words;if(2!==e.length&&4!==e.length&&e.length<6)throw new Error("Invalid key length - 3DES requires the key length to be 64, 128, 192 or >192.");var t=e.slice(0,2),r=e.length<4?e.slice(0,2):e.slice(2,4),i=e.length<6?e.slice(0,2):e.slice(4,6);this._des1=u.createEncryptor(n.create(t)),this._des2=u.createEncryptor(n.create(r)),this._des3=u.createEncryptor(n.create(i))},encryptBlock:function(e,t){this._des1.encryptBlock(e,t),this._des2.decryptBlock(e,t),this._des3.encryptBlock(e,t)},decryptBlock:function(e,t){this._des3.decryptBlock(e,t),this._des2.encryptBlock(e,t),this._des1.decryptBlock(e,t)},keySize:6,ivSize:2,blockSize:2});e.TripleDES=i._createHelper(p)}(),r.TripleDES)},3240:function(e,t,n){var r;e.exports=(r=n(9021),function(e){var t=r,n=t.lib,i=n.Base,s=n.WordArray,o=t.x64={};o.Word=i.extend({init:function(e,t){this.high=e,this.low=t}}),o.WordArray=i.extend({init:function(t,n){t=this.words=t||[],this.sigBytes=n!=e?n:8*t.length},toX32:function(){for(var e=this.words,t=e.length,n=[],r=0;r<t;r++){var i=e[r];n.push(i.high),n.push(i.low)}return s.create(n,this.sigBytes)},clone:function(){for(var e=i.clone.call(this),t=e.words=this.words.slice(0),n=t.length,r=0;r<n;r++)t[r]=t[r].clone();return e}})}(),r)},7054:(e,t,n)=>{"use strict";n.d(t,{A:()=>Ht});var r=Object.keys,i=Array.isArray,s="undefined"!=typeof self?self:"undefined"!=typeof window?window:n.g;function o(e,t){return"object"!=typeof t||r(t).forEach((function(n){e[n]=t[n]})),e}var a=Object.getPrototypeOf,l={}.hasOwnProperty;function c(e,t){return l.call(e,t)}function h(e,t){"function"==typeof t&&(t=t(a(e))),r(t).forEach((function(n){d(e,n,t[n])}))}var u=Object.defineProperty;function d(e,t,n,r){u(e,t,o(n&&c(n,"get")&&"function"==typeof n.get?{get:n.get,set:n.set,configurable:!0}:{value:n,configurable:!0,writable:!0},r))}function f(e){return{from:function(t){return e.prototype=Object.create(t.prototype),d(e.prototype,"constructor",e),{extend:h.bind(null,e.prototype)}}}}var p=Object.getOwnPropertyDescriptor;function g(e,t){var n;return p(e,t)||(n=a(e))&&g(n,t)}var v=[].slice;function m(e,t,n){return v.call(e,t,n)}function y(e,t){return t(e)}function b(e){if(!e)throw new Error("Assertion Failed")}function _(e){s.setImmediate?setImmediate(e):setTimeout(e,0)}function w(e,t){return e.reduce((function(e,n,r){var i=t(n,r);return i&&(e[i[0]]=i[1]),e}),{})}function S(e,t){return function(){try{e.apply(this,arguments)}catch(e){t(e)}}}function E(e,t,n){try{e.apply(null,n)}catch(e){t&&t(e)}}function A(e,t){if(c(e,t))return e[t];if(!t)return e;if("string"!=typeof t){for(var n=[],r=0,i=t.length;r<i;++r){var s=A(e,t[r]);n.push(s)}return n}var o=t.indexOf(".");if(-1!==o){var a=e[t.substr(0,o)];return void 0===a?void 0:A(a,t.substr(o+1))}}function P(e,t,n){if(e&&void 0!==t&&(!("isFrozen"in Object)||!Object.isFrozen(e)))if("string"!=typeof t&&"length"in t){b("string"!=typeof n&&"length"in n);for(var r=0,i=t.length;r<i;++r)P(e,t[r],n[r])}else{var s=t.indexOf(".");if(-1!==s){var o=t.substr(0,s),a=t.substr(s+1);if(""===a)void 0===n?delete e[o]:e[o]=n;else{var l=e[o];l||(l=e[o]={}),P(l,a,n)}}else void 0===n?delete e[t]:e[t]=n}}function I(e){var t={};for(var n in e)c(e,n)&&(t[n]=e[n]);return t}var x=[].concat;function O(e){return x.apply([],e)}var T="Boolean,String,Date,RegExp,Blob,File,FileList,ArrayBuffer,DataView,Uint8ClampedArray,ImageData,Map,Set".split(",").concat(O([8,16,32,64].map((function(e){return["Int","Uint","Float"].map((function(t){return t+e+"Array"}))})))).filter((function(e){return s[e]})).map((function(e){return s[e]}));function L(e){if(!e||"object"!=typeof e)return e;var t;if(i(e)){t=[];for(var n=0,r=e.length;n<r;++n)t.push(L(e[n]))}else if(T.indexOf(e.constructor)>=0)t=e;else for(var s in t=e.constructor?Object.create(e.constructor.prototype):{},e)c(e,s)&&(t[s]=L(e[s]));return t}function C(e,t,n,i){return n=n||{},i=i||"",r(e).forEach((function(r){if(c(t,r)){var s=e[r],o=t[r];"object"==typeof s&&"object"==typeof o&&s&&o&&""+s.constructor==""+o.constructor?C(s,o,n,i+r+"."):s!==o&&(n[i+r]=t[r])}else n[i+r]=void 0})),r(t).forEach((function(r){c(e,r)||(n[i+r]=t[r])})),n}var k="undefined"!=typeof Symbol&&Symbol.iterator,D=k?function(e){var t;return null!=e&&(t=e[k])&&t.apply(e)}:function(){return null},R={};function N(e){var t,n,r,s;if(1===arguments.length){if(i(e))return e.slice();if(this===R&&"string"==typeof e)return[e];if(s=D(e)){for(n=[];!(r=s.next()).done;)n.push(r.value);return n}if(null==e)return[e];if("number"==typeof(t=e.length)){for(n=new Array(t);t--;)n[t]=e[t];return n}return[e]}for(t=arguments.length,n=new Array(t);t--;)n[t]=arguments[t];return n}var B="undefined"!=typeof location&&/^(http|https):\/\/(localhost|127\.0\.0\.1)/.test(location.href);function M(e,t){B=e,F=t}var F=function(){return!0},H=!new Error("").stack;function U(){if(H)try{throw U.arguments,new Error}catch(e){return e}return new Error}function W(e,t){var n=e.stack;return n?(t=t||0,0===n.indexOf(e.name)&&(t+=(e.name+e.message).split("\n").length),n.split("\n").slice(t).filter(F).map((function(e){return"\n"+e})).join("")):""}var j=["Unknown","Constraint","Data","TransactionInactive","ReadOnly","Version","NotFound","InvalidState","InvalidAccess","Abort","Timeout","QuotaExceeded","Syntax","DataClone"],$=["Modify","Bulk","OpenFailed","VersionChange","Schema","Upgrade","InvalidTable","MissingAPI","NoSuchDatabase","InvalidArgument","SubTransaction","Unsupported","Internal","DatabaseClosed","PrematureCommit","ForeignAwait"].concat(j),V={VersionChanged:"Database version changed by other database connection",DatabaseClosed:"Database has been closed",Abort:"Transaction aborted",TransactionInactive:"Transaction has already completed or failed"};function z(e,t){this._e=U(),this.name=e,this.message=t}function G(e,t,n,r){this._e=U(),this.failures=t,this.failedKeys=r,this.successCount=n}function q(e,t){this._e=U(),this.name="BulkError",this.failures=t,this.message=function(e,t){return e+". Errors: "+t.map((function(e){return e.toString()})).filter((function(e,t,n){return n.indexOf(e)===t})).join("\n")}(e,t)}f(z).from(Error).extend({stack:{get:function(){return this._stack||(this._stack=this.name+": "+this.message+W(this._e,2))}},toString:function(){return this.name+": "+this.message}}),f(G).from(z),f(q).from(z);var Q=$.reduce((function(e,t){return e[t]=t+"Error",e}),{}),K=z,Y=$.reduce((function(e,t){var n=t+"Error";function r(e,r){this._e=U(),this.name=n,e?"string"==typeof e?(this.message=e,this.inner=r||null):"object"==typeof e&&(this.message=e.name+" "+e.message,this.inner=e):(this.message=V[t]||n,this.inner=null)}return f(r).from(K),e[t]=r,e}),{});Y.Syntax=SyntaxError,Y.Type=TypeError,Y.Range=RangeError;var J=j.reduce((function(e,t){return e[t+"Error"]=Y[t],e}),{});var X=$.reduce((function(e,t){return-1===["Syntax","Type","Range"].indexOf(t)&&(e[t+"Error"]=Y[t]),e}),{});function Z(){}function ee(e){return e}function te(e,t){return null==e||e===ee?t:function(n){return t(e(n))}}function ne(e,t){return function(){e.apply(this,arguments),t.apply(this,arguments)}}function re(e,t){return e===Z?t:function(){var n=e.apply(this,arguments);void 0!==n&&(arguments[0]=n);var r=this.onsuccess,i=this.onerror;this.onsuccess=null,this.onerror=null;var s=t.apply(this,arguments);return r&&(this.onsuccess=this.onsuccess?ne(r,this.onsuccess):r),i&&(this.onerror=this.onerror?ne(i,this.onerror):i),void 0!==s?s:n}}function ie(e,t){return e===Z?t:function(){e.apply(this,arguments);var n=this.onsuccess,r=this.onerror;this.onsuccess=this.onerror=null,t.apply(this,arguments),n&&(this.onsuccess=this.onsuccess?ne(n,this.onsuccess):n),r&&(this.onerror=this.onerror?ne(r,this.onerror):r)}}function se(e,t){return e===Z?t:function(n){var r=e.apply(this,arguments);o(n,r);var i=this.onsuccess,s=this.onerror;this.onsuccess=null,this.onerror=null;var a=t.apply(this,arguments);return i&&(this.onsuccess=this.onsuccess?ne(i,this.onsuccess):i),s&&(this.onerror=this.onerror?ne(s,this.onerror):s),void 0===r?void 0===a?void 0:a:o(r,a)}}function oe(e,t){return e===Z?t:function(){return!1!==t.apply(this,arguments)&&e.apply(this,arguments)}}function ae(e,t){return e===Z?t:function(){var n=e.apply(this,arguments);if(n&&"function"==typeof n.then){for(var r=this,i=arguments.length,s=new Array(i);i--;)s[i]=arguments[i];return n.then((function(){return t.apply(r,s)}))}return t.apply(this,arguments)}}X.ModifyError=G,X.DexieError=z,X.BulkError=q;var le={},ce=function(){try{return new Function("let F=async ()=>{},p=F();return [p,Object.getPrototypeOf(p),Promise.resolve(),F.constructor];")()}catch(t){var e=s.Promise;return e?[e.resolve(),e.prototype,e.resolve()]:[]}}(),he=ce[0],ue=ce[1],de=ce[2],fe=ue&&ue.then,pe=he&&he.constructor,ge=ce[3],ve=!!de,me=!1,ye=de?function(){de.then(We)}:s.setImmediate?setImmediate.bind(null,We):s.MutationObserver?function(){var e=document.createElement("div");new MutationObserver((function(){We(),e=null})).observe(e,{attributes:!0}),e.setAttribute("i","1")}:function(){setTimeout(We,0)},be=function(e,t){Oe.push([e,t]),we&&(ye(),we=!1)},_e=!0,we=!0,Se=[],Ee=[],Ae=null,Pe=ee,Ie={id:"global",global:!0,ref:0,unhandleds:[],onunhandled:ut,pgp:!1,env:{},finalize:function(){this.unhandleds.forEach((function(e){try{ut(e[0],e[1])}catch(e){}}))}},xe=Ie,Oe=[],Te=0,Le=[];function Ce(e){if("object"!=typeof this)throw new TypeError("Promises must be constructed via new");this._listeners=[],this.onuncatched=Z,this._lib=!1;var t=this._PSD=xe;if(B&&(this._stackHolder=U(),this._prev=null,this._numPrev=0),"function"!=typeof e){if(e!==le)throw new TypeError("Not a function");return this._state=arguments[1],this._value=arguments[2],void(!1===this._state&&Ne(this,this._value))}this._state=null,this._value=null,++t.ref,Re(this,e)}var ke={get:function(){var e=xe,t=Je;function n(n,r){var i=this,s=!e.global&&(e!==xe||t!==Je);s&&tt();var o=new Ce((function(t,o){Me(i,new De(lt(n,e,s),lt(r,e,s),t,o,e))}));return B&&Ue(o,this),o}return n.prototype=le,n},set:function(e){d(this,"then",e&&e.prototype===le?ke:{get:function(){return e},set:ke.set})}};function De(e,t,n,r,i){this.onFulfilled="function"==typeof e?e:null,this.onRejected="function"==typeof t?t:null,this.resolve=n,this.reject=r,this.psd=i}function Re(e,t){try{t((function(t){if(null===e._state){if(t===e)throw new TypeError("A promise cannot be resolved with itself.");var n=e._lib&&je();t&&"function"==typeof t.then?Re(e,(function(e,n){t instanceof Ce?t._then(e,n):t.then(e,n)})):(e._state=!0,e._value=t,Be(e)),n&&$e()}}),Ne.bind(null,e))}catch(t){Ne(e,t)}}function Ne(e,t){if(Ee.push(t),null===e._state){var n=e._lib&&je();t=Pe(t),e._state=!1,e._value=t,B&&null!==t&&"object"==typeof t&&!t._promise&&E((function(){var n=g(t,"stack");t._promise=e,d(t,"stack",{get:function(){return me?n&&(n.get?n.get.apply(t):n.value):e.stack}})})),function(e){Se.some((function(t){return t._value===e._value}))||Se.push(e)}(e),Be(e),n&&$e()}}function Be(e){var t=e._listeners;e._listeners=[];for(var n=0,r=t.length;n<r;++n)Me(e,t[n]);var i=e._PSD;--i.ref||i.finalize(),0===Te&&(++Te,be((function(){0==--Te&&Ve()}),[]))}function Me(e,t){if(null!==e._state){var n=e._state?t.onFulfilled:t.onRejected;if(null===n)return(e._state?t.resolve:t.reject)(e._value);++t.psd.ref,++Te,be(Fe,[n,e,t])}else e._listeners.push(t)}function Fe(e,t,n){try{Ae=t;var r,i=t._value;t._state?r=e(i):(Ee.length&&(Ee=[]),r=e(i),-1===Ee.indexOf(i)&&function(e){var t=Se.length;for(;t;)if(Se[--t]._value===e._value)return void Se.splice(t,1)}(t)),n.resolve(r)}catch(e){n.reject(e)}finally{Ae=null,0==--Te&&Ve(),--n.psd.ref||n.psd.finalize()}}function He(e,t,n){if(t.length===n)return t;var r="";if(!1===e._state){var i,s,o=e._value;null!=o?(i=o.name||"Error",s=o.message||o,r=W(o,0)):(i=o,s=""),t.push(i+(s?": "+s:"")+r)}return B&&((r=W(e._stackHolder,2))&&-1===t.indexOf(r)&&t.push(r),e._prev&&He(e._prev,t,n)),t}function Ue(e,t){var n=t?t._numPrev+1:0;n<100&&(e._prev=t,e._numPrev=n)}function We(){je()&&$e()}function je(){var e=_e;return _e=!1,we=!1,e}function $e(){var e,t,n;do{for(;Oe.length>0;)for(e=Oe,Oe=[],n=e.length,t=0;t<n;++t){var r=e[t];r[0].apply(null,r[1])}}while(Oe.length>0);_e=!0,we=!0}function Ve(){var e=Se;Se=[],e.forEach((function(e){e._PSD.onunhandled.call(null,e._value,e)}));for(var t=Le.slice(0),n=t.length;n;)t[--n]()}function ze(e){return new Ce(le,!1,e)}function Ge(e,t){var n=xe;return function(){var r=je(),i=xe;try{return st(n,!0),e.apply(this,arguments)}catch(e){t&&t(e)}finally{st(i,!1),r&&$e()}}}h(Ce.prototype,{then:ke,_then:function(e,t){Me(this,new De(null,null,e,t,xe))},catch:function(e){if(1===arguments.length)return this.then(null,e);var t=arguments[0],n=arguments[1];return"function"==typeof t?this.then(null,(function(e){return e instanceof t?n(e):ze(e)})):this.then(null,(function(e){return e&&e.name===t?n(e):ze(e)}))},finally:function(e){return this.then((function(t){return e(),t}),(function(t){return e(),ze(t)}))},stack:{get:function(){if(this._stack)return this._stack;try{me=!0;var e=He(this,[],20).join("\nFrom previous: ");return null!==this._state&&(this._stack=e),e}finally{me=!1}}},timeout:function(e,t){var n=this;return e<1/0?new Ce((function(r,i){var s=setTimeout((function(){return i(new Y.Timeout(t))}),e);n.then(r,i).finally(clearTimeout.bind(null,s))})):this}}),"undefined"!=typeof Symbol&&Symbol.toStringTag&&d(Ce.prototype,Symbol.toStringTag,"Promise"),Ie.env=ot(),h(Ce,{all:function(){var e=N.apply(null,arguments).map(nt);return new Ce((function(t,n){0===e.length&&t([]);var r=e.length;e.forEach((function(i,s){return Ce.resolve(i).then((function(n){e[s]=n,--r||t(e)}),n)}))}))},resolve:function(e){if(e instanceof Ce)return e;if(e&&"function"==typeof e.then)return new Ce((function(t,n){e.then(t,n)}));var t=new Ce(le,!0,e);return Ue(t,Ae),t},reject:ze,race:function(){var e=N.apply(null,arguments).map(nt);return new Ce((function(t,n){e.map((function(e){return Ce.resolve(e).then(t,n)}))}))},PSD:{get:function(){return xe},set:function(e){return xe=e}},newPSD:Ze,usePSD:at,scheduler:{get:function(){return be},set:function(e){be=e}},rejectionMapper:{get:function(){return Pe},set:function(e){Pe=e}},follow:function(e,t){return new Ce((function(n,r){return Ze((function(t,n){var r=xe;r.unhandleds=[],r.onunhandled=n,r.finalize=ne((function(){var e=this;!function(e){function t(){e(),Le.splice(Le.indexOf(t),1)}Le.push(t),++Te,be((function(){0==--Te&&Ve()}),[])}((function(){0===e.unhandleds.length?t():n(e.unhandleds[0])}))}),r.finalize),e()}),t,n,r)}))}});var qe={awaits:0,echoes:0,id:0},Qe=0,Ke=[],Ye=0,Je=0,Xe=0;function Ze(e,t,n,r){var i=xe,s=Object.create(i);s.parent=i,s.ref=0,s.global=!1,s.id=++Xe;var a=Ie.env;s.env=ve?{Promise:Ce,PromiseProp:{value:Ce,configurable:!0,writable:!0},all:Ce.all,race:Ce.race,resolve:Ce.resolve,reject:Ce.reject,nthen:ct(a.nthen,s),gthen:ct(a.gthen,s)}:{},t&&o(s,t),++i.ref,s.finalize=function(){--this.parent.ref||this.parent.finalize()};var l=at(s,e,n,r);return 0===s.ref&&s.finalize(),l}function et(){return qe.id||(qe.id=++Qe),++qe.awaits,qe.echoes+=7,qe.id}function tt(e){!qe.awaits||e&&e!==qe.id||(0==--qe.awaits&&(qe.id=0),qe.echoes=7*qe.awaits)}function nt(e){return qe.echoes&&e&&e.constructor===pe?(et(),e.then((function(e){return tt(),e}),(function(e){return tt(),dt(e)}))):e}function rt(e){++Je,qe.echoes&&0!=--qe.echoes||(qe.echoes=qe.id=0),Ke.push(xe),st(e,!0)}function it(){var e=Ke[Ke.length-1];Ke.pop(),st(e,!1)}function st(e,t){var n,r=xe;if((t?!qe.echoes||Ye++&&e===xe:!Ye||--Ye&&e===xe)||(n=t?rt.bind(null,e):it,fe.call(he,n)),e!==xe&&(xe=e,r===Ie&&(Ie.env=ot()),ve)){var i=Ie.env.Promise,o=e.env;ue.then=o.nthen,i.prototype.then=o.gthen,(r.global||e.global)&&(Object.defineProperty(s,"Promise",o.PromiseProp),i.all=o.all,i.race=o.race,i.resolve=o.resolve,i.reject=o.reject)}}function ot(){var e=s.Promise;return ve?{Promise:e,PromiseProp:Object.getOwnPropertyDescriptor(s,"Promise"),all:e.all,race:e.race,resolve:e.resolve,reject:e.reject,nthen:ue.then,gthen:e.prototype.then}:{}}function at(e,t,n,r,i){var s=xe;try{return st(e,!0),t(n,r,i)}finally{st(s,!1)}}function lt(e,t,n){return"function"!=typeof e?e:function(){var r=xe;n&&et(),st(t,!0);try{return e.apply(this,arguments)}finally{st(r,!1)}}}function ct(e,t){return function(n,r){return e.call(this,lt(n,t,!1),lt(r,t,!1))}}var ht="unhandledrejection";function ut(e,t){var n;try{n=t.onuncatched(e)}catch(e){}if(!1!==n)try{var r,i={promise:t,reason:e};if(s.document&&document.createEvent?((r=document.createEvent("Event")).initEvent(ht,!0,!0),o(r,i)):s.CustomEvent&&o(r=new CustomEvent(ht,{detail:i}),i),r&&s.dispatchEvent&&(dispatchEvent(r),!s.PromiseRejectionEvent&&s.onunhandledrejection))try{s.onunhandledrejection(r)}catch(e){}r.defaultPrevented||console.warn("Unhandled rejection: "+(e.stack||e))}catch(e){}}var dt=Ce.reject;function ft(e){var t={},n=function(n,r){if(r){for(var i=arguments.length,s=new Array(i-1);--i;)s[i-1]=arguments[i];return t[n].subscribe.apply(null,s),e}if("string"==typeof n)return t[n]};n.addEventType=a;for(var s=1,o=arguments.length;s<o;++s)a(arguments[s]);return n;function a(e,s,o){if("object"!=typeof e){var l;s||(s=oe),o||(o=Z);var c={subscribers:[],fire:o,subscribe:function(e){-1===c.subscribers.indexOf(e)&&(c.subscribers.push(e),c.fire=s(c.fire,e))},unsubscribe:function(e){c.subscribers=c.subscribers.filter((function(t){return t!==e})),c.fire=c.subscribers.reduce(s,o)}};return t[e]=n[e]=c,c}r(l=e).forEach((function(e){var t=l[e];if(i(t))a(e,l[e][0],l[e][1]);else{if("asap"!==t)throw new Y.InvalidArgument("Invalid event config");var n=a(e,ee,(function(){for(var e=arguments.length,t=new Array(e);e--;)t[e]=arguments[e];n.subscribers.forEach((function(e){_((function(){e.apply(null,t)}))}))}))}}))}}var pt,gt="{version}",vt=String.fromCharCode(65535),mt=function(){try{return IDBKeyRange.only([[]]),[[]]}catch(e){return vt}}(),yt=-1/0,bt="Invalid key provided. Keys must be of type string, number, Date or Array<string | number | Date>.",_t="String expected.",wt=[],St="undefined"!=typeof navigator&&/(MSIE|Trident|Edge)/.test(navigator.userAgent),Et=St,At=St,Pt=function(e){return!/(dexie\.js|dexie\.min\.js)/.test(e)};function It(e,t){var n,a,l,u,f,p=It.dependencies,g=o({addons:It.addons,autoOpen:!0,indexedDB:p.indexedDB,IDBKeyRange:p.IDBKeyRange},t),v=g.addons,_=g.autoOpen,x=g.indexedDB,T=g.IDBKeyRange,k=this._dbSchema={},D=[],M=[],F={},H=null,j=null,$=!1,V=null,z=!1,Q="readonly",K="readwrite",J=this,X=new Ce((function(e){n=e})),ne=new Ce((function(e,t){a=t})),oe=!0,le=!!Ft(x);function ce(e){this._cfg={version:e,storesSource:null,dbschema:{},tables:{},contentUpgrade:null},this.stores({})}function he(e,t,n){var i=J._createTransaction(K,M,k);i.create(t),i._completion.catch(n);var s=i._reject.bind(i);Ze((function(){xe.trans=i,0===e?(r(k).forEach((function(e){ue(t,e,k[e].primKey,k[e].indexes)})),Ce.follow((function(){return J.on.populate.fire(i)})).catch(s)):function(e,t,n){var i=[],s=D.filter((function(t){return t._cfg.version===e}))[0];if(!s)throw new Y.Upgrade("Dexie specification of currently installed DB version is missing");k=J._dbSchema=s._cfg.dbschema;var o=!1,a=D.filter((function(t){return t._cfg.version>e}));function l(){return i.length?Ce.resolve(i.shift()(t.idbtrans)).then(l):Ce.resolve()}return a.forEach((function(e){i.push((function(){var r=k,i=e._cfg.dbschema;Be(r,n),Be(i,n),k=J._dbSchema=i;var s=function(e,t){var n={del:[],add:[],change:[]};for(var r in e)t[r]||n.del.push(r);for(r in t){var i=e[r],s=t[r];if(i){var o={name:r,def:s,recreate:!1,del:[],add:[],change:[]};if(i.primKey.src!==s.primKey.src)o.recreate=!0,n.change.push(o);else{var a=i.idxByName,l=s.idxByName;for(var c in a)l[c]||o.del.push(c);for(c in l){var h=a[c],u=l[c];h?h.src!==u.src&&o.change.push(u):o.add.push(u)}(o.del.length>0||o.add.length>0||o.change.length>0)&&n.change.push(o)}}else n.add.push([r,s])}return n}(r,i);if(s.add.forEach((function(e){ue(n,e[0],e[1].primKey,e[1].indexes)})),s.change.forEach((function(e){if(e.recreate)throw new Y.Upgrade("Not yet support for changing primary key");var t=n.objectStore(e.name);e.add.forEach((function(e){de(t,e)})),e.change.forEach((function(e){t.deleteIndex(e.name),de(t,e)})),e.del.forEach((function(e){t.deleteIndex(e)}))})),e._cfg.contentUpgrade)return o=!0,Ce.follow((function(){e._cfg.contentUpgrade(t)}))})),i.push((function(t){o&&Et||function(e,t){for(var n=0;n<t.db.objectStoreNames.length;++n){var r=t.db.objectStoreNames[n];null==e[r]&&t.db.deleteObjectStore(r)}}(e._cfg.dbschema,t)}))})),l().then((function(){!function(e,t){r(e).forEach((function(n){t.db.objectStoreNames.contains(n)||ue(t,n,e[n].primKey,e[n].indexes)}))}(k,n)}))}(e,i,t).catch(s)}))}function ue(e,t,n,r){var i=e.db.createObjectStore(t,n.keyPath?{keyPath:n.keyPath,autoIncrement:n.auto}:{autoIncrement:n.auto});return r.forEach((function(e){de(i,e)})),i}function de(e,t){e.createIndex(t.name,t.keyPath,{unique:t.unique,multiEntry:t.multi})}function fe(e,t,n){if(z||xe.letThrough){var r=J._createTransaction(e,t,k);try{r.create()}catch(e){return dt(e)}return r._promise(e,(function(e,t){return Ze((function(){return xe.trans=r,n(e,t,r)}))})).then((function(e){return r._completion.then((function(){return e}))}))}if(!$){if(!_)return dt(new Y.DatabaseClosed);J.open().catch(Z)}return X.then((function(){return fe(e,t,n)}))}function ve(e,t,n){var r=arguments.length;if(r<2)throw new Y.InvalidArgument("Too few arguments");for(var i=new Array(r-1);--r;)i[r-1]=arguments[r];return n=i.pop(),[e,O(i),n]}function me(e,t,n){this.name=e,this.schema=t,this._tx=n,this.hook=F[e]?F[e].hook:ft(null,{creating:[re,Z],reading:[te,ee],updating:[se,Z],deleting:[ie,Z]})}function ye(e,t,n){return(n?kt:Lt)((function(n){e.push(n),t&&t()}))}function be(e,t,n,r,i){return new Ce((function(s,o){var a=n.length,l=a-1;if(0===a)return s();if(r){var c,h=kt(o),u=Tt(null);E((function(){for(var r=0;r<a;++r){c={onsuccess:null,onerror:null};var o=n[r];i.call(c,o[0],o[1],t);var d=e.delete(o[0]);d._hookCtx=c,d.onerror=h,d.onsuccess=r===l?Tt(s):u}}),(function(e){throw c.onerror&&c.onerror(e),e}))}else for(var d=0;d<a;++d){var f=e.delete(n[d]);f.onerror=Lt(o),d===l&&(f.onsuccess=Ge((function(){return s()})))}}))}function _e(e,t,n,r){var i=this;this.db=J,this.mode=e,this.storeNames=t,this.idbtrans=null,this.on=ft(this,"complete","error","abort"),this.parent=r||null,this.active=!0,this._reculock=0,this._blockedFuncs=[],this._resolve=null,this._reject=null,this._waitingFor=null,this._waitingQueue=null,this._spinCount=0,this._completion=new Ce((function(e,t){i._resolve=e,i._reject=t})),this._completion.then((function(){i.active=!1,i.on.complete.fire()}),(function(e){var t=i.active;return i.active=!1,i.on.error.fire(e),i.parent?i.parent._reject(e):t&&i.idbtrans&&i.idbtrans.abort(),dt(e)}))}function we(e,t,n){this._ctx={table:e,index:":id"===t?null:t,or:n}}function Se(e,t){var n=null,r=null;if(t)try{n=t()}catch(e){r=e}var i=e._ctx,s=i.table;this._ctx={table:s,index:i.index,isPrimKey:!i.index||s.schema.primKey.keyPath&&i.index===s.schema.primKey.name,range:n,keysOnly:!1,dir:"next",unique:"",algorithm:null,filter:null,replayFilter:null,justLimit:!0,isMatch:null,offset:0,limit:1/0,error:r,or:i.or,valueMapper:s.hook.reading.fire}}function Ee(e,t){return!(e.filter||e.algorithm||e.or)&&(t?e.justLimit:!e.replayFilter)}function Ae(e,t){return e._cfg.version-t._cfg.version}function Pe(e,t,n){t.forEach((function(t){var r=n[t];e.forEach((function(e){t in e||(e===_e.prototype||e instanceof _e?d(e,t,{get:function(){return this.table(t)}}):e[t]=new me(t,r))}))}))}function Ie(e,t,n,r,i,s){var o=Ge(s?function(e,t,r){return n(s(e),t,r)}:n,i);e.onerror||(e.onerror=Lt(i)),e.onsuccess=S(t?function(){var n=e.result;if(n){var s=function(){n.continue()};t(n,(function(e){s=e}),r,i)&&o(n.value,n,(function(e){s=e})),s()}else r()}:function(){var t=e.result;if(t){var n=function(){t.continue()};o(t.value,t,(function(e){n=e})),n()}else r()},i)}function Oe(e,t){return x.cmp(e,t)}function Te(e,t){return Oe(e,t)>0?e:t}function Le(e,t){return x.cmp(e,t)}function ke(e,t){return x.cmp(t,e)}function De(e,t){return e<t?-1:e===t?0:1}function Re(e,t){return e>t?-1:e===t?0:1}function Ne(e,t){return e?t?function(){return e.apply(this,arguments)&&t.apply(this,arguments)}:e:t}function Be(e,t){for(var n=t.db.objectStoreNames,r=0;r<n.length;++r){var i=n[r],o=t.objectStore(i);l="getAll"in o;for(var a=0;a<o.indexNames.length;++a){var c=o.indexNames[a],h=o.index(c).keyPath,u="string"==typeof h?h:"["+m(h).join("+")+"]";if(e[i]){var d=e[i].idxByName[u];d&&(d.name=c)}}}/Safari/.test(navigator.userAgent)&&!/(Chrome\/|Edge\/)/.test(navigator.userAgent)&&s.WorkerGlobalScope&&s instanceof s.WorkerGlobalScope&&[].concat(navigator.userAgent.match(/Safari\/(\d*)/))[1]<604&&(l=!1)}function Me(e){J.on("blocked").fire(e),wt.filter((function(e){return e.name===J.name&&e!==J&&!e._vcFired})).map((function(t){return t.on("versionchange").fire(e)}))}this.version=function(e){if(H||$)throw new Y.Schema("Cannot add version when database is open");this.verno=Math.max(this.verno,e);var t=D.filter((function(t){return t._cfg.version===e}))[0];return t||(t=new ce(e),D.push(t),D.sort(Ae),oe=!1,t)},o(ce.prototype,{stores:function(e){this._cfg.storesSource=this._cfg.storesSource?o(this._cfg.storesSource,e):e;var t={};D.forEach((function(e){o(t,e._cfg.storesSource)}));var n=this._cfg.dbschema={};return this._parseStoresSpec(t,n),k=J._dbSchema=n,[F,J,_e.prototype].forEach((function(e){for(var t in e)e[t]instanceof me&&delete e[t]})),Pe([F,J,_e.prototype,this._cfg.tables],r(n),n),M=r(n),this},upgrade:function(e){return this._cfg.contentUpgrade=e,this},_parseStoresSpec:function(e,t){r(e).forEach((function(n){if(null!==e[n]){var r={},s=function(e){var t=[];return e.split(",").forEach((function(e){var n=(e=e.trim()).replace(/([&*]|\+\+)/g,""),r=/^\[/.test(n)?n.match(/^\[(.*)\]$/)[1].split("+"):n;t.push(new Nt(n,r||null,/\&/.test(e),/\*/.test(e),/\+\+/.test(e),i(r),/\./.test(e)))})),t}(e[n]),o=s.shift();if(o.multi)throw new Y.Schema("Primary key cannot be multi-valued");o.keyPath&&P(r,o.keyPath,o.auto?0:o.keyPath),s.forEach((function(e){if(e.auto)throw new Y.Schema("Only primary key can be marked as autoIncrement (++)");if(!e.keyPath)throw new Y.Schema("Index must have a name and cannot be an empty string");P(r,e.keyPath,e.compound?e.keyPath.map((function(){return""})):"")})),t[n]=new Bt(n,o,s,r)}}))}}),this._allTables=F,this._createTransaction=function(e,t,n,r){return new _e(e,t,n,r)},this._whenReady=function(e){return z||xe.letThrough?e():new Ce((function(e,t){if(!$){if(!_)return void t(new Y.DatabaseClosed);J.open().catch(Z)}X.then(e,t)})).then(e)},this.verno=0,this.open=function(){if($||H)return X.then((function(){return j?dt(j):J}));B&&(ne._stackHolder=U()),$=!0,j=null,z=!1;var t=n,i=null;return Ce.race([ne,new Ce((function(t,n){if(!x)throw new Y.MissingAPI("indexedDB API not found. If using IE10+, make sure to run your code on a server URL (not locally). If using old Safari versions, make sure to include indexedDB polyfill.");var s=oe?x.open(e):x.open(e,Math.round(10*J.verno));if(!s)throw new Y.MissingAPI("IndexedDB API not available");s.onerror=Lt(n),s.onblocked=Ge(Me),s.onupgradeneeded=Ge((function(t){if(i=s.transaction,oe&&!J._allowEmptyDB){s.onerror=Dt,i.abort(),s.result.close();var r=x.deleteDatabase(e);r.onsuccess=r.onerror=Ge((function(){n(new Y.NoSuchDatabase("Database "+e+" doesnt exist"))}))}else{i.onerror=Lt(n),he((t.oldVersion>Math.pow(2,62)?0:t.oldVersion)/10,i,n)}}),n),s.onsuccess=Ge((function(){if(i=null,H=s.result,wt.push(J),oe)!function(){if(J.verno=H.version/10,J._dbSchema=k={},0===(M=m(H.objectStoreNames,0)).length)return;var e=H.transaction(Mt(M),"readonly");M.forEach((function(t){for(var n=e.objectStore(t),r=n.keyPath,i=r&&"string"==typeof r&&-1!==r.indexOf("."),s=new Nt(r,r||"",!1,!1,!!n.autoIncrement,r&&"string"!=typeof r,i),o=[],a=0;a<n.indexNames.length;++a){var l=n.index(n.indexNames[a]);i=(r=l.keyPath)&&"string"==typeof r&&-1!==r.indexOf(".");var c=new Nt(l.name,r,!!l.unique,!!l.multiEntry,!1,r&&"string"!=typeof r,i);o.push(c)}k[t]=new Bt(t,s,o,{})})),Pe([F],r(k),k)}();else if(H.objectStoreNames.length>0)try{Be(k,H.transaction(Mt(H.objectStoreNames),Q))}catch(e){}H.onversionchange=Ge((function(e){J._vcFired=!0,J.on("versionchange").fire(e)})),le||"__dbnames"===e||pt.dbnames.put({name:e}).catch(Z),t()}),n)}))]).then((function(){return V=[],Ce.resolve(It.vip(J.on.ready.fire)).then((function e(){if(V.length>0){var t=V.reduce(ae,Z);return V=[],Ce.resolve(It.vip(t)).then(e)}}))})).finally((function(){V=null})).then((function(){return $=!1,J})).catch((function(e){try{i&&i.abort()}catch(e){}return $=!1,J.close(),dt(j=e)})).finally((function(){z=!0,t()}))},this.close=function(){var e=wt.indexOf(J);if(e>=0&&wt.splice(e,1),H){try{H.close()}catch(e){}H=null}_=!1,j=new Y.DatabaseClosed,$&&a(j),X=new Ce((function(e){n=e})),ne=new Ce((function(e,t){a=t}))},this.delete=function(){var t=arguments.length>0;return new Ce((function(n,r){if(t)throw new Y.InvalidArgument("Arguments not allowed in db.delete()");function i(){J.close();var t=x.deleteDatabase(e);t.onsuccess=Ge((function(){le||pt.dbnames.delete(e).catch(Z),n()})),t.onerror=Lt(r),t.onblocked=Me}$?X.then(i):i()}))},this.backendDB=function(){return H},this.isOpen=function(){return null!==H},this.hasBeenClosed=function(){return j&&j instanceof Y.DatabaseClosed},this.hasFailed=function(){return null!==j},this.dynamicallyOpened=function(){return oe},this.name=e,h(this,{tables:{get:function(){return r(F).map((function(e){return F[e]}))}}}),this.on=ft(this,"populate","blocked","versionchange",{ready:[ae,Z]}),this.on.ready.subscribe=y(this.on.ready.subscribe,(function(e){return function(t,n){It.vip((function(){z?(j||Ce.resolve().then(t),n&&e(t)):V?(V.push(t),n&&e(t)):(e(t),n||e((function e(){J.on.ready.unsubscribe(t),J.on.ready.unsubscribe(e)})))}))}})),this.transaction=function(){var e=ve.apply(this,arguments);return this._transaction.apply(this,e)},this._transaction=function(e,t,n){var r=xe.trans;r&&r.db===J&&-1===e.indexOf("!")||(r=null);var i=-1!==e.indexOf("?");e=e.replace("!","").replace("?","");try{var s=t.map((function(e){var t=e instanceof me?e.name:e;if("string"!=typeof t)throw new TypeError("Invalid table argument to Dexie.transaction(). Only Table or String are allowed");return t}));if("r"==e||e==Q)e=Q;else{if("rw"!=e&&e!=K)throw new Y.InvalidArgument("Invalid transaction mode: "+e);e=K}if(r){if(r.mode===Q&&e===K){if(!i)throw new Y.SubTransaction("Cannot enter a sub-transaction with READWRITE mode when parent transaction is READONLY");r=null}r&&s.forEach((function(e){if(r&&-1===r.storeNames.indexOf(e)){if(!i)throw new Y.SubTransaction("Table "+e+" not included in parent transaction.");r=null}})),i&&r&&!r.active&&(r=null)}}catch(e){return r?r._promise(null,(function(t,n){n(e)})):dt(e)}return r?r._promise(e,o,"lock"):xe.trans?at(xe.transless,(function(){return J._whenReady(o)})):J._whenReady(o);function o(){return Ce.resolve().then((function(){var t,i=xe.transless||xe,o=J._createTransaction(e,s,k,r),a={trans:o,transless:i};r?o.idbtrans=r.idbtrans:o.create(),n.constructor===ge&&et();var l=Ce.follow((function(){if(t=n.call(o,o))if(t.constructor===pe){var e=tt.bind(null,null);t.then(e,e)}else"function"==typeof t.next&&"function"==typeof t.throw&&(t=Rt(t))}),a);return(t&&"function"==typeof t.then?Ce.resolve(t).then((function(e){return o.active?e:dt(new Y.PrematureCommit("Transaction committed too early. See http://bit.ly/2kdckMn"))})):l.then((function(){return t}))).then((function(e){return r&&o._resolve(),o._completion.then((function(){return e}))})).catch((function(e){return o._reject(e),dt(e)}))}))}},this.table=function(e){if(!c(F,e))throw new Y.InvalidTable("Table "+e+" does not exist");return F[e]},h(me.prototype,{_trans:function(e,t,n){var r=this._tx||xe.trans;return r&&r.db===J?r===xe.trans?r._promise(e,t,n):Ze((function(){return r._promise(e,t,n)}),{trans:r,transless:xe.transless||xe}):fe(e,[this.name],t)},_idbstore:function(e,t,n){var r=this.name;return this._trans(e,(function(e,n,i){if(-1===i.storeNames.indexOf(r))throw new Y.NotFound("Table"+r+" not part of transaction");return t(e,n,i.idbtrans.objectStore(r),i)}),n)},get:function(e,t){if(e&&e.constructor===Object)return this.where(e).first(t);var n=this;return this._idbstore(Q,(function(t,r,i){var s=i.get(e);s.onerror=Lt(r),s.onsuccess=Ge((function(){t(n.hook.reading.fire(s.result))}),r)})).then(t)},where:function(e){if("string"==typeof e)return new we(this,e);if(i(e))return new we(this,"["+e.join("+")+"]");var t=r(e);if(1===t.length)return this.where(t[0]).equals(e[t[0]]);var n=this.schema.indexes.concat(this.schema.primKey).filter((function(e){return e.compound&&t.every((function(t){return e.keyPath.indexOf(t)>=0}))&&e.keyPath.every((function(e){return t.indexOf(e)>=0}))}))[0];if(n&&mt!==vt)return this.where(n.name).equals(n.keyPath.map((function(t){return e[t]})));n||console.warn("The query "+JSON.stringify(e)+" on "+this.name+" would benefit of a compound index ["+t.join("+")+"]");var s=this.schema.idxByName,o=t.reduce((function(t,n){return[t[0]||s[n],t[0]||!s[n]?Ne(t[1],(function(t){return""+A(t,n)==""+e[n]})):t[1]]}),[null,null]),a=o[0];return a?this.where(a.name).equals(e[a.keyPath]).filter(o[1]):n?this.filter(o[1]):this.where(t).equals("")},count:function(e){return this.toCollection().count(e)},offset:function(e){return this.toCollection().offset(e)},limit:function(e){return this.toCollection().limit(e)},reverse:function(){return this.toCollection().reverse()},filter:function(e){return this.toCollection().and(e)},each:function(e){return this.toCollection().each(e)},toArray:function(e){return this.toCollection().toArray(e)},orderBy:function(e){return new Se(new we(this,i(e)?"["+e.join("+")+"]":e))},toCollection:function(){return new Se(new we(this))},mapToClass:function(e,t){this.schema.mappedClass=e;var n=Object.create(e.prototype);t&&Ot(n,t),this.schema.instanceTemplate=n;var r=function(t){if(!t)return t;var n=Object.create(e.prototype);for(var r in t)if(c(t,r))try{n[r]=t[r]}catch(e){}return n};return this.schema.readHook&&this.hook.reading.unsubscribe(this.schema.readHook),this.schema.readHook=r,this.hook("reading",r),e},defineClass:function(e){return this.mapToClass(It.defineClass(e),e)},bulkDelete:function(e){return this.hook.deleting.fire===Z?this._idbstore(K,(function(t,n,r,i){t(be(r,i,e,!1,Z))})):this.where(":id").anyOf(e).delete().then((function(){}))},bulkPut:function(e,t){var n=this;return this._idbstore(K,(function(r,i,s){if(!s.keyPath&&!n.schema.primKey.auto&&!t)throw new Y.InvalidArgument("bulkPut() with non-inbound keys requires keys array in second argument");if(s.keyPath&&t)throw new Y.InvalidArgument("bulkPut(): keys argument invalid on tables with inbound keys");if(t&&t.length!==e.length)throw new Y.InvalidArgument("Arguments objects and keys must have the same length");if(0===e.length)return r();var o,a,l=function(e){0===c.length?r(e):i(new q(n.name+".bulkPut(): "+c.length+" of "+h+" operations failed",c))},c=[],h=e.length,u=n;if(n.hook.creating.fire===Z&&n.hook.updating.fire===Z){a=ye(c);for(var d=0,f=e.length;d<f;++d)(o=t?s.put(e[d],t[d]):s.put(e[d])).onerror=a;o.onerror=ye(c,l),o.onsuccess=Ct(l)}else{var p=t||s.keyPath&&e.map((function(e){return A(e,s.keyPath)})),g=p&&w(p,(function(t,n){return null!=t&&[t,e[n]]})),v=p?u.where(":id").anyOf(p.filter((function(e){return null!=e}))).modify((function(){this.value=g[this.primKey],g[this.primKey]=null})).catch(G,(function(e){c=e.failures})).then((function(){for(var n=[],r=t&&[],i=p.length-1;i>=0;--i){var s=p[i];(null==s||g[s])&&(n.push(e[i]),t&&r.push(s),null!=s&&(g[s]=null))}return n.reverse(),t&&r.reverse(),u.bulkAdd(n,r)})).then((function(e){var t=p[p.length-1];return null!=t?t:e})):u.bulkAdd(e);v.then(l).catch(q,(function(e){c=c.concat(e.failures),l()})).catch(i)}}),"locked")},bulkAdd:function(e,t){var n=this,r=this.hook.creating.fire;return this._idbstore(K,(function(i,s,o,a){if(!o.keyPath&&!n.schema.primKey.auto&&!t)throw new Y.InvalidArgument("bulkAdd() with non-inbound keys requires keys array in second argument");if(o.keyPath&&t)throw new Y.InvalidArgument("bulkAdd(): keys argument invalid on tables with inbound keys");if(t&&t.length!==e.length)throw new Y.InvalidArgument("Arguments objects and keys must have the same length");if(0===e.length)return i();function l(e){0===d.length?i(e):s(new q(n.name+".bulkAdd(): "+d.length+" of "+f+" operations failed",d))}var c,h,u,d=[],f=e.length;if(r!==Z){var p,g=o.keyPath;h=ye(d,null,!0),u=Tt(null),E((function(){for(var n=0,i=e.length;n<i;++n){p={onerror:null,onsuccess:null};var s=t&&t[n],l=e[n],d=t?s:g?A(l,g):void 0,f=r.call(p,d,l,a);null==d&&null!=f&&(g?P(l=L(l),g,f):s=f),(c=null!=s?o.add(l,s):o.add(l))._hookCtx=p,n<i-1&&(c.onerror=h,p.onsuccess&&(c.onsuccess=u))}}),(function(e){throw p.onerror&&p.onerror(e),e})),c.onerror=ye(d,l,!0),c.onsuccess=Tt(l)}else{h=ye(d);for(var v=0,m=e.length;v<m;++v)(c=t?o.add(e[v],t[v]):o.add(e[v])).onerror=h;c.onerror=ye(d,l),c.onsuccess=Ct(l)}}))},add:function(e,t){var n=this.hook.creating.fire;return this._idbstore(K,(function(r,i,s,o){var a={onsuccess:null,onerror:null};if(n!==Z){var l=null!=t?t:s.keyPath?A(e,s.keyPath):void 0,c=n.call(a,l,e,o);null==l&&null!=c&&(s.keyPath?P(e,s.keyPath,c):t=c)}try{var h=null!=t?s.add(e,t):s.add(e);h._hookCtx=a,h.onerror=kt(i),h.onsuccess=Tt((function(t){var n=s.keyPath;n&&P(e,n,t),r(t)}))}catch(e){throw a.onerror&&a.onerror(e),e}}))},put:function(e,t){var n=this,r=this.hook.creating.fire,i=this.hook.updating.fire;if(r!==Z||i!==Z){var s=this.schema.primKey.keyPath,o=void 0!==t?t:s&&A(e,s);return null==o?this.add(e):(e=L(e),this._trans(K,(function(){return n.where(":id").equals(o).modify((function(){this.value=e})).then((function(r){return 0===r?n.add(e,t):o}))}),"locked"))}return this._idbstore(K,(function(n,r,i){var s=void 0!==t?i.put(e,t):i.put(e);s.onerror=Lt(r),s.onsuccess=Ge((function(t){var r=i.keyPath;r&&P(e,r,t.target.result),n(s.result)}))}))},delete:function(e){return this.hook.deleting.subscribers.length?this.where(":id").equals(e).delete():this._idbstore(K,(function(t,n,r){var i=r.delete(e);i.onerror=Lt(n),i.onsuccess=Ge((function(){t(i.result)}))}))},clear:function(){return this.hook.deleting.subscribers.length?this.toCollection().delete():this._idbstore(K,(function(e,t,n){var r=n.clear();r.onerror=Lt(t),r.onsuccess=Ge((function(){e(r.result)}))}))},update:function(e,t){if("object"!=typeof t||i(t))throw new Y.InvalidArgument("Modifications must be an object.");if("object"!=typeof e||i(e))return this.where(":id").equals(e).modify(t);r(t).forEach((function(n){P(e,n,t[n])}));var n=A(e,this.schema.primKey.keyPath);return void 0===n?dt(new Y.InvalidArgument("Given object does not contain its primary key")):this.where(":id").equals(n).modify(t)}}),h(_e.prototype,{_lock:function(){return b(!xe.global),++this._reculock,1!==this._reculock||xe.global||(xe.lockOwnerFor=this),this},_unlock:function(){if(b(!xe.global),0==--this._reculock)for(xe.global||(xe.lockOwnerFor=null);this._blockedFuncs.length>0&&!this._locked();){var e=this._blockedFuncs.shift();try{at(e[1],e[0])}catch(e){}}return this},_locked:function(){return this._reculock&&xe.lockOwnerFor!==this},create:function(e){var t=this;if(!this.mode)return this;if(b(!this.idbtrans),!e&&!H)switch(j&&j.name){case"DatabaseClosedError":throw new Y.DatabaseClosed(j);case"MissingAPIError":throw new Y.MissingAPI(j.message,j);default:throw new Y.OpenFailed(j)}if(!this.active)throw new Y.TransactionInactive;return b(null===this._completion._state),(e=this.idbtrans=e||H.transaction(Mt(this.storeNames),this.mode)).onerror=Ge((function(n){Dt(n),t._reject(e.error)})),e.onabort=Ge((function(n){Dt(n),t.active&&t._reject(new Y.Abort(e.error)),t.active=!1,t.on("abort").fire(n)})),e.oncomplete=Ge((function(){t.active=!1,t._resolve()})),this},_promise:function(e,t,n){var r=this;if(e===K&&this.mode!==K)return dt(new Y.ReadOnly("Transaction is readonly"));if(!this.active)return dt(new Y.TransactionInactive);if(this._locked())return new Ce((function(i,s){r._blockedFuncs.push([function(){r._promise(e,t,n).then(i,s)},xe])}));if(n)return Ze((function(){var e=new Ce((function(e,n){r._lock();var i=t(e,n,r);i&&i.then&&i.then(e,n)}));return e.finally((function(){return r._unlock()})),e._lib=!0,e}));var i=new Ce((function(e,n){var i=t(e,n,r);i&&i.then&&i.then(e,n)}));return i._lib=!0,i},_root:function(){return this.parent?this.parent._root():this},waitFor:function(e){var t=this._root();if(e=Ce.resolve(e),t._waitingFor)t._waitingFor=t._waitingFor.then((function(){return e}));else{t._waitingFor=e,t._waitingQueue=[];var n=t.idbtrans.objectStore(t.storeNames[0]);!function e(){for(++t._spinCount;t._waitingQueue.length;)t._waitingQueue.shift()();t._waitingFor&&(n.get(-1/0).onsuccess=e)}()}var r=t._waitingFor;return new Ce((function(n,i){e.then((function(e){return t._waitingQueue.push(Ge(n.bind(null,e)))}),(function(e){return t._waitingQueue.push(Ge(i.bind(null,e)))})).finally((function(){t._waitingFor===r&&(t._waitingFor=null)}))}))},abort:function(){this.active&&this._reject(new Y.Abort),this.active=!1},tables:{get:(u="Transaction.tables",f=function(){return F},function(){return console.warn(u+" is deprecated. See https://github.com/dfahlander/Dexie.js/wiki/Deprecations. "+W(U(),1)),f.apply(this,arguments)})},table:function(e){return new me(e,J.table(e).schema,this)}}),h(we.prototype,(function(){function e(e,t,n){var r=e instanceof we?new Se(e):e;return r._ctx.error=n?new n(t):new TypeError(t),r}function t(e){return new Se(e,(function(){return T.only("")})).limit(0)}function n(e,t,n,r,i,s){for(var o=Math.min(e.length,r.length),a=-1,l=0;l<o;++l){var c=t[l];if(c!==r[l])return i(e[l],n[l])<0?e.substr(0,l)+n[l]+n.substr(l+1):i(e[l],r[l])<0?e.substr(0,l)+r[l]+n.substr(l+1):a>=0?e.substr(0,a)+t[a]+n.substr(a+1):null;i(e[l],c)<0&&(a=l)}return o<r.length&&"next"===s?e+n.substr(e.length):o<e.length&&"prev"===s?e.substr(0,n.length):a<0?null:e.substr(0,a)+r[a]+n.substr(a+1)}function r(t,r,i,s){var o,a,l,c,h,u,d,f=i.length;if(!i.every((function(e){return"string"==typeof e})))return e(t,_t);function p(e){o=function(e){return"next"===e?function(e){return e.toUpperCase()}:function(e){return e.toLowerCase()}}(e),a=function(e){return"next"===e?function(e){return e.toLowerCase()}:function(e){return e.toUpperCase()}}(e),l="next"===e?De:Re;var t=i.map((function(e){return{lower:a(e),upper:o(e)}})).sort((function(e,t){return l(e.lower,t.lower)}));c=t.map((function(e){return e.upper})),h=t.map((function(e){return e.lower})),u=e,d="next"===e?"":s}p("next");var g=new Se(t,(function(){return T.bound(c[0],h[f-1]+s)}));g._ondirectionchange=function(e){p(e)};var v=0;return g._addAlgorithm((function(e,t,i){var s=e.key;if("string"!=typeof s)return!1;var o=a(s);if(r(o,h,v))return!0;for(var p=null,g=v;g<f;++g){var m=n(s,o,c[g],h[g],l,u);null===m&&null===p?v=g+1:(null===p||l(p,m)>0)&&(p=m)}return t(null!==p?function(){e.continue(p+d)}:i),!1})),g}return{between:function(n,r,i,s){i=!1!==i,s=!0===s;try{return Oe(n,r)>0||0===Oe(n,r)&&(i||s)&&(!i||!s)?t(this):new Se(this,(function(){return T.bound(n,r,!i,!s)}))}catch(t){return e(this,bt)}},equals:function(e){return new Se(this,(function(){return T.only(e)}))},above:function(e){return new Se(this,(function(){return T.lowerBound(e,!0)}))},aboveOrEqual:function(e){return new Se(this,(function(){return T.lowerBound(e)}))},below:function(e){return new Se(this,(function(){return T.upperBound(e,!0)}))},belowOrEqual:function(e){return new Se(this,(function(){return T.upperBound(e)}))},startsWith:function(t){return"string"!=typeof t?e(this,_t):this.between(t,t+vt,!0,!0)},startsWithIgnoreCase:function(e){return""===e?this.startsWith(e):r(this,(function(e,t){return 0===e.indexOf(t[0])}),[e],vt)},equalsIgnoreCase:function(e){return r(this,(function(e,t){return e===t[0]}),[e],"")},anyOfIgnoreCase:function(){var e=N.apply(R,arguments);return 0===e.length?t(this):r(this,(function(e,t){return-1!==t.indexOf(e)}),e,"")},startsWithAnyOfIgnoreCase:function(){var e=N.apply(R,arguments);return 0===e.length?t(this):r(this,(function(e,t){return t.some((function(t){return 0===e.indexOf(t)}))}),e,vt)},anyOf:function(){var n=N.apply(R,arguments),r=Le;try{n.sort(r)}catch(t){return e(this,bt)}if(0===n.length)return t(this);var i=new Se(this,(function(){return T.bound(n[0],n[n.length-1])}));i._ondirectionchange=function(e){r="next"===e?Le:ke,n.sort(r)};var s=0;return i._addAlgorithm((function(e,t,i){for(var o=e.key;r(o,n[s])>0;)if(++s===n.length)return t(i),!1;return 0===r(o,n[s])||(t((function(){e.continue(n[s])})),!1)})),i},notEqual:function(e){return this.inAnyRange([[yt,e],[e,mt]],{includeLowers:!1,includeUppers:!1})},noneOf:function(){var t=N.apply(R,arguments);if(0===t.length)return new Se(this);try{t.sort(Le)}catch(t){return e(this,bt)}var n=t.reduce((function(e,t){return e?e.concat([[e[e.length-1][1],t]]):[[yt,t]]}),null);return n.push([t[t.length-1],mt]),this.inAnyRange(n,{includeLowers:!1,includeUppers:!1})},inAnyRange:function(n,r){if(0===n.length)return t(this);if(!n.every((function(e){return void 0!==e[0]&&void 0!==e[1]&&Le(e[0],e[1])<=0})))return e(this,"First argument to inAnyRange() must be an Array of two-value Arrays [lower,upper] where upper must not be lower than lower",Y.InvalidArgument);var i=!r||!1!==r.includeLowers,s=r&&!0===r.includeUppers;var o,a=Le;function l(e,t){return a(e[0],t[0])}try{o=n.reduce((function(e,t){for(var n=0,r=e.length;n<r;++n){var i=e[n];if(Oe(t[0],i[1])<0&&Oe(t[1],i[0])>0){i[0]=Oe(s=i[0],o=t[0])<0?s:o,i[1]=Te(i[1],t[1]);break}}var s,o;return n===r&&e.push(t),e}),[]),o.sort(l)}catch(t){return e(this,bt)}var c=0,h=s?function(e){return Le(e,o[c][1])>0}:function(e){return Le(e,o[c][1])>=0},u=i?function(e){return ke(e,o[c][0])>0}:function(e){return ke(e,o[c][0])>=0};var d=h,f=new Se(this,(function(){return T.bound(o[0][0],o[o.length-1][1],!i,!s)}));return f._ondirectionchange=function(e){"next"===e?(d=h,a=Le):(d=u,a=ke),o.sort(l)},f._addAlgorithm((function(e,t,n){for(var r=e.key;d(r);)if(++c===o.length)return t(n),!1;return!!function(e){return!h(e)&&!u(e)}(r)||(0===Oe(r,o[c][1])||0===Oe(r,o[c][0])||t((function(){a===Le?e.continue(o[c][0]):e.continue(o[c][1])})),!1)})),f},startsWithAnyOf:function(){var n=N.apply(R,arguments);return n.every((function(e){return"string"==typeof e}))?0===n.length?t(this):this.inAnyRange(n.map((function(e){return[e,e+vt]}))):e(this,"startsWithAnyOf() only works with strings")}}})),h(Se.prototype,(function(){function e(e,t){e.filter=Ne(e.filter,t)}function t(e,t,n){var r=e.replayFilter;e.replayFilter=r?function(){return Ne(r(),t())}:t,e.justLimit=n&&!r}function n(e,t){if(e.isPrimKey)return t;var n=e.table.schema.idxByName[e.index];if(!n)throw new Y.Schema("KeyPath "+e.index+" on object store "+t.name+" is not indexed");return t.index(n.name)}function i(e,t){var r=n(e,t);return e.keysOnly&&"openKeyCursor"in r?r.openKeyCursor(e.range||null,e.dir+e.unique):r.openCursor(e.range||null,e.dir+e.unique)}function s(e,t,n,r,s){var o=e.replayFilter?Ne(e.filter,e.replayFilter()):e.filter;e.or?function(){var a={},l=0;function h(){2==++l&&n()}function u(e,n,i){if(!o||o(n,i,h,r)){var s=n.primaryKey,l=""+s;"[object ArrayBuffer]"===l&&(l=""+new Uint8Array(s)),c(a,l)||(a[l]=!0,t(e,n,i))}}e.or._iterate(u,h,r,s),Ie(i(e,s),e.algorithm,u,h,r,!e.keysOnly&&e.valueMapper)}():Ie(i(e,s),Ne(e.algorithm,o),t,n,r,!e.keysOnly&&e.valueMapper)}return{_read:function(e,t){var n=this._ctx;return n.error?n.table._trans(null,dt.bind(null,n.error)):n.table._idbstore(Q,e).then(t)},_write:function(e){var t=this._ctx;return t.error?t.table._trans(null,dt.bind(null,t.error)):t.table._idbstore(K,e,"locked")},_addAlgorithm:function(e){var t=this._ctx;t.algorithm=Ne(t.algorithm,e)},_iterate:function(e,t,n,r){return s(this._ctx,e,t,n,r)},clone:function(e){var t=Object.create(this.constructor.prototype),n=Object.create(this._ctx);return e&&o(n,e),t._ctx=n,t},raw:function(){return this._ctx.valueMapper=null,this},each:function(e){var t=this._ctx;return this._read((function(n,r,i){s(t,e,n,r,i)}))},count:function(e){var t=this._ctx;if(Ee(t,!0))return this._read((function(e,r,i){var s=n(t,i),o=t.range?s.count(t.range):s.count();o.onerror=Lt(r),o.onsuccess=function(n){e(Math.min(n.target.result,t.limit))}}),e);var r=0;return this._read((function(e,n,i){s(t,(function(){return++r,!1}),(function(){e(r)}),n,i)}),e)},sortBy:function(e,t){var n=e.split(".").reverse(),r=n[0],i=n.length-1;function s(e,t){return t?s(e[n[t]],t-1):e[r]}var o="next"===this._ctx.dir?1:-1;function a(e,t){var n=s(e,i),r=s(t,i);return n<r?-o:n>r?o:0}return this.toArray((function(e){return e.sort(a)})).then(t)},toArray:function(e){var t=this._ctx;return this._read((function(e,r,i){if(l&&"next"===t.dir&&Ee(t,!0)&&t.limit>0){var o=t.table.hook.reading.fire,a=n(t,i),c=t.limit<1/0?a.getAll(t.range,t.limit):a.getAll(t.range);c.onerror=Lt(r),c.onsuccess=Ct(o===ee?e:function(t){try{e(t.map(o))}catch(e){r(e)}})}else{var h=[];s(t,(function(e){h.push(e)}),(function(){e(h)}),r,i)}}),e)},offset:function(e){var n=this._ctx;return e<=0||(n.offset+=e,Ee(n)?t(n,(function(){var t=e;return function(e,n){return 0===t||(1===t?(--t,!1):(n((function(){e.advance(t),t=0})),!1))}})):t(n,(function(){var t=e;return function(){return--t<0}}))),this},limit:function(e){return this._ctx.limit=Math.min(this._ctx.limit,e),t(this._ctx,(function(){var t=e;return function(e,n,r){return--t<=0&&n(r),t>=0}}),!0),this},until:function(t,n){return e(this._ctx,(function(e,r,i){return!t(e.value)||(r(i),n)})),this},first:function(e){return this.limit(1).toArray((function(e){return e[0]})).then(e)},last:function(e){return this.reverse().first(e)},filter:function(t){return e(this._ctx,(function(e){return t(e.value)})),function(e,t){e.isMatch=Ne(e.isMatch,t)}(this._ctx,t),this},and:function(e){return this.filter(e)},or:function(e){return new we(this._ctx.table,e,this)},reverse:function(){return this._ctx.dir="prev"===this._ctx.dir?"next":"prev",this._ondirectionchange&&this._ondirectionchange(this._ctx.dir),this},desc:function(){return this.reverse()},eachKey:function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.key,n)}))},eachUniqueKey:function(e){return this._ctx.unique="unique",this.eachKey(e)},eachPrimaryKey:function(e){var t=this._ctx;return t.keysOnly=!t.isMatch,this.each((function(t,n){e(n.primaryKey,n)}))},keys:function(e){var t=this._ctx;t.keysOnly=!t.isMatch;var n=[];return this.each((function(e,t){n.push(t.key)})).then((function(){return n})).then(e)},primaryKeys:function(e){var t=this._ctx;if(l&&"next"===t.dir&&Ee(t,!0)&&t.limit>0)return this._read((function(e,r,i){var s=n(t,i),o=t.limit<1/0?s.getAllKeys(t.range,t.limit):s.getAllKeys(t.range);o.onerror=Lt(r),o.onsuccess=Ct(e)})).then(e);t.keysOnly=!t.isMatch;var r=[];return this.each((function(e,t){r.push(t.primaryKey)})).then((function(){return r})).then(e)},uniqueKeys:function(e){return this._ctx.unique="unique",this.keys(e)},firstKey:function(e){return this.limit(1).keys((function(e){return e[0]})).then(e)},lastKey:function(e){return this.reverse().firstKey(e)},distinct:function(){var t=this._ctx,n=t.index&&t.table.schema.idxByName[t.index];if(!n||!n.multi)return this;var r={};return e(this._ctx,(function(e){var t=e.primaryKey.toString(),n=c(r,t);return r[t]=!0,!n})),this},modify:function(e){var t=this,n=this._ctx.table.hook,i=n.updating.fire,s=n.deleting.fire;return this._write((function(n,a,l,h){var u;if("function"==typeof e)u=i===Z&&s===Z?e:function(t){var n=L(t);if(!1===e.call(this,t,this))return!1;if(c(this,"value")){var o=C(n,this.value),a=i.call(this,o,this.primKey,n,h);a&&(t=this.value,r(a).forEach((function(e){P(t,e,a[e])})))}else s.call(this,this.primKey,t,h)};else if(i===Z){var d=r(e),f=d.length;u=function(t){for(var n=!1,r=0;r<f;++r){var i=d[r],s=e[i];A(t,i)!==s&&(P(t,i,s),n=!0)}return n}}else{var p=e;e=I(p),u=function(t){var n=!1,s=i.call(this,e,this.primKey,L(t),h);return s&&o(e,s),r(e).forEach((function(r){var i=e[r];A(t,r)!==i&&(P(t,r,i),n=!0)})),s&&(e=I(p)),n}}var g=0,v=0,m=!1,y=[],b=[],_=null;function w(e){return e&&(y.push(e),b.push(_)),a(new G("Error modifying one or more objects",y,v,b))}function S(){m&&v+y.length===g&&(y.length>0?w():n(v))}t.clone().raw()._iterate((function(e,t){_=t.primaryKey;var n={primKey:t.primaryKey,value:e,onsuccess:null,onerror:null};function r(e){return y.push(e),b.push(n.primKey),S(),!0}if(!1!==u.call(n,e,n)){var i=!c(n,"value");++g,E((function(){var e=i?t.delete():t.update(n.value);e._hookCtx=n,e.onerror=kt(r),e.onsuccess=Tt((function(){++v,S()}))}),r)}else n.onsuccess&&n.onsuccess(n.value)}),(function(){m=!0,S()}),w,l)}))},delete:function(){var e=this,t=this._ctx,n=t.range,r=t.table.hook.deleting.fire,i=r!==Z;if(!i&&Ee(t)&&(t.isPrimKey&&!At||!n))return this._write((function(e,t,r){var i=Lt(t),s=n?r.count(n):r.count();s.onerror=i,s.onsuccess=function(){var o=s.result;E((function(){var t=n?r.delete(n):r.clear();t.onerror=i,t.onsuccess=function(){return e(o)}}),(function(e){return t(e)}))}}));var s=i?2e3:1e4;return this._write((function(n,o,a,l){var c=0,h=e.clone({keysOnly:!t.isMatch&&!i}).distinct().limit(s).raw(),u=[],d=function(){return h.each(i?function(e,t){u.push([t.primaryKey,t.value])}:function(e,t){u.push(t.primaryKey)}).then((function(){return i?u.sort((function(e,t){return Le(e[0],t[0])})):u.sort(Le),be(a,l,u,i,r)})).then((function(){var e=u.length;return c+=e,u=[],e<s?c:d()}))};n(d())}))}}})),o(this,{Collection:Se,Table:me,Transaction:_e,Version:ce,WhereClause:we}),J.on("versionchange",(function(e){e.newVersion>0?console.warn("Another connection wants to upgrade database '"+J.name+"'. Closing db now to resume the upgrade."):console.warn("Another connection wants to delete database '"+J.name+"'. Closing db now to resume the delete request."),J.close()})),J.on("blocked",(function(e){!e.newVersion||e.newVersion<e.oldVersion?console.warn("Dexie.delete('"+J.name+"') was blocked"):console.warn("Upgrade '"+J.name+"' blocked by other connection holding version "+e.oldVersion/10)})),v.forEach((function(e){e(J)}))}function xt(e){if("function"==typeof e)return new e;if(i(e))return[xt(e[0])];if(e&&"object"==typeof e){var t={};return Ot(t,e),t}return e}function Ot(e,t){return r(t).forEach((function(n){var r=xt(t[n]);e[n]=r})),e}function Tt(e){return Ge((function(t){var n=t.target,r=n._hookCtx,i=r.value||n.result,s=r&&r.onsuccess;s&&s(i),e&&e(i)}),e)}function Lt(e){return Ge((function(t){return Dt(t),e(t.target.error),!1}))}function Ct(e){return Ge((function(t){e(t.target.result)}))}function kt(e){return Ge((function(t){var n=t.target,r=n.error,i=n._hookCtx,s=i&&i.onerror;return s&&s(r),Dt(t),e(r),!1}))}function Dt(e){e.stopPropagation&&e.stopPropagation(),e.preventDefault&&e.preventDefault()}function Rt(e){var t=function(t){return e.next(t)},n=s(t),r=s((function(t){return e.throw(t)}));function s(e){return function(t){var s=e(t),o=s.value;return s.done?o:o&&"function"==typeof o.then?o.then(n,r):i(o)?Ce.all(o).then(n,r):n(o)}}return s(t)()}function Nt(e,t,n,r,i,s,o){this.name=e,this.keyPath=t,this.unique=n,this.multi=r,this.auto=i,this.compound=s,this.dotted=o;var a="string"==typeof t?t:t&&"["+[].join.call(t,"+")+"]";this.src=(n?"&":"")+(r?"*":"")+(i?"++":"")+a}function Bt(e,t,n,r){this.name=e,this.primKey=t||new Nt,this.indexes=n||[new Nt],this.instanceTemplate=r,this.mappedClass=null,this.idxByName=w(n,(function(e){return[e.name,e]}))}function Mt(e){return 1===e.length?e[0]:e}function Ft(e){var t=e&&(e.getDatabaseNames||e.webkitGetDatabaseNames);return t&&t.bind(e)}M(B,Pt),h(It,X),h(It,{delete:function(e){var t=new It(e),n=t.delete();return n.onblocked=function(e){return t.on("blocked",e),this},n},exists:function(e){return new It(e).open().then((function(e){return e.close(),!0})).catch(It.NoSuchDatabaseError,(function(){return!1}))},getDatabaseNames:function(e){var t=Ft(It.dependencies.indexedDB);return t?new Ce((function(e,n){var r=t();r.onsuccess=function(t){e(m(t.target.result,0))},r.onerror=Lt(n)})).then(e):pt.dbnames.toCollection().primaryKeys(e)},defineClass:function(){return function(e){e&&o(this,e)}},applyStructure:Ot,ignoreTransaction:function(e){return xe.trans?at(xe.transless,e):e()},vip:function(e){return Ze((function(){return xe.letThrough=!0,e()}))},async:function(e){return function(){try{var t=Rt(e.apply(this,arguments));return t&&"function"==typeof t.then?t:Ce.resolve(t)}catch(e){return dt(e)}}},spawn:function(e,t,n){try{var r=Rt(e.apply(n,t||[]));return r&&"function"==typeof r.then?r:Ce.resolve(r)}catch(e){return dt(e)}},currentTransaction:{get:function(){return xe.trans||null}},waitFor:function(e,t){var n=Ce.resolve("function"==typeof e?It.ignoreTransaction(e):e).timeout(t||6e4);return xe.trans?xe.trans.waitFor(n):n},Promise:Ce,debug:{get:function(){return B},set:function(e){M(e,"dexie"===e?function(){return!0}:Pt)}},derive:f,extend:o,props:h,override:y,Events:ft,getByKeyPath:A,setByKeyPath:P,delByKeyPath:function(e,t){"string"==typeof t?P(e,t,void 0):"length"in t&&[].map.call(t,(function(t){P(e,t,void 0)}))},shallowClone:I,deepClone:L,getObjectDiff:C,asap:_,maxKey:mt,minKey:yt,addons:[],connections:wt,MultiModifyError:Y.Modify,errnames:Q,IndexSpec:Nt,TableSchema:Bt,dependencies:function(){try{return{indexedDB:s.indexedDB||s.mozIndexedDB||s.webkitIndexedDB||s.msIndexedDB,IDBKeyRange:s.IDBKeyRange||s.webkitIDBKeyRange}}catch(e){return{indexedDB:null,IDBKeyRange:null}}}(),semVer:gt,version:gt.split(".").map((function(e){return parseInt(e)})).reduce((function(e,t,n){return e+t/Math.pow(10,2*n)})),default:It,Dexie:It}),Ce.rejectionMapper=function(e,t){if(!e||e instanceof z||e instanceof TypeError||e instanceof SyntaxError||!e.name||!J[e.name])return e;var n=new J[e.name](t||e.message,e);return"stack"in e&&d(n,"stack",{get:function(){return this.inner.stack}}),n},(pt=new It("__dbnames")).version(1).stores({dbnames:"name"}),function(){var e="Dexie.DatabaseNames";try{void 0!==typeof localStorage&&void 0!==s.document&&(JSON.parse(localStorage.getItem(e)||"[]").forEach((function(e){return pt.dbnames.put({name:e}).catch(Z)})),localStorage.removeItem(e))}catch(e){}}();const Ht=It},4213:function(e,t,n){var r,i,s;i=[],void 0===(s="function"==typeof(r=function(){"use strict";function t(e,t){return void 0===t?t={autoBom:!1}:"object"!=typeof t&&(console.warn("Deprecated: Expected third argument to be a object"),t={autoBom:!t}),t.autoBom&&/^\s*(?:text\/\S*|application\/xml|\S*\/\S*\+xml)\s*;.*charset\s*=\s*utf-8/i.test(e.type)?new Blob(["\ufeff",e],{type:e.type}):e}function r(e,t,n){var r=new XMLHttpRequest;r.open("GET",e),r.responseType="blob",r.onload=function(){l(r.response,t,n)},r.onerror=function(){console.error("could not download file")},r.send()}function i(e){var t=new XMLHttpRequest;t.open("HEAD",e,!1);try{t.send()}catch(e){}return 200<=t.status&&299>=t.status}function s(e){try{e.dispatchEvent(new MouseEvent("click"))}catch(n){var t=document.createEvent("MouseEvents");t.initMouseEvent("click",!0,!0,window,0,0,0,80,20,!1,!1,!1,!1,0,null),e.dispatchEvent(t)}}var o="object"==typeof window&&window.window===window?window:"object"==typeof self&&self.self===self?self:"object"==typeof n.g&&n.g.global===n.g?n.g:void 0,a=o.navigator&&/Macintosh/.test(navigator.userAgent)&&/AppleWebKit/.test(navigator.userAgent)&&!/Safari/.test(navigator.userAgent),l=o.saveAs||("object"!=typeof window||window!==o?function(){}:"download"in HTMLAnchorElement.prototype&&!a?function(e,t,n){var a=o.URL||o.webkitURL,l=document.createElement("a");t=t||e.name||"download",l.download=t,l.rel="noopener","string"==typeof e?(l.href=e,l.origin===location.origin?s(l):i(l.href)?r(e,t,n):s(l,l.target="_blank")):(l.href=a.createObjectURL(e),setTimeout((function(){a.revokeObjectURL(l.href)}),4e4),setTimeout((function(){s(l)}),0))}:"msSaveOrOpenBlob"in navigator?function(e,n,o){if(n=n||e.name||"download","string"!=typeof e)navigator.msSaveOrOpenBlob(t(e,o),n);else if(i(e))r(e,n,o);else{var a=document.createElement("a");a.href=e,a.target="_blank",setTimeout((function(){s(a)}))}}:function(e,t,n,i){if((i=i||open("","_blank"))&&(i.document.title=i.document.body.innerText="downloading..."),"string"==typeof e)return r(e,t,n);var s="application/octet-stream"===e.type,l=/constructor/i.test(o.HTMLElement)||o.safari,c=/CriOS\/[\d]+/.test(navigator.userAgent);if((c||s&&l||a)&&"undefined"!=typeof FileReader){var h=new FileReader;h.onloadend=function(){var e=h.result;e=c?e:e.replace(/^data:[^;]*;/,"data:attachment/file;"),i?i.location.href=e:location=e,i=null},h.readAsDataURL(e)}else{var u=o.URL||o.webkitURL,d=u.createObjectURL(e);i?i.location=d:location.href=d,i=null,setTimeout((function(){u.revokeObjectURL(d)}),4e4)}});o.saveAs=l.saveAs=l,e.exports=l})?r.apply(t,i):r)||(e.exports=s)},6765:(e,t,n)=>{"use strict";function r(e){this.message=e}n.d(t,{A:()=>a}),r.prototype=new Error,r.prototype.name="InvalidCharacterError";var i="undefined"!=typeof window&&window.atob&&window.atob.bind(window)||function(e){var t=String(e).replace(/=+$/,"");if(t.length%4==1)throw new r("'atob' failed: The string to be decoded is not correctly encoded.");for(var n,i,s=0,o=0,a="";i=t.charAt(o++);~i&&(n=s%4?64*n+i:i,s++%4)?a+=String.fromCharCode(255&n>>(-2*s&6)):0)i="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=".indexOf(i);return a};function s(e){var t=e.replace(/-/g,"+").replace(/_/g,"/");switch(t.length%4){case 0:break;case 2:t+="==";break;case 3:t+="=";break;default:throw"Illegal base64url string!"}try{return function(e){return decodeURIComponent(i(e).replace(/(.)/g,(function(e,t){var n=t.charCodeAt(0).toString(16).toUpperCase();return n.length<2&&(n="0"+n),"%"+n})))}(t)}catch(e){return i(t)}}function o(e){this.message=e}o.prototype=new Error,o.prototype.name="InvalidTokenError";const a=function(e,t){if("string"!=typeof e)throw new o("Invalid token specified");var n=!0===(t=t||{}).header?0:1;try{return JSON.parse(s(e.split(".")[n]))}catch(e){throw new o("Invalid token specified: "+e.message)}}},8291:(e,t,n)=>{var r,i;!function(){var s,o,a,l,c,h,u,d,f,p,g,v,m,y,b,_,w,S,E,A,P,I,x,O,T,L,C,k,D,R,N=function(e){var t=new N.Builder;return t.pipeline.add(N.trimmer,N.stopWordFilter,N.stemmer),t.searchPipeline.add(N.stemmer),e.call(t,t),t.build()};N.version="2.3.8",N.utils={},N.utils.warn=(s=this,function(e){s.console&&console.warn&&console.warn(e)}),N.utils.asString=function(e){return null==e?"":e.toString()},N.utils.clone=function(e){if(null==e)return e;for(var t=Object.create(null),n=Object.keys(e),r=0;r<n.length;r++){var i=n[r],s=e[i];if(Array.isArray(s))t[i]=s.slice();else{if("string"!=typeof s&&"number"!=typeof s&&"boolean"!=typeof s)throw new TypeError("clone is not deep and does not support nested objects");t[i]=s}}return t},N.FieldRef=function(e,t,n){this.docRef=e,this.fieldName=t,this._stringValue=n},N.FieldRef.joiner="/",N.FieldRef.fromString=function(e){var t=e.indexOf(N.FieldRef.joiner);if(-1===t)throw"malformed field ref string";var n=e.slice(0,t),r=e.slice(t+1);return new N.FieldRef(r,n,e)},N.FieldRef.prototype.toString=function(){return null==this._stringValue&&(this._stringValue=this.fieldName+N.FieldRef.joiner+this.docRef),this._stringValue},N.Set=function(e){if(this.elements=Object.create(null),e){this.length=e.length;for(var t=0;t<this.length;t++)this.elements[e[t]]=!0}else this.length=0},N.Set.complete={intersect:function(e){return e},union:function(e){return e},contains:function(){return!0}},N.Set.empty={intersect:function(){return this},union:function(e){return e},contains:function(){return!1}},N.Set.prototype.contains=function(e){return!!this.elements[e]},N.Set.prototype.intersect=function(e){var t,n,r,i=[];if(e===N.Set.complete)return this;if(e===N.Set.empty)return e;this.length<e.length?(t=this,n=e):(t=e,n=this),r=Object.keys(t.elements);for(var s=0;s<r.length;s++){var o=r[s];o in n.elements&&i.push(o)}return new N.Set(i)},N.Set.prototype.union=function(e){return e===N.Set.complete?N.Set.complete:e===N.Set.empty?this:new N.Set(Object.keys(this.elements).concat(Object.keys(e.elements)))},N.idf=function(e,t){var n=0;for(var r in e)"_index"!=r&&(n+=Object.keys(e[r]).length);var i=(t-n+.5)/(n+.5);return Math.log(1+Math.abs(i))},N.Token=function(e,t){this.str=e||"",this.metadata=t||{}},N.Token.prototype.toString=function(){return this.str},N.Token.prototype.update=function(e){return this.str=e(this.str,this.metadata),this},N.Token.prototype.clone=function(e){return e=e||function(e){return e},new N.Token(e(this.str,this.metadata),this.metadata)},N.tokenizer=function(e,t){if(null==e||null==e)return[];if(Array.isArray(e))return e.map((function(e){return new N.Token(N.utils.asString(e).toLowerCase(),N.utils.clone(t))}));for(var n=e.toString().toLowerCase(),r=n.length,i=[],s=0,o=0;s<=r;s++){var a=s-o;if(n.charAt(s).match(N.tokenizer.separator)||s==r){if(a>0){var l=N.utils.clone(t)||{};l.position=[o,a],l.index=i.length,i.push(new N.Token(n.slice(o,s),l))}o=s+1}}return i},N.tokenizer.separator=/[\s\-]+/,N.Pipeline=function(){this._stack=[]},N.Pipeline.registeredFunctions=Object.create(null),N.Pipeline.registerFunction=function(e,t){t in this.registeredFunctions&&N.utils.warn("Overwriting existing registered function: "+t),e.label=t,N.Pipeline.registeredFunctions[e.label]=e},N.Pipeline.warnIfFunctionNotRegistered=function(e){e.label&&e.label in this.registeredFunctions||N.utils.warn("Function is not registered with pipeline. This may cause problems when serialising the index.\n",e)},N.Pipeline.load=function(e){var t=new N.Pipeline;return e.forEach((function(e){var n=N.Pipeline.registeredFunctions[e];if(!n)throw new Error("Cannot load unregistered function: "+e);t.add(n)})),t},N.Pipeline.prototype.add=function(){Array.prototype.slice.call(arguments).forEach((function(e){N.Pipeline.warnIfFunctionNotRegistered(e),this._stack.push(e)}),this)},N.Pipeline.prototype.after=function(e,t){N.Pipeline.warnIfFunctionNotRegistered(t);var n=this._stack.indexOf(e);if(-1==n)throw new Error("Cannot find existingFn");n+=1,this._stack.splice(n,0,t)},N.Pipeline.prototype.before=function(e,t){N.Pipeline.warnIfFunctionNotRegistered(t);var n=this._stack.indexOf(e);if(-1==n)throw new Error("Cannot find existingFn");this._stack.splice(n,0,t)},N.Pipeline.prototype.remove=function(e){var t=this._stack.indexOf(e);-1!=t&&this._stack.splice(t,1)},N.Pipeline.prototype.run=function(e){for(var t=this._stack.length,n=0;n<t;n++){for(var r=this._stack[n],i=[],s=0;s<e.length;s++){var o=r(e[s],s,e);if(null!=o&&""!==o)if(Array.isArray(o))for(var a=0;a<o.length;a++)i.push(o[a]);else i.push(o)}e=i}return e},N.Pipeline.prototype.runString=function(e,t){var n=new N.Token(e,t);return this.run([n]).map((function(e){return e.toString()}))},N.Pipeline.prototype.reset=function(){this._stack=[]},N.Pipeline.prototype.toJSON=function(){return this._stack.map((function(e){return N.Pipeline.warnIfFunctionNotRegistered(e),e.label}))},N.Vector=function(e){this._magnitude=0,this.elements=e||[]},N.Vector.prototype.positionForIndex=function(e){if(0==this.elements.length)return 0;for(var t=0,n=this.elements.length/2,r=n-t,i=Math.floor(r/2),s=this.elements[2*i];r>1&&(s<e&&(t=i),s>e&&(n=i),s!=e);)r=n-t,i=t+Math.floor(r/2),s=this.elements[2*i];return s==e||s>e?2*i:s<e?2*(i+1):void 0},N.Vector.prototype.insert=function(e,t){this.upsert(e,t,(function(){throw"duplicate index"}))},N.Vector.prototype.upsert=function(e,t,n){this._magnitude=0;var r=this.positionForIndex(e);this.elements[r]==e?this.elements[r+1]=n(this.elements[r+1],t):this.elements.splice(r,0,e,t)},N.Vector.prototype.magnitude=function(){if(this._magnitude)return this._magnitude;for(var e=0,t=this.elements.length,n=1;n<t;n+=2){var r=this.elements[n];e+=r*r}return this._magnitude=Math.sqrt(e)},N.Vector.prototype.dot=function(e){for(var t=0,n=this.elements,r=e.elements,i=n.length,s=r.length,o=0,a=0,l=0,c=0;l<i&&c<s;)(o=n[l])<(a=r[c])?l+=2:o>a?c+=2:o==a&&(t+=n[l+1]*r[c+1],l+=2,c+=2);return t},N.Vector.prototype.similarity=function(e){return this.dot(e)/this.magnitude()||0},N.Vector.prototype.toArray=function(){for(var e=new Array(this.elements.length/2),t=1,n=0;t<this.elements.length;t+=2,n++)e[n]=this.elements[t];return e},N.Vector.prototype.toJSON=function(){return this.elements},N.stemmer=(o={ational:"ate",tional:"tion",enci:"ence",anci:"ance",izer:"ize",bli:"ble",alli:"al",entli:"ent",eli:"e",ousli:"ous",ization:"ize",ation:"ate",ator:"ate",alism:"al",iveness:"ive",fulness:"ful",ousness:"ous",aliti:"al",iviti:"ive",biliti:"ble",logi:"log"},a={icate:"ic",ative:"",alize:"al",iciti:"ic",ical:"ic",ful:"",ness:""},u="^("+(c="[^aeiou][^aeiouy]*")+")?"+(h=(l="[aeiouy]")+"[aeiou]*")+c+"("+h+")?$",d="^("+c+")?"+h+c+h+c,f="^("+c+")?"+l,p=new RegExp("^("+c+")?"+h+c),g=new RegExp(d),v=new RegExp(u),m=new RegExp(f),y=/^(.+?)(ss|i)es$/,b=/^(.+?)([^s])s$/,_=/^(.+?)eed$/,w=/^(.+?)(ed|ing)$/,S=/.$/,E=/(at|bl|iz)$/,A=new RegExp("([^aeiouylsz])\\1$"),P=new RegExp("^"+c+l+"[^aeiouwxy]$"),I=/^(.+?[^aeiou])y$/,x=/^(.+?)(ational|tional|enci|anci|izer|bli|alli|entli|eli|ousli|ization|ation|ator|alism|iveness|fulness|ousness|aliti|iviti|biliti|logi)$/,O=/^(.+?)(icate|ative|alize|iciti|ical|ful|ness)$/,T=/^(.+?)(al|ance|ence|er|ic|able|ible|ant|ement|ment|ent|ou|ism|ate|iti|ous|ive|ize)$/,L=/^(.+?)(s|t)(ion)$/,C=/^(.+?)e$/,k=/ll$/,D=new RegExp("^"+c+l+"[^aeiouwxy]$"),R=function(e){var t,n,r,i,s,l,c;if(e.length<3)return e;if("y"==(r=e.substr(0,1))&&(e=r.toUpperCase()+e.substr(1)),s=b,(i=y).test(e)?e=e.replace(i,"$1$2"):s.test(e)&&(e=e.replace(s,"$1$2")),s=w,(i=_).test(e)){var h=i.exec(e);(i=p).test(h[1])&&(i=S,e=e.replace(i,""))}else s.test(e)&&(t=(h=s.exec(e))[1],(s=m).test(t)&&(l=A,c=P,(s=E).test(e=t)?e+="e":l.test(e)?(i=S,e=e.replace(i,"")):c.test(e)&&(e+="e")));return(i=I).test(e)&&(e=(t=(h=i.exec(e))[1])+"i"),(i=x).test(e)&&(t=(h=i.exec(e))[1],n=h[2],(i=p).test(t)&&(e=t+o[n])),(i=O).test(e)&&(t=(h=i.exec(e))[1],n=h[2],(i=p).test(t)&&(e=t+a[n])),s=L,(i=T).test(e)?(t=(h=i.exec(e))[1],(i=g).test(t)&&(e=t)):s.test(e)&&(t=(h=s.exec(e))[1]+h[2],(s=g).test(t)&&(e=t)),(i=C).test(e)&&(t=(h=i.exec(e))[1],s=v,l=D,((i=g).test(t)||s.test(t)&&!l.test(t))&&(e=t)),s=g,(i=k).test(e)&&s.test(e)&&(i=S,e=e.replace(i,"")),"y"==r&&(e=r.toLowerCase()+e.substr(1)),e},function(e){return e.update(R)}),N.Pipeline.registerFunction(N.stemmer,"stemmer"),N.generateStopWordFilter=function(e){var t=e.reduce((function(e,t){return e[t]=t,e}),{});return function(e){if(e&&t[e.toString()]!==e.toString())return e}},N.stopWordFilter=N.generateStopWordFilter(["a","able","about","across","after","all","almost","also","am","among","an","and","any","are","as","at","be","because","been","but","by","can","cannot","could","dear","did","do","does","either","else","ever","every","for","from","get","got","had","has","have","he","her","hers","him","his","how","however","i","if","in","into","is","it","its","just","least","let","like","likely","may","me","might","most","must","my","neither","no","nor","not","of","off","often","on","only","or","other","our","own","rather","said","say","says","she","should","since","so","some","than","that","the","their","them","then","there","these","they","this","tis","to","too","twas","us","wants","was","we","were","what","when","where","which","while","who","whom","why","will","with","would","yet","you","your"]),N.Pipeline.registerFunction(N.stopWordFilter,"stopWordFilter"),N.trimmer=function(e){return e.update((function(e){return e.replace(/^\W+/,"").replace(/\W+$/,"")}))},N.Pipeline.registerFunction(N.trimmer,"trimmer"),N.TokenSet=function(){this.final=!1,this.edges={},this.id=N.TokenSet._nextId,N.TokenSet._nextId+=1},N.TokenSet._nextId=1,N.TokenSet.fromArray=function(e){for(var t=new N.TokenSet.Builder,n=0,r=e.length;n<r;n++)t.insert(e[n]);return t.finish(),t.root},N.TokenSet.fromClause=function(e){return"editDistance"in e?N.TokenSet.fromFuzzyString(e.term,e.editDistance):N.TokenSet.fromString(e.term)},N.TokenSet.fromFuzzyString=function(e,t){for(var n=new N.TokenSet,r=[{node:n,editsRemaining:t,str:e}];r.length;){var i=r.pop();if(i.str.length>0){var s,o=i.str.charAt(0);o in i.node.edges?s=i.node.edges[o]:(s=new N.TokenSet,i.node.edges[o]=s),1==i.str.length&&(s.final=!0),r.push({node:s,editsRemaining:i.editsRemaining,str:i.str.slice(1)})}if(0!=i.editsRemaining){if("*"in i.node.edges)var a=i.node.edges["*"];else{a=new N.TokenSet;i.node.edges["*"]=a}if(0==i.str.length&&(a.final=!0),r.push({node:a,editsRemaining:i.editsRemaining-1,str:i.str}),i.str.length>1&&r.push({node:i.node,editsRemaining:i.editsRemaining-1,str:i.str.slice(1)}),1==i.str.length&&(i.node.final=!0),i.str.length>=1){if("*"in i.node.edges)var l=i.node.edges["*"];else{l=new N.TokenSet;i.node.edges["*"]=l}1==i.str.length&&(l.final=!0),r.push({node:l,editsRemaining:i.editsRemaining-1,str:i.str.slice(1)})}if(i.str.length>1){var c,h=i.str.charAt(0),u=i.str.charAt(1);u in i.node.edges?c=i.node.edges[u]:(c=new N.TokenSet,i.node.edges[u]=c),1==i.str.length&&(c.final=!0),r.push({node:c,editsRemaining:i.editsRemaining-1,str:h+i.str.slice(2)})}}}return n},N.TokenSet.fromString=function(e){for(var t=new N.TokenSet,n=t,r=0,i=e.length;r<i;r++){var s=e[r],o=r==i-1;if("*"==s)t.edges[s]=t,t.final=o;else{var a=new N.TokenSet;a.final=o,t.edges[s]=a,t=a}}return n},N.TokenSet.prototype.toArray=function(){for(var e=[],t=[{prefix:"",node:this}];t.length;){var n=t.pop(),r=Object.keys(n.node.edges),i=r.length;n.node.final&&(n.prefix.charAt(0),e.push(n.prefix));for(var s=0;s<i;s++){var o=r[s];t.push({prefix:n.prefix.concat(o),node:n.node.edges[o]})}}return e},N.TokenSet.prototype.toString=function(){if(this._str)return this._str;for(var e=this.final?"1":"0",t=Object.keys(this.edges).sort(),n=t.length,r=0;r<n;r++){var i=t[r];e=e+i+this.edges[i].id}return e},N.TokenSet.prototype.intersect=function(e){for(var t=new N.TokenSet,n=void 0,r=[{qNode:e,output:t,node:this}];r.length;){n=r.pop();for(var i=Object.keys(n.qNode.edges),s=i.length,o=Object.keys(n.node.edges),a=o.length,l=0;l<s;l++)for(var c=i[l],h=0;h<a;h++){var u=o[h];if(u==c||"*"==c){var d=n.node.edges[u],f=n.qNode.edges[c],p=d.final&&f.final,g=void 0;u in n.output.edges?(g=n.output.edges[u]).final=g.final||p:((g=new N.TokenSet).final=p,n.output.edges[u]=g),r.push({qNode:f,output:g,node:d})}}}return t},N.TokenSet.Builder=function(){this.previousWord="",this.root=new N.TokenSet,this.uncheckedNodes=[],this.minimizedNodes={}},N.TokenSet.Builder.prototype.insert=function(e){var t,n=0;if(e<this.previousWord)throw new Error("Out of order word insertion");for(var r=0;r<e.length&&r<this.previousWord.length&&e[r]==this.previousWord[r];r++)n++;this.minimize(n),t=0==this.uncheckedNodes.length?this.root:this.uncheckedNodes[this.uncheckedNodes.length-1].child;for(r=n;r<e.length;r++){var i=new N.TokenSet,s=e[r];t.edges[s]=i,this.uncheckedNodes.push({parent:t,char:s,child:i}),t=i}t.final=!0,this.previousWord=e},N.TokenSet.Builder.prototype.finish=function(){this.minimize(0)},N.TokenSet.Builder.prototype.minimize=function(e){for(var t=this.uncheckedNodes.length-1;t>=e;t--){var n=this.uncheckedNodes[t],r=n.child.toString();r in this.minimizedNodes?n.parent.edges[n.char]=this.minimizedNodes[r]:(n.child._str=r,this.minimizedNodes[r]=n.child),this.uncheckedNodes.pop()}},N.Index=function(e){this.invertedIndex=e.invertedIndex,this.fieldVectors=e.fieldVectors,this.tokenSet=e.tokenSet,this.fields=e.fields,this.pipeline=e.pipeline},N.Index.prototype.search=function(e){return this.query((function(t){new N.QueryParser(e,t).parse()}))},N.Index.prototype.query=function(e){for(var t=new N.Query(this.fields),n=Object.create(null),r=Object.create(null),i=Object.create(null),s=Object.create(null),o=Object.create(null),a=0;a<this.fields.length;a++)r[this.fields[a]]=new N.Vector;e.call(t,t);for(a=0;a<t.clauses.length;a++){var l=t.clauses[a],c=null,h=N.Set.complete;c=l.usePipeline?this.pipeline.runString(l.term,{fields:l.fields}):[l.term];for(var u=0;u<c.length;u++){var d=c[u];l.term=d;var f=N.TokenSet.fromClause(l),p=this.tokenSet.intersect(f).toArray();if(0===p.length&&l.presence===N.Query.presence.REQUIRED){for(var g=0;g<l.fields.length;g++){s[C=l.fields[g]]=N.Set.empty}break}for(var v=0;v<p.length;v++){var m=p[v],y=this.invertedIndex[m],b=y._index;for(g=0;g<l.fields.length;g++){var _=y[C=l.fields[g]],w=Object.keys(_),S=m+"/"+C,E=new N.Set(w);if(l.presence==N.Query.presence.REQUIRED&&(h=h.union(E),void 0===s[C]&&(s[C]=N.Set.complete)),l.presence!=N.Query.presence.PROHIBITED){if(r[C].upsert(b,l.boost,(function(e,t){return e+t})),!i[S]){for(var A=0;A<w.length;A++){var P,I=w[A],x=new N.FieldRef(I,C),O=_[I];void 0===(P=n[x])?n[x]=new N.MatchData(m,C,O):P.add(m,C,O)}i[S]=!0}}else void 0===o[C]&&(o[C]=N.Set.empty),o[C]=o[C].union(E)}}}if(l.presence===N.Query.presence.REQUIRED)for(g=0;g<l.fields.length;g++){s[C=l.fields[g]]=s[C].intersect(h)}}var T=N.Set.complete,L=N.Set.empty;for(a=0;a<this.fields.length;a++){var C;s[C=this.fields[a]]&&(T=T.intersect(s[C])),o[C]&&(L=L.union(o[C]))}var k=Object.keys(n),D=[],R=Object.create(null);if(t.isNegated()){k=Object.keys(this.fieldVectors);for(a=0;a<k.length;a++){x=k[a];var B=N.FieldRef.fromString(x);n[x]=new N.MatchData}}for(a=0;a<k.length;a++){var M=(B=N.FieldRef.fromString(k[a])).docRef;if(T.contains(M)&&!L.contains(M)){var F,H=this.fieldVectors[B],U=r[B.fieldName].similarity(H);if(void 0!==(F=R[M]))F.score+=U,F.matchData.combine(n[B]);else{var W={ref:M,score:U,matchData:n[B]};R[M]=W,D.push(W)}}}return D.sort((function(e,t){return t.score-e.score}))},N.Index.prototype.toJSON=function(){var e=Object.keys(this.invertedIndex).sort().map((function(e){return[e,this.invertedIndex[e]]}),this),t=Object.keys(this.fieldVectors).map((function(e){return[e,this.fieldVectors[e].toJSON()]}),this);return{version:N.version,fields:this.fields,fieldVectors:t,invertedIndex:e,pipeline:this.pipeline.toJSON()}},N.Index.load=function(e){var t={},n={},r=e.fieldVectors,i=Object.create(null),s=e.invertedIndex,o=new N.TokenSet.Builder,a=N.Pipeline.load(e.pipeline);e.version!=N.version&&N.utils.warn("Version mismatch when loading serialised index. Current version of lunr '"+N.version+"' does not match serialized index '"+e.version+"'");for(var l=0;l<r.length;l++){var c=(u=r[l])[0],h=u[1];n[c]=new N.Vector(h)}for(l=0;l<s.length;l++){var u,d=(u=s[l])[0],f=u[1];o.insert(d),i[d]=f}return o.finish(),t.fields=e.fields,t.fieldVectors=n,t.invertedIndex=i,t.tokenSet=o.root,t.pipeline=a,new N.Index(t)},N.Builder=function(){this._ref="id",this._fields=Object.create(null),this._documents=Object.create(null),this.invertedIndex=Object.create(null),this.fieldTermFrequencies={},this.fieldLengths={},this.tokenizer=N.tokenizer,this.pipeline=new N.Pipeline,this.searchPipeline=new N.Pipeline,this.documentCount=0,this._b=.75,this._k1=1.2,this.termIndex=0,this.metadataWhitelist=[]},N.Builder.prototype.ref=function(e){this._ref=e},N.Builder.prototype.field=function(e,t){if(/\//.test(e))throw new RangeError("Field '"+e+"' contains illegal character '/'");this._fields[e]=t||{}},N.Builder.prototype.b=function(e){this._b=e<0?0:e>1?1:e},N.Builder.prototype.k1=function(e){this._k1=e},N.Builder.prototype.add=function(e,t){var n=e[this._ref],r=Object.keys(this._fields);this._documents[n]=t||{},this.documentCount+=1;for(var i=0;i<r.length;i++){var s=r[i],o=this._fields[s].extractor,a=o?o(e):e[s],l=this.tokenizer(a,{fields:[s]}),c=this.pipeline.run(l),h=new N.FieldRef(n,s),u=Object.create(null);this.fieldTermFrequencies[h]=u,this.fieldLengths[h]=0,this.fieldLengths[h]+=c.length;for(var d=0;d<c.length;d++){var f=c[d];if(null==u[f]&&(u[f]=0),u[f]+=1,null==this.invertedIndex[f]){var p=Object.create(null);p._index=this.termIndex,this.termIndex+=1;for(var g=0;g<r.length;g++)p[r[g]]=Object.create(null);this.invertedIndex[f]=p}null==this.invertedIndex[f][s][n]&&(this.invertedIndex[f][s][n]=Object.create(null));for(var v=0;v<this.metadataWhitelist.length;v++){var m=this.metadataWhitelist[v],y=f.metadata[m];null==this.invertedIndex[f][s][n][m]&&(this.invertedIndex[f][s][n][m]=[]),this.invertedIndex[f][s][n][m].push(y)}}}},N.Builder.prototype.calculateAverageFieldLengths=function(){for(var e=Object.keys(this.fieldLengths),t=e.length,n={},r={},i=0;i<t;i++){var s=N.FieldRef.fromString(e[i]),o=s.fieldName;r[o]||(r[o]=0),r[o]+=1,n[o]||(n[o]=0),n[o]+=this.fieldLengths[s]}var a=Object.keys(this._fields);for(i=0;i<a.length;i++){var l=a[i];n[l]=n[l]/r[l]}this.averageFieldLength=n},N.Builder.prototype.createFieldVectors=function(){for(var e={},t=Object.keys(this.fieldTermFrequencies),n=t.length,r=Object.create(null),i=0;i<n;i++){for(var s=N.FieldRef.fromString(t[i]),o=s.fieldName,a=this.fieldLengths[s],l=new N.Vector,c=this.fieldTermFrequencies[s],h=Object.keys(c),u=h.length,d=this._fields[o].boost||1,f=this._documents[s.docRef].boost||1,p=0;p<u;p++){var g,v,m,y=h[p],b=c[y],_=this.invertedIndex[y]._index;void 0===r[y]?(g=N.idf(this.invertedIndex[y],this.documentCount),r[y]=g):g=r[y],v=g*((this._k1+1)*b)/(this._k1*(1-this._b+this._b*(a/this.averageFieldLength[o]))+b),v*=d,v*=f,m=Math.round(1e3*v)/1e3,l.insert(_,m)}e[s]=l}this.fieldVectors=e},N.Builder.prototype.createTokenSet=function(){this.tokenSet=N.TokenSet.fromArray(Object.keys(this.invertedIndex).sort())},N.Builder.prototype.build=function(){return this.calculateAverageFieldLengths(),this.createFieldVectors(),this.createTokenSet(),new N.Index({invertedIndex:this.invertedIndex,fieldVectors:this.fieldVectors,tokenSet:this.tokenSet,fields:Object.keys(this._fields),pipeline:this.searchPipeline})},N.Builder.prototype.use=function(e){var t=Array.prototype.slice.call(arguments,1);t.unshift(this),e.apply(this,t)},N.MatchData=function(e,t,n){for(var r=Object.create(null),i=Object.keys(n||{}),s=0;s<i.length;s++){var o=i[s];r[o]=n[o].slice()}this.metadata=Object.create(null),void 0!==e&&(this.metadata[e]=Object.create(null),this.metadata[e][t]=r)},N.MatchData.prototype.combine=function(e){for(var t=Object.keys(e.metadata),n=0;n<t.length;n++){var r=t[n],i=Object.keys(e.metadata[r]);null==this.metadata[r]&&(this.metadata[r]=Object.create(null));for(var s=0;s<i.length;s++){var o=i[s],a=Object.keys(e.metadata[r][o]);null==this.metadata[r][o]&&(this.metadata[r][o]=Object.create(null));for(var l=0;l<a.length;l++){var c=a[l];null==this.metadata[r][o][c]?this.metadata[r][o][c]=e.metadata[r][o][c]:this.metadata[r][o][c]=this.metadata[r][o][c].concat(e.metadata[r][o][c])}}}},N.MatchData.prototype.add=function(e,t,n){if(!(e in this.metadata))return this.metadata[e]=Object.create(null),void(this.metadata[e][t]=n);if(t in this.metadata[e])for(var r=Object.keys(n),i=0;i<r.length;i++){var s=r[i];s in this.metadata[e][t]?this.metadata[e][t][s]=this.metadata[e][t][s].concat(n[s]):this.metadata[e][t][s]=n[s]}else this.metadata[e][t]=n},N.Query=function(e){this.clauses=[],this.allFields=e},N.Query.wildcard=new String("*"),N.Query.wildcard.NONE=0,N.Query.wildcard.LEADING=1,N.Query.wildcard.TRAILING=2,N.Query.presence={OPTIONAL:1,REQUIRED:2,PROHIBITED:3},N.Query.prototype.clause=function(e){return"fields"in e||(e.fields=this.allFields),"boost"in e||(e.boost=1),"usePipeline"in e||(e.usePipeline=!0),"wildcard"in e||(e.wildcard=N.Query.wildcard.NONE),e.wildcard&N.Query.wildcard.LEADING&&e.term.charAt(0)!=N.Query.wildcard&&(e.term="*"+e.term),e.wildcard&N.Query.wildcard.TRAILING&&e.term.slice(-1)!=N.Query.wildcard&&(e.term=e.term+"*"),"presence"in e||(e.presence=N.Query.presence.OPTIONAL),this.clauses.push(e),this},N.Query.prototype.isNegated=function(){for(var e=0;e<this.clauses.length;e++)if(this.clauses[e].presence!=N.Query.presence.PROHIBITED)return!1;return!0},N.Query.prototype.term=function(e,t){if(Array.isArray(e))return e.forEach((function(e){this.term(e,N.utils.clone(t))}),this),this;var n=t||{};return n.term=e.toString(),this.clause(n),this},N.QueryParseError=function(e,t,n){this.name="QueryParseError",this.message=e,this.start=t,this.end=n},N.QueryParseError.prototype=new Error,N.QueryLexer=function(e){this.lexemes=[],this.str=e,this.length=e.length,this.pos=0,this.start=0,this.escapeCharPositions=[]},N.QueryLexer.prototype.run=function(){for(var e=N.QueryLexer.lexText;e;)e=e(this)},N.QueryLexer.prototype.sliceString=function(){for(var e=[],t=this.start,n=this.pos,r=0;r<this.escapeCharPositions.length;r++)n=this.escapeCharPositions[r],e.push(this.str.slice(t,n)),t=n+1;return e.push(this.str.slice(t,this.pos)),this.escapeCharPositions.length=0,e.join("")},N.QueryLexer.prototype.emit=function(e){this.lexemes.push({type:e,str:this.sliceString(),start:this.start,end:this.pos}),this.start=this.pos},N.QueryLexer.prototype.escapeCharacter=function(){this.escapeCharPositions.push(this.pos-1),this.pos+=1},N.QueryLexer.prototype.next=function(){if(this.pos>=this.length)return N.QueryLexer.EOS;var e=this.str.charAt(this.pos);return this.pos+=1,e},N.QueryLexer.prototype.width=function(){return this.pos-this.start},N.QueryLexer.prototype.ignore=function(){this.start==this.pos&&(this.pos+=1),this.start=this.pos},N.QueryLexer.prototype.backup=function(){this.pos-=1},N.QueryLexer.prototype.acceptDigitRun=function(){var e,t;do{t=(e=this.next()).charCodeAt(0)}while(t>47&&t<58);e!=N.QueryLexer.EOS&&this.backup()},N.QueryLexer.prototype.more=function(){return this.pos<this.length},N.QueryLexer.EOS="EOS",N.QueryLexer.FIELD="FIELD",N.QueryLexer.TERM="TERM",N.QueryLexer.EDIT_DISTANCE="EDIT_DISTANCE",N.QueryLexer.BOOST="BOOST",N.QueryLexer.PRESENCE="PRESENCE",N.QueryLexer.lexField=function(e){return e.backup(),e.emit(N.QueryLexer.FIELD),e.ignore(),N.QueryLexer.lexText},N.QueryLexer.lexTerm=function(e){if(e.width()>1&&(e.backup(),e.emit(N.QueryLexer.TERM)),e.ignore(),e.more())return N.QueryLexer.lexText},N.QueryLexer.lexEditDistance=function(e){return e.ignore(),e.acceptDigitRun(),e.emit(N.QueryLexer.EDIT_DISTANCE),N.QueryLexer.lexText},N.QueryLexer.lexBoost=function(e){return e.ignore(),e.acceptDigitRun(),e.emit(N.QueryLexer.BOOST),N.QueryLexer.lexText},N.QueryLexer.lexEOS=function(e){e.width()>0&&e.emit(N.QueryLexer.TERM)},N.QueryLexer.termSeparator=N.tokenizer.separator,N.QueryLexer.lexText=function(e){for(;;){var t=e.next();if(t==N.QueryLexer.EOS)return N.QueryLexer.lexEOS;if(92!=t.charCodeAt(0)){if(":"==t)return N.QueryLexer.lexField;if("~"==t)return e.backup(),e.width()>0&&e.emit(N.QueryLexer.TERM),N.QueryLexer.lexEditDistance;if("^"==t)return e.backup(),e.width()>0&&e.emit(N.QueryLexer.TERM),N.QueryLexer.lexBoost;if("+"==t&&1===e.width())return e.emit(N.QueryLexer.PRESENCE),N.QueryLexer.lexText;if("-"==t&&1===e.width())return e.emit(N.QueryLexer.PRESENCE),N.QueryLexer.lexText;if(t.match(N.QueryLexer.termSeparator))return N.QueryLexer.lexTerm}else e.escapeCharacter()}},N.QueryParser=function(e,t){this.lexer=new N.QueryLexer(e),this.query=t,this.currentClause={},this.lexemeIdx=0},N.QueryParser.prototype.parse=function(){this.lexer.run(),this.lexemes=this.lexer.lexemes;for(var e=N.QueryParser.parseClause;e;)e=e(this);return this.query},N.QueryParser.prototype.peekLexeme=function(){return this.lexemes[this.lexemeIdx]},N.QueryParser.prototype.consumeLexeme=function(){var e=this.peekLexeme();return this.lexemeIdx+=1,e},N.QueryParser.prototype.nextClause=function(){var e=this.currentClause;this.query.clause(e),this.currentClause={}},N.QueryParser.parseClause=function(e){var t=e.peekLexeme();if(null!=t)switch(t.type){case N.QueryLexer.PRESENCE:return N.QueryParser.parsePresence;case N.QueryLexer.FIELD:return N.QueryParser.parseField;case N.QueryLexer.TERM:return N.QueryParser.parseTerm;default:var n="expected either a field or a term, found "+t.type;throw t.str.length>=1&&(n+=" with value '"+t.str+"'"),new N.QueryParseError(n,t.start,t.end)}},N.QueryParser.parsePresence=function(e){var t=e.consumeLexeme();if(null!=t){switch(t.str){case"-":e.currentClause.presence=N.Query.presence.PROHIBITED;break;case"+":e.currentClause.presence=N.Query.presence.REQUIRED;break;default:var n="unrecognised presence operator'"+t.str+"'";throw new N.QueryParseError(n,t.start,t.end)}var r=e.peekLexeme();if(null==r){n="expecting term or field, found nothing";throw new N.QueryParseError(n,t.start,t.end)}switch(r.type){case N.QueryLexer.FIELD:return N.QueryParser.parseField;case N.QueryLexer.TERM:return N.QueryParser.parseTerm;default:n="expecting term or field, found '"+r.type+"'";throw new N.QueryParseError(n,r.start,r.end)}}},N.QueryParser.parseField=function(e){var t=e.consumeLexeme();if(null!=t){if(-1==e.query.allFields.indexOf(t.str)){var n=e.query.allFields.map((function(e){return"'"+e+"'"})).join(", "),r="unrecognised field '"+t.str+"', possible fields: "+n;throw new N.QueryParseError(r,t.start,t.end)}e.currentClause.fields=[t.str];var i=e.peekLexeme();if(null==i){r="expecting term, found nothing";throw new N.QueryParseError(r,t.start,t.end)}if(i.type===N.QueryLexer.TERM)return N.QueryParser.parseTerm;r="expecting term, found '"+i.type+"'";throw new N.QueryParseError(r,i.start,i.end)}},N.QueryParser.parseTerm=function(e){var t=e.consumeLexeme();if(null!=t){e.currentClause.term=t.str.toLowerCase(),-1!=t.str.indexOf("*")&&(e.currentClause.usePipeline=!1);var n=e.peekLexeme();if(null!=n)switch(n.type){case N.QueryLexer.TERM:return e.nextClause(),N.QueryParser.parseTerm;case N.QueryLexer.FIELD:return e.nextClause(),N.QueryParser.parseField;case N.QueryLexer.EDIT_DISTANCE:return N.QueryParser.parseEditDistance;case N.QueryLexer.BOOST:return N.QueryParser.parseBoost;case N.QueryLexer.PRESENCE:return e.nextClause(),N.QueryParser.parsePresence;default:var r="Unexpected lexeme type '"+n.type+"'";throw new N.QueryParseError(r,n.start,n.end)}else e.nextClause()}},N.QueryParser.parseEditDistance=function(e){var t=e.consumeLexeme();if(null!=t){var n=parseInt(t.str,10);if(isNaN(n)){var r="edit distance must be numeric";throw new N.QueryParseError(r,t.start,t.end)}e.currentClause.editDistance=n;var i=e.peekLexeme();if(null!=i)switch(i.type){case N.QueryLexer.TERM:return e.nextClause(),N.QueryParser.parseTerm;case N.QueryLexer.FIELD:return e.nextClause(),N.QueryParser.parseField;case N.QueryLexer.EDIT_DISTANCE:return N.QueryParser.parseEditDistance;case N.QueryLexer.BOOST:return N.QueryParser.parseBoost;case N.QueryLexer.PRESENCE:return e.nextClause(),N.QueryParser.parsePresence;default:r="Unexpected lexeme type '"+i.type+"'";throw new N.QueryParseError(r,i.start,i.end)}else e.nextClause()}},N.QueryParser.parseBoost=function(e){var t=e.consumeLexeme();if(null!=t){var n=parseInt(t.str,10);if(isNaN(n)){var r="boost must be numeric";throw new N.QueryParseError(r,t.start,t.end)}e.currentClause.boost=n;var i=e.peekLexeme();if(null!=i)switch(i.type){case N.QueryLexer.TERM:return e.nextClause(),N.QueryParser.parseTerm;case N.QueryLexer.FIELD:return e.nextClause(),N.QueryParser.parseField;case N.QueryLexer.EDIT_DISTANCE:return N.QueryParser.parseEditDistance;case N.QueryLexer.BOOST:return N.QueryParser.parseBoost;case N.QueryLexer.PRESENCE:return e.nextClause(),N.QueryParser.parsePresence;default:r="Unexpected lexeme type '"+i.type+"'";throw new N.QueryParseError(r,i.start,i.end)}else e.nextClause()}},void 0===(i="function"==typeof(r=function(){return N})?r.call(t,n,t,e):r)||(e.exports=i)}()},7098:function(e,t,n){"use strict";var r;!function(){if("function"!=typeof i){var i=function(e){return e};i.nonNative=!0}const s=i("plaintext"),o=i("html"),a=i("comment"),l=/<(\w*)>/g,c=/<\/?([^\s\/>]+)/;function h(e,t,n){return d(e=e||"",u(t=t||[],n=n||""))}function u(e,t){return{allowable_tags:e=function(e){let t=new Set;if("string"==typeof e){let n;for(;n=l.exec(e);)t.add(n[1])}else i.nonNative||"function"!=typeof e[i.iterator]?"function"==typeof e.forEach&&e.forEach(t.add,t):t=new Set(e);return t}(e),tag_replacement:t,state:s,tag_buffer:"",depth:0,in_quote_char:""}}function d(e,t){if("string"!=typeof e)throw new TypeError("'html' parameter must be a string");let n=t.allowable_tags,r=t.tag_replacement,i=t.state,l=t.tag_buffer,c=t.depth,h=t.in_quote_char,u="";for(let t=0,d=e.length;t<d;t++){let d=e[t];if(i===s)if("<"===d)i=o,l+=d;else u+=d;else if(i===o)switch(d){case"<":if(h)break;c++;break;case">":if(h)break;if(c){c--;break}h="",i=s,l+=">",n.has(f(l))?u+=l:u+=r,l="";break;case'"':case"'":h=d===h?"":h||d,l+=d;break;case"-":"<!-"===l&&(i=a),l+=d;break;case" ":case"\n":if("<"===l){i=s,u+="< ",l="";break}l+=d;break;default:l+=d}else if(i===a)if(">"===d)"--"==l.slice(-2)&&(i=s),l="";else l+=d}return t.state=i,t.tag_buffer=l,t.depth=c,t.in_quote_char=h,u}function f(e){let t=c.exec(e);return t?t[1].toLowerCase():null}h.init_streaming_mode=function(e,t){let n=u(e=e||[],t=t||"");return function(e){return d(e||"",n)}},void 0===(r=function(){return h}.call(t,n,t,e))||(e.exports=r)}()},2626:(e,t,n)=>{e.exports={WebVTT:n(4124).WebVTT,VTTCue:n(3111).VTTCue,VTTRegion:n(4960).VTTRegion}},4124:function(){!function(e){function t(e,t){return void 0===t&&(t=1),"rgba("+[parseInt(e.substring(0,2),16),parseInt(e.substring(2,4),16),parseInt(e.substring(4,6),16),t].join(",")+")"}var n=1;function r(e,r,s){switch(s){case"webvtt.font.color":case"webvtt.font.opacity":var o=Services.prefs.getCharPref("webvtt.font.color"),a=Services.prefs.getIntPref("webvtt.font.opacity")/100;i.fontSet=t(o,a);break;case"webvtt.font.scale":n=Services.prefs.getIntPref("webvtt.font.scale")/100;break;case"webvtt.bg.color":case"webvtt.bg.opacity":var l=Services.prefs.getCharPref("webvtt.bg.color"),c=Services.prefs.getIntPref("webvtt.bg.opacity")/100;i.backgroundSet=t(l,c);break;case"webvtt.edge.color":case"webvtt.edge.type":var h=Services.prefs.getIntPref("webvtt.edge.type"),u=Services.prefs.getCharPref("webvtt.edge.color");i.edgeSet=["","0px 0px ","4px 4px 4px ","-2px -2px ","2px 2px "][h]+t(u)}}if("undefined"!=typeof Services){var i={};["webvtt.font.color","webvtt.font.opacity","webvtt.font.scale","webvtt.bg.color","webvtt.bg.opacity","webvtt.edge.color","webvtt.edge.type"].forEach((function(e){r(0,0,e),Services.prefs.addObserver(e,r,!1)}))}var s=Object.create||function(){function e(){}return function(t){if(1!==arguments.length)throw new Error("Object.create shim only accepts one parameter.");return e.prototype=t,new e}}();function o(e,t){this.name="ParsingError",this.code=e.code,this.message=t||e.message}function a(e){function t(e,t,n,r){return 3600*(0|e)+60*(0|t)+(0|n)+(0|r)/1e3}var n=e.match(/^(\d+):(\d{2})(:\d{2})?\.(\d{3})/);return n?n[3]?t(n[1],n[2],n[3].replace(":",""),n[4]):n[1]>59?t(n[1],n[2],0,n[4]):t(0,n[1],n[2],n[4]):null}function l(){this.values=s(null)}function c(e,t,n,r){var i=r?e.split(r):[e];for(var s in i)if("string"==typeof i[s]){var o=i[s].split(n);if(2===o.length)t(o[0],o[1])}}function h(e,t,n){var r=e;function i(){var t=a(e);if(null===t)throw new o(o.Errors.BadTimeStamp,"Malformed timestamp: "+r);return e=e.replace(/^[^\sa-zA-Z-]+/,""),t}function s(){e=e.replace(/^\s+/,"")}if(s(),t.startTime=i(),s(),"--\x3e"!==e.substr(0,3))throw new o(o.Errors.BadTimeStamp,"Malformed time stamp (time stamps must be separated by '--\x3e'): "+r);e=e.substr(3),s(),t.endTime=i(),s(),function(e,t){var r=new l;c(e,(function(e,t){switch(e){case"region":for(var i=n.length-1;i>=0;i--)if(n[i].id===t){r.set(e,n[i].region);break}break;case"vertical":r.alt(e,t,["rl","lr"]);break;case"line":var s=t.split(","),o=s[0];r.integer(e,o),r.percent(e,o)&&r.set("snapToLines",!1),r.alt(e,o,["auto"]),2===s.length&&r.alt("lineAlign",s[1],["start","middle","end"]);break;case"position":s=t.split(","),r.percent(e,s[0]),2===s.length&&r.alt("positionAlign",s[1],["start","middle","end"]);break;case"size":r.percent(e,t);break;case"align":r.alt(e,t,["start","middle","end","left","right"])}}),/:/,/\s/),t.region=r.get("region",null),t.vertical=r.get("vertical",""),t.line=r.get("line","auto"),t.lineAlign=r.get("lineAlign","start"),t.snapToLines=r.get("snapToLines",!0),t.size=r.get("size",100),t.align=r.get("align","middle"),t.position=r.get("position","auto"),t.positionAlign=r.get("positionAlign",{start:"start",left:"start",middle:"middle",end:"end",right:"end"},t.align)}(e,t)}o.prototype=s(Error.prototype),o.prototype.constructor=o,o.Errors={BadSignature:{code:0,message:"Malformed WebVTT signature."},BadTimeStamp:{code:1,message:"Malformed time stamp."}},l.prototype={set:function(e,t){this.get(e)||""===t||(this.values[e]=t)},get:function(e,t,n){return n?this.has(e)?this.values[e]:t[n]:this.has(e)?this.values[e]:t},has:function(e){return e in this.values},alt:function(e,t,n){for(var r=0;r<n.length;++r)if(t===n[r]){this.set(e,t);break}},integer:function(e,t){/^-?\d+$/.test(t)&&this.set(e,parseInt(t,10))},percent:function(e,t){return!!(t.match(/^([\d]{1,3})(\.[\d]*)?%$/)&&(t=parseFloat(t))>=0&&t<=100)&&(this.set(e,t),!0)}};var u={"&amp;":"&","&lt;":"<","&gt;":">","&lrm;":"‎","&rlm;":"‏","&nbsp;":" "},d={c:"span",i:"i",b:"b",u:"u",ruby:"ruby",rt:"rt",v:"span",lang:"span"},f={v:"title",lang:"lang"},p={rt:"ruby"};function g(e,t){function n(){if(!t)return null;var e,n=t.match(/^([^<]*)(<[^>]+>?)?/);return e=n[1]?n[1]:n[2],t=t.substr(e.length),e}function r(e){return u[e]}function i(e){for(;y=e.match(/&(amp|lt|gt|lrm|rlm|nbsp);/);)e=e.replace(y[0],r);return e}function s(e,t){return!p[t.localName]||p[t.localName]===e.localName}function o(t,n){var r=d[t];if(!r)return null;var i=e.document.createElement(r);i.localName=r;var s=f[t];return s&&n&&(i[s]=n.trim()),i}for(var l,c=e.document.createElement("div"),h=c,g=[];null!==(l=n());)if("<"!==l[0])h.appendChild(e.document.createTextNode(i(l)));else{if("/"===l[1]){g.length&&g[g.length-1]===l.substr(2).replace(">","")&&(g.pop(),h=h.parentNode);continue}var v,m=a(l.substr(1,l.length-2));if(m){v=e.document.createProcessingInstruction("timestamp",m),h.appendChild(v);continue}var y=l.match(/^<([^.\s/0-9>]+)(\.[^\s\\>]+)?([^>\\]+)?(\\?)>?$/);if(!y)continue;if(!(v=o(y[1],y[3])))continue;if(!s(h,v))continue;y[2]&&(v.className=y[2].substr(1).replace("."," ")),g.push(y[1]),h.appendChild(v),h=v}return c}var v=[[1470,1470],[1472,1472],[1475,1475],[1478,1478],[1488,1514],[1520,1524],[1544,1544],[1547,1547],[1549,1549],[1563,1563],[1566,1610],[1645,1647],[1649,1749],[1765,1766],[1774,1775],[1786,1805],[1807,1808],[1810,1839],[1869,1957],[1969,1969],[1984,2026],[2036,2037],[2042,2042],[2048,2069],[2074,2074],[2084,2084],[2088,2088],[2096,2110],[2112,2136],[2142,2142],[2208,2208],[2210,2220],[8207,8207],[64285,64285],[64287,64296],[64298,64310],[64312,64316],[64318,64318],[64320,64321],[64323,64324],[64326,64449],[64467,64829],[64848,64911],[64914,64967],[65008,65020],[65136,65140],[65142,65276],[67584,67589],[67592,67592],[67594,67637],[67639,67640],[67644,67644],[67647,67669],[67671,67679],[67840,67867],[67872,67897],[67903,67903],[67968,68023],[68030,68031],[68096,68096],[68112,68115],[68117,68119],[68121,68147],[68160,68167],[68176,68184],[68192,68223],[68352,68405],[68416,68437],[68440,68466],[68472,68479],[68608,68680],[126464,126467],[126469,126495],[126497,126498],[126500,126500],[126503,126503],[126505,126514],[126516,126519],[126521,126521],[126523,126523],[126530,126530],[126535,126535],[126537,126537],[126539,126539],[126541,126543],[126545,126546],[126548,126548],[126551,126551],[126553,126553],[126555,126555],[126557,126557],[126559,126559],[126561,126562],[126564,126564],[126567,126570],[126572,126578],[126580,126583],[126585,126588],[126590,126590],[126592,126601],[126603,126619],[126625,126627],[126629,126633],[126635,126651],[1114109,1114109]];function m(e){for(var t=0;t<v.length;t++){var n=v[t];if(e>=n[0]&&e<=n[1])return!0}return!1}function y(){}function b(e,t,n){var r="undefined"!=typeof navigator&&/MSIE\s8\.0/.test(navigator.userAgent),s="rgba(255, 255, 255, 1)",o="rgba(0, 0, 0, 0.8)",a="";void 0!==i&&(s=i.fontSet,o=i.backgroundSet,a=i.edgeSet),r&&(s="rgb(255, 255, 255)",o="rgb(0, 0, 0)"),y.call(this),this.cue=t,this.cueDiv=g(e,t.text);var l={color:s,backgroundColor:o,textShadow:a,position:"relative",left:0,right:0,top:0,bottom:0,display:"inline"};r||(l.writingMode=""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl",l.unicodeBidi="plaintext"),this.applyStyles(l,this.cueDiv),this.div=e.document.createElement("div"),l={textAlign:"middle"===t.align?"center":t.align,font:n.font,whiteSpace:"pre-line",position:"absolute"},r||(l.direction=function(e){var t=[],n="";if(!e||!e.childNodes)return"ltr";function r(e,t){for(var n=t.childNodes.length-1;n>=0;n--)e.push(t.childNodes[n])}function i(e){if(!e||!e.length)return null;var t=e.pop(),n=t.textContent||t.innerText;if(n){var s=n.match(/^.*(\n|\r)/);return s?(e.length=0,s[0]):n}return"ruby"===t.tagName?i(e):t.childNodes?(r(e,t),i(e)):void 0}for(r(t,e);n=i(t);)for(var s=0;s<n.length;s++)if(m(n.charCodeAt(s)))return"rtl";return"ltr"}(this.cueDiv),l.writingMode=""===t.vertical?"horizontal-tb":"lr"===t.vertical?"vertical-lr":"vertical-rl".stylesunicodeBidi="plaintext"),this.applyStyles(l),this.div.appendChild(this.cueDiv);var c=0;switch(t.positionAlign){case"start":c=t.position;break;case"middle":c=t.position-t.size/2;break;case"end":c=t.position-t.size}""===t.vertical?this.applyStyles({left:this.formatStyle(c,"%"),width:this.formatStyle(t.size,"%")}):this.applyStyles({top:this.formatStyle(c,"%"),height:this.formatStyle(t.size,"%")}),this.move=function(e){this.applyStyles({top:this.formatStyle(e.top,"px"),bottom:this.formatStyle(e.bottom,"px"),left:this.formatStyle(e.left,"px"),right:this.formatStyle(e.right,"px"),height:this.formatStyle(e.height,"px"),width:this.formatStyle(e.width,"px")})}}function _(e){var t,n,r,i,s="undefined"!=typeof navigator&&/MSIE\s8\.0/.test(navigator.userAgent);if(e.div){n=e.div.offsetHeight,r=e.div.offsetWidth,i=e.div.offsetTop;var o=(o=e.div.childNodes)&&(o=o[0])&&o.getClientRects&&o.getClientRects();e=e.div.getBoundingClientRect(),t=o?Math.max(o[0]&&o[0].height||0,e.height/o.length):0}this.left=e.left,this.right=e.right,this.top=e.top||i,this.height=e.height||n,this.bottom=e.bottom||i+(e.height||n),this.width=e.width||r,this.lineHeight=void 0!==t?t:e.lineHeight,s&&!this.lineHeight&&(this.lineHeight=13)}function w(e,t,n,r){var i=new _(t),s=t.cue,o=function(e){if("number"==typeof e.line&&(e.snapToLines||e.line>=0&&e.line<=100))return e.line;if(!e.track||!e.track.textTrackList||!e.track.textTrackList.mediaElement)return-1;for(var t=e.track,n=t.textTrackList,r=0,i=0;i<n.length&&n[i]!==t;i++)"showing"===n[i].mode&&r++;return-1*++r}(s),a=[];if(s.snapToLines){var l;switch(s.vertical){case"":a=["+y","-y"],l="height";break;case"rl":a=["+x","-x"],l="width";break;case"lr":a=["-x","+x"],l="width"}var c=i.lineHeight,h=c*Math.round(o),u=n[l]+c,d=a[0];Math.abs(h)>u&&(h=h<0?-1:1,h*=Math.ceil(u/c)*c),o<0&&(h+=""===s.vertical?n.height:n.width,a=a.reverse()),i.move(d,h)}else{var f=i.lineHeight/n.height*100;switch(s.lineAlign){case"middle":o-=f/2;break;case"end":o-=f}switch(s.vertical){case"":t.applyStyles({top:t.formatStyle(o,"%")});break;case"rl":t.applyStyles({left:t.formatStyle(o,"%")});break;case"lr":t.applyStyles({right:t.formatStyle(o,"%")})}a=["+y","-x","+x","-y"],i=new _(t)}var p=function(e,t){for(var i,s=new _(e),o=1,a=0;a<t.length;a++){for(;e.overlapsOppositeAxis(n,t[a])||e.within(n)&&e.overlapsAny(r);)e.move(t[a]);if(e.within(n))return e;var l=e.intersectPercentage(n);o>l&&(i=new _(e),o=l),e=new _(s)}return i||s}(i,a);t.move(p.toCSSCompatValues(n))}function S(){}y.prototype.applyStyles=function(e,t){for(var n in t=t||this.div,e)e.hasOwnProperty(n)&&(t.style[n]=e[n])},y.prototype.formatStyle=function(e,t){return 0===e?0:e+t},b.prototype=s(y.prototype),b.prototype.constructor=b,_.prototype.move=function(e,t){switch(t=void 0!==t?t:this.lineHeight,e){case"+x":this.left+=t,this.right+=t;break;case"-x":this.left-=t,this.right-=t;break;case"+y":this.top+=t,this.bottom+=t;break;case"-y":this.top-=t,this.bottom-=t}},_.prototype.overlaps=function(e){return this.left<e.right&&this.right>e.left&&this.top<e.bottom&&this.bottom>e.top},_.prototype.overlapsAny=function(e){for(var t=0;t<e.length;t++)if(this.overlaps(e[t]))return!0;return!1},_.prototype.within=function(e){return this.top>=e.top&&this.bottom<=e.bottom&&this.left>=e.left&&this.right<=e.right},_.prototype.overlapsOppositeAxis=function(e,t){switch(t){case"+x":return this.left<e.left;case"-x":return this.right>e.right;case"+y":return this.top<e.top;case"-y":return this.bottom>e.bottom}},_.prototype.intersectPercentage=function(e){return Math.max(0,Math.min(this.right,e.right)-Math.max(this.left,e.left))*Math.max(0,Math.min(this.bottom,e.bottom)-Math.max(this.top,e.top))/(this.height*this.width)},_.prototype.toCSSCompatValues=function(e){return{top:this.top-e.top,bottom:e.bottom-this.bottom,left:this.left-e.left,right:e.right-this.right,height:this.height,width:this.width}},_.getSimpleBoxPosition=function(e){var t=e.div?e.div.offsetHeight:e.tagName?e.offsetHeight:0,n=e.div?e.div.offsetWidth:e.tagName?e.offsetWidth:0,r=e.div?e.div.offsetTop:e.tagName?e.offsetTop:0;return{left:(e=e.div?e.div.getBoundingClientRect():e.tagName?e.getBoundingClientRect():e).left,right:e.right,top:e.top||r,height:e.height||t,bottom:e.bottom||r+(e.height||t),width:e.width||n}},S.StringDecoder=function(){return{decode:function(e){if(!e)return"";if("string"!=typeof e)throw new Error("Error - expected string data.");return decodeURIComponent(encodeURIComponent(e))}}},S.convertCueToDOMTree=function(e,t){return e&&t?g(e,t):null};S.processCues=function(e,t,r){if(!e||!t||!r)return null;for(;r.firstChild;)r.removeChild(r.firstChild);var i=e.document.createElement("div");if(i.style.position="absolute",i.style.left="0",i.style.right="0",i.style.top="0",i.style.bottom="0",i.style.margin="1.5%",r.appendChild(i),function(e){for(var t=0;t<e.length;t++)if(e[t].hasBeenReset||!e[t].displayState)return!0;return!1}(t)){var s=[],o=_.getSimpleBoxPosition(i),a={font:Math.round(.05*o.height*100)/100*n+"px sans-serif"};!function(){for(var n,r,l=0;l<t.length;l++)r=t[l],n=new b(e,r,a),i.appendChild(n.div),w(0,n,o,s),r.displayState=n.div,s.push(_.getSimpleBoxPosition(n))}()}else for(var l=0;l<t.length;l++)i.appendChild(t[l].displayState)},S.Parser=function(e,t){this.window=e,this.state="INITIAL",this.buffer="",this.decoder=t||new TextDecoder("utf8"),this.regionList=[]},S.Parser.prototype={reportOrThrowError:function(e){if(!(e instanceof o))throw e;this.onparsingerror&&this.onparsingerror(e)},parse:function(e){var t=this;function n(){for(var e=t.buffer,n=0;n<e.length&&"\r"!==e[n]&&"\n"!==e[n];)++n;var r=e.substr(0,n);return"\r"===e[n]&&++n,"\n"===e[n]&&++n,t.buffer=e.substr(n),r}function r(e){c(e,(function(e,n){if("Region"===e)!function(e){var n=new l;if(c(e,(function(e,t){switch(e){case"id":n.set(e,t);break;case"width":n.percent(e,t);break;case"lines":n.integer(e,t);break;case"regionanchor":case"viewportanchor":var r=t.split(",");if(2!==r.length)break;var i=new l;if(i.percent("x",r[0]),i.percent("y",r[1]),!i.has("x")||!i.has("y"))break;n.set(e+"X",i.get("x")),n.set(e+"Y",i.get("y"));break;case"scroll":n.alt(e,t,["up"])}}),/=/,/\s/),n.has("id")){var r=new t.window.VTTRegion;r.width=n.get("width",100),r.lines=n.get("lines",3),r.regionAnchorX=n.get("regionanchorX",0),r.regionAnchorY=n.get("regionanchorY",100),r.viewportAnchorX=n.get("viewportanchorX",0),r.viewportAnchorY=n.get("viewportanchorY",100),r.scroll=n.get("scroll",""),t.onregion&&t.onregion(r),t.regionList.push({id:n.get("id"),region:r})}}(n)}),/:/)}e&&(t.buffer+=t.decoder.decode(e,{stream:!0}));try{var i;if("INITIAL"===t.state){if(!/\r\n|\n/.test(t.buffer))return this;var s=(i=n()).match(/^WEBVTT([ \t].*)?$/);if(!s||!s[0])throw new o(o.Errors.BadSignature);t.state="HEADER"}for(var a=!1;t.buffer;){if(!/\r\n|\n/.test(t.buffer))return this;switch(a?a=!1:i=n(),t.state){case"HEADER":/:/.test(i)?r(i):i||(t.state="ID");continue;case"NOTE":i||(t.state="ID");continue;case"ID":if(/^NOTE($|[ \t])/.test(i)){t.state="NOTE";break}if(!i)continue;if(t.cue=new t.window.VTTCue(0,0,""),t.state="CUE",-1===i.indexOf("--\x3e")){t.cue.id=i;continue}case"CUE":try{h(i,t.cue,t.regionList)}catch(e){t.reportOrThrowError(e),t.cue=null,t.state="BADCUE";continue}t.state="CUETEXT";continue;case"CUETEXT":var u=-1!==i.indexOf("--\x3e");if(!i||u&&(a=!0)){t.oncue&&t.oncue(t.cue),t.cue=null,t.state="ID";continue}t.cue.text&&(t.cue.text+="\n"),t.cue.text+=i;continue;case"BADCUE":i||(t.state="ID");continue}}}catch(e){t.reportOrThrowError(e),"CUETEXT"===t.state&&t.cue&&t.oncue&&t.oncue(t.cue),t.cue=null,t.state="INITIAL"===t.state?"BADWEBVTT":"BADCUE"}return this},flush:function(){var e=this;try{if(e.buffer+=e.decoder.decode(),(e.cue||"HEADER"===e.state)&&(e.buffer+="\n\n",e.parse()),"INITIAL"===e.state)throw new o(o.Errors.BadSignature)}catch(t){e.reportOrThrowError(t)}return e.onflush&&e.onflush(),this}},e.WebVTT=S}(this)},3111:function(e,t,n){var r;e.exports&&(this.VTTCue=this.VTTCue||n(8733).VTTCue),(r=this).VTTCue.prototype.toJSON=function(){var e={},t=this;return Object.keys(this).forEach((function(n){"getCueAsHTML"!==n&&"hasBeenReset"!==n&&"displayState"!==n&&(e[n]=t[n])})),e},r.VTTCue.create=function(e){if(!e.hasOwnProperty("startTime")||!e.hasOwnProperty("endTime")||!e.hasOwnProperty("text"))throw new Error("You must at least have start time, end time, and text.");var t=new r.VTTCue(e.startTime,e.endTime,e.text);for(var n in e)t.hasOwnProperty(n)&&(t[n]=e[n]);return t},r.VTTCue.fromJSON=function(e){return this.create(JSON.parse(e))}},8733:function(){!function(e){var t={"":!0,lr:!0,rl:!0},n={start:!0,middle:!0,end:!0,left:!0,right:!0};function r(e){return"string"==typeof e&&(!!n[e.toLowerCase()]&&e.toLowerCase())}function i(e){for(var t=1;t<arguments.length;t++){var n=arguments[t];for(var r in n)e[r]=n[r]}return e}function s(e,n,s){var o=this,a=/MSIE\s8\.0/.test(navigator.userAgent),l={};a?o=document.createElement("custom"):l.enumerable=!0,o.hasBeenReset=!1;var c="",h=!1,u=e,d=n,f=s,p=null,g="",v=!0,m="auto",y="start",b=50,_="middle",w=50,S="middle";if(Object.defineProperty(o,"id",i({},l,{get:function(){return c},set:function(e){c=""+e}})),Object.defineProperty(o,"pauseOnExit",i({},l,{get:function(){return h},set:function(e){h=!!e}})),Object.defineProperty(o,"startTime",i({},l,{get:function(){return u},set:function(e){if("number"!=typeof e)throw new TypeError("Start time must be set to a number.");u=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"endTime",i({},l,{get:function(){return d},set:function(e){if("number"!=typeof e)throw new TypeError("End time must be set to a number.");d=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"text",i({},l,{get:function(){return f},set:function(e){f=""+e,this.hasBeenReset=!0}})),Object.defineProperty(o,"region",i({},l,{get:function(){return p},set:function(e){p=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"vertical",i({},l,{get:function(){return g},set:function(e){var n=function(e){return"string"==typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}(e);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");g=n,this.hasBeenReset=!0}})),Object.defineProperty(o,"snapToLines",i({},l,{get:function(){return v},set:function(e){v=!!e,this.hasBeenReset=!0}})),Object.defineProperty(o,"line",i({},l,{get:function(){return m},set:function(e){if("number"!=typeof e&&"auto"!==e)throw new SyntaxError("An invalid number or illegal string was specified.");m=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"lineAlign",i({},l,{get:function(){return y},set:function(e){var t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");y=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"position",i({},l,{get:function(){return b},set:function(e){if(e<0||e>100)throw new Error("Position must be between 0 and 100.");b=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"positionAlign",i({},l,{get:function(){return _},set:function(e){var t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");_=t,this.hasBeenReset=!0}})),Object.defineProperty(o,"size",i({},l,{get:function(){return w},set:function(e){if(e<0||e>100)throw new Error("Size must be between 0 and 100.");w=e,this.hasBeenReset=!0}})),Object.defineProperty(o,"align",i({},l,{get:function(){return S},set:function(e){var t=r(e);if(!t)throw new SyntaxError("An invalid or illegal string was specified.");S=t,this.hasBeenReset=!0}})),o.displayState=void 0,a)return o}s.prototype.getCueAsHTML=function(){return WebVTT.convertCueToDOMTree(window,this.text)},e.VTTCue=e.VTTCue||s}(this)},4960:function(e,t,n){var r;e.exports&&(this.VTTRegion=n(9588).VTTRegion),(r=this).VTTRegion.create=function(e){var t=new r.VTTRegion;for(var n in e)t.hasOwnProperty(n)&&(t[n]=e[n]);return t},r.VTTRegion.fromJSON=function(e){return this.create(JSON.parse(e))}},9588:function(){!function(e){var t={"":!0,up:!0};function n(e){return"number"==typeof e&&e>=0&&e<=100}e.VTTRegion=e.VTTRegion||function(){var e=100,r=3,i=0,s=100,o=0,a=100,l="";Object.defineProperties(this,{width:{enumerable:!0,get:function(){return e},set:function(t){if(!n(t))throw new Error("Width must be between 0 and 100.");e=t}},lines:{enumerable:!0,get:function(){return r},set:function(e){if("number"!=typeof e)throw new TypeError("Lines must be set to a number.");r=e}},regionAnchorY:{enumerable:!0,get:function(){return s},set:function(e){if(!n(e))throw new Error("RegionAnchorX must be between 0 and 100.");s=e}},regionAnchorX:{enumerable:!0,get:function(){return i},set:function(e){if(!n(e))throw new Error("RegionAnchorY must be between 0 and 100.");i=e}},viewportAnchorY:{enumerable:!0,get:function(){return a},set:function(e){if(!n(e))throw new Error("ViewportAnchorY must be between 0 and 100.");a=e}},viewportAnchorX:{enumerable:!0,get:function(){return o},set:function(e){if(!n(e))throw new Error("ViewportAnchorX must be between 0 and 100.");o=e}},scroll:{enumerable:!0,get:function(){return l},set:function(e){var n=function(e){return"string"==typeof e&&!!t[e.toLowerCase()]&&e.toLowerCase()}(e);if(!1===n)throw new SyntaxError("An invalid or illegal string was specified.");l=n}}})}}(this)},5813:e=>{e.exports={Global:class{static set subtitles(e){this._subtitles=e}static get subtitles(){return this._subtitles||[]}static set pauseAtPhraseEnd(e){this._pauseAtPhraseEnd=e}static get pauseAtPhraseEnd(){return this._pauseAtPhraseEnd}static set rewindToPhraseStart(e){this._rewindToPhraseStart=e}static get rewindToPhraseStart(){return this._rewindToPhraseStart}}}},4172:(e,t,n)=>{const{console:r}=n(2777),{APP_NAME:i}=n(2963),{getIsInPlayerPage:s,getManifestInUrl:o,getIsInHuluStorePage:a}=n(6727);e.exports={HuluAPI:class{constructor(){this.token=null,this.sessionToken=null,this.id=null}activateWatchManifest(){this.checkManifestLoop()}checkManifestLoop(){this.checkManifest().catch((e=>{r.error(e)})).then((()=>{setTimeout(this.checkManifestLoop.bind(this),1e3)}))}checkManifest(){if(!s())return Promise.resolve(!1);const e=o();return e?(window[`__${i}PrimaryManifestList`]||(window[`__${i}PrimaryManifestList`]=[]),window[`__${i}PrimaryManifestList`].find((t=>t.movieId===e.toString()))?Promise.resolve(!0):this.setTokenId().then((t=>t?this.setManifest(e):Promise.resolve(!1)))):Promise.resolve(!1)}setTokenId(){return this.setTokenIdFromAPI().then((e=>e||this.setTokenIdFromWindow()))}setTokenIdFromAPI(){return this.sync().then((e=>(this.token=e.authContext.token,this.sessionToken=e.authContext.sessionToken,this.id=e.authContext.id,!0))).catch((e=>(r.error(e),!1)))}setTokenIdFromLocalStorage(){let e=window.localStorage.tokenkey;if(!e)return!1;try{let t=JSON.parse(e);return!!(t&&t.token&&t.id)&&(this.token=t.token,this.id=t.id,!0)}catch(e){return r.error(e),!1}}setTokenIdFromWindow(){let e=null;try{e=window.app.appContext.state.model.models}catch(e){}try{e=window.app.reactContext.models}catch(e){}if(!e)return!1;let t=null;try{t=e.authContext.data}catch(e){}return!!(t&&t.token&&t.sessionToken&&t.id)&&(this.token=t.token,this.sessionToken=t.sessionToken,this.id=t.id,!0)}setManifest(e){return this.auth(e).then((e=>{let t=e&&e.media&&e.media.values;if(t.asset_id&&t.caption_ja_normal_standard&&t.caption_en_normal_standard){let n={};n.movieId=t.asset_id.toString();let s={kind:"subtitles",srclang:"en",src:t.caption_en_normal_standard},o={kind:"subtitles",srclang:"ja",src:t.caption_ja_normal_standard};return n.tracks=[s,o],n.thumbnail_tile_urls=e.media.thumbnail_tile_urls,r.log(`Found Manifest: ${n.movieId}`),window[`__${i}PrimaryManifestList`]||(window[`__${i}PrimaryManifestList`]=[]),window[`__${i}PrimaryManifestList`].find((e=>e.movieId===n.movieId))||window[`__${i}PrimaryManifestList`].push(n),!0}return!1})).catch((e=>(r.error(e),!1)))}sync(){return new Promise(((e,t)=>{let n=new XMLHttpRequest;n.open("GET","https://www.hulu.jp/api/user/sync"),n.onload=()=>{try{const t=JSON.parse(n.responseText);return e(t)}catch(e){return r.error(e),t()}},n.onerror=()=>t(),n.send()}))}auth(e){return new Promise(((t,n)=>{let i=new XMLHttpRequest;i.open("POST","https://papi.prod.hjholdings.tv/api/v1/playback/auth"),i.setRequestHeader("accept","application/json, text/plain, */*"),i.setRequestHeader("accept-language","ja"),i.setRequestHeader("authorization",`Bearer ${this.token}`),i.setRequestHeader("content-type","application/json;charset=UTF-8"),i.setRequestHeader("x-user-id",this.id),i.setRequestHeader("x-session-token",this.sessionToken),i.onload=()=>{try{const e=JSON.parse(i.responseText);return t(e)}catch(e){return r.error(e),n()}},i.onerror=()=>n();let s={meta_id:`asset:${e}`,user_id:this.id};a()&&(s={meta_id:`tvod_asset:${e}`,service:"store",user_id:this.id}),i.send(JSON.stringify(s))}))}getMovieTitle(e){return this.pathEvaluator(e).then((t=>{if(t&&t.jsonGraph&&t.jsonGraph.meta[`asset:${e}`]&&t.jsonGraph.meta[`asset:${e}`].name&&t.jsonGraph.meta[`asset:${e}`].name.value){return t.jsonGraph.meta[`asset:${e}`].name.value}return null}))}getThumbnailURL(e){return this.pathEvaluator(e).then((t=>{if(t&&t.jsonGraph&&t.jsonGraph.meta[`asset:${e}`]&&t.jsonGraph.meta[`asset:${e}`].thumbnailUrl&&t.jsonGraph.meta[`asset:${e}`].thumbnailUrl.value){return t.jsonGraph.meta[`asset:${e}`].thumbnailUrl.value}return null}))}getThumbnail(e){return this.getThumbnailURL(e).then((e=>{if(!e)throw new Error(`Thumbnail URL doesn't exist "${e}"`);return fetch(e,{method:"GET"}).then((t=>{if(!t.ok)throw new Error(`Failed to fetch the url "${e}"`);return t.blob()})).then((e=>new Promise(((t,n)=>{const r=new FileReader;r.onload=()=>t({dataURL:r.result}),r.onerror=()=>n(null),r.readAsDataURL(e)})))).catch((e=>(r.error(e),null)))}))}pathEvaluator(e){const t=new URLSearchParams;t.append("paths",JSON.stringify([["meta",`asset:${e}`,["canMyList","mylisted"]]])),t.append("method","get");let n=`https://www.hulu.jp/pathEvaluator?${t.toString()}`;return fetch(n,{credentials:"same-origin",method:"GET"}).then((e=>{if(!e.ok)throw new Error(`Failed to fetch the url "${n}"`);return e.json()})).then((e=>e)).catch((e=>(r.error(e),null)))}}}},4877:(e,t,n)=>{const{APP_NAME:r,ENGLISH_WORD_CLASS_NAME:i,SUBTITLE_TEXT_SECONDARY_CONTAINER_ID:s}=n(2963),{PopupPhrases:o}=n(1080),{HighLightController:a}=n(4506);e.exports={StaticCss:class{constructor(){}activate(){this.append()}append(){const e=`${r}StaticCss`;if(document.getElementById(e))return;let t=document.createElement("style");t.id=`${r}StaticCss`,t.innerHTML=`\n    \n    /* hideOverlay */\n    .bezel .fa-player-pause, .bezel .fa-player-play{\n      visibility: hidden;\n    }\n    \n    .metadata-info-row {\n      visibility: hidden;\n    }\n    \n    /* HighLight */\n    #${s} .${i}.${a.CLASS_NAME_HIGHLIGHT_FAVORITE_WORD_IN_ORIGINAL_LINE}{\n      background-color: rgba(255, 255, 0, 0.5);\n    }\n    \n    \n    /* popupPhrase */\n    #${o.POPUP_PHRASE_CONTAINER_ID_NAME}{\n      z-index: 101;\n      display: block;\n      top: 0px;\n      left: 0px;\n      position: absolute;\n      font-size: 16px;\n      margin: 10px;\n      padding: 0px;\n      line-height: 2.0;\n      background-color: rgba(0,0,0,0.8);\n      color: #f9f9f9;\n      border-radius: 4px;\n      user-select: text;\n    }\n    .${o.POPUP_PHRASE_ROW_CLASS_NAME}{\n      padding-top: 5px;\n      margin: 5px 10px;\n    }\n    .${o.POPUP_PHRASE_ROW_CLASS_NAME}:last-child{\n      padding-bottom: 5px;\n    }\n    .${o.POPUP_PHRASE_ROW_CLASS_NAME} + .${o.POPUP_PHRASE_ROW_CLASS_NAME}{\n      border-top: 1px solid rgba(255, 255, 255, 0.2);\n    }\n    .${o.POPUP_PHRASE_ROW_CLASS_NAME} .favoritePhraseMain{\n    }\n    \n    #${o.POPUP_PHRASE_CONTAINER_ID_NAME} .highLightFavoriteWord{\n      font-weight: bold;\n      text-decoration: underline;\n    }\n    #${o.POPUP_PHRASE_CONTAINER_ID_NAME} .thumbnail{\n      display: block;\n      padding: 5px 0;\n      height: 90px;\n    }\n    \n    .${i}:hover{\n      opacity: 1.0 !important;\n      cursor: pointer;\n      text-decoration-line: none;\n    }\n    \n    /* Fix color when user changes the theme. Override A tag of hulu css */\n    .${i}{\n      color: #F1F1F1 !important;\n    }\n    \n    `,document.head.appendChild(t)}}}},6157:e=>{e.exports={AudioPlayerBlob:class{constructor(e){this.url=URL.createObjectURL(e),this.audio=new Audio(this.url),this.audio.loop=!0}revoke(){this.audio.paused||this.audio.pause(),this.url&&URL.revokeObjectURL(this.url),this.audio=null}get paused(){return this.audio.paused}async play(){await this.audio.play()}pause(){this.audio.pause()}}}},4961:(e,t,n)=>{const{console:r}=n(2777),{getManifestInUrl:i,getIsInPlayerPage:s}=n(6727);class o{static scriptLoadPromise=null;static shakaSrc="https://ajax.googleapis.com/ajax/libs/shaka-player/4.11.2/shaka-player.compiled.js";constructor(){this.audio=new Audio,this.audioContext=new AudioContext,this.source=null,this.downloadState="GENESIS",this._isRecording=!1,this.RECORDING_MARGIN_TIME_SEC=.5,this.numberOfwaitingRecordings=0,this.licenseUrlWidevine=null,this.licenseUrlPlayready=null,this.manifestUrl=null,this.certificateUrl=null}revoke(){return this.waitIfDownloading().then((()=>this.waitIfExistWaitingRecordings())).then((()=>this.waitIfRecording())).then((()=>{this.audio&&this.audio.src&&(r.log("Audio revoked for recording"),URL.revokeObjectURL(this.audio.src)),this.audio=null}))}setAudioInfo(){try{if(!s())throw new Error("Player page is not detected.");const e=i();if(!e)throw new Error("Manifest is not found in the URL.");const t=window.app.appContext.state.playerApp.localPlayer().getMedia();if(e.toString()!==t.refId)throw new Error("Manifest ID in URL does not match the media reference ID.");this.refId=t.refId;let n=t.sources.find((e=>"dash_cenc"===e.label&&"960x540"===e.resolution));return n||(n=t.sources.find((e=>"dash_cenc"===e.label))),this.licenseUrlWidevine=n.keySystems["com.widevine.alpha"].licenseUrl,this.licenseUrlPlayready=n.keySystems["com.microsoft.playready"].licenseUrl,this.certificateUrl=n.keySystems["com.widevine.alpha"].certificateUrl,this.manifestUrl=n.src,!0}catch(e){return r.error(e),!1}}load(){return new Promise(((e,t)=>this.licenseUrlWidevine&&this.licenseUrlPlayready&&this.manifestUrl?"READY"===this.downloadState?e():"FAIL"===this.downloadState?t(new Error("To download audio is failed")):"GENESIS"===this.downloadState?(this.downloadState="LOADING",r.log(`Audio loading for clipping the audio in a phrase. Epoch time:${Date.now()}`),this.loadAndInitPlayer().then((()=>(this.downloadState="READY",r.log(`Audio loaded for clipping the audio in a phrase. Epoch time:${Date.now()}`),e()))).catch((e=>(this.downloadState="FAIL",r.error(`Audio failed to load for clipping the audio in a phrase. Epoch time:${Date.now()}`),t(e))))):void("LOADING"===this.downloadState&&this.waitIfDownloading().then((()=>"READY"===this.downloadState?e():"FAIL"===this.downloadState?t(new Error("To download audio is failed")):void 0))):t(new Error("licenseUrl or manifestUrl doesn't exist"))))}static loadShakaScript(){return null!==o.scriptLoadPromise||(o.scriptLoadPromise=new Promise(((e,t)=>{const n=document.createElement("script");n.src=o.shakaSrc,n.onload=()=>{r.log("Shaka Player script loaded"),o.isScriptLoaded=!0,e()},n.onerror=()=>{t(new Error("Failed to load the Shaka Player script"))},document.head.appendChild(n)}))),o.scriptLoadPromise}async initPlayer(){if(window.shaka.polyfill.installAll(),!window.shaka.Player.isBrowserSupported())throw new Error("Browser not supported");this.player=new shaka.Player,await this.player.attach(this.audio),this.player.addEventListener("error",(e=>{var t;t=e.detail,r.error("Error code",t.code,"object",t)})),this.player.configure({drm:{servers:{"com.widevine.alpha":this.licenseUrlWidevine,"com.microsoft.playready":this.licenseUrlPlayready},advanced:{"com.widevine.alpha":{serverCertificateUri:this.certificateUrl}}}});try{await this.player.load(this.manifestUrl),r.log("The audio has now been loaded")}catch(e){throw r.error("Error code",e.code,"object",e),e}}async loadAndInitPlayer(){try{await o.loadShakaScript(),await this.initPlayer(),r.log("Player initialized successfully")}catch(e){throw r.error("Failed to load and initialize the player",e),e}}get isDownloading(){return"LOADING"===this.downloadState}waitIfDownloading(){return new Promise(((e,t)=>{if("LOADING"!==this.downloadState)return e();const n=3e3;r.log("The audio is already downloading, wait 3000 ms");const i=setInterval((()=>{if("LOADING"!==this.downloadState)return clearInterval(i),e();r.log("The audio is already downloading, wait 3000 ms")}),n)}))}get isRecording(){return this._isRecording}waitIfRecording(){return new Promise(((e,t)=>{if(!this._isRecording)return e();this.numberOfwaitingRecordings++;const n=setInterval((()=>{if(!this._isRecording)return clearInterval(n),this.numberOfwaitingRecordings--,e()}),3e3)}))}waitIfExistWaitingRecordings(){return new Promise(((e,t)=>{const n=setInterval((()=>{if(0===this.numberOfwaitingRecordings)return clearInterval(n),e()}),3e3)}))}smartRecord(e,t){return this.load().then((()=>this.waitIfRecording())).then((()=>this.record(e,t)))}record(e,t){return new Promise(((n,i)=>{if(e-=this.RECORDING_MARGIN_TIME_SEC,t+=this.RECORDING_MARGIN_TIME_SEC,"READY"!==this.downloadState)return i(new Error("Downloaded audio data doesn't exist"));if(this._isRecording)return i(new Error("currently recording the audio"));this._isRecording=!0,r.log(`Recording an audio in a phrase starts. beginSeconds:${e} endSeconds:${t} Epoch time:${Date.now()}`);let s=[];this.audio.volume=1,this.source||(this.source=this.audioContext.createMediaElementSource(this.audio));const o=this.audioContext.createMediaStreamDestination();this.source.connect(o),this.audio.currentTime=e;const a=t-e,l="audio/webm;codecs=opus";let c=new MediaRecorder(o.stream,{mimeType:l});c.addEventListener("dataavailable",(e=>{s.push(e.data)})),c.addEventListener("stop",(i=>{this.audio.pause();let o=new Blob(s,{type:l});return this._isRecording=!1,r.log(`Recording an audio in a phrase finished. beginSeconds:${e} endSeconds:${t} Epoch time:${Date.now()}`),n(o)})),r.log(`Audio recorder starts. Epoch time:${Date.now()}`),c.start(),r.log(`Going to start the audio playback. Epoch time:${Date.now()}`),this.audio.play().then((()=>{r.log(`Audio playback has been successfully started. Epoch time:${Date.now()}`),setTimeout((()=>{c.stop()}),1e3*a)})).catch((e=>(r.error(`Audio playback failed. Epoch time:${Date.now()}`,e),this._isRecording=!1,i(e))))}))}isMacOS(){if(navigator.userAgentData){return"macOS"===navigator.userAgentData.platform}return navigator.userAgent?navigator.userAgent.includes("Macintosh"):(r.warn("userAgentData or userAgent is not available."),!1)}toDataURL(e){return new Promise(((t,n)=>{let r=new FileReader;r.onload=()=>{let e=r.result;t(e)},r.readAsDataURL(e)}))}equal(e){return this.manifestUrl===e.manifestUrl}}e.exports={AudioRecorder:o}},5134:(e,t,n)=>{const{AudioRecorder:r}=n(4961);e.exports={AudioRecorderManager:class{static createOrGet(){let e=new r;return e.setAudioInfo()?(this.audioRecorder?this.audioRecorder.equal(e)||(this.audioRecorder.revoke(),this.audioRecorder=e):this.audioRecorder=e,this.audioRecorder):null}}}},2787:e=>{e.exports={ExtensionButton:class{constructor(e){this.buttonDataImage,this.buttonIdName=e,this.buttonImageIdName=`${this.buttonIdName}-image`,this.BUTTON_CLASS_NAME="bcc-controls-button",this.button,this.image,this.CHECK_INTERVAL_MS=1e3}activate(){this._activateButton()}_activateButton(){this._createButtonIfNotExist(),setInterval((()=>{this._createButtonIfNotExist()}),this.CHECK_INTERVAL_MS)}_createButtonIfNotExist(){if(null!==document.getElementById(this.buttonIdName))return!1;let e=document.querySelector(".button-controls-row .right-btn");if(null===e)return!1;this._createButton(),e.insertAdjacentElement("afterbegin",this.button)}_createButton(){this._createBaseButton(),this._createCustomButton()}_createCustomButton(){}_createBaseButton(){this.button=document.createElement("div"),this.button.setAttribute("id",this.buttonIdName),this.button.classList.add(this.BUTTON_CLASS_NAME),this.button.style.display="flex",this.button.style.justifyContent="center",this.button.style.alignItems="center",this.button.style.backgroundImage="none",this.button.style.cursor="pointer";const e={width:"50%",height:"50%"},t={width:"51%",height:"51%"};this.image=document.createElement("img"),this.image.setAttribute("id",this.buttonImageIdName),Object.assign(this.image.style,e),this.button.appendChild(this.image),this.button.addEventListener("mouseenter",(e=>{Object.assign(this.image.style,t)})),this.button.addEventListener("mouseleave",(t=>{Object.assign(this.image.style,e)}))}}}},6535:(e,t,n)=>{const{PauseAtPhraseEnd:r}=n(2806),{ExtensionButton:i}=n(2787);e.exports={PauseAtPhraseEndButton:class extends i{constructor(){super("pause-at-phrase-end"),this.buttonDataImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gcNFTMWzUClHgAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAAE+SURBVHja7ZcxTsMwFIb/oi6sDEitKiZYWZDAgwcO0FuUI/gCLEw+BWfgAkgevHRhZYmqig5MDBVi68LA0oQSm6T190mZnp4Tf34vtiUAAIBiGaQe0AXzKul8W9zbOMiZvytHpVcAAhCAAAQgoOhzgAtmlnjMB0mnNfG7zPk7MZQ0SSxg2BCfZM6nBdqs1kLSe8sxvxri88z5TYwljbYJePE2tnqBC2ZdF/c2PuXM/8X33f4UwDaIAAQgAAEI4CCUDm/jRZf5VAACEIAABCAAAQhAAAIQkOYu4IK52vM5vnkbV20uQ9M9F/AsaUULIOCPLeBtvKcCSq6Ahh3iRtJxD+ZReRurfxcg6VrSSU8Ws6IFOqiAj57M47MTAd7GR3YBBCDgoH6Cly6Y0YHPeVwn4Oz7oQVKaoGlAAAAoEQ2AhA6JiMwQXkAAAAASUVORK5CYII=",this.pauseAtPhraseEnd=new r}_createCustomButton(){this._setButtonOff(),this.image.setAttribute("src",this.buttonDataImage),this.button.addEventListener("click",(()=>{this.pauseAtPhraseEnd._isRunning?(this.pauseAtPhraseEnd.deactivate(),this._setButtonOff()):(this.pauseAtPhraseEnd.activate(),this._setButtonOn())}))}_setButtonOn(){Object.assign(this.image.style,{filter:"grayscale(0)"})}_setButtonOff(){Object.assign(this.image.style,{filter:"grayscale(1)"})}}}},7503:(e,t,n)=>{const{ExtensionPlayer:r}=n(7057),{ExtensionButton:i}=n(2787);e.exports={RewindButton:class extends i{constructor(e){super("rewind-button"),this.buttonDataImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QAAAAAAAD5Q7t/AAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gcOAR06/QVkkwAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAASzSURBVHja7ZtbiFZVFMf/a26al6whc7xNBIbjS0nkrYsGhiIkQWA+hE0P2YMM9RD1ItVDT0JWDyUqPUUXIcLoYgVhYIJF0SQpWVmWw0xOM2nopOOMM78evj0gw/h9+5zv7H0+Tv6fZvgW+/I/a++19l7/LV3F/xs29gewSdJbZjaaZQeAJM2XtETSrZIWSVogabKkekkjznRQ0l+Sfpf0i6RvJH0v6ZyZhWcCOAS8BtRl0FYdsAJ4EfgRGCEdzgNfAE8BrY7MoARQDQnAtcATbtJZYxj4BFiXxUcqRwDAjiSduIk/B5wmDg4DDwAWigAvEgADHga6yQefA22hCADYfSUSgLnAPvLHeeDpqpfFFQiYkATgPqCX2sLHQHMIAgDeABoAAR1uQ6pFHAMWJJl3g6fdJhez/5bUcXn+kAKDkrok/eP+75M0TdJ0Sc2SWqtof6GkA8AaMzuSNBE6JGl5iAgr6VtJeyXtl3RY0uBEyY2L87MkLZO0VtKDklpS9NkraZWZ/ZTVEkiDc8CrwMK0CQzQCKwH9gOjCfv/DWjJg4BLwOvAnCzTaWC1i/9JcBBoiknAceDugNlqo0u4kmzC22MR8D4wI8YJznlDv+e4RoB7QxPwMlAf8xgLtAFdCcLj5InayepQMdXt9vHO8WbHJK2W9KdneHwy9BLYHeSUVtkTlrp0uBLOANeH3gTzIuExz/FtjREGo5PgTqUfeIytB5gUIxHKg4SbPZfChhCb4HhslrQzJglmdkLSDg/TR2KlwtE9AZgDDFYY07/A9NAekIsnmFmPpA8rmE2RtCoWAXkshz0eNitjEhCbhM8kXahgs2KiC5GfXbEiFJY4InYFXgYDQKekO8uYLQLqzWykkOUu4BWPDXp2zCUQGyc8bJqLTMApD5tJRSag38OmqcgEeKOoBFznYXOpyATM9LC5WGQCWj1szhaZgNsr/D4wdpVWOAKABpd1lsNxMxsqqgcsH0tyyuDrIkeBhzxsDhb1DDAV6PMo3bUU1QPaJd3g4f6nqmW6qQa//jRPrdKWqibuNHtdSZUYEQjY5jH5gVQyGnfvfv84/d+XLuTUwuTvAoY8CNiZpvG2MmqwbUHVm37jmw384TH5oURe68SP24GLZRodBTbnvO6/8ryi35W08Y4EEtb22J4AzHDSGR+cBm5Ms+F1JhAhbI119Q3cBHyXoEDzeNqOFgMXEnS0F5gZcOJyoqm+BGP6tKoPA2xJWA7rBR7NWjECzAfeSagWOwnMqrZjc6qvpOgENlabNDl3f8nF8CQYAJZmxX4T8FHKAmm3u6e/x4cM5+Ytzov2pZTlDgHrfeZmCUiYopLac00VXA5IOiLpqKQzKlWieiTNkzQsaa6k21R6UpNWLjskqd3M9oTYhJqAt6ldnAXWhQ5BdcDz7lhZS/gVWBwrCRGwNseXIuPxblkFWEAiml2EyMsbuoENmb4dSukNy9zztphr/YXLpS61cCSVC3XvBXxR0g08GzLbzIqMecAz7qRWLRn9wJsuBW7MeqwW2itUKlOtlHSHSk9nb3Fx/5rx5io9yTnpcoUfJB2Q1Glmw6HGaDl5SL1KBcxGlWQ6wyqVqgbNDF1FPPwHS+adQ2FbWM0AAAAASUVORK5CYII=",this.extensionPlayer=new r}_createCustomButton(){this.image.setAttribute("src",this.buttonDataImage),this.button.addEventListener("click",(()=>{this.extensionPlayer.rewind(),this.extensionPlayer.play()}));const e={opacity:"0.5"},t={opacity:"1.0"};Object.assign(this.image.style,e),this.button.addEventListener("mouseenter",(e=>{Object.assign(this.image.style,t)})),this.button.addEventListener("mouseleave",(t=>{Object.assign(this.image.style,e)}))}}}},2519:(e,t,n)=>{const{ExtensionPlayer:r}=n(7057),{ExtensionButton:i}=n(2787),{RewindToPhraseStart:s}=n(216);e.exports={RewindToPhraseStartButton:class extends i{constructor(){super("rewind-to-phrase-start-button"),this.buttonDataImage="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAABmJLR0QAdADEADhLtXtyAAAACXBIWXMAAAsTAAALEwEAmpwYAAAAB3RJTUUH4gcODSAQRUwcnwAAABl0RVh0Q29tbWVudABDcmVhdGVkIHdpdGggR0lNUFeBDhcAAASvSURBVHja7ZpbiFZVFIC/NTNmkmN2UVMss7KCSrQhK7tgRGImPRSW9BIkZT4E2kMvqRiWUNFDEBSlD2owQhZFgWVJCimVSqgPJTI6WSjZTSU1Tf+vhznKMMx//sucf+bMZcF5Wvvsvde3115n7bUP9HOJchuqdwLbIuJMtYOpFwFTgFuAsZ00OQIcArZGxJ5ckVJfU5vVhgrfG6EuUDerZy1fDqur1RmFQiHyAsByIag3q6vUU3ZdWtTn1QvzACAVgjpcfafC1S5XDqiz8wCgUwjqLPU3ay/N6sU9DeDcROrVOnVZjVa9mOxTb+yqXQ1dfH9O8iUJ4LEK3y0AZ4ATyfuN7foqR8YDW9SHI2JLT3lApbJbXapOUxvbbyF1kHqNOkd9Xz1aZp9H1FvzDKCgfqTeUeF4jer8JPCVkoPqlXkEsF+9r4vjDlXfSECmyTeV5ii1BrBWHZbh+DPVYyXGXJwXAK3qBTWYw9QSEP5Vx1fSZ12NeI0DVhUKhfpMDy4RW4EHgf+KNBkMvJKnGNBcKBQaajCXeSljnlWv62kPOJ8nRMSaGgSnd4GtKTbNy1se0Jw1BHVyypfhkDooDx7QPmPM1BMi4gfgiyLqK4CpeQJwHkLGMWFlim563gDUIiasB04V0ZWVHlcyke+S4JOFTAO+ymAbHFe3A3d1or6hXxQ11fdSgm/Jk2WDOreXM7gkRTdXtdQWGNvLAQxN0Y0FzFMQzJ10DIIHgN97mQ2TU3Q7OvGAMcDoYgB2RcSOXhYEnyyi+hv4LCLs0H5aewC9egskUf7eIuqWjsb3xRgwCRhZRLczj5lg1vJoim5LnwagDgWeLaI+DXzarQCSu8Bh3cjgOeCyIrqNEfFHtwBQR6lvJ3vu9W5a/QnA0hIFE2oKQL1AXQj8lLhiHfC0+niNjR8CrAOKFV33Ap9UmwiVO4nbgdXA9R0PaMAK9ZekgJm18YOBD4CJKc0WlfP566oHDOnE+Pa5+efqAzUIeh8CD6U025QAoqYAImITsCKlSSOwXn0xi+KHOhH4toTxx4FnKln9rgbBhcCuFH098DLwfXIZGlUYfrn6KrAduKlE8/kRsbfSMaoGEBH/AI/Q9lNTqcPK18A29Sl1ZAmjB6l3q28B+4AXgFIV3uURsSaL02ClEFrU+4HNwIgSzZtoK2KeVXcn3nMS2AMMTw4oo5LcfngF01hZKBQWZXUcrgbCj+o9tJWox5XxSn2Sw0/qamgAlquL6+vrrbaTTDLB5J++JmBDN2WBR4EnImJRXV2dXekos1Q4Iv4EZgALgGM1NP5LoCki1mbRWaaHoYgwIt4EJiTp6OkMu98JzI6I6RHRklWnNTkNRsThiJgHXA0sS9LlauQE8DEwE5gcEeuynmtDLTdqRBwClgBLkmRmBnAbcG0Cp2NJez/wM7CbttvfDRHxVy3nWM4vr00Zjrcxec6dGzqL7O1lfKV/fHQiB5OFqNoDZvXyqtHmtGSt398LDFyMlBHIXhrwgP7sAWVUhobkwI7WiGjtiTxgCnBpThazdWAL9IAHHM2JHSd7BEBErB74CgwAGADQp4LgRHV0H7d5TBqAq5JnYAv0py3wa38G8D+6rGPSt80uGwAAAABJRU5ErkJggg==",this.rewindToPhraseStart=new s}_createCustomButton(){this.image.setAttribute("src",this.buttonDataImage),this.button.addEventListener("click",(()=>{this.rewindToPhraseStart.rewindToPharseStartAndPlay()}));const e={opacity:"0.5"},t={opacity:"1.0"};Object.assign(this.image.style,e),this.button.addEventListener("mouseenter",(e=>{Object.assign(this.image.style,t)})),this.button.addEventListener("mouseleave",(t=>{Object.assign(this.image.style,e)}))}}}},6727:e=>{const t=()=>/^\/(?:store\/)?watch\/(\d+)/.exec(window.location.pathname)[1];e.exports={activateKeyboardShortCut:(e,t)=>{const n=n=>{if(n.ctrlKey||n.metaKey)return;if(document.activeElement&&document.activeElement.tagName&&"input"===document.activeElement.tagName.toLowerCase())return;n.key.toLowerCase()===e.toLowerCase()&&t()};document.addEventListener("keydown",n);return()=>{document.removeEventListener("keydown",n)}},getIsInPlayerPage:()=>/hulu\.jp\/(store\/)?watch/i.test(window.location.href),getIsInHuluStorePage:()=>/hulu\.jp\/store\/watch/i.test(window.location.href),getManifestInUrl:t,getMovieId:()=>t(),getMovieTitle:()=>"",querySelectorOfFirstMatch:(e,t=document)=>{for(let n of e){let e=t.querySelector(n);if(e)return e;console.warn(`cssセレクタ "${n}" が存在しません`)}return null}}},2777:e=>{const t="[同時字幕]",n={log:(...e)=>window.console.log(t,...e),warn:(...e)=>window.console.warn(t,...e),error:(...e)=>window.console.error(t,...e)};e.exports={console:n}},4269:(e,t,n)=>{const{FavoritePhrasesController:r}=n(9323),{APP_NAME:i,Settings:s}=n(2963),{sleep:o}=n(7413),{console:a}=n(2777),l=n(4213);e.exports={FavoritePhrasesBackUpController:class{constructor(){this.favoritePhrasesController=new r,this.settings=new s,this.isProcessingOfImport=!1,this.isProcessingOfExport=!1}getFileInputEle(){let e=document.createElement("span");e.innerHTML=`\n            <button id="${i}ButtonOfFavoritePhrasesBackUp">お気に入りのバックアップファイルをダウンロード</button>\n            <button id="${i}ButtonOfFavoritePhrasesRestore">\n                <label for="${i}InputOfFavoritePhrasesRestore">\n                    お気に入りのバックアップファイルを選択して復元\n                </label>\n            </button>\n            <input type="file" id="${i}InputOfFavoritePhrasesRestore" accept=".json" multiple>\n            <span id="${i}FavoritePhrasesBackupMessage"></span>        \n        `;let t=e.querySelector(`#${i}FavoritePhrasesBackupMessage`),n=e.querySelector(`#${i}ButtonOfFavoritePhrasesBackUp`),r=e.querySelector(`#${i}InputOfFavoritePhrasesRestore`);return r.addEventListener("change",(()=>{this.import(r.files,t).then((()=>{r.value=""}))})),n.addEventListener("click",(()=>{this.export(t).then((()=>{this.persist()}))})),e}import(e,t){if(this.isProcessingOfImport)return a.warn("現在、バックアップファイルの復元中です。"),Promise.resolve();this.isProcessingOfImport=!0,t.textContent="バックアップファイルの復元を開始。";let n=Promise.resolve();for(let r=0;r<e.length;r++)n=n.then((()=>(t.textContent=`バックアップファイル${e[r].name}の復元中です。`,this.importPartOf(e[r],t).then((()=>{t.textContent=`${e[r].name}を復元しました。`})).catch((n=>{t.textContent=`${e[r].name}の復元に失敗しました。`})).then((()=>o(1e3))))));return n.then((()=>{t.textContent="バックアップファイルの復元が完了しました。",this.isProcessingOfImport=!1})).catch((e=>{a.error(e),t.textContent="バックアップファイルの復元に失敗しました。",this.isProcessingOfImport=!1})),n}importPartOf(e){return e?new Promise(((t,n)=>{let r=new FileReader;r.addEventListener("load",(()=>{try{let e=r.result,i=JSON.parse(e);if(!(Array.isArray(i)&&i.every((e=>e.hasOwnProperty("id")))&&i.every((e=>e.hasOwnProperty("watchId")))&&i.every((e=>e.hasOwnProperty("epochTimeAtCreated")))))throw new Error("ファイルが破損しています。");i=this.convertAudioDataURLToBlob(i),i=i.map((e=>e=this.favoritePhrasesController.validateFavoritePhraseAndFixItIfItIsWrong(e))),this.favoritePhrasesController.getDatabase().favoritePhrases.bulkPut(i).then((e=>t())).catch((e=>n(e)))}catch(e){n(e)}})),r.readAsText(e)})):Promise.resolve()}export(e){return this.isProcessingOfExport?(a.warn("現在、バックアップ処理中です。"),Promise.resolve()):(this.isProcessingOfExport=!0,this.NUMBER_OF_LOADING_AT_ONCE=100,this.favoritePhrasesController.getDatabase().favoritePhrases.count().then((t=>{if(0===t)return e.textContent="バックアップするお気に入りがありません。",void(this.isProcessingOfExport=!1);e.textContent=`全${t}行のバックアップを開始`;let n=Promise.resolve();for(let r=0;r<t;r++)r%this.NUMBER_OF_LOADING_AT_ONCE==0&&(n=n.then((()=>this.exportPartOf(r,this.NUMBER_OF_LOADING_AT_ONCE).then((n=>(e.textContent=`全${t}行のバックアップ中: index${r}-${r+n}`,o(1e3)))))));return n.then((()=>{e.textContent="バックアップが完了しました。",this.isProcessingOfExport=!1})).catch((()=>{e.textContent="バックアップに失敗しました。",this.isProcessingOfExport=!1})),n})))}exportPartOf(e,t){return this.favoritePhrasesController.getDatabase().favoritePhrases.orderBy("id").offset(e).limit(t).toArray().then((t=>this.convertAudioBlobToDataURLAsync(t).then((()=>{let n=t.length-1;const r=JSON.stringify(t);let i=new Blob([r],{type:"application/json"});return l.saveAs(i,`hulu_ver1_num${e}-${e+n}.json`),n}))))}blobToDataURLAsync(e){return new Promise(((t,n)=>{let r=new FileReader;r.addEventListener("load",(()=>{let e=r.result;t(e)})),r.addEventListener("error",(e=>{a.error("broken audio data"),n()})),r.readAsDataURL(e)}))}dataURLtoBlob(e){let t=atob(e.split(",")[1]),n=e.split(",")[0].split(":")[1].split(";base64")[0],r=new ArrayBuffer(t.length),i=new Uint8Array(r);for(let e=0;e<t.length;e++)i[e]=t.charCodeAt(e);return new Blob([r],{type:n})}convertAudioBlobToDataURLAsync(e){return new Promise((t=>{if(0===e.length)return t();let n=Promise.resolve();for(let r=0;r<e.length;r++)n=n.then((()=>e[r].audioData&&e[r].audioData.hasOwnProperty("blob")?this.blobToDataURLAsync(e[r].audioData.blob).then((t=>{delete e[r].audioData.blob,e[r].audioData.dataURL=t})).catch((t=>{delete e[r].audioData,a.error("delete audioData because it's broken")})).then((()=>{if(r===e.length-1)return t()})):r===e.length-1?t():void 0))}))}convertAudioDataURLToBlob(e){for(let t=0;t<e.length;t++)if(e[t].audioData&&e[t].audioData.hasOwnProperty("dataURL")){try{e[t].audioData.blob=this.dataURLtoBlob(e[t].audioData.dataURL)}catch(e){a.error(e)}delete e[t].audioData.dataURL}return e}persist(){navigator.storage&&navigator.storage.persist&&navigator.storage.persisted().then((e=>{e?a.log("Storage will not be cleared except by explicit user action"):navigator.storage.persist().then((e=>{e?a.log("Storage will not be cleared except by explicit user action"):a.log("Storage may be cleared by the UA under storage pressure.")}))}))}}}},9323:(e,t,n)=>{const{ExtensionPlayer:r}=n(7057),{console:i}=n(2777),{Global:s}=n(5813),{activateKeyboardShortCut:o,getMovieId:a}=n(6727),{SubtitleTextExtractor:l}=n(5707),c=n(4369).A,{FavoritePhraseWord:h,FavoritePhrase:u}=n(2369),{HuluAPI:d}=n(4172),{AudioRecorderManager:f}=n(5134),{ThumbnailManager:p}=n(5164),g=n(7054).A,{APP_NAME:v,ENGLISH_WORD_CLASS_NAME:m,Settings:y,CHROME_EXTENSION_ID:b}=n(2963);class _{constructor(){this.extensionPlayer=new r,this.subtitleTextExtractor=new l,this.huluAPI=new d,this.settings=new y,this.loadIndexedDB(),this.messageOfAdded="お気に入りに追加しました",this.messageOfDeleted="お気に入りを削除しました"}static get ON_UPDATED_FAVORITE_PHRASES(){return"onUpdatedFavoritePhrases"}static get EVENT_DELETED(){return"deleted"}static get EVENT_ADDED(){return"added"}loadIndexedDB(){this.db=new g(v),this.db.version(1).stores({favoritePhrases:["++id","watchId","cueId","beginMs","endMs","englishWord","isLearned","epochTimeAtCreated","[watchId+beginMs+endMs]","[watchId+beginMs+endMs+englishWord]"].join(","),_favoritePhraseWords:["++","word","favoritePhraseId","secondWord","thirdWord","[word+secondWord]","[word+secondWord+thirdWord]","bigram","trigram","isFavoriteWord"].join(",")})}getDatabase(){return this.db}activate(){this.tryRestoreFromStorageIfNotExist(),this.activateKeyboardShortCutOfAddPhraseOnMousePointer()}tryRestoreFromStorageIfNotExist(){g.exists(v).then((e=>{e||this.tryRestoreFromStorage()})).catch((function(e){i.error("Oops, an error occurred when trying to check database existance")}))}activateKeyboardShortCutOfAddCurrentPhrase(){let e=0;o("keyboardShortcutAddCurrentPhraseToFavorite",(()=>{if(Date.now()-e<200)return;e=Date.now();const{word:t,lineId:n}=this.focusWordController.getWordLineIdOfFocused();if("string"==typeof t&&"number"==typeof n){const e=s.subtitles.find((e=>e.active));if(!e||!e.active||"READY"!==e.state||!e.lines)return;const r=e.lines.find((e=>e.id===n));this.addOrDeleteAsync(r,t)}else this.addOrDeleteCurrentPhraseAsync()}))}activateKeyboardShortCutOfAddPhraseOnMousePointer(){document.addEventListener("contextmenu",(e=>{let t=e.clientX,n=e.clientY,r=document.elementFromPoint(t,n);if(r&&r.classList.contains(m)){let e=parseInt(r.getAttribute("lineId"));const t=s.subtitles.find((e=>e.active));if(!t||!t.active||"READY"!==t.state||!t.lines)return;const n=t.lines.find((t=>t.id===e)),i=r.childNodes[0].textContent;this.addOrDeleteAsync(n,i)}}))}deletePhraseAsync(e){let t=e.id;return this.db.favoritePhrases.delete(parseInt(t)).then((()=>{this._isSameMovieId(e)&&this._dispatchEvent(e,_.EVENT_DELETED)})).then((()=>this.deleteIndexOfLearningWordsAsync(e)))}validateFavoritePhraseAndFixItIfItIsWrong(e){for(let t of Object.keys(e))null===e[t]||void 0===e[t]?delete e[t]:!0===e[t]?e[t]=1:!1===e[t]&&(e[t]=0);return e}addPhraseAsync(e){let t=e.toObjectExceptUndefined();return this.db.favoritePhrases.add(t).then((t=>{e.id=t,this._isSameMovieId(e)&&this._dispatchEvent(e,_.EVENT_ADDED)})).then((()=>e))}_isSameMovieId(e){const t=a();return!(!t||!e.watchId||t.toString()!==e.watchId.toString())}_dispatchEvent(e,t){let n=new CustomEvent(_.ON_UPDATED_FAVORITE_PHRASES,{detail:{favoritePhrase:e,status:t}});document.querySelectorAll(`.${_.ON_UPDATED_FAVORITE_PHRASES}`).forEach((e=>{e.dispatchEvent(n)}))}addOrDeleteAsync(e,t){return this.getPhraseWithLineAsync(e,t).then((n=>n?this.deletePhraseAsync(n):this.addLinePhraseAsync(e,t)))}addOrDeleteCurrentPhraseAsync(){const e=s.subtitles.find((e=>e.active));if(!e||!e.active||"READY"!==e.state||!e.lines)return Promise.resolve();const t=this.extensionPlayer.getCurrentTime();if(null===t)return Promise.resolve();const n=e.lines.find((e=>e.beginSeek<=t&&t<=e.endPause));return n?this.addOrDeleteAsync(n,null):Promise.resolve()}deleteIfSamePhraseExistsAsync(e,t=null){return this.getPhraseWithLineAsync(e,t).then((e=>{if(e)return this.deletePhraseAsync(e).then((()=>{i.log(`Deleted a duplicated old phrase id:${e.id}`)}))}))}async addLinePhraseAsync(e,t=null){const n=this.subtitleTextExtractor.getEnglishText(e.beginOriginal,e.endOriginal),r=this.subtitleTextExtractor.getJapaneseText(e),s=a();await this.deleteIfSamePhraseExistsAsync(e,t);let o=new u;o.watchId=s,o.cueId=e.id,o.beginMs=e.beginOriginal,o.endMs=e.endOriginal,o.englishPhrase=n,o.japanesePhrase=r,t&&(o.englishWord=t),o=await this.addPhraseAsync(o),this.addIndexOfLearningWordsAsync(o),this.huluAPI.getMovieTitle(s).then((e=>{this.addMovieTitleToPhrase(o,e)}));const l=(parseInt((e.endOriginal-e.beginOriginal)/2)+e.beginOriginal)/1e3;if(!await this.addThumbnailsToPhraseBySeconds(o,l))try{const e=await this.huluAPI.getThumbnail(s);await this.addThumbnailToPhrase(o,e)}catch(e){i.error("Hulu API からサムネイルを取得できませんでした。",e)}const c=e.beginOriginal/1e3,h=e.endOriginal/1e3;return await this.addAudioToPhraseBySeconds(o,c,h),o}async addThumbnailsToPhraseBySeconds(e,t){try{const n=p.createOrGet();let r={};const i=await n.getThumbnailDataURLFromTargetSecondsAsync(t);if(!i)throw new Error("サムネイルを取得できませんでした。");r.dataURL=i;const s=await n.getThumbnailDataURLBeforeFromTargetSecondsAsync(t);s&&(r.dataURLBefore=s);const o=await n.getThumbnailDataURLAfterFromTargetSecondsAsync(t);o&&(r.dataURLAfter=o),await this.addThumbnailToPhrase(e,r)}catch(e){return i.error(e),!1}return!0}async addAudioToPhraseBySeconds(e,t,n){const r=f.createOrGet();if(r){const i=await r.smartRecord(t,n);i&&await this.addAudioToPhrase(e,{blob:i})}}async addMovieTitleToPhrase(e,t){return this.db.favoritePhrases.where("id").equals(e.id).modify({movieTitle:t})}async addThumbnailToPhrase(e,t){return this.db.favoritePhrases.where("id").equals(e.id).modify({thumbnail:t})}async addAudioToPhrase(e,t){return this.db.favoritePhrases.where("id").equals(e.id).modify({audioData:t})}getAllFavoritePhraseInCurrentMovie(){const e=a();let t=[];return this.db.favoritePhrases.where({watchId:e}).each((e=>{let n=u.getInstanceFromRawData(e);t.push(n)})).then((()=>t))}getAllFavoriteWordsDictAsync(){const e=a();let t=[],n=[];return this.db.favoritePhrases.filter((e=>!!e.englishWord)).each((r=>{let i=r.englishWord.toLowerCase();r.watchId===e?t.push(i):n.push(i)})).then((()=>({wordsInCurrentMovie:t,wordsInOtherMovie:n})))}getPhraseWithLineAsync(e,t=null){let n={watchId:a(),beginMs:e.beginOriginal,endMs:e.endOriginal};return this.db.favoritePhrases.where(n).filter((e=>!t&&!e.englishWord||!(!t||!e.englishWord||t.toLowerCase()!==e.englishWord.toLowerCase()))).first((e=>{if(!e)return null;return u.getInstanceFromRawData(e)})).catch((e=>(i.error(e),null)))}get(e){return this.db.favoritePhrases.get(e)}getFavoritePhrasesInOtherMovieByWord(e,t=null){const n=a();let r=this.db.favoritePhrases.where("englishWord").equalsIgnoreCase(e);return r=r.filter((e=>e.watchId!==n)),null!==t&&(r=r.limit(t)),r.toArray()}getWordsWithLineAsync(e){const t=a();if(!t)return i.error("Failed to getWordsWithLineAsync because movieId is not found"),null;let n=[];return this.db.favoritePhrases.where({watchId:t,beginMs:e.beginOriginal,endMs:e.endOriginal}).each((e=>{e.englishWord&&n.push(e.englishWord)})).then((()=>n)).catch((e=>(i.error(e),null)))}getIndexOfLearningWords(e){if(!e)return null;e=(e=e.toLowerCase()).replace(/<br\s*\/?>/gi," ");let t=c(e);return t?t.map((e=>e.value)):null}get_favoritePhraseWords(e,t,n){let r=this.getIndexOfLearningWords(e);return r?r.map(((e,i)=>{let s={word:e,favoritePhraseId:t},o=i+1;o<r.length&&(s.secondWord=r[o],s.bigram=e+" "+r[o]);let a=i+2;return a<r.length&&(s.thirdWord=r[a],s.trigram=e+" "+r[o]+" "+r[a]),n&&e===n.toLowerCase()?s.isFavoriteWord=1:s.isFavoriteWord=0,s})):null}addIndexOfLearningWordsAsync(e){let t=this.get_favoritePhraseWords(e.englishPhrase,e.id,e.englishWord);return t?this.db._favoritePhraseWords.bulkAdd(t):Promise.reject(new Error("Failed to add index of learning words"))}deleteIndexOfLearningWordsAsync(e){return this.db._favoritePhraseWords.where("favoritePhraseId").equals(e.id).delete()}backupToStorage(){return this.export().then((e=>{chrome.runtime.sendMessage(b,{favoritePhrases:e},(e=>{e.message&&i.log(e.message)}))}))}tryRestoreFromStorage(){chrome.runtime.sendMessage(b,{getFavoritePhrases:!0},(e=>{e.favoritePhrases?this.import(e.favoritePhrases):e.message&&i.log(e.message)}))}export(){return this.db.transaction("r",this.db.favoritePhrases,(()=>{let e=[];return this.db.favoritePhrases.orderBy("id").reverse().limit(1e3).each((t=>{t.thumbnail&&delete t.thumbnail,t.audioData&&delete t.audioData,e.push(t)})).then((()=>e))}))}import(e){return e&&e[0].hasOwnProperty("id")?this.db.transaction("rw",this.db.favoritePhrases,(()=>this.db.favoritePhrases.clear().then((()=>this.db.favoritePhrases.bulkAdd(e))))):(i.error("wrong data for import"),Promise.reject())}}e.exports={FavoritePhrasesController:_}},2369:e=>{class t{constructor(e=void 0,t=void 0,n=void 0,r=void 0,i=void 0,s=void 0,o=void 0,a=void 0,l=0,c=void 0,h=Date.now(),u=void 0){this.id=e,this.watchId=t,this.cueId=n,this.beginMs=r,this.endMs=i,this.englishPhrase=s,this.japanesePhrase=o,this.englishWord=a,this.isLearned=l,this.movieTitle=c,this.epochTimeAtCreated=h,this.thumbnail=u}get id(){return this._id}set id(e){this._id=e}get watchId(){return this._watchId}set watchId(e){this._watchId=e}get cueId(){return this._cueId}set cueId(e){this._cueId=e}get beginMs(){return this._beginMs}set beginMs(e){this._beginMs=e}get endMs(){return this._endMs}set endMs(e){this._endMs=e}get englishPhrase(){return this._englishPhrase}set englishPhrase(e){this._englishPhrase=e}get japanesePhrase(){return this._japanesePhrase}set japanesePhrase(e){this._japanesePhrase=e}get englishWord(){return this._englishWord}set englishWord(e){this._englishWord=e}get isLearned(){return this._isLearned}set isLearned(e){if(null==e)throw new TypeError("this value must be zero or one");this._isLearned=e}get movieTitle(){return this._movieTitle}set movieTitle(e){this._movieTitle=e}get thumbnail(){return this._thumbnail}set thumbnail(e){this._thumbnail=e}get epochTimeAtCreated(){return this._epochTimeAtCreated}set epochTimeAtCreated(e){this._epochTimeAtCreated=e}toObjectExceptUndefined(){let e={};return null!==this.id&&void 0!==this.id&&(e.id=this.id),null!==this.watchId&&void 0!==this.watchId&&(e.watchId=this.watchId),null!==this.cueId&&void 0!==this.cueId&&(e.cueId=this.cueId),null!==this.beginMs&&void 0!==this.beginMs&&(e.beginMs=this.beginMs),null!==this.endMs&&void 0!==this.endMs&&(e.endMs=this.endMs),null!==this.englishPhrase&&void 0!==this.englishPhrase&&(e.englishPhrase=this.englishPhrase),null!==this.japanesePhrase&&void 0!==this.japanesePhrase&&(e.japanesePhrase=this.japanesePhrase),null!==this.englishWord&&void 0!==this.englishWord&&(e.englishWord=this.englishWord),null!==this.isLearned&&void 0!==this.isLearned&&(!0===this.isLearned?e.isLearned=1:!1===this.isLearned?e.isLearned=0:e.isLearned=this.isLearned),null!==this.movieTitle&&void 0!==this.movieTitle&&(e.movieTitle=this.movieTitle),null!==this.epochTimeAtCreated&&void 0!==this.epochTimeAtCreated&&(e.epochTimeAtCreated=this.epochTimeAtCreated),null!==this.thumbnail&&void 0!==this.thumbnail&&(e.thumbnail=this.thumbnail),e}static getInstanceFromRawData(e){return new t(e.id,e.watchId,e.cueId,e.beginMs,e.endMs,e.englishPhrase,e.japanesePhrase,e.englishWord,e.isLearned,e.movieTitle,e.epochTimeAtCreated,e.thumbnail)}}e.exports={FavoritePhrase:t,FavoritePhraseWord:class{constructor(){this.word=void 0,this.favoritePhraseId=void 0,this.secondWord=void 0,this.thirdWord=void 0,this.bigram=void 0,this.trigram=void 0,this.isFavoriteWord=void 0}get word(){return this._word}set word(e){this._word=e}get favoritePhraseId(){return this._favoritePhraseId}set favoritePhraseId(e){this._favoritePhraseId=e}get secondWord(){return this._secondWord}set secondWord(e){this._secondWord=e}get thirdWord(){return this._thirdWord}set thirdWord(e){this._thirdWord=e}get bigram(){return this._bigram}set bigram(e){this._bigram=e}get trigram(){return this._trigram}set trigram(e){this._trigram=e}get isFavoriteWord(){return this._isFavoriteWord}set isFavoriteWord(e){this._isFavoriteWord=e}}}},4865:(e,t,n)=>{const{APP_NAME:r,Settings:i,ENGLISH_WORD_CLASS_NAME:s}=n(2963),{querySelectorOfFirstMatch:o,getMovieId:a}=n(6727),{ExtensionPlayer:l}=n(7057),c=n(4369).A,{PopupDictionary:h}=n(7508),{ClickableDictionary:u}=n(1010),{FavoritePhrasesController:d}=n(9323),{TextEditor:f}=n(7210),{console:p}=n(2777),{FavoritePhrasesBackUpController:g}=n(4269),{AudioPlayerBlob:v}=n(6157);e.exports={FavoritePhrasesViewer:class{constructor(){this.containerId=`${r}FavoritePhrasesContainer`,this.settings=new i,this.extensionPlayer=new l,this._createdThumbnailUrls=[],this.NUMBER_OF_LOADING_AT_ONCE=10,this.isActivatedResizeListener=!1,this.titleText="お気に入りに追加した単語とフレーズの一覧",this.closeText="閉じる",this.playText="再生",this.deleteText="削除",this.searchPlaceHolderText="英語を検索",this.clickableDictionary=new u,this.favoritePhrasesController=new d,this.textEditor=new f,this.cssIdOfHideLearningPhraseOnFavoritePhrases=`${r}HideLearningPhraseOnFavoritePhrasesCSS`,this.cssIdOfHideNativePhraseOnFavoritePhrases=`${r}HideNativePhraseOnFavoritePhrasesCSS`,this.idOfSearch=0,this.cssSelectorsToAppendChild=["body"],this.favoritePhrasesBackUpController=new g}activate(){this.appendCss(),this.appendContainer()}get isActive(){return!!document.getElementById(this.containerId)}deactivate(){this.removeContainer()}activateOrDeactivate(){this.isActive?this.deactivate():this.activate()}deletePhrase(e){this.favoritePhrasesController.deletePhraseAsync(e),this.startOrderByNewestData&&this.startOrderByNewestData.ids.includes(e.id)&&this.startOrderByNewestData.offset--,this.searchAWordData&&this.searchAWordData.ids.includes(e.id)&&this.searchAWordData.offset--,this.searchLearningWordsData&&this.searchLearningWordsData.ids.includes(e.id)&&this.searchLearningWordsData.offset--}appendContainer(){let e=document.getElementById(this.containerId);if(e)return;let t=o(this.cssSelectorsToAppendChild);if(!t)return void p.error("doesn't exist the parent element to append the container of favorite phrases.");e=document.createElement("div"),e.setAttribute("id",this.containerId);const n=document.createElement("div");n.setAttribute("id",`${this.containerId}TitleClose`),n.innerHTML=`\n        <span id="${this.containerId}Title">${this.titleText}</span>\n        <span id="${this.containerId}Close">${this.closeText}</span>\n    `;n.querySelector(`#${this.containerId}Close`).addEventListener("click",(()=>{this.removeContainer()}));const r=document.createElement("div");r.id=`${this.containerId}Options`,r.innerHTML=`\n      <span class="optionWrapper searchWrapper">\n        <input placeholder="${this.searchPlaceHolderText}" spellcheck="true" type="search" id="${this.containerId}Search">\n      </span>\n      <span class="optionWrapper">\n        <label for="${this.containerId}IsEnabledStartSearchOrderByTimeOnCurrentMovie" style="cursor: pointer">現在の動画のみ表示</label>\n        <input type="checkbox" id="${this.containerId}IsEnabledStartSearchOrderByTimeOnCurrentMovie" style="cursor: pointer">\n      </span>\n      <span class="optionWrapper">\n        <label for="${this.containerId}IsEnabledHideLearningPhraseOnFavoritePhrases" style="cursor: pointer">英語字幕を隠す</label>\n        <input type="checkbox" id="${this.containerId}IsEnabledHideLearningPhraseOnFavoritePhrases" style="cursor: pointer">\n      </span>\n      <span class="optionWrapper">\n        <label for="${this.containerId}IsEnabledHideNativePhraseOnFavoritePhrases" style="cursor: pointer">日本語字幕を隠す</label>\n        <input type="checkbox" id="${this.containerId}IsEnabledHideNativePhraseOnFavoritePhrases" style="cursor: pointer">\n      </span>\n    `;const i=r.querySelector(`#${this.containerId}IsEnabledStartSearchOrderByTimeOnCurrentMovie`);i.checked=this.settings.isEnabledStartSearchOrderByTimeOnCurrentMovie,i.addEventListener("change",(()=>{this.settings.isEnabledStartSearchOrderByTimeOnCurrentMovie=i.checked,this.updateFavoritePhrasesList()}));const s=r.querySelector(`#${this.containerId}IsEnabledHideLearningPhraseOnFavoritePhrases`);s.checked=this.settings.isEnabledHideLearningPhraseOnFavoritePhrases;const a=()=>{this.settings.isEnabledHideLearningPhraseOnFavoritePhrases?this.enableHideLearningPhraseOnFavoritePhrases():this.disableHideLearningPhraseOnFavoritePhrases()};a(),s.addEventListener("change",(()=>{this.settings.isEnabledHideLearningPhraseOnFavoritePhrases=s.checked,a()}));const l=r.querySelector(`#${this.containerId}IsEnabledHideNativePhraseOnFavoritePhrases`);l.checked=this.settings.isEnabledHideNativePhraseOnFavoritePhrases;const c=()=>{this.settings.isEnabledHideNativePhraseOnFavoritePhrases?this.enableHideNativePhraseOnFavoritePhrases():this.disableHideNativePhraseOnFavoritePhrases()};c(),l.addEventListener("change",(()=>{this.settings.isEnabledHideNativePhraseOnFavoritePhrases=l.checked,c()}));let h=Promise.resolve();this.searchEle=r.querySelector(`#${this.containerId}Search`),this.searchEle.addEventListener("input",(e=>{let t=e.target.value;h=h.then((()=>this.startSearchText(t).catch((e=>{p.error(e)}))))})),e.appendChild(n),e.appendChild(r),t.appendChild(e),e.addEventListener("scroll",(()=>{this.check()})),this.addResizeListener(),this.updateFavoritePhrasesList()}addResizeListener(){this.isActivatedResizeListener||(this.isActivatedResizeListener=!0,window.addEventListener("resize",this.check.bind(this)))}removeResizeListener(){this.isActivatedResizeListener&&(this.isActivatedResizeListener=!1,window.removeEventListener("resize",this.check.bind(this)))}check(e=null){this.timeoutId||(this.timeoutId=setTimeout((()=>{this.timeoutId=0;const t=document.getElementById(this.containerId);if(!t)return;t.scrollHeight-(t.scrollTop+t.clientHeight)<=200&&this.loadMore(e)}),200))}updateFavoritePhrasesList(){let e=this.searchEle.value;return""!==e&&null!==e?this.startSearchText(e):this.settings.isEnabledStartSearchOrderByTimeOnCurrentMovie?this.startSearchOrderByTimeOnCurrentMovie():this.startSearchOrderByNewest()}startSearchOrderByNewest(){let e=++this.idOfSearch;return this.resetSearchResult(),this.getNextFavoritePhrasesAsync=()=>this.favoritePhrasesController.getDatabase().favoritePhrases.orderBy("id").reverse().offset(this.startOrderByNewestData.offset).limit(this.NUMBER_OF_LOADING_AT_ONCE).toArray().then((e=>{this.startOrderByNewestData.offset+=e.length;let t=e.map((e=>e.id));return this.startOrderByNewestData.ids=this.startOrderByNewestData.ids.concat(t),e})),this.loadMore(e)}startSearchOrderByTimeOnCurrentMovie(){let e=++this.idOfSearch;this.resetSearchResult();const t=a();let n;return this.getNextFavoritePhrasesAsync=()=>{const e=e=>e.splice(0,this.NUMBER_OF_LOADING_AT_ONCE);return n?Promise.resolve().then((()=>e(n))):this.favoritePhrasesController.getDatabase().favoritePhrases.where("watchId").equals(t).sortBy("beginSecond").then((t=>(n=t,e(n))))},this.loadMore(e)}startSearchText(e){if(""===(e=e.toLowerCase())||null===e)return this.updateFavoritePhrasesList();let t=c(e);if(!t)return this.updateFavoritePhrasesList();let n=t.map((e=>e.value)),r=n[0],i=++this.idOfSearch;this.resetSearchResult();let s=!1;const o=a(),l=()=>{let e=this.favoritePhrasesController.getDatabase().favoritePhrases.where("englishWord").startsWithIgnoreCase(r);return this.settings.isEnabledStartSearchOrderByTimeOnCurrentMovie&&(e=e.and((e=>e.watchId===o))),e.offset(this.searchAWordData.offset).limit(this.NUMBER_OF_LOADING_AT_ONCE).toArray().then((e=>{this.searchAWordData.offset+=e.length;let t=e.map((e=>e.id));return this.searchAWordData.ids=this.searchAWordData.ids.concat(t),e.length<this.NUMBER_OF_LOADING_AT_ONCE&&(s=!0),e}))},h=()=>{let e=[],t=Promise.resolve();return this.settings.isEnabledStartSearchOrderByTimeOnCurrentMovie&&(t=t.then((()=>this.favoritePhrasesController.getDatabase().favoritePhrases.where("watchId").equals(o).each((t=>{e.push(t.id)}))))),t.then((()=>{let t=this.favoritePhrasesController.getDatabase()._favoritePhraseWords.where("word").startsWith(r);return n.length>1&&(t=t.and((e=>e.secondWord&&e.secondWord.startsWith(n[1]))),n.length>2&&(t=t.and((e=>e.thirdWord&&e.thirdWord.startsWith(n[2]))))),this.settings.isEnabledStartSearchOrderByTimeOnCurrentMovie&&(t=t.and((t=>e.includes(t.favoritePhraseId)))),t.offset(this.searchLearningWordsData.offset).limit(this.NUMBER_OF_LOADING_AT_ONCE).toArray().then((e=>{this.searchLearningWordsData.offset+=e.length;let t=(e=e.filter((e=>!this.searchAWordData.ids.includes(e.favoritePhraseId)))).map((e=>e.favoritePhraseId));return this.searchLearningWordsData.ids=this.searchLearningWordsData.ids.concat(t),this.favoritePhrasesController.getDatabase().favoritePhrases.where("id").anyOf(t).toArray()}))}))};return this.getNextFavoritePhrasesAsync=()=>n.length>1?h():l().then((e=>s?h().then((t=>e.concat(t))):e)),this.loadMore(i)}resetSearchResult(){this.startOrderByNewestData={offset:0,ids:[]},this.searchAWordData={offset:0,ids:[]},this.searchLearningWordsData={offset:0,ids:[]};const e=document.getElementById(this.containerId);e&&e.querySelectorAll(".favoritePhraseRow").forEach((e=>{e.remove()}))}getNextFavoritePhrasesAsync(){return Promise.resolve([])}loadMore(e=null){return this.getNextFavoritePhrasesAsync().then((t=>{null===e||this.idOfSearch===e?(this.render(t),0<t.length&&this.check(e)):p.log("Revoke old search result")}))}render(e){const t=document.getElementById(this.containerId);e.forEach((e=>{const n=document.createElement("div");n.classList.add("favoritePhraseRow");let r="";e.englishWord&&(r=`\n            <div class="learningWordWrapper">\n              <span class="learningWord hoverAction ${s}">${e.englishWord}</span>\n            </div>\n          `);let i="";if(e.thumbnail&&e.thumbnail.dataURL)try{i=`<img class="thumbnail" draggable="false" src="${e.thumbnail.dataURL}" />`}catch(e){p.error(e)}let o="";e.movieTitle&&(o=`\n          <a class="favoritePhraseTitle hoverAction"\n          href="https://www.hulu.jp/watch/${e.watchId}?t=${parseInt(e.beginMs/1e3)}">\n              ${e.movieTitle}\n          </a>\n        `);let l=this.textEditor.editLearningSubtitleOnFavoritePhrases(e.englishPhrase,"en");n.innerHTML=`\n          <div class="favoritePhraseMain">\n          \n            ${r}\n              \n            <div class="learningPhrase">${l}</div>\n            \n            <div class="nativePhrase">${e.japanesePhrase?e.japanesePhrase:""}</div>\n          \n          </div>\n          \n          <div class="favoritePhraseSub">\n          \n            ${i}\n            \n            ${o}\n              \n            <a class="playPhraseButton hoverAction" \n              href="https://www.hulu.jp/watch/${e.watchId}?t=${parseInt(e.beginMs/1e3)}">\n             ${this.playText}\n            </a>\n            \n            <div class="deletePhraseButton hoverAction" data-phraseid="${e.id}">\n              ${this.deleteText}\n            </div>\n                    \n          </div>\n        `,h.activatePopupDictionaryOnFavoritePhrases(n),this.clickableDictionary.enableTextEle(n),n.querySelector(".deletePhraseButton").addEventListener("click",(()=>{this.deletePhrase(e),n.remove(),this.check()}));n.querySelector(".favoritePhraseSub");let c=n.querySelector(".thumbnail");if(c){let t;c.addEventListener("mouseenter",(()=>{if(!e.thumbnail)return;if(!e.thumbnail.dataURL)return;if(!e.thumbnail.dataURLBefore)return;if(!e.thumbnail.dataURLAfter)return;c.src=e.thumbnail.dataURLBefore;const n=[e.thumbnail.dataURL,e.thumbnail.dataURLAfter,e.thumbnail.dataURLBefore];t=setInterval((()=>{let e=n.shift();c.src=e,n.push(e)}),500)})),c.addEventListener("mouseleave",(()=>{e.thumbnail&&e.thumbnail.dataURL&&(clearInterval(t),c.src=e.thumbnail.dataURL)}))}const u=e=>{if(c.classList.contains("audioCanPlay"))return;let t;c.classList.remove("audioCannotPlay"),c.classList.add("audioCanPlay"),c.addEventListener("click",(()=>{t||(t=new v(e.audioData.blob),t.play())})),c.addEventListener("mouseleave",(()=>{t&&(t.revoke(),t=null)}))};if(c&&e.audioData&&e.audioData.blob)u(e);else if(c){c.classList.add("audioCannotPlay");let t=!1,n=!1;const r=()=>{this.favoritePhrasesController.get(e.id).then((e=>{e&&e.audioData&&e.audioData.blob?(n=!0,u(e)):t&&setTimeout(r,1e3)}))};c.addEventListener("mouseenter",(()=>{t=!0,n||r()})),c.addEventListener("mouseleave",(()=>{t=!1}))}[].forEach.call(n.querySelectorAll(".playPhraseButton, .favoritePhraseTitle"),(t=>{t.addEventListener("click",(t=>{const n=a();e.watchId===n&&(t.preventDefault(),this.extensionPlayer.seek(e.beginMs),this.extensionPlayer.play())}))})),t.appendChild(n)}))}removeContainer(){let e=document.getElementById(this.containerId);e?e.remove():p.error(`Doesn't exist the containerId of ${this.containerId}`),this.removeResizeListener(),this.revokeAllThumbnailUrls(),this.favoritePhrasesController.backupToStorage(),this.favoritePhrasesBackUpController.persist()}appendCss(){let e=document.createElement("style");e.innerHTML=`\n    \n    #${this.containerId}{\n      position: fixed;\n      z-index: 999;\n      top: 56px;\n      bottom: 56px;\n      left: 56px;\n      right: 56px;\n      overflow-y: auto;\n      height: 80%;\n      background-color: #262626;\n      font-size: 16px;\n      line-height: 2.0;\n      user-select: text;\n      border-radius: 4px;\n      box-shadow: 0 1px 3px rgba(0,0,0,.12), 0 1px 2px rgba(0,0,0,.24);\n      padding: 10px;\n      font-family: Arial, Helvetica;\n      color: #f1f1f1;\n    }\n     \n    @media (min-width: 1280px){\n      #${this.containerId} .favoritePhraseRow{\n        display: flex;\n      }\n      \n      #${this.containerId} .favoritePhraseRow .favoritePhraseMain{\n        flex-grow: 1;\n      }\n      \n      #${this.containerId} .favoritePhraseRow .favoritePhraseTitle{\n        flex-grow: unset;\n      }\n    }\n    \n    \n    #${this.containerId} .hoverAction:hover {\n      background-color: rgba(255,255,255,0.05);\n    }\n    \n    \n    #${this.containerId}::-webkit-scrollbar {\n      width: 12px;\n    }\n    \n    #${this.containerId}::-webkit-scrollbar-track {\n    }\n     \n    #${this.containerId}::-webkit-scrollbar-thumb {\n      border-radius: 2px;\n      background: rgba(255,0,0,0.8);\n      box-shadow: inset 0 0 6px rgba(0,0,0,0.5);\n      min-height: 30px;\n    }\n    \n    #${this.containerId}TitleClose{\n      display: flex;\n      font-size: 18px;\n      font-weight: bolder;\n    }\n    \n    #${this.containerId}Title{\n      flex-grow: 1;\n      padding: 10px;\n    }\n    \n    #${this.containerId}Close{\n      cursor: pointer;\n      padding: 10px;\n      white-space: nowrap;\n    }\n    \n    #${this.containerId}Options{\n      display: flex;\n      justify-content: flex-end;\n      user-select: none;\n    }\n    \n    #${this.containerId}Options .optionWrapper{\n      padding: 0 10px;\n    }\n    \n    #${this.containerId}Options .optionWrapper input{\n      display: inline-block;\n    }\n    \n    #${this.containerId} .searchWrapper{\n      flex-grow: 1;\n    }\n        \n    #${this.containerId}Search{\n      background-color: #000;\n      color: #f1f1f1;\n      border: none;\n      border-radius: 2px;\n      padding: 2px 10px;\n    }\n    \n    #${this.containerId}Search::placeholder, #${this.containerId}Search::-webkit-input-placeholder{\n      color: #808080;\n    }\n    \n    #${this.containerId} .favoritePhraseRow {\n      border-bottom: 1px groove rgba(255, 255, 255, 0.1);\n      padding: 10px;\n    }\n    \n    #${this.containerId} .favoritePhraseRow .favoritePhraseMain{\n      display: flex;\n    }\n    \n    #${this.containerId} .favoritePhraseRow .favoritePhraseMain .learningWordWrapper{\n      display: flex;\n    }\n    \n    #${this.containerId} .favoritePhraseRow .favoritePhraseMain .learningWord{\n      padding: 10px;\n      font-weight: bolder;\n      white-space: nowrap;\n      border-radius: 2px;\n    }\n    \n    #${this.containerId} .favoritePhraseRow .favoritePhraseMain .learningPhrase,\n    #${this.containerId} .favoritePhraseRow .favoritePhraseMain .nativePhrase{\n      padding: 10px;\n      border-radius: 2px;\n      flex-grow: 1;\n      text-align: center;\n    }\n    \n    #${this.containerId} .favoritePhraseRow .favoritePhraseSub{\n      display: flex;\n      justify-content: flex-end;\n    }\n    \n    #${this.containerId} .favoritePhraseRow .favoritePhraseSub .thumbnail{\n      padding: 10px;\n      border-radius: 2px;\n      height: 90px;\n      pointer-events: auto !important;\n    }\n    \n    #${this.containerId} .favoritePhraseRow .favoritePhraseSub .thumbnail.audioCanPlay {\n      cursor: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAACsUlEQVRYR+2WTYiNURjHf/+djySRj7BgI5oF+bYxk6KJBgtkyoSFWYiN2VgIWbGQUiajTCLyUZTCSENpYtA0aKwtRJSvhqX+eqZz9c5179x7Z0aTmnd33nPe5/k9//Oc/3nFCD8a4fyMAvz/CtgeB8wD3kv6WGlPDUkB2/uBJmB2SrxV0vVKIAYFYHtDSrw6JXsGLAPeSppTDMD2DGCSpDe5NRUB2F6QEu9KAXqBU0A78DDeSSoa0/Zh4AjQIOli3/py5LI9JiUOuSemb25EckkdtqvLBJgMPAamATWSXv0BsL0HWAjMLwAVSRel9z3A8VwF8W4ggDQXlddJ6rXdAFwAWiQ19gHYbgPWllDjF3BM0tH8dSUAaoE7wElJB1K+q8BWYIlsx36eT0E7gbsFQELiekkfCkGW2gLbl4HtwBpJ7bZXAR3AwQDoSvI+lxSd3O9JjVMtqWaA7u7XA7Z3Aq0RV1K37eXAU+CMpL22xwJfgbYA+AmEmUSFV4YJIAoJNW9J2pxkfwl8yRVi+wUwJgCckkZXPhoOgJTwAVAlaXoahyLrJU1N43PRB/8S4GaYk6SZKeFZYGMGqLlPdds/gPHADkmXhkMB24uBkPi2pLoEEOPPktal8RNgQgCEjS4FuiTFh8PZhCskdWaa8LSk/cnYognvBEDOHiNxdzROkWO4TdKnIR7DWkn3MsdwX86IrgFbyjCiJknh/fkqFbVi2xE34rdK2v2XEeUi2a4PowDmFgDJWnFs2SFJ9zPfDgQQc6HyJknfC1pxicrDqgtdRtHFzZJel3LCDGjuMoprOY59d1m3YSZA/nX8DTgBREdXch03SmqJuBUBZEDyf0gCYCXQI6mqmKK2ZwFTovLcmkEBZEBG5pcsW6HtMLHYmnfFbsuBemxICpRq3nLmRwFGFfgNyuJ0RMYn2+UAAAAASUVORK5CYII=), auto\n    }\n    \n    #${this.containerId} .favoritePhraseRow .favoritePhraseSub .thumbnail.audioCannotPlay {\n      cursor: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAgCAYAAABzenr0AAAB8klEQVRYR+2Wv2sUURSFv9OawkIJpLWzUzQJwUYNaGMbkYBFGvsUSUotLERRxDKFWAiKNnZBm4hFMDGE/AtWFiEJQqwUjtzhzTpuZnZ3shMXYW+1zNyd+71zfz0xYNOA4zME+P8VsH0emAL2JL2uW1NHVsD2CWABWATid9hDSUt1II4EYPtWChynD9sELiYVTh0bQJI7ThwAYb+AR8AHYDUeSKp1qJ6cK+ReieCSVm1f7hvA9h3gHHC2RMKTQC73N+CBpGe5X98Att8D13rI3XLkXtL3om8VgO0Z4EBSqPWX2b4OjMn2HPA8vV0HDjkD94BLktbKIDsAOPnflPS2oFiAvclqxvZWkveLpIkS0rsB0Km4uiiQBQIyiKTKn2e2f6Q+npX0qkmA+FZ7wPzkOVAokMt0RdLHpgFKIFpq5CkYOMABMALclvSyaQV6ScEGMA5sSbrQJMChgqsowqzKU+Bt4F1Jq8X7KUmfG2/DVCTRFtGb3exxaslIW8s6tGFM1/3iDCjMghvA6dYusD0LTANnSiiKo/hrmoZ5L0er9b8LOh29YhnFzHgiafPYAQqyxUIqruOfwH3gU9/bsFvy23LefiGJHTIJ7EgarfOtnu4DFZVfdiV7Kmn+nwC0peUqsCvpRZ3g2Siu+4em/YcAQwV+Ay4yGYZfjoZMAAAAAElFTkSuQmCC), auto\n    }\n    \n    #${this.containerId} .favoritePhraseRow .favoritePhraseSub .favoritePhraseTitle{\n      user-select: none;\n      padding: 10px;\n      color: #e1e1e1;\n      border-radius: 2px;\n      font-size: 14px;\n      \n      width: 10em;\n      text-align: left;\n      flex-grow: 1;\n    }\n    \n    #${this.containerId} .favoritePhraseRow .favoritePhraseSub .playPhraseButton{\n      user-select: none;\n      padding: 10px;\n      color: #e1e1e1;\n      border-radius: 2px;\n      font-size: 14px;\n      \n      white-space: nowrap;\n    }\n    \n    #${this.containerId} .favoritePhraseRow .favoritePhraseSub .deletePhraseButton{\n      user-select: none;\n      padding: 10px;\n      color: #e1e1e1;\n      border-radius: 2px;\n      font-size: 14px;\n      \n      white-space: nowrap;\n      cursor: pointer;\n    }\n    \n    `,document.head.appendChild(e)}revokeAllThumbnailUrls(){this._createdThumbnailUrls.forEach((e=>{URL.revokeObjectURL(e)}))}enableHideLearningPhraseOnFavoritePhrases(){if(document.getElementById(this.cssIdOfHideLearningPhraseOnFavoritePhrases))return;let e=document.createElement("style");e.id=this.cssIdOfHideLearningPhraseOnFavoritePhrases,e.innerHTML=`\n      #${this.containerId} .learningPhrase {\n        filter: blur(8px);\n      }\n      \n      #${this.containerId} .learningPhrase:hover {\n        filter: blur(0px);\n      }\n    `,document.head.appendChild(e)}disableHideLearningPhraseOnFavoritePhrases(){const e=document.getElementById(this.cssIdOfHideLearningPhraseOnFavoritePhrases);e&&e.remove()}enableHideNativePhraseOnFavoritePhrases(){if(document.getElementById(this.cssIdOfHideNativePhraseOnFavoritePhrases))return;let e=document.createElement("style");e.id=this.cssIdOfHideNativePhraseOnFavoritePhrases,e.innerHTML=`\n      #${this.containerId} .nativePhrase {\n        filter: blur(8px);\n      }\n      \n      #${this.containerId} .nativePhrase:hover {\n        filter: blur(0px);\n      }\n    `,document.head.appendChild(e)}disableHideNativePhraseOnFavoritePhrases(){const e=document.getElementById(this.cssIdOfHideNativePhraseOnFavoritePhrases);e&&e.remove()}}}},7057:(e,t,n)=>{const{Settings:r}=n(2963),{console:i}=n(2777),{activateKeyboardShortCut:s}=n(6727);e.exports={ExtensionPlayer:class{constructor(){this.settings=new r,this._rewindMax=30,this._rewindMin=1,this._rewindStep=1,this.video=void 0}get rewindMax(){return this._rewindMax}get rewindMin(){return this._rewindMin}get rewindStep(){return this._rewindStep}rewind(){let e=this.settings.rewindSeconds,t=this.getVideo(),n=t.currentTime;t.currentTime=n<e?0:n-e}seek(e){let t=(e=0<e?e:0)/1e3;this.getVideo().currentTime=t}play(){let e=this.getVideo();e.paused?e.play():i.warn("video is already playing")}pause(){let e=this.getVideo();e.paused?i.warn("video is already pausing"):e.pause()}getPaused(){let e=this.getVideo();return null===e?null:e.paused}playOrPause(){let e=this.getVideo();e.paused?e.play():e.pause()}enableKeyboardShortcut(){s("1",(()=>{this.rewind(),this.play()})),s("b",(()=>{this.rewind(),this.play()})),s("v",(()=>{this.playOrPause()})),s("w",(()=>{this.playOrPause()}))}getCurrentTime(){const e=this.getVideo();if(!e)return null;return parseInt(1e3*e.currentTime)}getVideo(){return document.querySelector("video")}getDuration(){const e=document.querySelector("video");return e?e.duration:window.app.appContext.state.playerApp.localPlayer().duration()}}}},2806:(e,t,n)=>{const{ExtensionPlayer:r}=n(7057),{console:i}=n(2777),{Global:s}=n(5813);e.exports={PauseAtPhraseEnd:class{constructor(){this._extensionPlayer=new r,this._isRunning=!1,this._beforePausedTime=-1e3,this._detectingTime=50,this._breakTime=50}get isRunning(){return this._isRunning}activate(){this._isRunning?i.warn(`${this.constructor.name} is already activated`):(this._reset(),this._isRunning=!0,i.log(`${this.constructor.name} is activated`),window.requestAnimationFrame(this._loop.bind(this)))}deactivate(){this._reset(),this._isRunning=!1,i.log(`${this.constructor.name} is deactivated`)}_loop(){try{this._check(),this._isRunning&&window.requestAnimationFrame(this._loop.bind(this))}catch(e){i.error("Fatal: ",e),this.deactivate()}}_reset(){this._beforePausedTime=-1,s.rewindToPhraseStart&&void 0!==s.rewindToPhraseStart.beforeSeekingTime&&(s.rewindToPhraseStart.beforeSeekingTime=null)}_check(){const e=s.subtitles.find((e=>"en"===e.language));if(!e.active||"READY"!==e.state||!e.lines)return;const t=this._extensionPlayer.getCurrentTime();if(null===t)return;if(t-this._breakTime<this._beforePausedTime&&this._beforePausedTime<t+this._breakTime)return;if(s.rewindToPhraseStart&&s.rewindToPhraseStart.beforeSeekingTime&&t-this._breakTime<s.rewindToPhraseStart.beforeSeekingTime&&s.rewindToPhraseStart.beforeSeekingTime<t+this._breakTime)return;this._reset();e.lines.filter((e=>e.endOriginal-this._detectingTime<=t&&t<=e.endOriginal)).length>0&&(this._extensionPlayer.pause(),this._beforePausedTime=t)}}}},2190:(e,t,n)=>{const{APP_NAME:r}=n(2963);e.exports={PlaybackRateController:class{constructor(){this.keydownHandler=void 0,this.timer=void 0,this.name=`${r}-playback-rate`,this.minRate=.2,this.maxRate=2}activate(){this.keydownHandler||(this.keydownHandler=window.addEventListener("keydown",this._keyUpHandler.bind(this)))}deactivate(){this.keydownHandler&&(window.removeEventListener("keydown",this.keydownHandler),this.keydownHandler=null)}_keyUpHandler(e){if(e.ctrlKey||e.altKey||e.shiftKey||e.metaKey)return;if("4"!==e.key&&"6"!==e.key)return;const t=document.querySelector("video");if(!t)return;let n=t.playbackRate;"4"===e.key?n-=.1:"6"===e.key&&(n+=.1),n=Math.max(Math.min(n,this.maxRate),this.minRate),t.playbackRate=n;let r=document.querySelector(`#${this.name}`);r||(r=document.createElement("div"),r.id=this.name,r.style.position="absolute",r.style.top="10%",r.style.left="5%",r.style.fontSize="36px",r.style.fontFamily="sans-serif",r.style.fontWeight="800",r.style.color="white",r.style.display="flex",r.style.alignItems="center",r.style.zIndex=2,r.style.textShadow="#000 1px 1px 1px, #000 -1px 1px 1px, #000 1px -1px 1px, #000 -1px -1px 1px, #000 0px 0px 7px",t.parentElement.appendChild(r)),r&&(r.innerHTML=`<span>${n.toFixed(1)}倍速</span>`,this.timer&&clearTimeout(this.timer),r.style.transition="none",r.style.opacity="1",this.timer=setTimeout((()=>{r.style.transition="opacity 2.3s",r.style.opacity="0",this.timer=null}),200))}}}},216:(e,t,n)=>{const{ExtensionPlayer:r}=n(7057),{activateKeyboardShortCut:i}=n(6727),{Global:s}=n(5813);e.exports={RewindToPhraseStart:class{constructor(){this.extensionPlayer=new r,this.beforeSeekingTime=void 0,this.handler,this.GO_TO_PREVIOUS_DETECTION_MS=500}activate(){this.enableKeyboardShortcut()}seekAndPlay(e){this.extensionPlayer.seek(e),this.beforeSeekingTime=e,this.extensionPlayer.play()}rewindToPharseStartAndPlay(){const e=s.subtitles.find((e=>"en"===e.language));if(!e.active||"READY"!==e.state||!e.lines)return;const t=this.extensionPlayer.getCurrentTime();if(null===t)return;const n=e.lines.find((e=>e.beginOriginal<=t&&t<=e.endOriginal)),r=()=>{const n=e.lines.filter((e=>e.endOriginal<t)).reverse().find((e=>e));if(n){const e=n.beginOriginal;this.seekAndPlay(e)}};if(n){if(t-n.beginOriginal<=this.GO_TO_PREVIOUS_DETECTION_MS)r();else{const e=n.beginOriginal;this.seekAndPlay(e)}}else r()}seekToNextLineStartAndPlay(){const e=s.subtitles.find((e=>"en"===e.language));if(!e.active||"READY"!==e.state||!e.lines)return;const t=this.extensionPlayer.getCurrentTime();if(null===t)return;const n=e.lines.find((e=>e.beginOriginal<=t&&t<=e.endOriginal));let r;r=n?e.lines.find((e=>n.beginOriginal<e.beginOriginal)):e.lines.find((e=>t<e.beginOriginal)),r&&this.seekAndPlay(r.beginOriginal)}enableKeyboardShortcut(){this.deactivateKeyboardShortCutRewindToPharseStartAndPlay=i("n",(()=>{this.rewindToPharseStartAndPlay()})),this.deactivateKeyboardShortCutRewindToPharseStartAndPlay=i("a",(()=>{this.rewindToPharseStartAndPlay()})),this.deactivateKeyboardShortCutSeekToNextLineStartAndPlay=i("h",(()=>{this.seekToNextLineStartAndPlay()})),this.deactivateKeyboardShortCutSeekToNextLineStartAndPlay=i("d",(()=>{this.seekToNextLineStartAndPlay()}))}disableKeyboardShortcut(){this.deactivateKeyboardShortCutRewindToPharseStartAndPlay&&this.deactivateKeyboardShortCutRewindToPharseStartAndPlay(),this.deactivateKeyboardShortCutSeekToNextLineStartAndPlay&&this.deactivateKeyboardShortCutSeekToNextLineStartAndPlay()}}}},7314:(e,t,n)=>{const{Settings:r,SUBTITLE_TEXT_PRIMARY_CONTAINER_ID:i,SUBTITLE_TEXT_SECONDARY_CONTAINER_ID:s}=n(2963);e.exports={FontSizeController:class{constructor(){this._settings=new r,this._maxSize=4,this._minSize=1,this._step=.1}get minSize(){return this._minSize}get maxSize(){return this._maxSize}get step(){return this._step}makeBigger(){let e=this._settings.fontSize+this._step;return!!this.checkSize(e)&&(this._settings.fontSize=e,!0)}makeSmaller(){let e=this._settings.fontSize-this._step;return!!this.checkSize(e)&&(this._settings.fontSize=e,!0)}checkSize(e){return this.minSize<=e&&e<=this.maxSize}set fontSize(e){[i,s].forEach((t=>{const n=document.getElementById(t);e=parseFloat(e),n.style.fontSize=`${e}vw`,this._settings.fontSize=e}))}}}},6698:(e,t,n)=>{const{Settings:r,APP_NAME:i}=n(2963),{FontSizeController:s}=n(7314),{ExtensionPlayer:o}=n(7057),{GoogleLicenseController:a}=n(778),{sleep:l}=n(7413),{PhraseListViewer:c}=n(5675),{getMovieId:h,getIsInPlayerPage:u}=n(6727),{Global:d}=n(5813),{FavoritePhrasesViewer:f}=n(4865),{FavoritePhrasesBackUpController:p}=n(4269);e.exports={GUISettings:class{constructor(){this.targetElementSelector=".player-container",this.containerId=`${i}ExtensionSettingsContainer`,this.containerStyleId=`${i}ExtensionSettingsStyle`,this.settings=new r,this.fontSizeController=new s,this.extensionPlayer=new o,this.observer=void 0,this.backgroundColor="#000",this.textColor="#999",this.textInputColor="#99cc33",this.stripeContainerStyleId="stripe-popup-style",this.stripeContainerId="stripe-popup",this.CHECK_INTERVAL_MS=1e3,this.checkAvailableMessageOnThisVideo=null,this.googleLicenseController=new a,this.favoritePhrasesViewer=new f,this.favoritePhrasesBackUpController=new p}activate(){this._activateButton()}_activateButton(){this._findTargetElementAndSetGUI(),setInterval((()=>{this._findTargetElementAndSetGUI()}),this.CHECK_INTERVAL_MS)}_findTargetElementAndSetGUI(e){let t=document.querySelector(this.targetElementSelector);null!==t&&l(2e3).then((()=>{this.appendContainerStyleIfNotExists(),this.appendContainer(t)}))}appendContainerStyleIfNotExists(){if(document.querySelector(`#${this.containerStyleId}`))return;const e=document.createElement("style");e.setAttribute("id",this.containerStyleId),e.innerHTML=`\n        \n        #${this.containerId} .section{\n            margin: 0px 5px;\n        }\n        \n        #${this.containerId} #extensionRewindSeconds{\n            background-color: rgb(14, 14, 14);\n            color: rgb(153, 204, 51);\n            border: 0px;\n            margin: 5px;\n            text-align: center;\n        }\n        \n        #${this.containerId} #extensionFontSize{\n            border: 0;\n            margin: 5px;\n            text-align: center;\n            background-color: #0e0e0e;\n        }\n        \n        #${this.containerId} #autoRunDualSubtitleOn, #${this.containerId} #autoRunDualSubtitleOff{\n            display: inline-block;\n        }\n        \n        #${this.containerId} #isFixedEnglishSubtitleTop-on, #${this.containerId} #isFixedEnglishSubtitleTop-off{\n            display: inline-block;\n        }\n        \n        #${this.containerId} #popupDictionaryMode{\n            all: initial;\n            color: #fff;\n            background-color: rgb(14, 14, 14);\n            padding: 5px;\n            margin: 5px;\n        }\n        \n        #${this.containerId} #buttonOfStripeLicense,\n        #${this.containerId} #buttonOfPhraseListViewer,\n        #${this.containerId} #buttonOfFavoritePhrasesViewer,\n        #${this.containerId} #${i}ButtonOfFavoritePhrasesBackUp,\n        #${this.containerId} #${i}ButtonOfFavoritePhrasesRestore\n        {\n            color: rgb(51, 51, 51);\n            margin: 5px 5px;\n            opacity: 1;\n        }\n        \n        #${this.containerId} #${i}InputOfFavoritePhrasesRestore{\n            display: none;\n        }\n        \n        #${this.containerId} #${i}FavoritePhrasesBackupMessage{\n            color: #fff;\n        }\n        \n        #${this.containerId} #availableMessageOnThisVideo{\n            color: #f00;\n        }\n        \n        \n        `,document.head.appendChild(e)}appendContainer(e){if(document.querySelector(`#${this.containerId}`))return;const t=document.createElement("div");t.id=this.containerId,t.style.backgroundColor=this.backgroundColor,t.style.color=this.textColor,t.style.textAlign="center",t.style.fontSize="16px",t.innerHTML='\n            \n            <span>同時字幕の設定:</span>\n            \n            <span class="section">\n                <span>巻き戻し秒数</span>\n                <input id="extensionRewindSeconds" type="number">\n            </span>\n            \n            <span class="section">\n                <span>英語字幕の大きさ</span>\n                <input id="extensionFontSize" type="number">\n            </span>\n            \n            <span class="section">\n                クリック時の辞書\n                <select id="popupDictionaryMode"></select>\n            </span>\n            \n            <span class="section">\n                <span style="margin-left: 5px;">英語字幕の位置</span>\n                <input type="radio" id="isFixedEnglishSubtitleTop-on" name="isFixedEnglishSubtitleTop">\n                <label for="isFixedEnglishSubtitleTop-on">上</label>\n                <input type="radio" id="isFixedEnglishSubtitleTop-off" name="isFixedEnglishSubtitleTop">\n                <label for="isFixedEnglishSubtitleTop-off">下</label>\n            </span>\n            \n            <span class="section">\n                <label for="IsLowerCaseOfEnglish">英語字幕をすべて小文字にする</label>\n                <input style="display: inline-block" type="checkbox" id="IsLowerCaseOfEnglish">\n            </span>\n            \n            <br>\n            \n            <span class="section" id="buttonsOfFavoritePhrasesWrapper">\n                <button id="buttonOfFavoritePhrasesViewer">お気に入り一覧</button>\n            </span>\n            \n            <br>\n            \n            <button id="buttonOfPhraseListViewer">字幕一覧</button>\n            \n            <span class="section">\n                <span>同時字幕の有効化</span>\n                <input type="radio" id="autoRunDualSubtitleOn" name="autoRunDualSubtitle">\n                <label for="autoRunDualSubtitleOn">On</label>\n                <input type="radio" id="autoRunDualSubtitleOff" name="autoRunDualSubtitle">\n                <label for="autoRunDualSubtitleOff">Off</label>\n            </span>\n            \n            <button id="buttonOfStripeLicense">体験版の開始や製品版ライセンスのお支払い</button>\n        \n            <br>\n            \n            <div id="availableMessageOnThisVideo"></div>\n            \n            <a href="https://sites.google.com/view/niko-hulu-license" target="_blank" style="text-decoration: underline; color:#FFF;">同時字幕の体験版や製品版を開始するにはこちら</a>をご覧ください。\n            同時字幕はコントロールバーの設定アイコンをクリックして日本語と英語字幕の両方がグレーアウトしていない動画でご利用可能です。\n            同時字幕の有効化をOnにしていても、設定アイコンをクリックして字幕言語の日本語と英語のどちらかがグレーアウトしていると同時字幕ができませんのでご注意ください。\n            同じ映像でもタイトルに（字）又は（吹）が含まれている動画がありますので、その場合は（字）の動画を選択してください。字幕の方をデフォルトで開く設定にするには<a href="https://www.hulu.jp/settings" target="_blank" style="text-decoration: underline; color:#FFF;">こちら</a>から。\n            英語字幕の動画を検索するには<a href="https://www.hulu.jp/browse/editorial/13163" target="_blank" style="text-decoration: underline; color:#FFF;">海外ドラマを英語字幕で楽しむ</a>や<a href="https://www.hulu.jp/browse/editorial/13205" target="_blank" style="text-decoration: underline; color:#FFF;">洋画を英語字幕で楽しむ</a>などをご覧ください。\n            \n';let n=t.querySelector("#extensionRewindSeconds");n.value=this.settings.rewindSeconds.toFixed(),n.setAttribute("min",this.extensionPlayer.rewindMin),n.setAttribute("max",this.extensionPlayer.rewindMax),n.setAttribute("step",this.extensionPlayer.rewindStep),n.addEventListener("input",(e=>{if(""===n.value)return;let t=parseInt(n.value);isNaN(t)||(this.settings.rewindSeconds=t)}));let s=t.querySelector("#extensionFontSize");s.value=this.settings.fontSize.toFixed(1),s.setAttribute("min",this.fontSizeController.minSize),s.setAttribute("max",this.fontSizeController.maxSize),s.setAttribute("step",this.fontSizeController.step),s.style.color=this.textInputColor,s.addEventListener("input",(e=>{if(""===s.value)return;let t=parseFloat(s.value);isNaN(t)||(this.fontSizeController.fontSize=t)}));let o=t.querySelector("#autoRunDualSubtitleOn");o.value=!0;let a=t.querySelector("label[for='autoRunDualSubtitleOn']"),d=t.querySelector("#autoRunDualSubtitleOff");d.value=!1;let f=t.querySelector("label[for='autoRunDualSubtitleOff']");this.settings.isEnabledDualSubtitle?(o.checked=!0,a.style.color=this.textInputColor,f.style.color=""):(d.checked=!0,f.style.color=this.textInputColor,a.style.color=""),o.addEventListener("input",(e=>{o.checked&&(this.settings.isEnabledDualSubtitle=!0,a.style.color=this.textInputColor,f.style.color="")})),d.addEventListener("input",(e=>{d.checked&&(this.settings.isEnabledDualSubtitle=!1,f.style.color=this.textInputColor,a.style.color="")}));let p=t.querySelector("#isFixedEnglishSubtitleTop-on");p.value=!0;let g=t.querySelector("label[for='isFixedEnglishSubtitleTop-on']"),v=t.querySelector("#isFixedEnglishSubtitleTop-off");v.value=!0;let m=t.querySelector("label[for='isFixedEnglishSubtitleTop-off']");this.settings.isFixedEnglishSubtitleTop?(p.checked=!0,g.style.color=this.textInputColor,m.style.color=""):(v.checked=!0,m.style.color=this.textInputColor,g.style.color=""),p.addEventListener("input",(e=>{p.checked&&(this.settings.isFixedEnglishSubtitleTop=!0,g.style.color=this.textInputColor,m.style.color="")})),v.addEventListener("input",(e=>{v.checked&&(this.settings.isFixedEnglishSubtitleTop=!1,m.style.color=this.textInputColor,g.style.color="")}));t.querySelector("#buttonOfPhraseListViewer").addEventListener("click",(e=>{let t=c.getInstance();t.isActive&&t.showOrHide()}));t.querySelector("#buttonOfFavoritePhrasesViewer").addEventListener("click",(e=>{this.favoritePhrasesViewer.activateOrDeactivate()}));let y=t.querySelector("#buttonsOfFavoritePhrasesWrapper"),b=this.favoritePhrasesBackUpController.getFileInputEle();y.appendChild(b);const _=t.querySelector("#popupDictionaryMode"),w=(e,t,n)=>{let r=document.createElement("option");r.value=n,r.text=`${t}`,e.add(r,null)};w(_,"英辞郎 (英和辞典)",r.POPUP_DICTIONARY_MODE_alc),w(_,"Weblio (英和辞典)",r.POPUP_DICTIONARY_MODE_weblio),w(_,"ロングマン (英英辞典)",r.POPUP_DICTIONARY_MODE_longman),w(_,"オックスフォード (英英辞典)",r.POPUP_DICTIONARY_MODE_oxford),w(_,"ケンブリッジ (英英辞典)",r.POPUP_DICTIONARY_MODE_cambridge),w(_,"Google検索 (日本)",r.POPUP_DICTIONARY_MODE_googletextjajp),w(_,"Google検索 (アメリカ)",r.POPUP_DICTIONARY_MODE_googletextenus),w(_,"Google画像 (日本)",r.POPUP_DICTIONARY_MODE_googleimage),w(_,"Google画像 (アメリカ)",r.POPUP_DICTIONARY_MODE_googleimageenus),w(_,"Flickr画像",r.POPUP_DICTIONARY_MODE_flickr),w(_,"英辞郎ProLite (英和辞典)",r.POPUP_DICTIONARY_MODE_alcprolite),w(_,"英辞郎Pro (英和辞典)",r.POPUP_DICTIONARY_MODE_alcpro),w(_,"なし (無効化)",r.POPUP_DICTIONARY_MODE_none),_.value=this.settings.popupDictionaryMode,_.addEventListener("change",(()=>{this.settings.popupDictionaryMode=_.value}));const S=t.querySelector("#IsLowerCaseOfEnglish");S.checked=this.settings.isLowerCaseOfEnglish,S.addEventListener("change",(()=>{this.settings.isLowerCaseOfEnglish=S.checked}));if(t.querySelector("#buttonOfStripeLicense").addEventListener("click",(e=>{let t=document.getElementById(this.stripeContainerId);t?t.remove():(this.appendStripeContainerStyleIfNotExists(),this.appendStripeContainer())})),!this.checkAvailableMessageOnThisVideo){this.checkAvailableMessageOnThisVideo=!0;let e=()=>{if(u()){const e=h();if(e){let t=document.getElementById("availableMessageOnThisVideo");if(t){let n="";window[`__${i}PrimaryManifestList`].find((t=>t.movieId.toString()===e.toString()))?(n="",t.textContent=n):(n="この動画は日本語字幕と英語字幕の両方が存在しないため同時字幕ができません。",t.textContent=n)}}}};const t=()=>this.googleLicenseController.isSignedIn().then((t=>{if(t)e();else{let e=document.getElementById("availableMessageOnThisVideo");e&&(e.textContent="[体験版の開始や製品版ライセンスのお支払い]ボタンをクリックしてサインインしてください。")}})).catch((e=>{console.error(e)})),n=()=>{t().then((()=>l(2e3))).then((()=>{n()}))};this.googleLicenseController.appendGoogleScript().then((()=>{n()}))}e.insertAdjacentElement("afterend",t)}appendStripeContainerStyleIfNotExists(){if(document.getElementById(this.stripeContainerStyleId))return;const e=document.createElement("style");e.setAttribute("id",this.stripeContainerStyleId),e.innerHTML=`\n\n\n        .${this.stripeContainerId}SettingTitle{\n          font-weight: bolder;\n          margin: 20px 0px 0px;\n        }\n\n        .${this.stripeContainerId}Section{\n          padding-left: 20px;\n        }\n\n        #${this.stripeContainerId}Header{\n          display: flex; \n          font-size: 20px; \n          font-weight: bolder;\n        }\n\n        #${this.stripeContainerId}HeaderTitle{\n          flex-grow: 1;\n        }\n\n        #${this.stripeContainerId}HeaderClose{\n          cursor: pointer; white-space: nowrap;\n        }\n    \n        /* Scrollbar Width */\n        #${this.stripeContainerId} {\n            z-index: 999;\n            color: #FFF;\n            background-color: #262626;\n            position: fixed;\n            top: 10%;\n            right: 10%;\n            bottom: 10%;\n            left: 10%;\n\n            overflow-y: auto;\n            border-radius: 6px;\n            box-shadow: rgba(0, 0, 0, 0.12) 0px 1px 3px, rgba(0, 0, 0, 0.24) 0px 1px 2px;\n            padding: 20px;\n            font-size: 16px;\n            line-height: 2;\n            letter-spacing: 0.05em;\n        }\n\n        #${this.stripeContainerId} .button{\n          border-width: 0;\n          border-radius: 4px;\n          box-shadow: 0 1px 3px rgba(0,0,0,.12), 0 1px 2px rgba(0,0,0,.24);\n          text-align: center;\n          padding: 4px 0px;\n          margin: 5px;\n          display: block;\n          cursor: pointer;\n          background-color: #808080;\n          color: #fff;\n        }\n        #${this.stripeContainerId} .button:hover{\n          filter: brightness(90%);\n        }\n        #${this.stripeContainerId} .button:active{\n          filter: brightness(80%);\n        }\n\n        #${this.stripeContainerId} .btn-primary {\n          background-color: #007bff;\n        }\n\n        #${this.stripeContainerId} #gAuthStatus, #${this.stripeContainerId} #gLicenseStatus {\n            font-weight: bold;\n        }\n        \n        #${this.stripeContainerId} #messageOfThirdPartyCookie {\n          color: red;\n        }\n        \n        #${this.stripeContainerId} #messageOfThirdPartyCookie a{\n          color: red;\n          text-decoration: underline;\n        }\n        \n        #${a.googleSignInButtonId}{\n          display: flex;\n          align-items: center;\n          justify-content: center;\n          margin: 5px;\n        }\n        \n        #gAuthSignOutContainer{\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n        \n        #gAuthSignOut{\n          width: 400px;\n        }\n\n        `,document.head.appendChild(e)}appendStripeContainer(){let e=document.body;if(!e)return void console.error("doesn't exist the parent element to append the container of settings.");const t=document.createElement("div");t.id=this.stripeContainerId,t.innerHTML=`\n\n<div id="${this.stripeContainerId}Header">\n    <span id="${this.stripeContainerId}HeaderTitle">ライセンス</span>\n    <span id="${this.stripeContainerId}HeaderClose">閉じる</span>\n</div>\n\n<div class="${this.stripeContainerId}SettingTitle">体験版や製品版のライセンス</div>\n<div class="${this.stripeContainerId}Section">\n\n  <div>Googleアカウント：<span id="gAuthStatus"></span></div>\n  <div>ライセンスの状態：<span id="gLicenseStatus"></span></div>\n  <div id="${a.googleSignInButtonId}"></div>\n  <div id="gAuthSignOutContainer">\n        <span class="button" id="gAuthSignOut">サインアウト</span>\n  </div>\n  体験版の試用期間は3日間です。\n  体験版や製品版を開始するには【Googleでログイン】ボタンを押してユーザー認証をしてライセンスを更新してください。\n  ライセンスの更新後、反映させるにはページの更新をしてください。ライセンス認証ができない場合は\n  <a href="https://sites.google.com/view/niko-hulu-license#h.p_Dq70HLsbedi4" target="_blank" style="color: #fff; text-decoration: underline;">サードパーティーCookieを許可</a>、\n  <a href="https://sites.google.com/view/niko-hulu-license#h.p_Dq70HLsbedi4" target="_blank" style="color: #fff; text-decoration: underline;">広告ブロッカーを無効化</a>、\n  <a href="https://sites.google.com/view/niko-hulu-license#h.p_Dq70HLsbedi4" target="_blank" style="color: #fff; text-decoration: underline;">セキュリティソフトの許可リストにライセンスURLを追加</a>してください。\n</div>\n\n<div class="${this.stripeContainerId}SettingTitle">製品版ライセンスのお支払い方法</div>\n<div class="${this.stripeContainerId}Section">\n  <a href="https://niko-pay.appspot.com/ja/login" target="_blank" class="button btn-primary buttonOpenPaymentPage" >お支払いページ</a>\n  決済処理はStripe社が代行します。ご購入後は【Googleでログイン】ボタンをクリックしてユーザー認証してライセンスを更新してください。反映させるにはページの更新をしてください。\n</div>\n\n<div class="${this.stripeContainerId}SettingTitle">※ライセンスについて</div>\n<div class="${this.stripeContainerId}Section">\nライセンスの認証方法は<a href="https://sites.google.com/view/niko-hulu-license" target="_blank" style="color: #fff; text-decoration: underline;">こちらのページ</a>をご覧ください。\nライセンスの問題の解決方法は<a href="https://sites.google.com/view/niko-hulu-license#h.p_Dq70HLsbedi4" target="_blank" style="color: #fff; text-decoration: underline;">こちらのページ</a>をご覧ください。\n</div>\n\n      `,e.appendChild(t);t.querySelector(`#${this.stripeContainerId}HeaderClose`).addEventListener("click",(()=>{this.removeStripeContainer()}));const n=new a;let r;n.handleCredentialResponseBefore=()=>{r=n.getLicenseFromStorage()},n.handleCredentialResponseAfter=()=>{if(i(),s(),null===r||r&&"NONE"===r.accessLevel){let e=n.getLicenseFromStorage();!e||"FULL"!==e.accessLevel&&"FREE_TRIAL"!==e.accessLevel||(console.log("Reload current page to update the license"),location.reload())}},n.appendGoogleScript().then((()=>{n.initialize(),i(),s()}));let i=()=>{n.waitForGoogleSignInIsReady().then((()=>n.getUserName().then((e=>{document.getElementById("gAuthStatus")&&(document.getElementById("gAuthStatus").textContent=`${e}でサインインしています`)})).catch((e=>{document.getElementById("gAuthStatus")&&(document.getElementById("gAuthStatus").innerHTML="<span style='color: red;'>サインアウトしています</span>")}))))},s=()=>{n.getLicense().then((e=>{let t="なし";t="FULL"===e.accessLevel?"購入済み":"FREE_TRIAL"===e.accessLevel?"体験版":"体験版の期間が終了",document.getElementById("gLicenseStatus")&&(document.getElementById("gLicenseStatus").textContent=t)})).catch((e=>{console.error(e),document.getElementById("gLicenseStatus")&&(document.getElementById("gLicenseStatus").innerHTML="")}))};document.getElementById("gAuthSignOut").addEventListener("click",(()=>{n.waitForGoogleSignInIsReady().then((()=>n.revoke())).then((()=>{i()}))}));t.querySelectorAll(".buttonOpenPaymentPage").forEach((e=>{e.addEventListener("click",(()=>{this.settings.openPaymentPageEpochTime=Date.now()}))}))}removeStripeContainer(){document.getElementById(this.stripeContainerId).remove()}}}},778:(e,t,n)=>{const{_x:r,_o:i}=n(7413),{console:s}=n(2777),{Settings:o,APP_NAME:a}=n(2963),l=n(1396),c=n(6765).A;class h{constructor(){this.clientId="319573212273-qde0uf4dlccql9tgo5n3anjdkp0gilo9.apps.googleusercontent.com",this.checkLicenseURL="https://niko-pay.appspot.com/api/license?plan-name=hulu-monthly",this.googleScriptURL="https://accounts.google.com/gsi/client",this.licenseNoCheckTimeEpoch=864e5,this.licenseStorageName="HDSFLEL",this.settings=new o,this.forceUpdateDurationFromOpenPaymentPageEpochTime=864e5,this.googleSingInDataStorageName="HDSFLEGSID"}static get googleSignInButtonId(){return`${a}GoogleSignInButtonId`}appendGoogleScript(){return Promise.resolve().then((()=>{if(!document.querySelector(`script[src="${this.googleScriptURL}"]`)){let e=document.createElement("script");e.setAttribute("type","text/javascript"),e.setAttribute("src",this.googleScriptURL),(document.head||document.documentElement).appendChild(e)}return this.waitForGoogleSignInIsReady()}))}waitForGoogleSignInIsReady(){return new Promise(((e,t)=>{const n=(r=0)=>{const i=3e5;return window.google&&window.google.accounts&&window.google.accounts.id?(s.log("Google sign-in exists"),e()):i<r?t(new Error("Reached the timeout of loading google sign-in script. Waited 300000ms")):void setTimeout((()=>{n(r+=500)}),500)};return n()}))}initialize(){google.accounts.id.initialize({client_id:this.clientId,auto_select:!0,callback:e=>{this.handleCredentialResponseBefore();const t=e.credential;this.setGoogleSingInDataToStorage(t),this.updateLicense().then((()=>{this.handleCredentialResponseAfter()}))}}),google.accounts.id.renderButton(document.getElementById(h.googleSignInButtonId),{theme:"outline",size:"large",width:400,click_listener:()=>{s.log("Sign in with Google button clicked...")}}),google.accounts.id.prompt()}handleCredentialResponseBefore(){}handleCredentialResponseAfter(){}setGoogleSingInDataToStorage(e){const t=c(e);let n={};n.id=t.sub,n.name=t.name,n.email=t.email,n.token=e;let r=l.AES.encrypt(JSON.stringify(n),a).toString();window.localStorage.setItem(this.googleSingInDataStorageName,r)}getGoogleSingInDataFromStorage(){const e=window.localStorage.getItem(this.googleSingInDataStorageName);if(e)try{let t=l.AES.decrypt(e,a).toString(l.enc.Utf8),n=JSON.parse(t);return["id","name","email","token"].every((e=>e in n))||(s.warn("Lack of googleSingInData."),s.warn(n)),n}catch(e){return s.error(e),null}return null}removeGoogleSingInDataFromStorage(){window.localStorage.removeItem(this.googleSingInDataStorageName)}isSignedIn(){return new Promise(((e,t)=>e(!!window.localStorage.getItem(this.googleSingInDataStorageName))))}revoke(){return new Promise(((e,t)=>{let n=this.getGoogleSingInDataFromStorage();return n?(this.removeGoogleSingInDataFromStorage(),window.google&&window.google.accounts&&window.google.accounts.id?void window.google.accounts.id.revoke(n.id,(t=>t.successful?(s.log("Successful to sign out"),e(!0)):(s.log("Failed to sign out"),s.error(t.error),e(!1)))):t(new Error("Google sign-in doesn't exit"))):t(new Error("googleSingInData doesn't exist"))}))}getUserName(){return Promise.resolve().then((()=>{let e=this.getGoogleSingInDataFromStorage();if(!e)throw new Error("googleSingInData doesn't exist");return e.name}))}getLicenseOverHttp(){return s.log("Get the license over Https"),this._getLicenseOverHttpXHR()}_getLicenseOverHttpXHR(){return Promise.resolve().then((()=>{let e=this.getGoogleSingInDataFromStorage();if(!e)throw new Error("googleSingInData doesn't exist");return e})).then((e=>new Promise(((t,n)=>{s.log("Starting authenticated XHR...");let r=new XMLHttpRequest;r.open("POST",this.checkLicenseURL),r.setRequestHeader("Authorization","Bearer "+e.token),r.onload=()=>{const e=JSON.parse(r.responseText);return s.log(r.responseText),t(e)},r.onerror=()=>n(),r.send()}))))}_getLicenseOverHttpFetch(){return Promise.resolve().then((()=>{let e=this.getGoogleSingInDataFromStorage();if(!e)throw new Error("googleSingInData doesn't exist");return e})).then((e=>fetch(this.checkLicenseURL,{method:"POST",mode:"cors",headers:{Authorization:"Bearer "+e.token}}).then((e=>e.json()))))}getLicense(){let e=this.getLicenseFromStorage();return!e||this.isLicenseCacheExpired()?this.updateLicense():Promise.resolve(e)}updateLicense(){return this.getLicenseOverHttp().then((e=>(this.setLicenseToStorage(e),this.getLicenseFromStorage())))}getLicenseFromStorage(){const e=window.localStorage.getItem(this.licenseStorageName);if(e)try{return JSON.parse(r(e))}catch(e){return s.error(e),null}return null}setLicenseToStorage(e){let t={};t.accessLevel=e.accessLevel,t.updatedTimeEpoch=Date.now(),window.localStorage.setItem(this.licenseStorageName,i(JSON.stringify(t)))}isLicenseCacheExpired(){const e=this.getLicenseFromStorage();if(!e)return!0;const t=Date.now()-e.updatedTimeEpoch;if(t<0)return s.error("OSの時刻を正しく設定してください。"),!0;if(t>this.licenseNoCheckTimeEpoch)return!0;const n=Date.now()-this.settings.openPaymentPageEpochTime;return n<this.forceUpdateDurationFromOpenPaymentPageEpochTime&&(s.log(`License cache has expired because of the payment page has been recently opened. elapsedEpochTimeSincePaymentPageOpened:${n}`),!0)}}e.exports={GoogleLicenseController:h}},2963:(e,t,n)=>{const{console:r}=n(2777),i="HuluDualSubtitle",s=`${i}-bcc-settings-option`,o=`${i}EnglishWord`;class a{constructor(){this._STORAGE_KEY=`${i}Settings`,this._DEFAULT_SETTINGS={rewindSeconds:3,fontSize:2.5,isAutoDualSubtitle:!0,isEnglishSubtitleTop:!0,isLowerCaseOfEnglish:!1,isEnabledDualSubtitle:!0,isFixedEnglishSubtitleTop:!1,popupDictionaryMode:a.POPUP_DICTIONARY_MODE_alc,openPaymentPageEpochTime:0,isPhraseListViewer:!1,isEnabledDisplayOnlyFavoritePhrases:!1,displayOnlyFavoriteOption:a.DISPLAY_ONLY_FAVORITE_OPTION_IN_CURRENT_MOVIE,isEnabledStartSearchOrderByTimeOnCurrentMovie:!1,isEnabledHideLearningPhraseOnFavoritePhrases:!1,isEnabledHideNativePhraseOnFavoritePhrases:!1}}static get DISPLAY_ONLY_FAVORITE_OPTION_IN_CURRENT_MOVIE(){return"displayOnlyFavoriteOptionInCurrentMovie"}static get DISPLAY_ONLY_FAVORITE_OPTION_IN_OTHER_MOVIE(){return"displayOnlyFavoriteOptionInOtherMovie"}static get DISPLAY_ONLY_FAVORITE_OPTION_ALL(){return"displayOnlyFavoriteOptionALL"}static get POPUP_DICTIONARY_MODE_alc(){return"alc"}static get POPUP_DICTIONARY_MODE_alcprolite(){return"alcprolite"}static get POPUP_DICTIONARY_MODE_alcpro(){return"alcpro"}static get POPUP_DICTIONARY_MODE_weblio(){return"weblio"}static get POPUP_DICTIONARY_MODE_longman(){return"longman"}static get POPUP_DICTIONARY_MODE_oxford(){return"oxford"}static get POPUP_DICTIONARY_MODE_googleimage(){return"googleimage"}static get POPUP_DICTIONARY_MODE_googleimageenus(){return"googleimageenus"}static get POPUP_DICTIONARY_MODE_googletextenus(){return"googletextenus"}static get POPUP_DICTIONARY_MODE_googletextjajp(){return"googletextjajp"}static get POPUP_DICTIONARY_MODE_cambridge(){return"cambridge"}static get POPUP_DICTIONARY_MODE_flickr(){return"flickr"}static get POPUP_DICTIONARY_MODE_none(){return"none"}set rewindSeconds(e){this._setKeyValue("rewindSeconds",e)}get rewindSeconds(){let e=this._userSettings.rewindSeconds;return null===e&&(this.rewindSeconds=this._DEFAULT_SETTINGS.rewindSeconds,e=this._DEFAULT_SETTINGS.rewindSeconds),e}set fontSize(e){this._setKeyValue("fontSize",e)}get fontSize(){let e=this._userSettings.fontSize;return null===e&&(this.fontSize=this._DEFAULT_SETTINGS.fontSize,e=this._DEFAULT_SETTINGS.fontSize),e}set isAutoDualSubtitle(e){this._setKeyValue("isAutoDualSubtitle",e)}get isAutoDualSubtitle(){return this._userSettings.isAutoDualSubtitle}set isEnglishSubtitleTop(e){this._setKeyValue("isEnglishSubtitleTop",e)}get isEnglishSubtitleTop(){return this._userSettings.isEnglishSubtitleTop}set isFixedEnglishSubtitleTop(e){this._setKeyValue("isFixedEnglishSubtitleTop",e)}get isFixedEnglishSubtitleTop(){return this._userSettings.isFixedEnglishSubtitleTop}set isLowerCaseOfEnglish(e){this._setKeyValue("isLowerCaseOfEnglish",e)}get isLowerCaseOfEnglish(){return this._userSettings.isLowerCaseOfEnglish}set isEnabledDualSubtitle(e){this._setKeyValue("isEnabledDualSubtitle",e)}get isEnabledDualSubtitle(){return this._userSettings.isEnabledDualSubtitle}set popupDictionaryMode(e){this._setKeyValue("popupDictionaryMode",e)}get popupDictionaryMode(){return this._userSettings.popupDictionaryMode}set openPaymentPageEpochTime(e){this._setKeyValue("openPaymentPageEpochTime",e)}get openPaymentPageEpochTime(){return this._userSettings.openPaymentPageEpochTime}set isPhraseListViewer(e){this._setKeyValue("isPhraseListViewer",e)}get isPhraseListViewer(){return this._userSettings.isPhraseListViewer}set displayOnlyFavoriteOption(e){this._setKeyValue("displayOnlyFavoriteOption",e)}get displayOnlyFavoriteOption(){return this._userSettings.displayOnlyFavoriteOption}set isEnabledDisplayOnlyFavoritePhrases(e){this._setKeyValue("isEnabledDisplayOnlyFavoritePhrases",e)}get isEnabledDisplayOnlyFavoritePhrases(){return this._userSettings.isEnabledDisplayOnlyFavoritePhrases}set isEnabledStartSearchOrderByTimeOnCurrentMovie(e){this._setKeyValue("isEnabledStartSearchOrderByTimeOnCurrentMovie",e)}get isEnabledStartSearchOrderByTimeOnCurrentMovie(){return this._userSettings.isEnabledStartSearchOrderByTimeOnCurrentMovie}set isEnabledHideLearningPhraseOnFavoritePhrases(e){this._setKeyValue("isEnabledHideLearningPhraseOnFavoritePhrases",e)}get isEnabledHideLearningPhraseOnFavoritePhrases(){return this._userSettings.isEnabledHideLearningPhraseOnFavoritePhrases}set isEnabledHideNativePhraseOnFavoritePhrases(e){this._setKeyValue("isEnabledHideNativePhraseOnFavoritePhrases",e)}get isEnabledHideNativePhraseOnFavoritePhrases(){return this._userSettings.isEnabledHideNativePhraseOnFavoritePhrases}static set settings(e){this._settings=e}static get settings(){return void 0===this._settings?null:this._settings}set _userSettings(e){a.settings=e;let t=this._getStorage();null!==t?t[this._STORAGE_KEY]=JSON.stringify(e):r.warn("Couldn't save user settings")}get _userSettings(){if(null!==a.settings)return a.settings;let e,t=this._getStorage();if(null===t)return r.warn("Use default settings"),a.settings=this._resetSettings(),a.settings;const n=t.getItem(this._STORAGE_KEY);if(null===n)return a.settings=this._resetSettings(),a.settings;try{e=JSON.parse(n)}catch(e){return r.warn("JSON file of the user settings is broken. Reset user settings"),a.settings=this._resetSettings(),a.settings}if(!this._validateSettings(e)){r.warn("Failed to validate settings. Reset user settings");let t=Object.assign({},this._DEFAULT_SETTINGS);return e=Object.assign(t,e),a.settings=this._resetSettings(e),a.settings}return a.settings=e,a.settings}_getStorage(){return void 0===window.localStorage?null:window.localStorage}_setKeyValue(e,t){let n=this._userSettings;n[e]=t,this._userSettings=n}_resetSettings(e=this._DEFAULT_SETTINGS){let t=this._getStorage();return null!==t&&(t[this._STORAGE_KEY]=JSON.stringify(e)),e}_validateSettings(e){return Object.keys(this._DEFAULT_SETTINGS).every((t=>t in e))}}e.exports={Settings:a,APP_NAME:i,SUBTITLE_TEXT_PRIMARY_CONTAINER_ID:"extension-subtitle-text-primary-container",SUBTITLE_TEXT_SECONDARY_CONTAINER_ID:"extension-subtitle-text-secondary-container",SUBTITLE_HORIZON_IMAGE_CONTAINER_ID:"extension-subtitle-horizon-image-container",SUBTITLE_VERTICAL_IMAGE_CONTAINER_ID:"extension-subtitle-vertical-image-container",SUBTITLE_IMAGE_CLASS_NAME:"extension-image-subtitle",SUBTITLE_TEXT_CLASS_NAME:"extension-text-subtitle",DUAL_SUBTITLE_BUTTON_ID:s,ENGLISH_WORD_CLASS_NAME:o,CHROME_EXTENSION_ID:"lmmahellpnmhbpmimpebhikpjhiojhok"}},1010:(e,t,n)=>{const{Settings:r,ENGLISH_WORD_CLASS_NAME:i}=n(2963);e.exports={ClickableDictionary:class{constructor(){this.settings=new r,this.ENGLISH_WORD_CLASS_NAME=i}enableTextEle(e){e.querySelectorAll(`.${this.ENGLISH_WORD_CLASS_NAME}`).forEach((e=>{e.style.cursor="pointer",e.addEventListener("click",(()=>{let t=this.getDictionaryUrl(this.settings.popupDictionaryMode,e.textContent,!0);t&&window.open(t,"_new")}))}))}getDictionaryUrl(e,t,n=!0){let i=n?null:`https://eow.alc.co.jp/search?q=${t}#main`;if(e)switch(e){case r.POPUP_DICTIONARY_MODE_alc:i=`https://eow.alc.co.jp/search?q=${t}#main`;break;case r.POPUP_DICTIONARY_MODE_alcprolite:i=`https://eowf.alc.co.jp/search?q=${t}`;break;case r.POPUP_DICTIONARY_MODE_alcpro:i=`https://eowp.alc.co.jp/search?q=${t}`;break;case r.POPUP_DICTIONARY_MODE_weblio:i=`https://ejje.weblio.jp/content_find?searchType=exact&query=${t}#main`;break;case r.POPUP_DICTIONARY_MODE_longman:i=`https://www.ldoceonline.com/jp/search/english/direct/?q=${t}`;break;case r.POPUP_DICTIONARY_MODE_oxford:i=`https://www.oxfordlearnersdictionaries.com/search/english/?q=${t}#main_column`;break;case r.POPUP_DICTIONARY_MODE_googleimage:i=`https://www.google.co.jp/search?tbm=isch&hl=ja&gl=jp&q="${t}"`;break;case r.POPUP_DICTIONARY_MODE_googleimageenus:i=`https://www.google.com/search?tbm=isch&hl=en&gl=us&q="${t}"`;break;case r.POPUP_DICTIONARY_MODE_googletextenus:i=`https://www.google.com/search?hl=en&gl=us&q="${t}"`;break;case r.POPUP_DICTIONARY_MODE_googletextjajp:i=`https://www.google.co.jp/search?hl=ja&gl=jp&q="${t}"`;break;case r.POPUP_DICTIONARY_MODE_cambridge:i=`https://dictionary.cambridge.org/search/english/direct/?q=${t}`;break;case r.POPUP_DICTIONARY_MODE_flickr:i=`https://www.flickr.com/search/?text=${t}`;case r.POPUP_DICTIONARY_MODE_none:}return i}}}},4506:(e,t,n)=>{const{FavoritePhrasesController:r}=n(9323),{ENGLISH_WORD_CLASS_NAME:i}=n(2963),{console:s}=n(2777);class o{constructor(){this.favoritePhrasesController=new r}static get CLASS_NAME_HIGHLIGHT_FAVORITE_WORD_IN_ORIGINAL_LINE(){return"highLightFavoriteWordInOriginalLine"}static get CLASS_NAME_HIGHLIGHT_FAVORITE_PHRASE_IN_ORIGINAL_LINE(){return"highLightFavoritePhraseInOriginalLine"}static get CLASS_NAME_HIGHLIGHT_FAVORITE_WORD_IN_CURRENT_MOVIE(){return"highLightFavoriteWordInCurrentMovie"}static get CLASS_NAME_HIGHLIGHT_FAVORITE_WORD_IN_OTHER_MOVIES(){return"highLightFavoriteWordInOtherMovies"}static get EVENT_DELETED(){return"deleted"}static get EVENT_ADDED(){return"added"}addHighLightOnSubtitle(e,t){if(e.length>0){let n=e.map((e=>this.favoritePhrasesController.getWordsWithLineAsync(e)));Promise.all(n).then((e=>{e.forEach((e=>{e.forEach((e=>{this._updateHighlightToWords(t,e,o.EVENT_ADDED,o.CLASS_NAME_HIGHLIGHT_FAVORITE_WORD_IN_ORIGINAL_LINE)}))}))}))}}addHighLightEventListener(e){e.classList.add(r.ON_UPDATED_FAVORITE_PHRASES),e.addEventListener(r.ON_UPDATED_FAVORITE_PHRASES,(t=>{if(t.detail.favoritePhrase.englishWord){let n=t.detail.favoritePhrase.englishWord,r=t.detail.status;this._updateHighlightToWords(e,n,r,o.CLASS_NAME_HIGHLIGHT_FAVORITE_WORD_IN_ORIGINAL_LINE)}}))}addHighLight(e,t){this._updateHighLight(e,t,o.EVENT_ADDED)}removeHighLight(e,t){this._updateHighLight(e,t,o.EVENT_DELETED)}updateHighLightAllFavoriteWordsPhrasesInTheMovieAsync(e){return this.favoritePhrasesController.getAllFavoritePhraseInCurrentMovie().then((t=>{t.forEach((t=>{this.addHighLight(e,t)}))}))}updateHighLightAllFavoriteWordsAsync(e){return this.favoritePhrasesController.getAllFavoriteWordsDictAsync().then((({wordsInCurrentMovie:t,wordsInOtherMovie:n})=>{e.querySelectorAll(`.${i}`).forEach((e=>{if(!e.textContent)return;let r=e.textContent.toLowerCase();t.includes(r)&&e.classList.add(o.CLASS_NAME_HIGHLIGHT_FAVORITE_WORD_IN_CURRENT_MOVIE),n.includes(r)&&e.classList.add(o.CLASS_NAME_HIGHLIGHT_FAVORITE_WORD_IN_OTHER_MOVIES)}))}))}updatePartialHighLight(e,t){t.status===o.EVENT_ADDED&&this.addHighLight(e,t.favoritePhrase),t.status===o.EVENT_DELETED&&this.removeHighLight(e,t.favoritePhrase)}_updateHighlightToWords(e,t,n,r){Array.from(e.querySelectorAll(`.${i}`)).filter((e=>e.textContent&&t&&e.textContent.toLowerCase()===t.toLowerCase())).forEach((e=>{n===o.EVENT_ADDED&&e.classList.add(r),n===o.EVENT_DELETED&&e.classList.remove(r)}))}_updateHighLight(e,t,n){let r=`${t.beginMs}${t.endMs}`;const i=e.querySelector(`.row[beginEndId="${r}"]`);if(!i)return void s.error(`Failed updateHighLight watchId:${t.watchId} beginSecond:${t.beginMs} endSecond:${t.endMs}`);const a=t.englishWord;if(!a){const e=i.querySelector(".favoriteButton svg");return n===o.EVENT_ADDED&&e.classList.add(o.CLASS_NAME_HIGHLIGHT_FAVORITE_PHRASE_IN_ORIGINAL_LINE),void(n===o.EVENT_DELETED&&e.classList.remove(o.CLASS_NAME_HIGHLIGHT_FAVORITE_PHRASE_IN_ORIGINAL_LINE))}this._updateHighlightToWords(i,a,n,o.CLASS_NAME_HIGHLIGHT_FAVORITE_WORD_IN_ORIGINAL_LINE),this._updateHighlightToWords(e,a,n,o.CLASS_NAME_HIGHLIGHT_FAVORITE_WORD_IN_CURRENT_MOVIE)}}e.exports={HighLightController:o}},5675:(e,t,n)=>{const{Global:r}=n(5813),{APP_NAME:i,Settings:s,ENGLISH_WORD_CLASS_NAME:o}=n(2963),{querySelectorOfFirstMatch:a,getIsInPlayerPage:l,getManifestInUrl:c}=n(6727),{TextEditor:h}=n(7210),{ExtensionPlayer:u}=n(7057),{SubtitleTextExtractor:d}=n(5707),{ClickableDictionary:f}=n(1010),{PopupDictionary:p}=n(7508),{PopupPhrases:g}=n(1080),{HighLightController:v}=n(4506),{FavoritePhrasesController:m}=n(9323),{ThumbnailManager:y}=n(5164);let b;class _{constructor(){this.CSS_ID=`${i}PhraseListViewerCSS`,this.CSS_ID_SHOW=`${i}PhraseListViewerCSSShow`,this.CSS_ID_HIDDEN=`${i}PhraseListViewerCSSHidden`,this.CONTAINER_ID=`${i}PhraseListViewerContainer`,this.HEADER_ID=`${this.CONTAINER_ID}Header`,this.renderElem=document.createElement("div"),this.renderElem.id=this.CONTAINER_ID,this.PARENT_ELEM_SELECTORS=[".player-container"],this.settings=new s,this.textEditor=new h,this.extensionPlayer=new u,this.subtitleTextExtractor=new d,this.clickableDictionary=new f,this.highLightController=new v,this.favoritePhrasesController=new m,this.lastMouseleavedTimeMS=0,this.isMouseOn=!1,this.renderElem.addEventListener("mouseenter",(()=>{this.isMouseOn=!0})),this.renderElem.addEventListener("mouseleave",(()=>{this.isMouseOn=!1,this.lastMouseleavedTimeMS=Date.now()})),this.renderElem.classList.add(m.ON_UPDATED_FAVORITE_PHRASES),this.renderElem.addEventListener(m.ON_UPDATED_FAVORITE_PHRASES,(e=>{this.highLightController.updatePartialHighLight(this.renderElem,e.detail),this.updateDisplayOnlyFavoritePhrases()})),this.parentElem}static get CLASS_NAME_POPUP_IN_PHRASE_LIST_VIEWER(){return"popupInPhraseListViewer"}static getInstance(){return b||(b=new _),b}activate(){this.appendCssIfNotExist(),this.checkLoop(),this.active=!0}deactivate(){this.active=!1}get isActive(){return this.active}checkLoop(){setTimeout((()=>{try{if(!this.active)return;if(l()){let{state:e,sub:t}=this.getSubtitle();"NEW"===e?this.settings.isPhraseListViewer?(this.sub=t,this.render(),this.show()):this.hide():"SAME"===e?this.settings.isPhraseListViewer?this.show():this.hide():"NONE"===e&&(this.sub=null,this.renderElem.innerHTML="",this.hide())}else this.sub=null,this.renderElem.innerHTML="",this.hide()}catch(e){console.error(e)}this.checkLoop()}),1e3)}getSubtitle(){let e=r.subtitles.find((e=>"READY"===e.state&&e.lines&&"en"===e.language));if(!e)return{state:"NONE",sub:e};if(l()){const t=c();if(t&&e.movieId){if(!(e.movieId.toString()===t.toString()))return{state:"NONE",sub:e}}}return this.sub&&this.sub.equals(e)?{state:"SAME",sub:e}:{state:"NEW",sub:e}}render(){this.popupPhrases=new g(this.sub.lines),this.renderElem.innerHTML="";let e=document.createDocumentFragment(),t=document.createElement("div");t.innerHTML=`\n        <svg role="presentation" aria-hidden="true" xmlns="http://www.w3.org/2000/svg" style="height: 0px; width: 0px; position: absolute;">\n            <defs>\n                <symbol id="${i}SvgPlay" viewBox="0 0 64 64"><path d="M32 38L20 44L20 32L20 20L32 26L44 32L32 38Z"></path></symbol>\n            </defs>\n            <defs>\n                <symbol id="${i}SvgFavoritePhrase" viewBox="0 0 64 64"><path d="M36.94 26.53L48 28.22L40 36.42L41.89 48L32 42.53L22.11 48L24 36.42L16 28.22L27.06 26.53L32 16L36.94 26.53Z"></path></symbol>\n            </defs>\n        </svg>\n        `,e.appendChild(t),this.sub.lines.forEach((t=>{let n=document.createElement("div"),r=`${t.beginOriginal}${t.endOriginal}`;n.setAttribute("beginEndId",r),n.classList.add("row"),n.setAttribute("lineId",t.id);let s=this.textEditor.editLearningSubtitleOnPhraseList(t,this.sub.language);n.innerHTML=`\n            <div class="playButton">\n              <svg focusable="false">\n                <use filter="" xlink:href="#${i}SvgPlay"></use>\n              </svg>\n            </div>\n            <div class="phrase">${s}</div>\n            <div class="favoriteButton">\n              <svg focusable="false">\n                <use filter="" xlink:href="#${i}SvgFavoritePhrase"></use>\n              </svg>\n            </div>\n          `,n.querySelector(".playButton").addEventListener("click",(()=>{this.extensionPlayer.seek(t.beginOriginal),this.extensionPlayer.play()})),n.querySelector(".playButton").addEventListener("mouseenter",(e=>{this.showNativePhrase(t,n)})),n.querySelector(".playButton").addEventListener("mouseleave",(()=>{this.deleteNativePhrase()})),n.querySelector(".favoriteButton").addEventListener("click",(e=>{this.favoritePhrasesController.addOrDeleteAsync(t,null)})),e.appendChild(n)})),"none"!==this.settings.popupDictionaryMode&&this.clickableDictionary.enableTextEle(e),p.activatePopupDictionaryOnPhraseListViewer(e),this.popupPhrases.activatePopupPhrasesOnPhraseListViewer(e),Promise.resolve().then((()=>this.highLightController.updateHighLightAllFavoriteWordsPhrasesInTheMovieAsync(e))).then((()=>this.highLightController.updateHighLightAllFavoriteWordsAsync(e))).catch((e=>{e.message+="Failed to highlight",console.error(e)})).then((()=>{this.renderElem.appendChild(e),this.renderElem.insertBefore(this.createHeader(),this.renderElem.firstChild),this.resetScroll()}))}enableDisplayOnlyFavoritePhrases(){this.renderElem.querySelectorAll(".row").forEach((e=>{let t=`.${v.CLASS_NAME_HIGHLIGHT_FAVORITE_WORD_IN_ORIGINAL_LINE}, .${v.CLASS_NAME_HIGHLIGHT_FAVORITE_PHRASE_IN_ORIGINAL_LINE}`;switch(this.settings.displayOnlyFavoriteOption){case s.DISPLAY_ONLY_FAVORITE_OPTION_IN_CURRENT_MOVIE:t=`.${v.CLASS_NAME_HIGHLIGHT_FAVORITE_WORD_IN_ORIGINAL_LINE}, .${v.CLASS_NAME_HIGHLIGHT_FAVORITE_PHRASE_IN_ORIGINAL_LINE}`;break;case s.DISPLAY_ONLY_FAVORITE_OPTION_IN_OTHER_MOVIE:t=`.${v.CLASS_NAME_HIGHLIGHT_FAVORITE_WORD_IN_OTHER_MOVIES}`;break;case s.DISPLAY_ONLY_FAVORITE_OPTION_ALL:t=`.${v.CLASS_NAME_HIGHLIGHT_FAVORITE_WORD_IN_ORIGINAL_LINE}, .${v.CLASS_NAME_HIGHLIGHT_FAVORITE_PHRASE_IN_ORIGINAL_LINE}, .${v.CLASS_NAME_HIGHLIGHT_FAVORITE_WORD_IN_OTHER_MOVIES}`}e.querySelector(t)?e.classList.remove("hideRow"):e.classList.add("hideRow")}))}disableDisplayOnlyFavoritePhrases(){this.renderElem.querySelectorAll(".hideRow").forEach((e=>{e.classList.remove("hideRow")}))}updateDisplayOnlyFavoritePhrases(){this.settings.isEnabledDisplayOnlyFavoritePhrases?this.enableDisplayOnlyFavoritePhrases():this.disableDisplayOnlyFavoritePhrases()}createHeader(){let e=document.createElement("div");e.id=this.HEADER_ID,e.innerHTML=`\n      <select id="${this.CONTAINER_ID}DisplayOnlyFavoriteOption">\n          <option value="${s.DISPLAY_ONLY_FAVORITE_OPTION_IN_CURRENT_MOVIE}">この動画内の</option>\n          <option value="${s.DISPLAY_ONLY_FAVORITE_OPTION_IN_OTHER_MOVIE}">この動画外の</option>\n          <option value="${s.DISPLAY_ONLY_FAVORITE_OPTION_ALL}">すべての</option>\n      </select>\n      <label for="${this.CONTAINER_ID}IsEnabledDisplayOnlyFavoritePhrases">お気に入りのみ表示</label>\n      <input type="checkbox" id="${this.CONTAINER_ID}IsEnabledDisplayOnlyFavoritePhrases">\n    `;const t=e.querySelector(`#${this.CONTAINER_ID}IsEnabledDisplayOnlyFavoritePhrases`);t.checked=this.settings.isEnabledDisplayOnlyFavoritePhrases;const n=e.querySelector(`#${this.CONTAINER_ID}DisplayOnlyFavoriteOption`);return n.value=this.settings.displayOnlyFavoriteOption,this.updateDisplayOnlyFavoritePhrases(),n.addEventListener("change",(()=>{this.settings.displayOnlyFavoriteOption=n.value,this.updateDisplayOnlyFavoritePhrases()})),t.addEventListener("change",(()=>{this.settings.isEnabledDisplayOnlyFavoritePhrases=t.checked,this.updateDisplayOnlyFavoritePhrases()})),e}showNativePhrase(e,t){let n=document.createElement("div");n.classList.add(_.CLASS_NAME_POPUP_IN_PHRASE_LIST_VIEWER),n.style.right=window.innerWidth-t.getBoundingClientRect().left+"px",n.style.top=`${t.getBoundingClientRect().top}px`;let r=this.getJapaneseEle(e);r&&n.appendChild(r);let i=this.getImageEle(e);i&&n.appendChild(i),this.parentElem.appendChild(n)}deleteNativePhrase(){this.parentElem.querySelectorAll(`.${_.CLASS_NAME_POPUP_IN_PHRASE_LIST_VIEWER}`).forEach((e=>{e.remove()}))}getJapaneseEle(e){let t=this.subtitleTextExtractor.getJapaneseText(e);if(!t)return null;let n=document.createElement("div");return n.classList.add("nativePhrase"),n.innerHTML=t,n}getImageEle(e){let t=parseInt((e.endOriginal-e.beginOriginal)/2)+e.beginOriginal;let n=y.createOrGet().getImageElement(t/1e3);return n?(n.classList.add("thumbnail"),n):null}showOrHide(){this.isShowing()?(this.settings.isPhraseListViewer=!1,this.hide()):(this.settings.isPhraseListViewer=!0,this.show())}isShowing(){return!!document.getElementById(this.CSS_ID_SHOW)}show(){if(!this.active)throw new Error("PhraseListViewer is not active");if(document.getElementById(this.CONTAINER_ID)||(this.parentElem=a(this.PARENT_ELEM_SELECTORS),this.parentElem&&this.parentElem.appendChild(this.renderElem)),this.startSyncPhraseList(),this.isShowing())return;let e=document.getElementById(this.CSS_ID_HIDDEN);e&&e.remove();let t=document.getElementById(this.CSS_ID_SHOW);t||(t=document.createElement("style"),t.id=this.CSS_ID_SHOW,t.innerHTML=`\n    \n    #${this.CONTAINER_ID}{\n        visibility: visible;\n    }\n    \n    .player-container{\n        display:flex;\n    }\n    \n    .player-width {\n        flex: 1;\n    }\n    \n    .watch .player-container .player-width {\n        min-width: initial !important;\n        max-width: initial !important;\n        width: initial !important;\n    }\n    `,document.head.appendChild(t))}hide(){if(this.stopSyncPhraseList(),!this.isShowing())return;let e=document.getElementById(this.CSS_ID_SHOW);e&&e.remove();let t=document.getElementById(this.CSS_ID_HIDDEN);t||(t=document.createElement("style"),t.id=this.CSS_ID_HIDDEN,t.innerHTML=`\n    \n    #${this.CONTAINER_ID}{\n        visibility: hidden;\n    }\n    \n    `,document.head.appendChild(t))}startSyncPhraseList(){this.syncPhraseListIntervalId||(this.syncPhraseListIntervalId=setInterval((()=>{this.sub&&this.sub.lines&&this.renderElem.hasChildNodes()&&(this.focus(),this.canScroll()&&this.scroll())}),100))}stopSyncPhraseList(){this.syncPhraseListIntervalId&&clearInterval(this.syncPhraseListIntervalId),this.syncPhraseListIntervalId=null}focus(){let e=this.getCurrentLine();if(!e)return;if(e.classList.contains("focus"))return;let t=document.getElementById(this.CONTAINER_ID).querySelectorAll(".focus");t&&t.forEach((e=>e.classList.remove("focus"))),e.classList.add("focus")}canScroll(){if(this.isMouseOn)return!1;if(this.extensionPlayer.getPaused())return!1;return!(Date.now()-this.lastMouseleavedTimeMS<3e3)}scroll(){let e=this.getCurrentLine();if(!e)return;let t=document.getElementById(this.CONTAINER_ID);let n=e.offsetTop-150,r=e.getBoundingClientRect();150<=r.top&&r.top<t.offsetHeight-150||t.scroll({top:n,behavior:"auto"})}resetScroll(){let e=document.getElementById(this.CONTAINER_ID);e&&e.scroll({top:0,behavior:"auto"})}getCurrentLine(){let e=document.getElementById(this.CONTAINER_ID),t=this.extensionPlayer.getCurrentTime();const n=this.sub.lines.find((e=>e.beginOriginal<=t&&t<=e.endOriginal));if(!n)return null;let r=n.id;return e.querySelector(`[lineId="${r}"]`)}appendCssIfNotExist(){let e=document.getElementById(this.CSS_ID);e||(e=document.createElement("style"),e.id=this.CSS_ID,e.innerHTML=`\n    \n    #${this.CONTAINER_ID}::-webkit-scrollbar {\n      width: 16px;\n    }\n     \n    #${this.CONTAINER_ID}::-webkit-scrollbar-track {\n      background-color: #202020;\n      box-shadow: inset 0 0 6px rgba(0,0,0,0.5);\n    }\n     \n    #${this.CONTAINER_ID}::-webkit-scrollbar-thumb {\n      min-height: 30px;\n      border: 2px solid;\n      border-radius: 4px;\n      border-color: #202020;\n      background-color: #fff;\n      box-shadow: inset 0 0 6px rgba(0,0,0,0.5);\n    }\n    \n    #${this.CONTAINER_ID}{\n        font-size: 16px;\n        color: #F1F1F1;\n        background: #262626;\n        user-select: text;\n        overflow-y: scroll;\n        flex-basis: 400px;\n    }\n    \n    #${this.CONTAINER_ID} .focus{\n      background: rgba(255, 255, 255, 0.2);\n    }\n    \n    #${this.CONTAINER_ID} .row{\n      border-bottom: 1px groove rgba(0, 0, 0, 1);\n      display: flex;\n    }\n    \n    #${this.CONTAINER_ID} .playButton, #${this.CONTAINER_ID} .favoriteButton{\n      user-select: none;\n      line-height: 0;\n    }\n    \n    #${this.CONTAINER_ID} .playButton{\n      padding: 5px 10px 4px;\n    }\n    \n    #${this.CONTAINER_ID} .favoriteButton{\n      padding: 5px 5px 4px;\n    }\n    \n    #${this.CONTAINER_ID} .playButton:hover, #${this.CONTAINER_ID} .favoriteButton:hover{\n      cursor: pointer;\n      background: rgba(255, 255, 255, 0.2);\n    }\n    \n    #${this.CONTAINER_ID} .playButton:hover svg, #${this.CONTAINER_ID} .favoriteButton:hover svg{\n      fill: #FFF;\n      opacity: 0.8;\n    }\n    \n    #${this.CONTAINER_ID} .playButton svg, #${this.CONTAINER_ID} .favoriteButton svg{\n      width: 20px;\n      height: 20px;\n      opacity: 0.2;\n      fill: #FFF;\n    }\n    \n    #${this.CONTAINER_ID} .favoriteButton svg.${v.CLASS_NAME_HIGHLIGHT_FAVORITE_PHRASE_IN_ORIGINAL_LINE}{\n      fill: #FF0 !important;\n      opacity: 0.8 !important;\n    }\n    \n    #${this.CONTAINER_ID} .phrase{\n      padding: 5px;\n      flex-grow: 1;\n      font-family: Arial, Helvetica;\n    }\n    \n    #${this.CONTAINER_ID} .phrase .${o}.${v.CLASS_NAME_HIGHLIGHT_FAVORITE_WORD_IN_ORIGINAL_LINE}{\n      background-color: rgba(255, 255, 0, 0.25);\n      font-weight: bolder;\n      text-decoration-line: underline;\n    }\n    \n    #${this.CONTAINER_ID} .phrase .${o}.${v.CLASS_NAME_HIGHLIGHT_FAVORITE_WORD_IN_CURRENT_MOVIE}{\n      font-weight: bolder;\n      text-decoration-line: underline;\n    }\n    \n    #${this.CONTAINER_ID} .phrase .${o}.${v.CLASS_NAME_HIGHLIGHT_FAVORITE_WORD_IN_OTHER_MOVIES}{\n      text-decoration-line: underline;\n    }\n    \n    .${_.CLASS_NAME_POPUP_IN_PHRASE_LIST_VIEWER}{\n      font-size: 16px;\n      border-radius: 2px;\n      position: fixed;\n      z-index: 20;\n    }\n    \n    .${_.CLASS_NAME_POPUP_IN_PHRASE_LIST_VIEWER} .nativePhrase{\n      text-align: right;\n      padding: 5px;\n      background-color: rgba(0,0,0,0.8);\n      color: #f9f9f9;\n    }\n    \n    .${_.CLASS_NAME_POPUP_IN_PHRASE_LIST_VIEWER} .thumbnail{\n      margin-left: auto;\n      margin-right: 0;\n    }\n    \n    #${this.HEADER_ID}{\n      position: sticky;\n      z-index: 10;\n      top: 0px;\n      background-color: rgba(0, 0, 0, 1.0);\n      box-shadow: rgba(0, 0, 0, 0.12) 0px 4px 4px, rgba(0, 0, 0, 0.24) 0px 2px 2px;\n      padding: 5px;\n      user-select: none;\n      font-size: 14px;\n      text-align: center;\n    }\n    \n    #${this.HEADER_ID} select{\n      all: unset;\n      width: 8em;\n      border: none;\n      background: transparent;\n      margin: 0 5px 0 0;\n      appearance: auto;\n    }\n    \n    #${this.HEADER_ID} select option{\n      background-color: black;\n    }\n    \n    #${this.HEADER_ID} label{\n      margin: 0 0 0 5px;\n      cursor: pointer;\n    }\n    \n    #${this.HEADER_ID} input{\n      display: inline-block;\n      margin: 0 5px;\n      cursor: pointer;\n    }\n    \n    #${this.CONTAINER_ID} .hideRow{\n      display: none;\n    }\n    \n    `,document.head.appendChild(e))}}e.exports={PhraseListViewer:_}},7508:(e,t,n)=>{const{APP_NAME:r,ENGLISH_WORD_CLASS_NAME:i,CHROME_EXTENSION_ID:s}=n(2963),{querySelectorOfFirstMatch:o}=n(6727),a=`${r}PopupDictionaryContainer`;class l{static activatePopupDictionaryOnPhraseListViewer(e){l.activatePopupDictionary(e,101,["video"],!1,"absolute")}static activatePopupDictionaryOnFavoritePhrases(e){l.activatePopupDictionary(e,1010,["body"],!1,"fixed")}static activatePopupDictionaryOnSubtitle(e){l.activatePopupDictionary(e,101,["video"],!0,"absolute")}static activatePopupDictionary(e,t,n,r,i){l.addPostMessageToWords(e,t,n,r,i),l.activatePopupDictionaryRemover(e)}static addPostMessageToWords(e,t,n,r,o){[].forEach.call(e.querySelectorAll(`.${i}`),(e=>{e.addEventListener("mouseenter",(e=>{l.isMouseHoveringOfLearningWord=!0,l.childSelectorsOfContainer=n,l.zIndex=t,l.position=o,l.isActivatedPopupDictionaryRemover=r;let a=[...e.target.parentElement.childNodes].findIndex((t=>t===e.target)),c=[...e.target.parentElement.childNodes].filter(((e,t)=>a<=t));let h=0,u="";for(let e=0;e<c.length&&(c[e].classList&&c[e].classList.contains(i)&&h++,c[e].nodeName&&"br"===c[e].nodeName.toLowerCase()?u+=" ":u+=c[e].textContent,!(3<=h));e++);chrome.runtime.sendMessage(s,{englishWord:u},(e=>{if(!l.isMouseHoveringOfLearningWord)return;let t=e.englishJapaneseDictArray;if(t){if(0===t.length)return;let e=l.editPopupDictionary(t);l.showPopupDictionary(e)}}))})),e.addEventListener("mouseleave",(e=>{l.isMouseHoveringOfLearningWord=!1,l.isActivatedPopupDictionaryRemover=!0;const t=document.getElementById(a);t&&t.remove()}))}))}static editPopupDictionary(e){return e.map((e=>{let t="";return t+=`<strong>${e.englishWord}</strong><br>`,t+=e.japaneseDescription+"<br>",t})).join('<div style="border-bottom: 1px solid rgba(255, 255, 255, 0.25); margin: 5px 0;"></div>')}static showPopupDictionary(e){let t=document.getElementById(a);if(!t){t=l.createPopupDictionaryContainer();const e=o(l.childSelectorsOfContainer);if(!e)return null;e.parentElement.appendChild(t)}return t.innerHTML=e,t}static createPopupDictionaryContainer(){const e=document.createElement("div");return e.id=a,Object.assign(e.style,{position:l.position,display:"block",top:"0px",right:"0px",width:"300px",padding:"10px",margin:"10px",lineHeight:"2.0",backgroundColor:"rgba(0,0,0,0.8)",color:"#f9f9f9",borderRadius:"4px",fontSize:"16px",zIndex:l.zIndex,userSelect:"text"}),e}static activatePopupDictionaryRemover(e){const t=new MutationObserver((e=>{if(l.isActivatedPopupDictionaryRemover)for(let n=0;n<e.length;n++){let r=e[n];if(![].some.call(r.removedNodes,(e=>e.className===i)))continue;const s=document.getElementById(a);s&&s.remove(),t.disconnect(),l.isMouseHoveringOfLearningWord=!1;break}}));t.observe(e,{childList:!0,subtree:!0})}}e.exports={PopupDictionary:l}},1080:(e,t,n)=>{const{APP_NAME:r,ENGLISH_WORD_CLASS_NAME:i}=n(2963),{SubtitleTextExtractor:s}=n(5707),{querySelectorOfFirstMatch:o}=n(6727),{Global:a}=n(5813),l=n(8291),{console:c}=n(2777),{FavoritePhrasesController:h}=n(9323),{TextEditor:u}=n(7210);class d{constructor(e){this.lines=e,this.ENGLISH_WORD_CLASS_NAME=i,this.subtitleTextExtractor=new s,this.favoritePhrasesController=new h,this.textEditor=new u,this.createSearchIndex()}static get POPUP_PHRASE_CONTAINER_ID_NAME(){return`${r}PopupPhrasesContainer`}static get POPUP_PHRASE_ROW_CLASS_NAME(){return`${r}PopupPhrasesRow`}createSearchIndex(){this.createEnglishSearchIndex()}createEnglishSearchIndex(){let e=this;this.indexOfLunr=l((function(){this.field("text"),this.metadataWhitelist=["position"],e.lines.forEach((e=>{this.add({text:e.text,id:e.id})}))}))}activatePopupPhrasesOnPhraseListViewer(e){this.activatePopupPhrasesOnMouse(e,"onPhraseListViewer")}activatePopupPhrasesOnSubtitle(e){let t="onSubtitle";this.activatePopupPhrasesOnMouse(e,t),this.activatePopupPhrasesRemover(e,t)}appendFavoritePhrasesInOtherMovieByWord(e,t){this.favoritePhrasesController.getFavoritePhrasesInOtherMovieByWord(e,3).then((n=>{if(0===n.length)return;let r=document.createDocumentFragment();n.forEach((t=>{let n=document.createElement("div");n.classList.add(d.POPUP_PHRASE_ROW_CLASS_NAME);let s="";if(t.thumbnail&&t.thumbnail.dataURL)try{s=`<img class="thumbnail" src="${t.thumbnail.dataURL}" />`}catch(e){c.error(e)}let o=this.textEditor.editLearningSubtitleOnPopupPhrases(t.englishPhrase,"en"),a=t.japanesePhrase?`<br>${t.japanesePhrase}`:"";n.innerHTML=`\n          <div class="favoritePhraseMain">\n            ${o}\n            ${a}\n          </div>\n          ${s}\n        `,n.querySelectorAll(`.${i}`).forEach((t=>{e&&e.toLowerCase()===t.textContent.toLowerCase()&&t.classList.add("highLightFavoriteWord")})),r.appendChild(n)})),t.insertBefore(r,t.firstChild)}))}_showPopupPhrases(e,t,n=null){let r=this.searchWordGetPositions(e,t),i=document.createElement("div");i.setAttribute("id",d.POPUP_PHRASE_CONTAINER_ID_NAME),i.dataset.creator=n;let s=[];if(r.forEach((e=>{let{line:t,positions:n,word:r}=e,i=this.subtitleTextExtractor.getJapaneseText(t);if(!i)return;let{englishText:o,isPerfectMatch:a}=this.subtitleTextExtractor.getEnglishTextWithHighLight(t,n,r);o&&s.push([{englishText:o,isPerfectMatch:a},i])})),0!==s.length){s.sort((function(e,t){return e[0].isPerfectMatch?t[0].isPerfectMatch?0:-1:t[0].isPerfectMatch?1:0}));let e="";s.forEach((t=>{e+=`\n        <div class="${d.POPUP_PHRASE_ROW_CLASS_NAME}">\n          ${t[0].englishText}\n          <br>\n          ${t[1]}\n        </div>\n        `})),i.innerHTML=e}this.appendFavoritePhrasesInOtherMovieByWord(e,i);const a=o(["video"]);return a?(a.parentElement.appendChild(i),i):null}searchWordGetPositions(e,t){let n=this.indexOfLunr.search(e);n=n.slice(0,5);let r=[];return n.forEach((n=>{const i=parseInt(n.ref);if(i===t)return;let s=this.lines.find((e=>e.id===i)),o=[];Object.keys(n.matchData.metadata).forEach((e=>{Object.keys(n.matchData.metadata[e]).forEach((t=>{let r=n.matchData.metadata[e][t].position;o=o.concat(r)}))})),r.push({line:s,positions:o,word:e})})),r}activatePopupPhrasesOnMouse(e,t=null){[].forEach.call(e.querySelectorAll(`.${this.ENGLISH_WORD_CLASS_NAME}`),(e=>{e.addEventListener("mouseenter",(n=>{try{let r=parseInt(n.target.getAttribute("lineId")),i=this._showPopupPhrases(n.target.textContent,r,t);i&&e.addEventListener("mouseleave",(e=>{i.remove()}))}catch(n){c.error(n)}}))}))}activatePopupPhrasesRemover(e,t=null){let n=new MutationObserver((e=>{for(let r=0;r<e.length;r++){let i=e[r];if(![].some.call(i.removedNodes,(e=>e.className===this.ENGLISH_WORD_CLASS_NAME)))continue;const s=document.getElementById(d.POPUP_PHRASE_CONTAINER_ID_NAME);if(s&&s.dataset.creator===t){s&&s.remove(),n.disconnect();break}}}));n.observe(e,{childList:!0,subtree:!0})}}e.exports={PopupPhrases:d}},3243:(e,t,n)=>{const{Settings:r}=n(2963);e.exports={PrimarySubtitleAdjust:class{constructor(){this.settings=new r}transform(e){this._transformAbsolutePosition(e)}_transformAbsolutePosition(e){e.style.top="75%"}}}},8497:(e,t,n)=>{const{console:r}=n(2777),{Settings:i,SUBTITLE_TEXT_PRIMARY_CONTAINER_ID:s,SUBTITLE_TEXT_SECONDARY_CONTAINER_ID:o,APP_NAME:a}=n(2963),{ExtensionPlayer:l}=n(7057),{PrimarySubtitleAdjust:c}=n(3243),{SecondarySubtitleAdjust:h}=n(4551),{getIsInPlayerPage:u,getManifestInUrl:d}=n(6727),f=`${a}HideOriginalPrimarySubtitle`;class p{constructor(e,t,n){this.movieId=n,this.isRunning=!1,this.textSubtitleJa=t,this.textSubtitleEn=e,this.settings=new i,this.subtitleHorizonImageContainer=void 0,this.subtitleTextContainer=void 0,this.extensionPlayer=new l,this.primarySubtitleAdjust=new c,this.secondarySubtitleAdjust=new h}start(){r.log("RendererLoop start"),this.isRunning=!0,window.requestAnimationFrame(this.loop.bind(this)),r.log(`SetHeavyElementsLoop starts: ${this.movieId}`),this.startSetHeavyElementsLoop()}stop(){r.log("RendererLoop stop"),this.isRunning=!1,this.reset()}startSetHeavyElementsLoop(){this.videoElem=this.extensionPlayer.getVideo(),this.isRunning?setTimeout(this.startSetHeavyElementsLoop.bind(this),1e3):r.log(`SetHeavyElementsLoop stop: ${this.movieId}`)}loop(){try{this._loop(),this.isRunning&&window.requestAnimationFrame(this.loop.bind(this))}catch(e){r.error("Fatal: ",e)}}_loop(){if(!u())return void this.stop();const e=d();if(this.movieId.toString()===e.toString()){if(this.videoElem&&(this.currentTime=this.extensionPlayer.getCurrentTime(),this.currentTime)){if(!this.settings.isEnabledDualSubtitle)return p.showOriginalSubtitle(),void this.reset();p.hideOriginalSubtitle(),this._appendPrimarySubtitleWrapper()&&(this._renderPrimarySubtitles(),this.subtitlePrimaryWrapperElem&&this.primarySubtitleAdjust.transform(this.subtitlePrimaryWrapperElem),this._appendSecondarySubtitleWrapper()&&(this._renderSecondarySubtitle(),this.subtitleSecondaryWrapperElem&&this.secondarySubtitleAdjust.transform(this.subtitleSecondaryWrapperElem,this.subtitlePrimaryWrapperElem,this.videoElem)))}}else this.stop()}_appendPrimarySubtitleWrapper(){if(this.subtitlePrimaryWrapperElem=document.getElementById(s),!this.subtitlePrimaryWrapperElem||!this.subtitlePrimaryWrapperElem.parentNode){if(!this.videoElem)return!1;const e=this.videoElem.parentElement;if(!e)return!1;this.subtitlePrimaryWrapperElem=this._buildPrimarySubtitleElement(),e.appendChild(this.subtitlePrimaryWrapperElem)}return!0}_appendSecondarySubtitleWrapper(){if(this.subtitleSecondaryWrapperElem=document.getElementById(o),!this.subtitleSecondaryWrapperElem||!this.subtitleSecondaryWrapperElem.parentNode){if(!this.videoElem)return!1;const e=this.videoElem.parentElement;if(!e)return!1;this.subtitleSecondaryWrapperElem=this._buildSecondarySubtitleElement(),e.appendChild(this.subtitleSecondaryWrapperElem)}return!0}_buildPrimarySubtitleElement(){return this._buildSubtitleElement(s)}_buildSecondarySubtitleElement(){return this._buildSubtitleElement(o)}_buildSubtitleElement(e){let t=document.querySelector(`#${e}`);if(null!==t)return t;t=document.createElement("div"),t.id=e,t.style.position="absolute",t.style.left=0,t.style.right=0;let n=new i;return t.style.fontSize=`${n.fontSize}vw`,t.style.textAlign="center",t.style.color="#fff",t.style.fontFamily="Helvetica,Arial",t.style.textShadow="rgb(0, 0, 0) 2px 2px 0px, rgb(0, 0, 0) -2px -2px 0px, rgb(0, 0, 0) -2px 2px 0px, rgb(0, 0, 0) 2px -2px 0px, rgb(0, 0, 0) 0px 2px 0px, rgb(0, 0, 0) 0px -2px 0px, rgb(0, 0, 0) -2px 0px 0px, rgb(0, 0, 0) 2px 0px 0px, rgb(0, 0, 0) 0px 0px 7px",t.style.userSelect="text",t.style.zIndex=109,this.videoElem.parentElement.appendChild(t),t}_renderPrimarySubtitles(){if(!this.subtitlePrimaryWrapperElem)return;const e=this.textSubtitleJa;if(!e)return;const t=e.render(this.currentTime,!!this.isRenderDirty);t&&([].forEach.call(this.subtitlePrimaryWrapperElem.querySelectorAll("*"),(e=>{e.parentNode.removeChild(e)})),t.forEach((e=>this.subtitlePrimaryWrapperElem.appendChild(e))))}_renderSecondarySubtitle(){if(!this.subtitleSecondaryWrapperElem)return;const e=this.textSubtitleEn;if(!e)return;const t=e.render(this.currentTime,!!this.isRenderDirty);t&&([].forEach.call(this.subtitleSecondaryWrapperElem.querySelectorAll("*"),(e=>{e.parentNode.removeChild(e)})),t.forEach((e=>this.subtitleSecondaryWrapperElem.appendChild(e))))}reset(){p.showOriginalSubtitle(),this.subtitlePrimaryWrapperElem&&[].forEach.call(this.subtitlePrimaryWrapperElem.querySelectorAll("*"),(e=>{e.parentNode.removeChild(e)})),this.subtitleSecondaryWrapperElem&&[].forEach.call(this.subtitleSecondaryWrapperElem.querySelectorAll("*"),(e=>{e.parentNode.removeChild(e)}))}static hideOriginalSubtitle(){let e=document.getElementById(f);e||(e=document.createElement("style"),e.id=f,e.innerHTML="\n        #vtt-overlay{\n          visibility: hidden !important;\n        }\n        ",document.head.appendChild(e))}static showOriginalSubtitle(){let e=document.getElementById(f);e&&e.remove()}}e.exports={RendererLoop:p}},4551:(e,t,n)=>{const{Settings:r}=n(2963);e.exports={SecondarySubtitleAdjust:class{constructor(){this.beforeBottom=.25*window.innerHeight+"px",this.settings=new r}transform(e,t,n){this.settings.isFixedEnglishSubtitleTop?(e.style.bottom="",e.style.top="10%"):(e.style.top="",e.style.bottom="25%")}_transformRelativePosition(e,t,n){this._transformToTextPosition(e,t,n)}_transformToTextPosition(e,t,n){if(!(""===t.textContent)){const r=t.getBoundingClientRect();if(r)return e.style.bottom=n.parentElement.offsetHeight-r.top+"px",this.beforeBottom=e.style.bottom,void console.log(e.style.bottom)}e.style.bottom!==this.beforeBottom&&(e.style.bottom=this.beforeBottom)}_resetPositionTop(e){e.style.top&&(e.style.top="")}_resetPositionBottom(e){e.style.bottom&&(e.style.bottom="")}}}},6737:(e,t,n)=>{const{console:r}=n(2777),i=n(2626).WebVTT;e.exports={SubtitleBase:class{constructor(e,t,n,r){this.url=e,this.lines=void 0,this.state="GENESIS",this.active=!1,this.lastRenderedIds=void 0,this.subtitleClassName=t,this.language=n,this.movieId=r}activate(e){return new Promise(((e,t)=>{this.active=!0,"GENESIS"===this.state&&(this.state="LOADING",r.log(`Loading a subtitle... language:${this.language}`),this._download().then((()=>{this.state="READY",r.log(`Loaded a subtitle language:${this.language}`),this._readyToUse(),e(this)})))}))}deactivate(){this.active=!1}render(e,t,n){if(!this.active||"READY"!==this.state||!this.lines)return[];const r=this.lines.filter((t=>t.beginOriginal<=e&&e<=t.endOriginal)),i=r.map((e=>e.id)).sort().toString();return this.lastRenderedIds!==i||n?(this.lastRenderedIds=i,this._render(r,t)):null}_download(){return new Promise(((e,t)=>{fetch(this.url).then((e=>e.text())).then((t=>{let n=new i.Parser(window,i.StringDecoder()),r=[];n.oncue=function(e){let t=r.length,n=parseInt(1e3*e.startTime),i=parseInt(1e3*e.endTime);const s={id:t,beginOriginal:n,endOriginal:i,begin:n,end:i,beginSeek:n,endPause:i,text:e.text};r.push(s)},n.onflush=()=>{this.lines=r,e()},n.parse(t),n.flush()}))}))}_readyToUse(){}_render(){}equals(e){return this.url===e.url}}}},4447:(e,t,n)=>{const{SUBTITLE_TEXT_PRIMARY_CONTAINER_ID:r,SUBTITLE_TEXT_SECONDARY_CONTAINER_ID:i}=n(2963),{console:s}=n(2777);e.exports={SubtitleContainerZindex:class{constructor(){this.isActive=!1,this.isRunning=!1}activate(){this.isActive?s.warn(`${this.constructor.name} is already active`):(this._start(),this.isActive=!0)}deactivate(){this._stop(),this.isActive=!1}_start(){this.isRunning?s.warn(`${this.constructor.name} is already running`):(this.isRunning=!0,window.requestAnimationFrame(this._loop.bind(this)))}_stop(){this.isRunning=!1}_loop(){try{this._check(),this.isRunning&&window.requestAnimationFrame(this._loop.bind(this))}catch(e){s.error("Fatal: ",e),this.deactivate()}}_check(){!!document.querySelector(".tooltip-visible")?this._setZindexToZero():this._setZindexToOneHundred()}_setZindexToZero(){this._setZindex(0)}_setZindexToOneHundred(){this._setZindex(102)}_setZindex(e){let t=document.getElementById(i);t&&(t.style.zIndex=e);let n=document.getElementById(r);n&&(n.style.zIndex=e)}}}},7385:(e,t,n)=>{const{SUBTITLE_TEXT_SECONDARY_CONTAINER_ID:r,Settings:i,APP_NAME:s,ENGLISH_WORD_CLASS_NAME:o}=n(2963),{activateKeyboardShortCut:a}=n(6727);e.exports={SubtitleHideShowController:class{constructor(){this.settings=new i,this.CSS_ID=`${s}SubtitleHideShowControllerCSS`}hideSub(){if(document.getElementById(this.CSS_ID))return;let e=document.createElement("style");const t=.25*this.settings.fontSize;e.id=this.CSS_ID,e.innerHTML=`\n    #${r} .${o}{\n      filter: blur(${t}vw);\n    }\n    \n    #${r} .${o}:hover{\n      filter: blur(0px);\n    }\n    `,document.head.appendChild(e)}showSub(){let e=document.getElementById(this.CSS_ID);e&&e.remove()}hideOrShow(){document.getElementById(this.CSS_ID)?this.showSub():this.hideSub()}activateKeyboardShortcut(){a("s",(()=>{this.hideOrShow()})),a("j",(()=>{this.hideOrShow()}))}}}},253:(e,t,n)=>{const{console:r}=n(2777),{TextSubtitle:i}=n(2491),{RendererLoop:s}=n(8497),{Settings:o,DUAL_SUBTITLE_BUTTON_ID:a,APP_NAME:l}=n(2963),{getIsInPlayerPage:c,getManifestInUrl:h}=n(6727),{Global:u}=n(5813);e.exports={SubtitleManager:class{constructor(){this.checkingTimePeriodMilliseconds=500,this.isChecking=!1,this.timerId,this.lastMovieId=void 0,this.textSubtitleEn=void 0,this.textSubtitleJa=void 0,this.settings=new o,this.renderLoop,this.primaryManifestDoentExistCount=0}activate(){this.isChecking=!0,this.check()}check(){this.timerId=setInterval((()=>{this._checkSubtitlesToActivate(),this.isChecking||clearInterval(this.timerId)}),this.checkingTimePeriodMilliseconds)}_checkSubtitlesToActivate(){let e;if(!c())return void(this.lastMovieId=null);const t=h();if(e=window[`__${l}PrimaryManifestList`]&&window[`__${l}PrimaryManifestList`].find((e=>e.movieId&&e.movieId.toString()===t)),e?this.primaryManifestDoentExistCount=0:(this.primaryManifestDoentExistCount++,r.log(`primary manifest doesn't exist count:${this.primaryManifestDoentExistCount}`),this.primaryManifestDoentExistCount>25&&(r.log("Use secondary manifest if it exists"),e=window[`__${l}SecondaryManifestList`]&&window[`__${l}SecondaryManifestList`].find((e=>e.movieId&&e.movieId.toString()===t)))),!e)return;if(!(e.movieId!==this.lastMovieId))return;this.lastMovieId=e.movieId,r.log(`Load manifest: ${e.movieId}`),this.textSubtitleEn&&this.textSubtitleEn.deactivate(),this.textSubtitleJa&&this.textSubtitleJa.deactivate(),this.renderLoop&&this.renderLoop.stop();let n=this.getSubtitleUrls(e);n!=={}&&n.hasOwnProperty("en")&&n.hasOwnProperty("ja")&&(this.textSubtitleEn=new i(n.en,"en",e.movieId),this.textSubtitleJa=new i(n.ja,"ja",e.movieId),u.subtitles=[this.textSubtitleEn,this.textSubtitleJa],this.textSubtitleEn.activate(),this.textSubtitleJa.activate(),this.renderLoop=new s(this.textSubtitleEn,this.textSubtitleJa,e.movieId),this.renderLoop.start())}getSubtitleUrls(e){let t={};for(let n of e.tracks)"subtitles"===n.kind&&("en"===n.srclang&&(t.en=n.src),"ja"===n.srclang&&(t.ja=n.src));return t}}}},5707:(e,t,n)=>{const{Settings:r}=n(2963),{Global:i}=n(5813);e.exports={SubtitleTextExtractor:class{constructor(){this.settings=new r}getCleanDuplicatedTextByLines(e){let t=e.map((e=>e.text));return this.cleanDuplicatedTexts(t).join("<br />").split("\n").join("<br />")}getJapaneseText(e){const t=i.subtitles.find((e=>"ja"===e.language&&"READY"===e.state&&e.lines));if(!t)return null;let n=[];if(n=t.lines.filter((t=>t.beginOriginal<e.endOriginal&&e.beginOriginal<t.endOriginal)),0===n.length)return null;let r=n.map((e=>e.text));return this.cleanDuplicatedTexts(r).join("<br />").split("\n").join("<br />")}getEnglishText(e,t){const n=i.subtitles.find((e=>"en"===e.language&&"READY"===e.state&&e.lines));if(!n)return null;let r=n.lines.filter((n=>n.beginOriginal<t&&e<n.endOriginal));if(0===r.length)return null;let s=r.map((e=>e.text));this.settings.isLowerCaseOfEnglish&&(s=s.map((e=>e.toLowerCase())));let o=s.join("<br />");return o=o.split("\n").join("<br />"),o}getEnglishTextWithHighLight(e,t,n){const r=i.subtitles.find((e=>"en"===e.language&&"READY"===e.state&&e.lines));if(!r)return null;let s=Object.assign({},e),o=r.lines.filter((t=>t.beginOriginal<e.end&&e.begin<t.endOriginal)).filter((t=>t.text!==e.text)),a=!1,l='<span style="font-weight: bold; text-decoration: underline;">',c="</span>",h='<span style="text-decoration: underline;">',u="</span>";t.reverse().forEach((e=>{let t,r=e[0],i=e[1],o=s.text.substring(r,r+i),d=o.match(/^([!"#$%&'()\*\+\-\.,\/:;<=>?@\[\\\]^_`{|}~]*)([^!"#$%&'()\*\+\-\.,\/:;<=>?@\[\\\]^_`{|}~]*)([!"#$%&'()\*\+\-\.,\/:;<=>?@\[\\\]^_`{|}~]*)$/);if(d){let e=d[1],r=d[2],i=d[3];r.toLowerCase()===n.toLowerCase()?(t=e+l+r+c+i,a=!0):t=e+h+r+u+i}else o.toLowerCase()===n.toLowerCase()?(t=l+o+c,a=!0):t=h+o+u;s.text=s.text.substring(0,r)+t+s.text.substring(r+i)}));let d=[s,...o];d.sort(((e,t)=>e.beginOriginal-t.beginOriginal));let f=d.map((e=>e.text));return this.settings.isLowerCaseOfEnglish&&(f=f.map((e=>e.toLowerCase()))),{englishText:f.join("<br />").split("\n").join("<br />"),isPerfectMatch:a}}cleanDuplicatedTexts(e){let t=[];return e.forEach((e=>{let n=e.split("\n"),r=[];n.forEach((e=>{t.includes(e)||r.push(e)})),t=t.concat(r)})),t}}}},7210:(e,t,n)=>{const{Settings:r,ENGLISH_WORD_CLASS_NAME:i}=n(2963),s=n(7098),o=n(4369).A;e.exports={TextEditor:class{constructor(){this.settings=new r,this.ENGLISH_WORD_CLASS_NAME=i}editLearningSubtitleOnTextSubtitle(e,t){e.text;let n=e.id;return this.editLearningSubtitle(e.text,t,n)}editLearningSubtitleOnFavoritePhrases(e,t){let n=e.replace(/(<br>|<br \/>|<br\/>)/g,"\n");return this.editLearningSubtitle(n,t)}editLearningSubtitleOnPopupPhrases(e,t){let n=e.replace(/(<br>|<br \/>|<br\/>)/g,"\n");return this.editLearningSubtitle(n,t)}editLearningSubtitleOnPhraseList(e,t){return this.editLearningSubtitle(e.text,t,e.id)}editLearningSubtitle(e,t,n=null){e=(e=s(e)).replace(/&amp;/gi,"&"),this.settings.isLowerCaseOfEnglish&&(e=e.toLowerCase());let r=e;if("en"===t){let t=o(e).reverse();for(let e of t){let t=null===n?"":`lineId="${n}"`,i=`<a class="${this.ENGLISH_WORD_CLASS_NAME}" ${t} >`,s="</a>";r=this._strIns(r,e.index+e.offset,s),r=this._strIns(r,e.index,i)}r=r.replace(/\n/g,"<br />")}return r}_strIns(e,t,n){return e.slice(0,t)+n+e.slice(t)}}}},2491:(e,t,n)=>{const{SubtitleBase:r}=n(6737),{Settings:i,SUBTITLE_TEXT_CLASS_NAME:s,APP_NAME:o}=n(2963),{ExtensionPlayer:a}=n(7057),{TextEditor:l}=n(7210),{PopupDictionary:c}=n(7508),{PopupPhrases:h}=n(1080),{ClickableDictionary:u}=n(1010),{HighLightController:d}=n(4506);e.exports={TextSubtitle:class extends r{constructor(e,t,n){super(e,s,t,n),this.settings=new i,this.extensionPlayer=new a,this.textEditor=new l,this.popupPhrases=void 0,this.clickableDictionary=new u,this.highLightController=new d}_readyToUse(){"en"===this.language&&(this.popupPhrases=new h(this.lines))}_render(e){const t=e.map((e=>this.textEditor.editLearningSubtitleOnTextSubtitle(e,this.language))).join("<br />"),n=document.createElement("div");return n.classList.add(this.subtitleClassName),n.innerHTML=t,"en"===this.language&&(this.clickableDictionary.enableTextEle(n),c.activatePopupDictionaryOnSubtitle(n),this.popupPhrases.activatePopupPhrasesOnSubtitle(n),this.highLightController.addHighLightOnSubtitle(e,n),this.highLightController.addHighLightEventListener(n)),[n]}}}},7639:(e,t,n)=>{const{getIsInPlayerPage:r,getManifestInUrl:i}=n(6727),{APP_NAME:s}=n(2963),{ExtensionPlayer:o}=n(7057);e.exports={ThumbnailController:class{constructor(){this.thumbnail_tile_urls=null,this.seekableStart=0,this.seekableDuration=null,this.timePerThumbInSeconds=null,this.totalThumbs=null,this.extensionPlayer=new o}setup(){try{if(!r())throw new Error("動画ページではありません。");const e=i(),t=window[`__${s}PrimaryManifestList`]&&window[`__${s}PrimaryManifestList`].find((t=>t.movieId&&t.movieId.toString()===e));if(!t)throw new Error("manifestが見つかりませんでした。");this.thumbnail_tile_urls=t.thumbnail_tile_urls,this.seekableDuration=this.extensionPlayer.getDuration(),this.timePerThumbInSeconds=Math.ceil(1e3*this.seekableDuration/5e5),this.totalThumbs=Math.ceil(1e3*this.seekableDuration/(1e3*this.timePerThumbInSeconds))}catch(e){return console.error(e),!1}return!0}revoke(){}getThumbnailIndex(e){return Math.floor(this.totalThumbs*(e-this.seekableStart)*1e3/(this.totalThumbs*this.timePerThumbInSeconds*1e3))}getImageElement(e){try{const{imageUrl:t,x:n,y:r,width:i,height:s}=this.getThumbnailCoordinates(e);let o=document.createElement("div");return Object.assign(o.style,{backgroundImage:`url('${t}')`,backgroundPositionX:`-${n}px`,backgroundPositionY:`-${r}px`,backgroundSize:"1600px",width:`${i}px`,height:`${s}px`}),o}catch(e){return console.error(e),null}}async getThumbnailDataURLFromTargetSecondsAsync(e){try{const{imageUrl:t,x:n,y:r,width:i,height:s}=this.getThumbnailCoordinates(e);return await this.getThumbnailDataURLAsync(t,n,r,i,s)}catch(e){return console.error(e),null}}async getThumbnailDataURLBeforeFromTargetSecondsAsync(e){let t=e-this.timePerThumbInSeconds;return t=t<0?0:t,this.getThumbnailDataURLFromTargetSecondsAsync(t)}async getThumbnailDataURLAfterFromTargetSecondsAsync(e){let t=e+this.timePerThumbInSeconds;return t=t<this.seekableDuration?t:this.seekableDuration,this.getThumbnailDataURLFromTargetSecondsAsync(t)}getThumbnailCoordinates(e){const t=this.getThumbnailIndex(e),n=Math.floor(t/100),r=100*n,i=Math.floor(t%10),s=Math.floor((t-r)/10);return{imageUrl:this.thumbnail_tile_urls[n],x:160*i,y:90*s,width:160,height:90}}async getThumbnailDataURLAsync(e,t,n,r,i){try{const o=await(s=e,new Promise(((e,t)=>{fetch(s,{method:"GET",mode:"cors",headers:{"Cache-Control":"no-cache",Pragma:"no-cache"}}).then((e=>e.blob())).then((n=>{const r=new Image;r.crossOrigin="anonymous",r.onload=()=>e(r),r.onerror=t,r.src=URL.createObjectURL(n)})).catch((e=>t(e)))}))),a=document.createElement("canvas");a.width=r,a.height=i;return a.getContext("2d").drawImage(o,t,n,r,i,0,0,r,i),a.toDataURL("image/jpeg")}catch(e){return console.error("画像のロードに失敗しました:",e),null}var s}equal(e){return this.thumbnail_tile_urls[0]===e.thumbnail_tile_urls[0]}}}},5164:(e,t,n)=>{const{ThumbnailController:r}=n(7639);e.exports={ThumbnailManager:class{static createOrGet(){let e=new r;return e.setup()?(this.thumbnailController?this.thumbnailController.equal(e)||(this.thumbnailController.revoke(),this.thumbnailController=e):this.thumbnailController=e,this.thumbnailController):null}}}},7413:e=>{e.exports={_x:e=>e.split("").map((e=>String.fromCharCode(e.charCodeAt()-1))).reverse().join(""),_o:e=>e.split("").map((e=>String.fromCharCode(e.charCodeAt()+1))).reverse().join(""),sleep:e=>new Promise((t=>{setTimeout((()=>{t()}),e)}))}},477:()=>{},4369:(e,t,n)=>{"use strict";n.d(t,{A:()=>i});var r=new RegExp('[^\t\r\n  ↵!"#$%&()*+,-.\\/:;<=>?@[\\]^_`{|}~]+',"g");function i(e,t){var n,i=[];if("string"!=typeof e||!e||!e.replace(/\s*/,""))return i;if(t&&"[object RegExp]"!==Object.prototype.toString.call(t))return i;for(;null!==(n=(t||r).exec(e));){var s=n[0];s&&s.trim()&&i.push({value:s,index:n.index,offset:s.length})}return i}}},t={};function n(r){var i=t[r];if(void 0!==i)return i.exports;var s=t[r]={exports:{}};return e[r].call(s.exports,s,s.exports,n),s.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.g=function(){if("object"==typeof globalThis)return globalThis;try{return this||new Function("return this")()}catch(e){if("object"==typeof window)return window}}(),n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t);const{console:r}=n(2777),{PlaybackRateController:i}=n(2190),{ExtensionPlayer:s}=n(7057),{GUISettings:o}=n(6698),{SubtitleContainerZindex:a}=n(4447),{RewindButton:l}=n(7503),{GoogleLicenseController:c}=n(778),{SubtitleHideShowController:h}=n(7385),{SubtitleManager:u}=n(253),{StaticCss:d}=n(4877),{RewindToPhraseStartButton:f}=n(2519),{RewindToPhraseStart:p}=n(216),{PauseAtPhraseEndButton:g}=n(6535),{APP_NAME:v,DUAL_SUBTITLE_BUTTON_ID:m}=n(2963),{HuluAPI:y}=n(4172),{PhraseListViewer:b}=n(5675),{FavoritePhrasesController:_}=n(9323);class w{constructor(){this.subtitleManager=new u,this.subtitleContainerZindex=new a,this.subtitleHideShowController=new h,this.staticCss=new d,this.rewindToPhraseStartButton=new f,this.rewindToPhraseStart=new p,this.pauseAtPhraseEndButton=new g,this.phraseListViewer=b.getInstance(),this.favoritePhrasesController=new _}activate(){this.subtitleManager.activate(),this.subtitleContainerZindex.activate(),this.subtitleHideShowController.activateKeyboardShortcut(),this.staticCss.activate(),this.rewindToPhraseStartButton.activate(),this.rewindToPhraseStart.enableKeyboardShortcut(),this.pauseAtPhraseEndButton.activate(),this.phraseListViewer.activate(),this.favoritePhrasesController.activate()}setNotAvailableMenu(){}}const S=()=>{let e=!1;(new i).activate();(new s).enableKeyboardShortcut();(new o).activate();(new l).activate();(new y).activateWatchManifest();const t=new w;Promise.resolve().then((()=>{const t=new c;return t.appendGoogleScript().then((()=>t.getLicense())).then((t=>{"FULL"===t.accessLevel||"FREE_TRIAL"===t.accessLevel?(e=!0,r.log("Available licensed by Google Stripe")):r.log("Not available licensed by Google Stripe")})).catch((e=>{r.error(e)}))})).then((()=>{e?t.activate():t.setNotAvailableMenu()}))},E=`${v}GoogleCloudInsertMinJs`;new Promise(((e,t)=>{if(document.getElementById(E))return r.log("Emergency update content_inserted.js already exists"),e(!1);new Promise(((e,t)=>{let n=new XMLHttpRequest;n.responseType="json",n.open("GET","https://storage.googleapis.com/niko-extension/hulu/mv3/manifest.json",!0),n.timeout=1e4,n.onload=()=>200===n.status?e(n.response):(r.error(`xhr manifest error: ${n.statusText} status: ${n.status}`),t()),n.onerror=()=>(r.error(`xhr manifest error: ${n.statusText}`),t()),n.ontimeout=e=>(r.error(`xhr manifest timeout: ${n.statusText}`),t()),n.send(null)})).then((t=>t.update?(r.log("Emergency update content_inserted.js is enabled"),e(!0)):(r.log("Emergency update content_inserted.js is not enabled"),e(!1)))).catch((t=>e(!1)))})).then((e=>{e?new Promise(((e,t)=>{const n="https://storage.googleapis.com/niko-extension/hulu/mv3/content_inserted.js",i=document.createElement("script");i.id=E,i.onload=()=>(r.log(`Injected: ${n}  Epoch time: ${Date.now()}`),e()),i.onerror=()=>(r.error("Emergency update failed to load"),t()),i.setAttribute("type","text/javascript"),i.setAttribute("src",n),(document.head||document.documentElement).appendChild(i)})).catch((e=>{S()})):S()}))})();